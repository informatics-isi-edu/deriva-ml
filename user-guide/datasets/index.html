
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://informatics-isi-edu.github.io/deriva-ml/user-guide/datasets/">
      
      
        <link rel="prev" href="../identifiers/">
      
      
        <link rel="next" href="../features/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Datasets - DerivaML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datasets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DerivaML" class="md-header__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DerivaML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Datasets
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DerivaML" class="md-nav__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    DerivaML
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview of DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_ml_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installing deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identifiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identifying things in deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dataset-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset Types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Datasets
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-element-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset Element Types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-members-to-a-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Members to a Dataset
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing-dataset-members" class="md-nav__link">
    <span class="md-ellipsis">
      
        Listing Dataset Members
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Datasets
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splitting-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Splitting Datasets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Splitting Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-splitting-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Splitting Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simple-random-split" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simple Random Split
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labeled-splits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Labeled Splits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stratified-splitting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stratified Splitting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-selection-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Selection Functions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dry-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dry Run
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command-Line Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto-Detection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset Versioning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset Versioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-versions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with Versions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version Snapshots
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#downloading-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Downloading Datasets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Downloading Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-bag-export-traverses-related-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Bag Export Traverses Related Tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-download-in-executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic Download in Executions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-datasetbag" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with DatasetBag
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assets-in-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Assets in Datasets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assets in Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accessing-assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Accessing Assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Asset Organization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restructuring-assets-for-ml-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restructuring Assets for ML Workflows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restructuring Assets for ML Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grouping-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grouping Options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#symlinks-vs-copies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Symlinks vs Copies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-type-selection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Type Selection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-missing-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Missing Values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prediction-scenarios-datasets-without-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prediction Scenarios (Datasets Without Types)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-assets-through-foreign-key-paths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finding Assets Through Foreign Key Paths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-multiple-feature-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Multiple Feature Values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enforcing-vocabulary-based-grouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enforcing Vocabulary-Based Grouping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finding-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finding Datasets
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleting-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deleting Datasets
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file-assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog Annotations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring an Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydra-zen-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hydra-zen Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../running-models-and-notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Models and Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using DerivaML with Jupyter Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sample Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sample Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Library Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Library Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Classes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Classes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/deriva_ml_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/deriva_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaModel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Datasets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset_bag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DatasetBag
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset_split/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Splitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset_aux_classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Auxiliary Classes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Execution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/execution_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExecutionConfiguration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/deriva_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Definitions & Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dataset-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset Types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating Datasets
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-element-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset Element Types
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-members-to-a-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding Members to a Dataset
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#listing-dataset-members" class="md-nav__link">
    <span class="md-ellipsis">
      
        Listing Dataset Members
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nested-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Datasets
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splitting-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Splitting Datasets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Splitting Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-splitting-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Splitting Works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simple-random-split" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simple Random Split
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labeled-splits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Labeled Splits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stratified-splitting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stratified Splitting
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-selection-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Selection Functions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dry-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dry Run
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-line-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command-Line Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-detection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Auto-Detection
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-versioning" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset Versioning
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset Versioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#working-with-versions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with Versions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version-snapshots" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version Snapshots
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#downloading-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Downloading Datasets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Downloading Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-bag-export-traverses-related-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Bag Export Traverses Related Tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-download-in-executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic Download in Executions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-with-datasetbag" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working with DatasetBag
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#assets-in-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Assets in Datasets
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Assets in Datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accessing-assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Accessing Assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-organization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Asset Organization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restructuring-assets-for-ml-workflows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restructuring Assets for ML Workflows
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restructuring Assets for ML Workflows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grouping-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Grouping Options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#symlinks-vs-copies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Symlinks vs Copies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-type-selection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom Type Selection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-missing-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Missing Values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prediction-scenarios-datasets-without-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prediction Scenarios (Datasets Without Types)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finding-assets-through-foreign-key-paths" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finding Assets Through Foreign Key Paths
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-multiple-feature-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Handling Multiple Feature Values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enforcing-vocabulary-based-grouping" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enforcing Vocabulary-Based Grouping
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#finding-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Finding Datasets
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleting-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deleting Datasets
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="datasets">Datasets</h1>
<p>When working with ML models, it is often convenient to collect various input data into named, identifiable collections called datasets. DerivaML provides a flexible set of mechanisms for creating and manipulating datasets.</p>
<p>A dataset is a versioned collection of objects within a DerivaML catalog. Datasets can be heterogeneous, containing sets of different object types. It's possible to have an object referenced in multiple ways - for example, a collection of subjects and a collection of observations that reference those subjects. DerivaML manages these relationships and makes it possible to view them from all paths.</p>
<p>As with any other object in DerivaML, each dataset is identified by its <em>Resource Identifier</em> (RID). In addition, a dataset may have one or more dataset types and a version.</p>
<h2 id="dataset-types">Dataset Types</h2>
<p>Dataset types are assigned from a controlled vocabulary called <code>Dataset_Type</code>. You can define new dataset types as needed:</p>
<pre><code class="language-python">from deriva_ml import MLVocab

ml.add_term(MLVocab.dataset_type, &quot;TrainingSet&quot;, description=&quot;Dataset for model training&quot;)
ml.add_term(MLVocab.dataset_type, &quot;ValidationSet&quot;, description=&quot;Dataset for model validation&quot;)
</code></pre>
<p>When you create a dataset, you can provide as many dataset types as required to streamline organizing and discovering them in your code.</p>
<h2 id="creating-datasets">Creating Datasets</h2>
<p>The most common way to create a dataset is within an execution, which provides provenance tracking:</p>
<pre><code class="language-python">from deriva_ml import DerivaML
from deriva_ml.execution import ExecutionConfiguration

# Connect to the catalog
ml = DerivaML(&quot;deriva.example.org&quot;, &quot;my_catalog&quot;)

# Create a workflow
workflow = ml.create_workflow(
    name=&quot;Data Preparation Workflow&quot;,
    workflow_type=&quot;Data Processing&quot;,
    description=&quot;Prepares training and validation datasets&quot;
)

# Create an execution configuration
config = ExecutionConfiguration(
    workflow=workflow,
    description=&quot;Create datasets for experiment&quot;
)

# Create datasets within the execution context
with ml.create_execution(config) as exe:
    training_dataset = exe.create_dataset(
        dataset_types=[&quot;TrainingSet&quot;, &quot;Image&quot;],
        description=&quot;Training images for classification model&quot;
    )

    validation_dataset = exe.create_dataset(
        dataset_types=[&quot;ValidationSet&quot;, &quot;Image&quot;],
        description=&quot;Validation images for model evaluation&quot;
    )

# Upload any outputs after context exits
exe.upload_execution_outputs()
</code></pre>
<p>You can also create datasets directly through the DerivaML instance:</p>
<pre><code class="language-python">dataset = ml.create_dataset(
    dataset_types=[&quot;ExperimentData&quot;],
    description=&quot;Raw experimental data&quot;
)
</code></pre>
<h2 id="dataset-element-types">Dataset Element Types</h2>
<p>A dataset may consist of many different types of objects. In general, any element from the domain model may be included in a dataset. To see what element types are available:</p>
<pre><code class="language-python"># List available element types
element_types = dataset.list_dataset_element_types()
for table in element_types:
    print(table.name)
</code></pre>
<p>To add a new element type that can be included in datasets:</p>
<pre><code class="language-python"># Add Subject table as a valid dataset element type
ml.add_dataset_element_type(&quot;Subject&quot;)
</code></pre>
<h2 id="adding-members-to-a-dataset">Adding Members to a Dataset</h2>
<p>Once you have a dataset, you can add members using their RIDs:</p>
<pre><code class="language-python"># Add individual members by RID
dataset.add_dataset_members(members=[&quot;1-abc123&quot;, &quot;1-def456&quot;, &quot;1-ghi789&quot;])

# Add members with execution tracking
dataset.add_dataset_members(
    members=subject_rids,
    execution_rid=execution.execution_rid
)
</code></pre>
<h2 id="listing-dataset-members">Listing Dataset Members</h2>
<p>To see what's in a dataset:</p>
<pre><code class="language-python"># List all members of current version
members = dataset.list_dataset_members()
for member in members:
    print(f&quot;Table: {member['table']}, RID: {member['rid']}&quot;)

# List members of a specific version
members_v1 = dataset.list_dataset_members(version=&quot;1.0.0&quot;)
</code></pre>
<h2 id="nested-datasets">Nested Datasets</h2>
<p>Datasets can contain other datasets, forming hierarchies:</p>
<pre><code class="language-python"># Create a parent dataset
parent_dataset = ml.create_dataset(
    dataset_types=[&quot;ExperimentCollection&quot;],
    description=&quot;Collection of experiment datasets&quot;
)

# Add child datasets as members
parent_dataset.add_dataset_members(
    members=[training_dataset.dataset_rid, validation_dataset.dataset_rid]
)

# List child datasets
children = parent_dataset.list_dataset_children()

# List parent datasets
parents = training_dataset.list_dataset_parents()
</code></pre>
<h2 id="splitting-datasets">Splitting Datasets</h2>
<p>A common ML workflow is splitting a dataset into training and testing subsets. DerivaML provides the <a class="autorefs autorefs-internal" title="split_dataset" href="../../code-docs/dataset_split/#deriva_ml.dataset.split.split_dataset"><code>split_dataset</code></a> function for this, with full provenance tracking. The API follows scikit-learn conventions (<code>test_size</code>, <code>train_size</code>, <code>shuffle</code>, <code>seed</code>, <code>stratify</code>) while creating a proper dataset hierarchy in the catalog.</p>
<h3 id="how-splitting-works">How Splitting Works</h3>
<p><code>split_dataset</code> creates a three-level dataset hierarchy:</p>
<pre><code>Split (parent, type: &quot;Split&quot;)
├── Training (child, type: &quot;Training&quot;)
└── Testing (child, type: &quot;Testing&quot;)
</code></pre>
<p>The entire operation is performed within an execution context, so the split is fully traceable back to the source dataset, the parameters used, and the code that ran it.</p>
<h3 id="simple-random-split">Simple Random Split</h3>
<p>The simplest case splits a dataset into training and testing subsets by randomly shuffling members:</p>
<pre><code class="language-python">from deriva_ml.dataset.split import split_dataset

# 80/20 random split (default)
result = split_dataset(ml, source_dataset_rid, test_size=0.2, seed=42)

print(f&quot;Split:    {result['split']}&quot;)
print(f&quot;Training: {result['training']} ({result['train_count']} samples)&quot;)
print(f&quot;Testing:  {result['testing']} ({result['test_count']} samples)&quot;)
</code></pre>
<p>You can also specify absolute counts instead of fractions:</p>
<pre><code class="language-python"># Fixed-count split
result = split_dataset(
    ml, source_dataset_rid,
    train_size=400,
    test_size=100,
    seed=42,
)
</code></pre>
<h3 id="labeled-splits">Labeled Splits</h3>
<p>When your experiment needs ground truth labels in both training and testing sets (for evaluation, ROC curves, etc.), add the <code>"Labeled"</code> dataset type:</p>
<pre><code class="language-python">result = split_dataset(
    ml, source_dataset_rid,
    test_size=0.2,
    seed=42,
    training_types=[&quot;Labeled&quot;],
    testing_types=[&quot;Labeled&quot;],
)
</code></pre>
<p>This creates Training and Testing datasets with both their default type and the additional <code>"Labeled"</code> type, making them easy to discover and distinguish from unlabeled splits.</p>
<h3 id="stratified-splitting">Stratified Splitting</h3>
<p>Stratified splitting maintains the class distribution of a column across both splits. This requires denormalizing the dataset to access the column values:</p>
<pre><code class="language-python">result = split_dataset(
    ml, source_dataset_rid,
    test_size=0.2,
    seed=42,
    stratify_by_column=&quot;Image_Classification_Image_Class&quot;,
    include_tables=[&quot;Image&quot;, &quot;Image_Classification&quot;],
)
</code></pre>
<p>The <code>stratify_by_column</code> uses the denormalized column name format: <code>{TableName}_{ColumnName}</code>. The <code>include_tables</code> parameter specifies which tables to join during denormalization.</p>
<p>!!! note
    Stratified splitting requires scikit-learn to be installed. It is imported lazily, so the base <code>split_dataset</code> function works without it for random splits.</p>
<h3 id="custom-selection-functions">Custom Selection Functions</h3>
<p>For advanced splitting logic (balanced sampling, filtered subsets, etc.), provide a custom selection function:</p>
<pre><code class="language-python">import numpy as np

def balanced_selector(df, train_size, test_size, seed):
    &quot;&quot;&quot;Select equal numbers from each class.&quot;&quot;&quot;
    rng = np.random.default_rng(seed)
    label_col = &quot;Image_Classification_Image_Class&quot;
    classes = df[label_col].unique()
    train_idx, test_idx = [], []
    for cls in classes:
        cls_indices = df.index[df[label_col] == cls].to_numpy()
        rng.shuffle(cls_indices)
        per_class_train = train_size // len(classes)
        per_class_test = test_size // len(classes)
        train_idx.extend(cls_indices[:per_class_train])
        test_idx.extend(cls_indices[per_class_train:per_class_train + per_class_test])
    return np.array(train_idx), np.array(test_idx)

result = split_dataset(
    ml, source_dataset_rid,
    test_size=100,
    selection_fn=balanced_selector,
    include_tables=[&quot;Image&quot;, &quot;Image_Classification&quot;],
)
</code></pre>
<p>A selection function must conform to the <a class="autorefs autorefs-internal" title="SelectionFunction" href="../../code-docs/dataset_split/#deriva_ml.dataset.split.SelectionFunction"><code>SelectionFunction</code></a> protocol: it receives a DataFrame, train/test sizes, and a seed, and returns <code>(train_indices, test_indices)</code> as numpy arrays.</p>
<h3 id="dry-run">Dry Run</h3>
<p>Use <code>dry_run=True</code> to preview what would happen without modifying the catalog:</p>
<pre><code class="language-python">result = split_dataset(
    ml, source_dataset_rid,
    test_size=0.2,
    dry_run=True,
)
print(f&quot;Would create: {result['train_count']} train, {result['test_count']} test&quot;)
print(f&quot;Strategy: {result['strategy']}&quot;)
</code></pre>
<h3 id="command-line-interface">Command-Line Interface</h3>
<p>The <code>deriva-ml-split-dataset</code> CLI provides the same functionality from the command line:</p>
<pre><code class="language-bash"># Simple random split
deriva-ml-split-dataset --hostname localhost --catalog-id 9 \
    --dataset-rid 28D0 --test-size 0.2

# Stratified split
deriva-ml-split-dataset --hostname localhost --catalog-id 9 \
    --dataset-rid 28D0 --test-size 0.2 \
    --stratify-by-column Image_Classification_Image_Class \
    --include-tables Image,Image_Classification

# Dry run
deriva-ml-split-dataset --hostname localhost --catalog-id 9 \
    --dataset-rid 28D0 --dry-run
</code></pre>
<h3 id="auto-detection">Auto-Detection</h3>
<p>When the source dataset has members in only one element table, <code>split_dataset</code> auto-detects which table to split. If the dataset has members in multiple tables, you must specify <code>element_table</code>:</p>
<pre><code class="language-python">result = split_dataset(
    ml, source_dataset_rid,
    test_size=0.2,
    element_table=&quot;Image&quot;,  # Required when dataset has multiple element types
)
</code></pre>
<h2 id="dataset-versioning">Dataset Versioning</h2>
<p>Every dataset is assigned a version number using semantic versioning (<code>major.minor.patch</code>):</p>
<ul>
<li><strong>Major</strong>: Changes when there is a schema change to any object in the dataset</li>
<li><strong>Minor</strong>: Changes when new elements are added to a dataset</li>
<li><strong>Patch</strong>: Changes for minor alterations, such as adding comments or data cleaning</li>
</ul>
<p>DerivaML automatically assigns version <code>0.1.0</code> when a dataset is first created and increments the minor part whenever new elements are added.</p>
<h3 id="working-with-versions">Working with Versions</h3>
<pre><code class="language-python"># Get current version
current = dataset.current_version
print(f&quot;Current version: {current}&quot;)  # e.g., &quot;1.2.3&quot;

# Get version history
history = dataset.dataset_history()
for entry in history:
    print(f&quot;Version {entry.version}: {entry.description} at {entry.timestamp}&quot;)

# Increment version
from deriva_ml.dataset.aux_classes import VersionPart

new_version = dataset.increment_dataset_version(
    component=VersionPart.minor,
    description=&quot;Added new training samples&quot;
)
</code></pre>
<h3 id="version-snapshots">Version Snapshots</h3>
<p>Each version is tied to a catalog snapshot, ensuring that the values in the dataset are the values that were present when the version was created. This provides reproducibility for ML experiments.</p>
<pre><code class="language-python"># Get a dataset bound to a specific version
versioned_dataset = dataset.set_version(&quot;1.0.0&quot;)

# Access members at that version
members = versioned_dataset.list_dataset_members()
</code></pre>
<h2 id="downloading-datasets">Downloading Datasets</h2>
<p>Datasets can be downloaded as BDBag archives for offline use or sharing:</p>
<pre><code class="language-python">from deriva_ml.dataset.aux_classes import DatasetSpec

# Download the current version
bag = dataset.download_dataset_bag()

# Download a specific version
bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;)

# Download with materialization (fetches all referenced files)
bag = dataset.download_dataset_bag(materialize=True)
</code></pre>
<h3 id="how-bag-export-traverses-related-tables">How Bag Export Traverses Related Tables</h3>
<p>When exporting a dataset as a BDBag, DerivaML follows foreign key relationships from each member table to include related data (e.g., vocabulary terms, device records). However, it stops traversing when it reaches another <strong>dataset element type</strong> — a table that has its own <code>Dataset_X</code> association table — if that element type has no members in this dataset.</p>
<p>For example, consider a catalog where <code>CGM_Blood_Glucose</code> has a foreign key to <code>Observation</code>, which is referenced by <code>Image</code>, which links to <code>Image_Diagnosis</code>. If a dataset contains only <code>CGM_Blood_Glucose</code> records, the export will <em>not</em> follow the path through <code>Observation → Image → Image_Diagnosis</code>, because <code>Observation</code> is itself a dataset element type with no members in this dataset. If <code>Observation</code> records were needed, they would be included as explicit dataset members and reached through their own <code>Dataset_Observation</code> association path.</p>
<p>Non-element-type tables (tables without a <code>Dataset_X</code> association, such as <code>Device</code>) are traversed normally regardless of dataset membership.</p>
<p>This boundary-aware traversal ensures that bag exports include only the data relevant to the dataset's actual members, avoiding expensive multi-table joins that would return empty results.</p>
<h3 id="automatic-download-in-executions">Automatic Download in Executions</h3>
<p>When creating an execution with dataset specifications, you can download datasets within the execution context:</p>
<pre><code class="language-python">from deriva_ml.dataset import DatasetSpec

config = ExecutionConfiguration(
    datasets=[
        DatasetSpec(rid=&quot;1-abc123&quot;, version=&quot;1.0.0&quot;),
        DatasetSpec(rid=&quot;1-def456&quot;, materialize=True),
    ],
    workflow=workflow,
    description=&quot;Process datasets&quot;
)

with ml.create_execution(config) as exe:
    # Download datasets as needed
    bag = exe.download_dataset_bag(DatasetSpec(rid=&quot;1-abc123&quot;))
    print(f&quot;Dataset available at {bag.bag_path}&quot;)
</code></pre>
<h2 id="working-with-datasetbag">Working with DatasetBag</h2>
<p>Once downloaded, a dataset is represented as a <a class="autorefs autorefs-internal" title="DatasetBag" href="../../code-docs/dataset_bag/#deriva_ml.dataset.dataset_bag.DatasetBag"><code>DatasetBag</code></a> object:</p>
<pre><code class="language-python"># Access dataset metadata
print(f&quot;RID: {bag.dataset_rid}&quot;)
print(f&quot;Version: {bag.version}&quot;)

# Get tables as DataFrames
subjects_df = bag.get_table_as_dataframe(&quot;Subject&quot;)
images_df = bag.get_table_as_dataframe(&quot;Image&quot;)

# Access the local path
print(f&quot;Dataset path: {bag.path}&quot;)
</code></pre>
<h2 id="assets-in-datasets">Assets in Datasets</h2>
<p>Assets are files stored in the DerivaML object store (Hatrac). Each asset is characterized by:</p>
<ul>
<li>A versioned URL</li>
<li>Length (file size)</li>
<li>MD5 checksum</li>
<li>Asset type (from the <code>Asset_Type</code> vocabulary)</li>
</ul>
<h3 id="accessing-assets">Accessing Assets</h3>
<pre><code class="language-python"># Get asset table from a downloaded dataset bag
assets = bag.get_table_as_dataframe(&quot;Image&quot;)

# Assets have a local path after materialization
for _, asset in assets.iterrows():
    local_path = asset[&quot;Filename&quot;]
    print(f&quot;Asset: {local_path}&quot;)
</code></pre>
<h3 id="asset-organization">Asset Organization</h3>
<p>When datasets are materialized:</p>
<ul>
<li>All assets of the same type are placed in the same directory</li>
<li>The directory is named by the asset type</li>
<li>Use metadata to identify specific assets rather than relying on filenames</li>
</ul>
<p>If you need to reorganize assets for your application, using symbolic links is efficient for both time and disk space.</p>
<h3 id="restructuring-assets-for-ml-workflows">Restructuring Assets for ML Workflows</h3>
<p>Many ML frameworks expect training data organized in a specific directory structure (e.g., <code>train/class1/</code>, <code>train/class2/</code>). The <code>restructure_assets()</code> method reorganizes downloaded assets into a hierarchical directory structure based on dataset types and metadata or feature values.</p>
<pre><code class="language-python">from pathlib import Path

# Download a dataset with nested structure
bag = dataset.download_dataset_bag()

# Restructure images by dataset type and a label column/feature
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./ml_data&quot;),
    group_by=[&quot;label&quot;],
)
</code></pre>
<p>This creates a directory structure like:</p>
<pre><code>ml_data/
  Complete/           # Parent dataset type
    Training/         # Nested dataset type
      positive/       # Label value
        image1.jpg
        image2.jpg
      negative/
        image3.jpg
    Testing/
      positive/
        image4.jpg
      negative/
        image5.jpg
</code></pre>
<h4 id="grouping-options">Grouping Options</h4>
<p>The <code>group_by</code> parameter accepts column names from the asset table or feature names:</p>
<pre><code class="language-python"># Group by a column in the asset table
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./by_subject&quot;),
    group_by=[&quot;Subject&quot;],  # Foreign key column
)

# Group by a feature attached to the asset
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./by_quality&quot;),
    group_by=[&quot;Quality&quot;],  # Feature name
)

# Multiple grouping levels
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./multi_level&quot;),
    group_by=[&quot;Subject&quot;, &quot;Quality&quot;],  # Creates Subject/Quality/file structure
)
</code></pre>
<h4 id="symlinks-vs-copies">Symlinks vs Copies</h4>
<p>By default, <code>restructure_assets()</code> creates symbolic links to save disk space:</p>
<pre><code class="language-python"># Default: create symlinks (efficient, but requires original bag to remain)
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./linked&quot;),
    use_symlinks=True,  # Default
)

# Create copies instead (uses more disk space, but independent of original)
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./copied&quot;),
    use_symlinks=False,
)
</code></pre>
<h4 id="custom-type-selection">Custom Type Selection</h4>
<p>When a dataset has multiple types, you can control which type is used for the directory name:</p>
<pre><code class="language-python"># Use a custom function to select the type
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./custom&quot;),
    group_by=[&quot;label&quot;],
    type_selector=lambda types: types[-1] if types else &quot;unknown&quot;,
)
</code></pre>
<h4 id="handling-missing-values">Handling Missing Values</h4>
<p>When a grouping value is missing or <code>None</code>, assets are placed in an <code>Unknown</code> folder:</p>
<pre><code>ml_data/
  Training/
    positive/
      image1.jpg
    Unknown/          # Assets with missing label values
      image2.jpg
</code></pre>
<h4 id="prediction-scenarios-datasets-without-types">Prediction Scenarios (Datasets Without Types)</h4>
<p>When a dataset has no type defined (empty <code>dataset_types</code> list), it is treated as a Testing dataset. This is common for prediction/inference scenarios where you want to apply a trained model to new unlabeled data:</p>
<pre><code class="language-python"># Create a dataset for prediction (no type)
prediction_dataset = ml.create_dataset(
    dataset_types=[],  # No type - will be treated as Testing
    description=&quot;Unlabeled images for prediction&quot;
)

# Add images and download
prediction_dataset.add_dataset_members({&quot;Image&quot;: image_rids})
bag = prediction_dataset.download_dataset_bag()

# Restructure for prediction - ends up in testing/Unknown/
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./prediction_data&quot;),
    group_by=[&quot;Diagnosis&quot;],  # No labels assigned yet
)
</code></pre>
<p>This creates:</p>
<pre><code>prediction_data/
  testing/            # Dataset without type treated as Testing
    Unknown/          # No labels assigned
      image1.jpg
      image2.jpg
</code></pre>
<h4 id="finding-assets-through-foreign-key-paths">Finding Assets Through Foreign Key Paths</h4>
<p>Assets are found by traversing all foreign key paths from the dataset, not just direct associations. For example, if a dataset contains Subjects and the schema has Subject → Encounter → Image relationships, <code>restructure_assets()</code> will find all Images reachable through those paths even though they are not directly in a Dataset_Image association table:</p>
<pre><code class="language-python"># Dataset contains only Subjects
subject_dataset = ml.create_dataset(
    dataset_types=[&quot;Training&quot;],
    description=&quot;Training subjects&quot;
)
subject_dataset.add_dataset_members({&quot;Subject&quot;: subject_rids})

# But we want to restructure Images connected via FK path
bag = subject_dataset.download_dataset_bag()
bag.restructure_assets(
    asset_table=&quot;Image&quot;,  # Finds Images via Subject -&gt; Encounter -&gt; Image
    output_dir=Path(&quot;./ml_data&quot;),
    group_by=[&quot;Quality&quot;],
)
</code></pre>
<h4 id="handling-multiple-feature-values">Handling Multiple Feature Values</h4>
<p>When an asset has multiple values for the same feature (e.g., labeled by different annotators or different model runs), you can provide a <code>value_selector</code> function to choose which value to use:</p>
<pre><code class="language-python">from deriva_ml.dataset.dataset_bag import FeatureValueRecord

def select_latest_execution(records: list[FeatureValueRecord]) -&gt; FeatureValueRecord:
    &quot;&quot;&quot;Select the feature value from the most recent execution.&quot;&quot;&quot;
    return max(records, key=lambda r: r.execution_rid or &quot;&quot;)

def select_by_confidence(records: list[FeatureValueRecord]) -&gt; FeatureValueRecord:
    &quot;&quot;&quot;Select the feature value with highest confidence from raw record.&quot;&quot;&quot;
    return max(records, key=lambda r: r.raw_record.get(&quot;Confidence&quot;, 0))

# Use value_selector to resolve multiple values
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./ml_data&quot;),
    group_by=[&quot;Diagnosis&quot;],
    value_selector=select_latest_execution,
)
</code></pre>
<p>The <code>FeatureValueRecord</code> contains:
- <code>target_rid</code>: RID of the asset this feature value applies to
- <code>feature_name</code>: Name of the feature
- <code>value</code>: The feature value (typically a vocabulary term name)
- <code>execution_rid</code>: RID of the execution that created this value (for provenance)
- <code>raw_record</code>: The complete feature table row as a dictionary</p>
<p>If no <code>value_selector</code> is provided and an asset has multiple different values for the same feature, an error is raised when <code>enforce_vocabulary=True</code> (the default). Set <code>enforce_vocabulary=False</code> to use the first value found instead.</p>
<h4 id="enforcing-vocabulary-based-grouping">Enforcing Vocabulary-Based Grouping</h4>
<p>By default, <code>enforce_vocabulary=True</code> ensures that feature-based grouping only uses vocabulary-controlled features. This prevents accidental grouping by asset-based features (which would create cryptic directory names):</p>
<pre><code class="language-python"># This will raise an error if BoundingBox is an asset-based feature
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./ml_data&quot;),
    group_by=[&quot;BoundingBox&quot;],  # Asset-based feature
    enforce_vocabulary=True,   # Default - will error
)

# Allow non-vocabulary features
bag.restructure_assets(
    asset_table=&quot;Image&quot;,
    output_dir=Path(&quot;./ml_data&quot;),
    group_by=[&quot;BoundingBox&quot;],
    enforce_vocabulary=False,  # Allows asset-based features
)
</code></pre>
<h2 id="finding-datasets">Finding Datasets</h2>
<p>To discover datasets in the catalog:</p>
<pre><code class="language-python"># List all datasets
all_datasets = ml.find_datasets()
for ds in all_datasets:
    print(f&quot;{ds.dataset_rid}: {ds.description} (v{ds.current_version})&quot;)

# Look up a specific dataset
dataset = ml.lookup_dataset(&quot;1-abc123&quot;)
</code></pre>
<h2 id="deleting-datasets">Deleting Datasets</h2>
<p>Datasets can be soft-deleted (marked as deleted but retained in the catalog):</p>
<pre><code class="language-python"># Delete a single dataset
ml.delete_dataset(dataset)

# Delete a dataset and all nested datasets
ml.delete_dataset(dataset, recurse=True)
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../identifiers/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Identifying things in deriva-ml">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Identifying things in deriva-ml
              </div>
            </div>
          </a>
        
        
          
          <a href="../features/" class="md-footer__link md-footer__link--next" aria-label="Next: Features">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Features
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>