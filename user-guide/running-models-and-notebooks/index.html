
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://informatics-isi-edu.github.io/deriva-ml/user-guide/running-models-and-notebooks/">
      
      
        <link rel="prev" href="../hydra-zen-configuration/">
      
      
        <link rel="next" href="../notebooks/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Running Models and Notebooks - DerivaML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-models-and-notebooks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DerivaML" class="md-header__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DerivaML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Running Models and Notebooks
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DerivaML" class="md-nav__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    DerivaML
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview of DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_ml_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installing deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../identifiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identifying things in deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../file-assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog Annotations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring an Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydra-zen-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hydra-zen Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Running Models and Notebooks
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Models and Notebooks
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Layout
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-configuration-discovery-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Configuration Discovery Works
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-configuration-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting Up Configuration Groups
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting Up Configuration Groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-settings-deriva_ml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connection Settings (deriva_ml)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datasets-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Datasets (datasets)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assets-assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Assets (assets)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflows (workflow)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-configuration-model_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Model Configuration (model_config)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-model-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Writing a Model Function
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-base-configuration-basepy" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Base Configuration (base.py)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-with-deriva-ml-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running with deriva-ml-run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running with deriva-ml-run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-host-and-catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overriding Host and Catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experiments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experiments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiruns-and-sweeps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiruns and Sweeps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-provenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Provenance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notebook-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notebook Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notebook Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-notebook-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining a Notebook Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-run_notebook-in-the-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using run_notebook() in the Notebook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-with-deriva-ml-run-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running with deriva-ml-run-notebook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running with deriva-ml-run-notebook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameter Injection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspecting-available-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspecting Available Options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-selection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kernel Selection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Walkthrough
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-project-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Project Setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-define-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Define Configurations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-write-a-model-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Write a Model Function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-register-the-model-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Register the Model Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-the-base-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Create the Base Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Run
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using DerivaML with Jupyter Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sample Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sample Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Library Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Library Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Classes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Classes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/deriva_ml_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/deriva_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaModel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Datasets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset_bag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DatasetBag
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset_split/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Splitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/dataset_aux_classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Auxiliary Classes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Execution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/execution_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExecutionConfiguration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/deriva_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Definitions & Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code-docs/upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#project-layout" class="md-nav__link">
    <span class="md-ellipsis">
      
        Project Layout
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Project Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-configuration-discovery-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        How Configuration Discovery Works
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setting-up-configuration-groups" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting Up Configuration Groups
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting Up Configuration Groups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-settings-deriva_ml" class="md-nav__link">
    <span class="md-ellipsis">
      
        Connection Settings (deriva_ml)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#datasets-datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Datasets (datasets)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assets-assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Assets (assets)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflows (workflow)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-configuration-model_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Model Configuration (model_config)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-model-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Writing a Model Function
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-base-configuration-basepy" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Base Configuration (base.py)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-with-deriva-ml-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running with deriva-ml-run
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running with deriva-ml-run">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overriding-host-and-catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overriding Host and Catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#experiments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Experiments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiruns-and-sweeps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multiruns and Sweeps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-provenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Code Provenance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notebook-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Notebook Configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notebook Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-notebook-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining a Notebook Configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-run_notebook-in-the-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using run_notebook() in the Notebook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-with-deriva-ml-run-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        Running with deriva-ml-run-notebook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running with deriva-ml-run-notebook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-usage_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic Usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameter Injection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inspecting-available-options" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inspecting Available Options
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-selection" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kernel Selection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Streaming Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-walkthrough" class="md-nav__link">
    <span class="md-ellipsis">
      
        Complete Walkthrough
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Complete Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-project-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Project Setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-define-configurations" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Define Configurations
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-write-a-model-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Write a Model Function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-register-the-model-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Register the Model Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-the-base-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Create the Base Config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Run
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="running-models-and-notebooks">Running Models and Notebooks</h1>
<p>DerivaML provides two command-line tools for executing reproducible ML workflows:</p>
<ul>
<li><strong><code>deriva-ml-run</code></strong> — runs Python model functions</li>
<li><strong><code>deriva-ml-run-notebook</code></strong> — runs Jupyter notebooks</li>
</ul>
<p>Both tools use <a href="https://mit-ll-responsible-ai.github.io/hydra-zen/">hydra-zen</a>
for composable configuration and automatically track executions in the Deriva
catalog. This guide walks through setting up a project, writing configuration,
and running workflows.</p>
<p>For detailed configuration class documentation, see
<a href="../hydra-zen-configuration/">Hydra-zen Configuration</a>. For execution lifecycle
details, see <a href="../execution-configuration/">Configuring and Running Executions</a>.</p>
<h2 id="project-layout">Project Layout</h2>
<p>A DerivaML project follows this standard directory structure:</p>
<pre><code>my-project/
  pyproject.toml
  src/
    configs/             # Hydra-zen configuration modules (Python, no YAML)
      __init__.py
      base.py            # create_model_config() + store registration
      deriva.py          # Connection settings (deriva_ml group)
      datasets.py        # Dataset specifications (datasets group)
      assets.py          # Input asset RIDs (assets group)
      workflow.py        # Workflow definitions (workflow group)
      my_model.py        # Model configs (model_config group)
      my_notebook.py     # Notebook configs (notebook_config())
      experiments.py     # Experiment presets (loaded last)
      multiruns.py       # Named multirun/sweep configs
    models/
      my_model.py        # Model function implementations
  notebooks/
    my_notebook.ipynb
</code></pre>
<p>A repository template is available at
<a href="https://github.com/informatics-isi-edu/deriva-ml-model-template">DerivaML Repository Template</a>.</p>
<h3 id="how-configuration-discovery-works">How Configuration Discovery Works</h3>
<p>When you run <code>deriva-ml-run</code> or <code>deriva-ml-run-notebook</code>, the tool calls
<code>load_configs()</code> which uses <code>pkgutil.iter_modules()</code> to discover and import all
Python modules in the <code>configs/</code> package. Each module registers its configurations
with the hydra-zen store as a side effect of being imported.</p>
<p>Modules are loaded in alphabetical order, with one exception: <code>experiments.py</code> is
always loaded last because experiments typically reference configurations from
other modules.</p>
<h2 id="setting-up-configuration-groups">Setting Up Configuration Groups</h2>
<p>DerivaML uses five standard configuration groups. Each group needs at least a
default entry.</p>
<h3 id="connection-settings-deriva_ml">Connection Settings (<code>deriva_ml</code>)</h3>
<p>Define how to connect to Deriva catalogs:</p>
<pre><code class="language-python"># configs/deriva.py
from hydra_zen import builds, store
from deriva_ml import DerivaMLConfig

DerivaMLConf = builds(DerivaMLConfig, populate_full_signature=True)
deriva_store = store(group=&quot;deriva_ml&quot;)

# Development catalog
deriva_store(
    DerivaMLConf(hostname=&quot;dev.example.org&quot;, catalog_id=&quot;1&quot;),
    name=&quot;default_deriva&quot;,
)

# Production catalog
deriva_store(
    DerivaMLConf(hostname=&quot;prod.example.org&quot;, catalog_id=&quot;100&quot;),
    name=&quot;production&quot;,
)
</code></pre>
<p>See <a href="../hydra-zen-configuration/#derivamlconfig">DerivaMLConfig</a> for all parameters.</p>
<h3 id="datasets-datasets">Datasets (<code>datasets</code>)</h3>
<p>Specify which datasets to download for each workflow:</p>
<pre><code class="language-python"># configs/datasets.py
from hydra_zen import store
from deriva_ml.dataset import DatasetSpecConfig
from deriva_ml.execution import with_description

datasets_store = store(group=&quot;datasets&quot;)

# Required: default (used when no override is specified)
datasets_store([], name=&quot;default_dataset&quot;)

# A named dataset collection
datasets_store(
    with_description(
        [DatasetSpecConfig(rid=&quot;1-ABC&quot;, version=&quot;1.0.0&quot;)],
        &quot;Training dataset with 1000 labeled images.&quot;,
    ),
    name=&quot;training_data&quot;,
)
</code></pre>
<p>See <a href="../hydra-zen-configuration/#datasetspecconfig">DatasetSpecConfig</a> for options.</p>
<h3 id="assets-assets">Assets (<code>assets</code>)</h3>
<p>List input asset RIDs (model weights, configuration files, etc.):</p>
<pre><code class="language-python"># configs/assets.py
from hydra_zen import store
from deriva_ml.execution import with_description

asset_store = store(group=&quot;assets&quot;)

# Required: default
asset_store([], name=&quot;default_asset&quot;)

# Model weights
asset_store(
    with_description(
        [&quot;6-EPNR&quot;],
        &quot;ResNet50 pretrained weights from MAE pre-training.&quot;,
    ),
    name=&quot;resnet_weights&quot;,
)
</code></pre>
<p>For caching support, use <code>AssetSpecConfig</code> instead of plain RID strings.
See <a href="../hydra-zen-configuration/#configuration-descriptions">Configuration Descriptions</a>
for details on <code>with_description()</code>.</p>
<h3 id="workflows-workflow">Workflows (<code>workflow</code>)</h3>
<p>Define the computational process being tracked:</p>
<pre><code class="language-python"># configs/workflow.py
from hydra_zen import builds, store
from deriva_ml.execution import Workflow

workflow_store = store(group=&quot;workflow&quot;)

workflow_store(
    builds(Workflow, name=&quot;default&quot;, workflow_type=&quot;Training&quot;,
           populate_full_signature=True),
    name=&quot;default_workflow&quot;,
)

workflow_store(
    builds(Workflow, name=&quot;Feature Extraction&quot;, workflow_type=&quot;Preprocessing&quot;,
           description=&quot;Extract features from raw data&quot;,
           populate_full_signature=True),
    name=&quot;feature_extraction&quot;,
)
</code></pre>
<p>See <a href="../execution-configuration/#workflows">Workflows</a> for how workflows track
source code provenance.</p>
<h3 id="model-configuration-model_config">Model Configuration (<code>model_config</code>)</h3>
<p>Configure model hyperparameters. This is where <code>zen_partial=True</code> is essential:</p>
<pre><code class="language-python"># configs/my_model.py
from hydra_zen import builds, store
from models.my_model import train_classifier

model_store = store(group=&quot;model_config&quot;)

# Base config: partially applied, waits for ml_instance and execution
ModelConfig = builds(
    train_classifier,
    learning_rate=1e-3,
    epochs=10,
    batch_size=32,
    populate_full_signature=True,
    zen_partial=True,
)

model_store(ModelConfig, name=&quot;default_model&quot;)
model_store(ModelConfig, name=&quot;quick&quot;, epochs=3, learning_rate=1e-2)
model_store(ModelConfig, name=&quot;long_training&quot;, epochs=100, learning_rate=1e-4)
</code></pre>
<p>See <a href="../hydra-zen-configuration/#model-configuration-with-zen_partial">Model Configuration with zen_partial</a>
for the full pattern.</p>
<h2 id="writing-a-model-function">Writing a Model Function</h2>
<p>Model functions follow a simple protocol: they accept any number of configurable
parameters plus two keyword arguments injected at runtime:</p>
<pre><code class="language-python"># models/my_model.py
from deriva_ml import DerivaML
from deriva_ml.execution import Execution

def train_classifier(
    learning_rate: float,
    epochs: int,
    batch_size: int,
    ml_instance: DerivaML,
    execution: Execution | None = None,
) -&gt; None:
    &quot;&quot;&quot;Train a classifier using DerivaML execution context.&quot;&quot;&quot;
    # Access downloaded datasets
    for dataset in execution.datasets:
        bag = execution.download_dataset_bag(dataset)
        # Process data from the bag...

    # Access downloaded input assets (model weights, etc.)
    for table_name, asset_paths in execution.asset_paths.items():
        for asset_path in asset_paths:
            print(f&quot;Loaded {table_name}: {asset_path}&quot;)

    # Your training code here
    model = build_model()
    for epoch in range(epochs):
        train_epoch(model, learning_rate, batch_size)

    # Register output files for upload
    model_path = execution.asset_file_path(&quot;Model&quot;, &quot;best_model.pt&quot;)
    save_model(model, model_path)

    metrics_path = execution.asset_file_path(&quot;Execution_Metadata&quot;, &quot;metrics.json&quot;)
    save_metrics(metrics_path)
</code></pre>
<p>The <code>ml_instance</code> and <code>execution</code> parameters are injected by <code>run_model()</code> at
runtime. Hydra configures the remaining parameters (<code>learning_rate</code>, <code>epochs</code>,
<code>batch_size</code>) from the config store.</p>
<h2 id="the-base-configuration-basepy">The Base Configuration (<code>base.py</code>)</h2>
<p>The <code>base.py</code> module ties everything together using <code>create_model_config()</code>:</p>
<pre><code class="language-python"># configs/base.py
from hydra_zen import store
from deriva_ml import DerivaML
from deriva_ml.execution import create_model_config

DerivaModelConfig = create_model_config(
    DerivaML,                         # or your DerivaML subclass
    description=&quot;My project model run&quot;,
    hydra_defaults=[
        &quot;_self_&quot;,
        {&quot;deriva_ml&quot;: &quot;default_deriva&quot;},
        {&quot;datasets&quot;: &quot;default_dataset&quot;},
        {&quot;assets&quot;: &quot;default_asset&quot;},
        {&quot;workflow&quot;: &quot;default_workflow&quot;},
        {&quot;model_config&quot;: &quot;default_model&quot;},
    ],
)

store(DerivaModelConfig, name=&quot;deriva_model&quot;)
</code></pre>
<p><code>create_model_config()</code> creates a hydra-zen <code>builds()</code> of the <code>run_model()</code>
function with all the standard groups wired up. The <code>deriva_model</code> name must
match the <code>--config-name</code> argument (the default).</p>
<p>If your project uses a DerivaML subclass (e.g., <code>EyeAI</code>), pass it as the first
argument so that the correct class is instantiated at runtime.</p>
<h2 id="running-with-deriva-ml-run">Running with <code>deriva-ml-run</code></h2>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code class="language-bash"># Run with all defaults from base.py
uv run deriva-ml-run

# Override a config group
uv run deriva-ml-run model_config=quick datasets=training_data

# Override individual parameters
uv run deriva-ml-run model_config.epochs=50 model_config.learning_rate=0.001

# Dry run: download inputs but skip catalog writes
uv run deriva-ml-run dry_run=true

# Show all available configuration groups and options
uv run deriva-ml-run --info
</code></pre>
<h3 id="overriding-host-and-catalog">Overriding Host and Catalog</h3>
<p>You can override the Deriva connection from the command line without changing
configs:</p>
<pre><code class="language-bash">uv run deriva-ml-run --host prod.example.org --catalog 100
</code></pre>
<p>Or using Hydra override syntax:</p>
<pre><code class="language-bash">uv run deriva-ml-run deriva_ml=production
</code></pre>
<h3 id="experiments">Experiments</h3>
<p>Experiments are preset configurations that bundle specific model, dataset, asset,
and workflow choices. Define them in <code>configs/experiments.py</code>:</p>
<pre><code class="language-python"># configs/experiments.py
from hydra_zen import make_config, store
from configs.base import DerivaModelConfig

experiment_store = store(group=&quot;experiment&quot;, package=&quot;_global_&quot;)

experiment_store(
    make_config(
        hydra_defaults=[
            &quot;_self_&quot;,
            {&quot;override /model_config&quot;: &quot;quick&quot;},
            {&quot;override /datasets&quot;: &quot;training_data&quot;},
            {&quot;override /assets&quot;: &quot;resnet_weights&quot;},
            {&quot;override /workflow&quot;: &quot;default_workflow&quot;},
        ],
        description=&quot;Quick training with ResNet weights on training data.&quot;,
        bases=(DerivaModelConfig,),
    ),
    name=&quot;quick_training&quot;,
)
</code></pre>
<p>Run an experiment:</p>
<pre><code class="language-bash">uv run deriva-ml-run +experiment=quick_training

# Override an experiment parameter
uv run deriva-ml-run +experiment=quick_training model_config.epochs=25
</code></pre>
<p>Note the <code>+</code> prefix: this adds the experiment group, which is not in the default
config. The <code>override /</code> prefix in <code>hydra_defaults</code> ensures the experiment's
choices replace (rather than conflict with) the base defaults.</p>
<h3 id="multiruns-and-sweeps">Multiruns and Sweeps</h3>
<p>For parameter sweeps, use Hydra's multirun mode:</p>
<pre><code class="language-bash"># Sweep a parameter
uv run deriva-ml-run --multirun model_config.learning_rate=0.0001,0.001,0.01

# Sweep across experiments
uv run deriva-ml-run --multirun +experiment=quick_training,long_training
</code></pre>
<p>For complex sweeps, define named multirun configurations in
<code>configs/multiruns.py</code>:</p>
<pre><code class="language-python"># configs/multiruns.py
from deriva_ml.execution import multirun_config

multirun_config(
    &quot;lr_sweep&quot;,
    overrides=[
        &quot;+experiment=quick_training&quot;,
        &quot;model_config.learning_rate=0.0001,0.001,0.01,0.1&quot;,
    ],
    description='''## Learning Rate Sweep

    Exploring optimal learning rates for quick training config.

    | Learning Rate | Expected Behavior |
    |--------------|-------------------|
    | 0.0001 | Slow convergence |
    | 0.001 | Standard baseline |
    | 0.01 | Fast, may overshoot |
    | 0.1 | Likely unstable |
    ''',
)
</code></pre>
<p>Run a named multirun:</p>
<pre><code class="language-bash"># Use the named multirun config (automatically enables multirun mode)
uv run deriva-ml-run +multirun=lr_sweep

# Override parameters from the multirun config
uv run deriva-ml-run +multirun=lr_sweep model_config.epochs=5
</code></pre>
<p>Named multiruns create a parent-child execution structure in the catalog:</p>
<ul>
<li><strong>Parent execution</strong>: Contains the markdown description and links to all children</li>
<li><strong>Child executions</strong>: One per parameter combination, each with full provenance</li>
</ul>
<p>Use <code>list_parent_executions()</code> and <code>list_nested_executions()</code> to navigate this
hierarchy.</p>
<h3 id="code-provenance">Code Provenance</h3>
<p>DerivaML records the Git commit hash and source URL for each execution. Always
commit your code before running models:</p>
<pre><code class="language-bash">git add -A &amp;&amp; git commit -m &quot;Ready for training run&quot;
uv run bump-version patch  # Optional: create a release tag
uv run deriva-ml-run +experiment=quick_training
</code></pre>
<p>If the working tree has uncommitted changes, DerivaML issues a warning and the
execution record may not have a valid code reference.</p>
<p>See <a href="../execution-configuration/#automatic-source-code-detection">Automatic Source Code Detection</a>
for details on how provenance works in scripts, notebooks, and Docker containers.</p>
<h2 id="notebook-configuration">Notebook Configuration</h2>
<p>Notebooks use a slightly different pattern: instead of <code>zen_partial</code> model
functions, they use <code>notebook_config()</code> and <code>run_notebook()</code>.</p>
<h3 id="defining-a-notebook-configuration">Defining a Notebook Configuration</h3>
<p>For simple notebooks that only use the standard fields (datasets, assets, etc.):</p>
<pre><code class="language-python"># configs/my_analysis.py
from deriva_ml.execution import notebook_config

notebook_config(
    &quot;my_analysis&quot;,
    defaults={&quot;assets&quot;: &quot;comparison_weights&quot;, &quot;datasets&quot;: &quot;training_data&quot;},
)
</code></pre>
<p>For notebooks with custom parameters:</p>
<pre><code class="language-python"># configs/my_analysis.py
from dataclasses import dataclass
from deriva_ml.execution import BaseConfig, notebook_config

@dataclass
class MyAnalysisConfig(BaseConfig):
    threshold: float = 0.5
    num_samples: int = 100

notebook_config(
    &quot;my_analysis&quot;,
    config_class=MyAnalysisConfig,
    defaults={&quot;assets&quot;: &quot;comparison_weights&quot;},
)
</code></pre>
<h3 id="using-run_notebook-in-the-notebook">Using <code>run_notebook()</code> in the Notebook</h3>
<p>In the first code cell of your notebook:</p>
<pre><code class="language-python">from deriva_ml.execution import run_notebook

ml, execution, config = run_notebook(&quot;my_analysis&quot;)
</code></pre>
<p>This single call:</p>
<ol>
<li>Loads all config modules from <code>src/configs/</code></li>
<li>Resolves the hydra-zen configuration (including any CLI overrides)</li>
<li>Connects to the Deriva catalog</li>
<li>Creates a workflow and execution record</li>
<li>Downloads any specified datasets and assets</li>
</ol>
<p>After that, you can use <code>ml</code>, <code>execution</code>, and <code>config</code> throughout the notebook:</p>
<pre><code class="language-python"># Access resolved config values
print(config.threshold)  # 0.5

# Access downloaded assets
for table, paths in execution.asset_paths.items():
    for path in paths:
        print(f&quot;Asset: {path}&quot;)

# At the end of the notebook
execution.upload_execution_outputs()
</code></pre>
<h2 id="running-with-deriva-ml-run-notebook">Running with <code>deriva-ml-run-notebook</code></h2>
<h3 id="basic-usage_1">Basic Usage</h3>
<pre><code class="language-bash"># Run with default configuration
uv run deriva-ml-run-notebook notebooks/my_analysis.ipynb

# Override Hydra config groups (positional overrides)
uv run deriva-ml-run-notebook notebooks/my_analysis.ipynb \
    assets=different_weights deriva_ml=production
</code></pre>
<p>Hydra overrides are passed as positional arguments after the notebook path. These
are forwarded to the notebook via the <code>DERIVA_ML_HYDRA_OVERRIDES</code> environment
variable, where <code>run_notebook()</code> picks them up automatically.</p>
<h3 id="parameter-injection">Parameter Injection</h3>
<p>You can also inject values directly into a notebook's parameter cell (tagged with
<code>parameters</code> in Jupyter) using papermill:</p>
<pre><code class="language-bash"># Inject individual parameters
uv run deriva-ml-run-notebook notebooks/train.ipynb \
    -p learning_rate 0.001 -p epochs 50

# Load parameters from a file
uv run deriva-ml-run-notebook notebooks/train.ipynb --file params.yaml
</code></pre>
<h3 id="inspecting-available-options">Inspecting Available Options</h3>
<pre><code class="language-bash"># Show notebook parameters (from the papermill parameters cell)
uv run deriva-ml-run-notebook notebooks/train.ipynb --inspect

# Show available Hydra config groups
uv run deriva-ml-run-notebook notebooks/my_analysis.ipynb --info
</code></pre>
<h3 id="kernel-selection">Kernel Selection</h3>
<p>The CLI automatically detects the Jupyter kernel for the current virtual
environment. If auto-detection fails or you want to use a different kernel:</p>
<pre><code class="language-bash">uv run deriva-ml-run-notebook notebooks/train.ipynb --kernel my-ml-project
</code></pre>
<p>If no kernel is installed for your environment, use
<a href="../cli-reference/#deriva-ml-install-kernel"><code>deriva-ml-install-kernel</code></a>.</p>
<h3 id="output-handling">Output Handling</h3>
<p>After execution, <code>deriva-ml-run-notebook</code>:</p>
<ol>
<li>Converts the executed notebook to Markdown (with images embedded as base64
   data URIs and DataFrame tables converted to Markdown format)</li>
<li>Uploads both the <code>.ipynb</code> and <code>.md</code> files to the catalog as execution assets
   with type <code>notebook_output</code></li>
<li>Prints the execution URL for easy access</li>
</ol>
<h3 id="streaming-output">Streaming Output</h3>
<p>To see cell outputs in your terminal as the notebook runs:</p>
<pre><code class="language-bash">uv run deriva-ml-run-notebook notebooks/train.ipynb --log-output
</code></pre>
<h2 id="complete-walkthrough">Complete Walkthrough</h2>
<p>Here is a minimal end-to-end example showing how to set up a new DerivaML
project and run a model.</p>
<h3 id="1-project-setup">1. Project Setup</h3>
<pre><code class="language-bash"># Create project from template
gh repo create my-ml-project --template informatics-isi-edu/deriva-ml-model-template

# Set up environment
cd my-ml-project
uv sync
uv run deriva-ml-install-kernel  # If using notebooks
</code></pre>
<h3 id="2-define-configurations">2. Define Configurations</h3>
<p>Create <code>src/configs/deriva.py</code>:</p>
<pre><code class="language-python">from hydra_zen import builds, store
from deriva_ml import DerivaMLConfig

DerivaMLConf = builds(DerivaMLConfig, populate_full_signature=True)
store(DerivaMLConf(hostname=&quot;dev.example.org&quot;, catalog_id=&quot;1&quot;),
      group=&quot;deriva_ml&quot;, name=&quot;default_deriva&quot;)
</code></pre>
<p>Create <code>src/configs/datasets.py</code>:</p>
<pre><code class="language-python">from hydra_zen import store
from deriva_ml.dataset import DatasetSpecConfig

store([], group=&quot;datasets&quot;, name=&quot;default_dataset&quot;)
store([DatasetSpecConfig(rid=&quot;1-ABC&quot;, version=&quot;1.0.0&quot;)],
      group=&quot;datasets&quot;, name=&quot;training&quot;)
</code></pre>
<p>Create <code>src/configs/assets.py</code>:</p>
<pre><code class="language-python">from hydra_zen import store
store([], group=&quot;assets&quot;, name=&quot;default_asset&quot;)
</code></pre>
<p>Create <code>src/configs/workflow.py</code>:</p>
<pre><code class="language-python">from hydra_zen import builds, store
from deriva_ml.execution import Workflow

store(builds(Workflow, name=&quot;default&quot;, workflow_type=&quot;Training&quot;,
             populate_full_signature=True),
      group=&quot;workflow&quot;, name=&quot;default_workflow&quot;)
</code></pre>
<h3 id="3-write-a-model-function">3. Write a Model Function</h3>
<p>Create <code>src/models/classifier.py</code>:</p>
<pre><code class="language-python">from deriva_ml import DerivaML
from deriva_ml.execution import Execution

def train(
    learning_rate: float = 0.001,
    epochs: int = 10,
    ml_instance: DerivaML = None,
    execution: Execution | None = None,
) -&gt; None:
    print(f&quot;Training for {epochs} epochs at lr={learning_rate}&quot;)
    # Your training code here...
</code></pre>
<h3 id="4-register-the-model-config">4. Register the Model Config</h3>
<p>Create <code>src/configs/classifier.py</code>:</p>
<pre><code class="language-python">from hydra_zen import builds, store
from models.classifier import train

store(builds(train, populate_full_signature=True, zen_partial=True),
      group=&quot;model_config&quot;, name=&quot;default_model&quot;)
store(builds(train, epochs=3, populate_full_signature=True, zen_partial=True),
      group=&quot;model_config&quot;, name=&quot;quick&quot;)
</code></pre>
<h3 id="5-create-the-base-config">5. Create the Base Config</h3>
<p>Create <code>src/configs/base.py</code>:</p>
<pre><code class="language-python">from hydra_zen import store
from deriva_ml import DerivaML
from deriva_ml.execution import create_model_config

store(create_model_config(DerivaML), name=&quot;deriva_model&quot;)
</code></pre>
<h3 id="6-run">6. Run</h3>
<pre><code class="language-bash"># Authenticate
uv run deriva-globus-auth-utils login --host dev.example.org

# Verify configs
uv run deriva-ml-run --info

# Dry run
uv run deriva-ml-run dry_run=true

# Commit and run for real
git add -A &amp;&amp; git commit -m &quot;Initial model setup&quot;
uv run deriva-ml-run model_config=quick datasets=training
</code></pre>
<h2 id="troubleshooting">Troubleshooting</h2>
<p><strong>"Config directory not found"</strong> — Ensure <code>src/configs/</code> exists and contains an
<code>__init__.py</code>. The <code>--config-dir</code> flag defaults to <code>src/configs</code>.</p>
<p><strong>"Uncommitted changes" warning</strong> — Commit your code before running. DerivaML
tracks the Git commit hash for code provenance.</p>
<p><strong>"Kernel not found"</strong> — Run <code>uv run deriva-ml-install-kernel</code> to install a
Jupyter kernel for the current environment. Verify with
<code>jupyter kernelspec list</code>.</p>
<p><strong>Override syntax errors</strong> — Remember: <code>group=option</code> overrides a group in the
defaults list, <code>group.param=value</code> overrides a specific parameter, <code>+group=option</code>
adds a group not in the defaults (like <code>+experiment=...</code>).</p>
<p><strong>Notebook ignores Hydra overrides</strong> — Make sure the notebook calls
<code>run_notebook("config_name")</code> (not <code>get_notebook_configuration()</code> directly).
Hydra overrides are passed via the <code>DERIVA_ML_HYDRA_OVERRIDES</code> environment
variable, which <code>run_notebook()</code> reads automatically.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../hydra-zen-configuration/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Hydra-zen Configuration">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Hydra-zen Configuration
              </div>
            </div>
          </a>
        
        
          
          <a href="../notebooks/" class="md-footer__link md-footer__link--next" aria-label="Next: Using DerivaML with Jupyter Notebooks">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Using DerivaML with Jupyter Notebooks
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>