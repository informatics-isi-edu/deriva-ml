
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://informatics-isi-edu.github.io/deriva-ml/code-docs/dataset/">
      
      
        <link rel="prev" href="../deriva_model/">
      
      
        <link rel="next" href="../dataset_bag/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Dataset - DerivaML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dataset-class" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DerivaML" class="md-header__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DerivaML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dataset
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DerivaML" class="md-nav__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    DerivaML
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview of DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deriva_ml_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installing deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/identifiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identifying things in deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/file-assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog Annotations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/execution-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring an Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/hydra-zen-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hydra-zen Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/running-models-and-notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Models and Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using DerivaML with Jupyter Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sample Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sample Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Library Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Library Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Classes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Classes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_ml_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaModel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Datasets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Dataset
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset--create-a-new-dataset-via-an-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a new dataset via an execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset--download-for-offline-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        Download for offline use
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.current_version" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.dataset_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __eq__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __hash__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__init__--wrap-an-existing-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wrap an existing dataset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.add_dataset_members" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_dataset_members
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.add_dataset_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_dataset_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.add_dataset_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_dataset_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.create_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.dataset_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.delete_dataset_members" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_dataset_members
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.denormalize_as_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        denormalize_as_dataframe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.denormalize_as_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        denormalize_as_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.display_markdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        display_markdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.download_dataset_bag" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_dataset_bag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.find_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.get_chaise_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_chaise_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.increment_dataset_version" class="md-nav__link">
    <span class="md-ellipsis">
      
        increment_dataset_version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_children" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_children
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_element_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_element_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_members" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_members
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_parents" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_parents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_executions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.remove_dataset_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_dataset_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.to_markdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_markdown
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_bag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DatasetBag
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_split/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Splitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_aux_classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Auxiliary Classes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Execution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExecutionConfiguration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Definitions & Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset--create-a-new-dataset-via-an-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create a new dataset via an execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset--download-for-offline-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        Download for offline use
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.current_version" class="md-nav__link">
    <span class="md-ellipsis">
      
        current_version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.dataset_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __eq__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __hash__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__init__--wrap-an-existing-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wrap an existing dataset
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.add_dataset_members" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_dataset_members
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.add_dataset_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_dataset_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.add_dataset_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_dataset_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.create_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.dataset_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        dataset_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.delete_dataset_members" class="md-nav__link">
    <span class="md-ellipsis">
      
        delete_dataset_members
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.denormalize_as_dataframe" class="md-nav__link">
    <span class="md-ellipsis">
      
        denormalize_as_dataframe
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.denormalize_as_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        denormalize_as_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.display_markdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        display_markdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.download_dataset_bag" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_dataset_bag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.find_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.get_chaise_url" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_chaise_url
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.increment_dataset_version" class="md-nav__link">
    <span class="md-ellipsis">
      
        increment_dataset_version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_children" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_children
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_element_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_element_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_members" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_members
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_dataset_parents" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_parents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.list_executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_executions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.remove_dataset_type" class="md-nav__link">
    <span class="md-ellipsis">
      
        remove_dataset_type
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.dataset.dataset.Dataset.to_markdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_markdown
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="dataset-class">Dataset Class</h1>
<p>The Dataset class manages versioned datasets in a Deriva catalog. Datasets are
collections of related data elements that can be versioned, downloaded as BDBags,
and tracked through their lifecycle.</p>


<div class="doc doc-object doc-module">



<a id="deriva_ml.dataset.dataset"></a>
    <div class="doc doc-contents first">

        <p>Dataset management for DerivaML.</p>
<p>This module provides functionality for managing datasets in DerivaML. A dataset represents a collection
of related data that can be versioned, downloaded, and tracked. The module includes:</p>
<ul>
<li>Dataset class: Core class for dataset operations</li>
<li>Version management: Track and update dataset versions</li>
<li>History tracking: Record dataset changes over time</li>
<li>Download capabilities: Export datasets as BDBags</li>
<li>Relationship management: Handle dataset dependencies and hierarchies</li>
</ul>
<p>The Dataset class serves as a base class in DerivaML, making its methods accessible through
DerivaML class instances.</p>


<details class="typical-usage-example" open>
  <summary>Typical usage example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>ml = DerivaML('deriva.example.org', 'my_catalog')
with ml.create_execution(config) as exe:
...     dataset = exe.create_dataset(
...         dataset_types=['experiment'],
...         description='Experimental data'
...     )
...     dataset.add_dataset_members(members=['1-abc123', '1-def456'])
...     dataset.increment_dataset_version(
...         component=VersionPart.minor,
...         description='Added new samples'
...     )</p>
</blockquote>
</blockquote>
</blockquote>
</details>









<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="deriva_ml.dataset.dataset.Dataset" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Dataset</span>


</h2>


    <div class="doc doc-contents ">



        <p>Manages dataset operations in a Deriva catalog.</p>
<p>The Dataset class provides functionality for creating, modifying, and tracking datasets
in a Deriva catalog. It handles versioning, relationships between datasets, and data export.</p>
<p>A Dataset is a versioned collection of related data elements. Each dataset:
- Has a unique RID (Resource Identifier) within the catalog
- Maintains a version history using semantic versioning (major.minor.patch)
- Can contain nested datasets, forming a hierarchy
- Can be exported as a BDBag for offline use or sharing</p>
<p>The class implements the DatasetLike protocol, allowing code to work uniformly
with both live catalog datasets and downloaded DatasetBag objects.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.dataset.dataset.Dataset.dataset_rid">dataset_rid</span></code></td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The unique Resource Identifier for this dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="dataset_types


  
      property
   (deriva_ml.dataset.dataset.Dataset.dataset_types)" href="#deriva_ml.dataset.dataset.Dataset.dataset_types">dataset_types</a></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of vocabulary terms describing the dataset type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.dataset.dataset.Dataset.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description of the dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.dataset.dataset.Dataset.execution_rid">execution_rid</span></code></td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional RID of the execution that created this dataset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.dataset.dataset.Dataset._ml_instance">_ml_instance</span></code></td>
            <td>
                  <code><span title="deriva_ml.interfaces.DerivaMLCatalog">DerivaMLCatalog</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to the catalog containing this dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="deriva_ml.dataset.dataset.Dataset--create-a-new-dataset-via-an-execution">Create a new dataset via an execution</h3>
<p>with ml.create_execution(config) as exe:
...     dataset = exe.create_dataset(
...         dataset_types=["training_data"],
...         description="Image classification training set"
...     )
...     # Add members to the dataset
...     dataset.add_dataset_members(members=["1-abc", "1-def"])
...     # Increment version after changes
...     new_version = dataset.increment_dataset_version(VersionPart.minor, "Added samples")</p>
<h3 id="deriva_ml.dataset.dataset.Dataset--download-for-offline-use">Download for offline use</h3>
<p>bag = dataset.download_dataset_bag(version=new_version)</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages dataset operations in a Deriva catalog.</span>

<span class="sd">    The Dataset class provides functionality for creating, modifying, and tracking datasets</span>
<span class="sd">    in a Deriva catalog. It handles versioning, relationships between datasets, and data export.</span>

<span class="sd">    A Dataset is a versioned collection of related data elements. Each dataset:</span>
<span class="sd">    - Has a unique RID (Resource Identifier) within the catalog</span>
<span class="sd">    - Maintains a version history using semantic versioning (major.minor.patch)</span>
<span class="sd">    - Can contain nested datasets, forming a hierarchy</span>
<span class="sd">    - Can be exported as a BDBag for offline use or sharing</span>

<span class="sd">    The class implements the DatasetLike protocol, allowing code to work uniformly</span>
<span class="sd">    with both live catalog datasets and downloaded DatasetBag objects.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset_rid (RID): The unique Resource Identifier for this dataset.</span>
<span class="sd">        dataset_types (list[str]): List of vocabulary terms describing the dataset type.</span>
<span class="sd">        description (str): Human-readable description of the dataset.</span>
<span class="sd">        execution_rid (RID | None): Optional RID of the execution that created this dataset.</span>
<span class="sd">        _ml_instance (DerivaMLCatalog): Reference to the catalog containing this dataset.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Create a new dataset via an execution</span>
<span class="sd">        &gt;&gt;&gt; with ml.create_execution(config) as exe:</span>
<span class="sd">        ...     dataset = exe.create_dataset(</span>
<span class="sd">        ...         dataset_types=[&quot;training_data&quot;],</span>
<span class="sd">        ...         description=&quot;Image classification training set&quot;</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     # Add members to the dataset</span>
<span class="sd">        ...     dataset.add_dataset_members(members=[&quot;1-abc&quot;, &quot;1-def&quot;])</span>
<span class="sd">        ...     # Increment version after changes</span>
<span class="sd">        ...     new_version = dataset.increment_dataset_version(VersionPart.minor, &quot;Added samples&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # Download for offline use</span>
<span class="sd">        &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=new_version)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">catalog</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
        <span class="n">dataset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a Dataset object from an existing dataset in the catalog.</span>

<span class="sd">        This constructor wraps an existing dataset record. To create a new dataset</span>
<span class="sd">        in the catalog, use the static method Dataset.create_dataset() instead.</span>

<span class="sd">        Args:</span>
<span class="sd">            catalog: The DerivaMLCatalog instance containing this dataset.</span>
<span class="sd">            dataset_rid: The RID of the existing dataset record.</span>
<span class="sd">            description: Human-readable description of the dataset&#39;s purpose and contents.</span>
<span class="sd">            execution_rid: Optional execution RID that created or is associated with this dataset.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; # Wrap an existing dataset</span>
<span class="sd">            &gt;&gt;&gt; dataset = Dataset(catalog=ml, dataset_rid=&quot;4HM&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="o">=</span> <span class="n">dataset_rid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">execution_rid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span> <span class="o">=</span> <span class="n">catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the Dataset for debugging.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;deriva_ml.Dataset object at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s2">: rid=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;version=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="si">}</span><span class="s2">&#39;, types=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return hash based on dataset RID for use in sets and as dict keys.</span>

<span class="sd">        This allows Dataset objects to be stored in sets and used as dictionary keys.</span>
<span class="sd">        Two Dataset objects with the same RID will hash to the same value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check equality based on dataset RID.</span>

<span class="sd">        Two Dataset objects are considered equal if they reference the same</span>
<span class="sd">        dataset RID, regardless of other attributes like version or types.</span>

<span class="sd">        Args:</span>
<span class="sd">            other: Object to compare with.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if other is a Dataset with the same RID, False otherwise.</span>
<span class="sd">            Returns NotImplemented for non-Dataset objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dataset_rid</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_dataset_type_association_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the association table for dataset types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (table_name, table_path) for the Dataset-Dataset_Type association table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span>
            <span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">]</span>
            <span class="o">.</span><span class="n">find_associations</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">atable_name</span> <span class="o">=</span> <span class="n">associations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">associations</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">atable_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">atable_name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">atable_name</span><span class="p">,</span> <span class="n">atable_path</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dataset_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the dataset types from the catalog.</span>

<span class="sd">        This property fetches the current dataset types directly from the catalog,</span>
<span class="sd">        ensuring consistency when multiple Dataset instances reference the same</span>
<span class="sd">        dataset or when types are modified externally.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of dataset type term names from the Dataset_Type vocabulary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">atable_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_type_association_table</span><span class="p">()</span>
        <span class="n">ds_types</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset_Type</span><span class="p">)</span>
            <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ds</span><span class="p">[</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">]</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ds_types</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_dataset</span><span class="p">(</span>
        <span class="n">ml_instance</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
        <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new dataset in the catalog.</span>

<span class="sd">        Creates a dataset with specified types and description. The dataset must be</span>
<span class="sd">        associated with an execution for provenance tracking.</span>

<span class="sd">        Args:</span>
<span class="sd">            ml_instance: DerivaMLCatalog instance.</span>
<span class="sd">            execution_rid: Execution RID to associate with dataset creation (required).</span>
<span class="sd">            dataset_types: One or more dataset type terms from Dataset_Type vocabulary.</span>
<span class="sd">            description: Description of the dataset&#39;s purpose and contents.</span>
<span class="sd">            version: Optional initial version number. Defaults to 0.1.0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dataset: The newly created dataset.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If dataset_types are invalid or creation fails.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; with ml.create_execution(config) as exe:</span>
<span class="sd">            ...     dataset = exe.create_dataset(</span>
<span class="sd">            ...         dataset_types=[&quot;experiment&quot;, &quot;raw_data&quot;],</span>
<span class="sd">            ...         description=&quot;RNA sequencing experiment data&quot;,</span>
<span class="sd">            ...         version=DatasetVersion(1, 0, 0)</span>
<span class="sd">            ...     )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="ow">or</span> <span class="n">DatasetVersion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Validate dataset types</span>
        <span class="n">ds_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset_types</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">dataset_types</span>
        <span class="n">dataset_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ds_types</span><span class="p">]</span>

        <span class="c1"># Create the entry for the new dataset_table and get its RID.</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="n">ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">dataset_table_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">dataset_rid</span> <span class="o">=</span> <span class="n">dataset_table_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;Deleted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span>

        <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Execution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="p">[{</span><span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="n">dataset_rid</span><span class="p">,</span> <span class="s2">&quot;Execution&quot;</span><span class="p">:</span> <span class="n">execution_rid</span><span class="p">}]</span>
        <span class="p">)</span>
        <span class="n">Dataset</span><span class="o">.</span><span class="n">_insert_dataset_versions</span><span class="p">(</span>
            <span class="n">ml_instance</span><span class="o">=</span><span class="n">ml_instance</span><span class="p">,</span>
            <span class="n">dataset_list</span><span class="o">=</span><span class="p">[</span><span class="n">DatasetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">dataset_rid</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)],</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Initial dataset creation.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span>
            <span class="n">catalog</span><span class="o">=</span><span class="n">ml_instance</span><span class="p">,</span>
            <span class="n">dataset_rid</span><span class="o">=</span><span class="n">dataset_rid</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Skip version increment during initial creation (version already set above)</span>
        <span class="n">dataset</span><span class="o">.</span><span class="n">add_dataset_types</span><span class="p">(</span><span class="n">dataset_types</span><span class="p">,</span> <span class="n">_skip_version_increment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataset</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_dataset_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">,</span>
        <span class="n">_skip_version_increment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a dataset type to this dataset.</span>

<span class="sd">        Adds a type term to this dataset if it&#39;s not already present. The term must</span>
<span class="sd">        exist in the Dataset_Type vocabulary. Also increments the dataset&#39;s minor</span>
<span class="sd">        version to reflect the metadata change.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_type: Term name (string) or VocabularyTerm object from Dataset_Type vocabulary.</span>
<span class="sd">            _skip_version_increment: Internal parameter to skip version increment when</span>
<span class="sd">                called from add_dataset_types (which handles versioning itself).</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLInvalidTerm: If the term doesn&#39;t exist in the Dataset_Type vocabulary.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; dataset.add_dataset_type(&quot;Training&quot;)</span>
<span class="sd">            &gt;&gt;&gt; dataset.add_dataset_type(&quot;Validation&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert to VocabularyTerm if needed (validates the term exists)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">VocabularyTerm</span><span class="p">):</span>
            <span class="n">vocab_term</span> <span class="o">=</span> <span class="n">dataset_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocab_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">)</span>

        <span class="c1"># Check if already present</span>
        <span class="k">if</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Insert into association table</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">atable_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_type_association_table</span><span class="p">()</span>
        <span class="n">atable_path</span><span class="o">.</span><span class="n">insert</span><span class="p">([{</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">:</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">}])</span>

        <span class="c1"># Increment minor version to reflect metadata change (unless called from add_dataset_types)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_skip_version_increment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
                <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Added dataset type: </span><span class="si">{</span><span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_dataset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a dataset type from this dataset.</span>

<span class="sd">        Removes a type term from this dataset if it&#39;s currently associated. The term</span>
<span class="sd">        must exist in the Dataset_Type vocabulary.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_type: Term name (string) or VocabularyTerm object from Dataset_Type vocabulary.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLInvalidTerm: If the term doesn&#39;t exist in the Dataset_Type vocabulary.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; dataset.remove_dataset_type(&quot;Training&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert to VocabularyTerm if needed (validates the term exists)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">VocabularyTerm</span><span class="p">):</span>
            <span class="n">vocab_term</span> <span class="o">=</span> <span class="n">dataset_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vocab_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">)</span>

        <span class="c1"># Check if present</span>
        <span class="k">if</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Delete from association table</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">atable_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_type_association_table</span><span class="p">()</span>
        <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset_Type</span> <span class="o">==</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_dataset_types</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">],</span>
        <span class="n">_skip_version_increment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add one or more dataset types to this dataset.</span>

<span class="sd">        Convenience method for adding multiple types at once. Each term must exist</span>
<span class="sd">        in the Dataset_Type vocabulary. Types that are already associated with the</span>
<span class="sd">        dataset are silently skipped. Increments the dataset&#39;s minor version once</span>
<span class="sd">        after all types are added.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_types: Single term or list of terms. Can be strings (term names)</span>
<span class="sd">                or VocabularyTerm objects.</span>
<span class="sd">            _skip_version_increment: Internal parameter to skip version increment</span>
<span class="sd">                (used during initial dataset creation).</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLInvalidTerm: If any term doesn&#39;t exist in the Dataset_Type vocabulary.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; dataset.add_dataset_types([&quot;Training&quot;, &quot;Image&quot;])</span>
<span class="sd">            &gt;&gt;&gt; dataset.add_dataset_types(&quot;Testing&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize input to a list</span>
        <span class="n">types_to_add</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset_types</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">dataset_types</span>

        <span class="c1"># Track which types were actually added (not already present)</span>
        <span class="n">added_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">types_to_add</span><span class="p">:</span>
            <span class="c1"># Get term name before calling add_dataset_type</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">VocabularyTerm</span><span class="p">):</span>
                <span class="n">term_name</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">term_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

            <span class="c1"># Check if already present before adding</span>
            <span class="k">if</span> <span class="n">term_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_type</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">_skip_version_increment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">added_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term_name</span><span class="p">)</span>

        <span class="c1"># Increment version once for all added types (if any were added)</span>
        <span class="k">if</span> <span class="n">added_types</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_skip_version_increment</span><span class="p">:</span>
            <span class="n">type_names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">added_types</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
                <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Added dataset type(s): </span><span class="si">{</span><span class="n">type_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_dataset_table</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Dataset table from the catalog schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Table: The Deriva Table object for the Dataset table in the ML schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span>

    <span class="c1"># ==================== Read Interface Methods ====================</span>
    <span class="c1"># These methods implement the DatasetLike protocol for read operations.</span>
    <span class="c1"># They delegate to the catalog instance for actual data retrieval.</span>
    <span class="c1"># This allows Dataset and DatasetBag to share a common interface.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_element_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List the types of elements that can be contained in this dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterable of Table objects representing element types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">list_dataset_element_types</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find features associated with a table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table to find features for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterable of Feature objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">find_features</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dataset_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetHistory</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the version history of a dataset.</span>

<span class="sd">        Returns a chronological list of dataset versions, including their version numbers,</span>
<span class="sd">        creation times, and associated metadata.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[DatasetHistory]: List of history entries, each containing:</span>
<span class="sd">                - dataset_version: Version number (major.minor.patch)</span>
<span class="sd">                - minid: Minimal Viable Identifier</span>
<span class="sd">                - snapshot: Catalog snapshot time</span>
<span class="sd">                - dataset_rid: Dataset Resource Identifier</span>
<span class="sd">                - version_rid: Version Resource Identifier</span>
<span class="sd">                - description: Version description</span>
<span class="sd">                - execution_rid: Associated execution RID</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If dataset_rid is not a valid dataset RID.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; history = ml.dataset_history(&quot;1-abc123&quot;)</span>
<span class="sd">            &gt;&gt;&gt; for entry in history:</span>
<span class="sd">            ...     print(f&quot;Version {entry.dataset_version}: {entry.description}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">is_dataset_rid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID is not for a data set: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">version_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Version&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">DatasetHistory</span><span class="p">(</span>
                <span class="n">dataset_version</span><span class="o">=</span><span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Version&quot;</span><span class="p">]),</span>
                <span class="n">minid</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Minid&quot;</span><span class="p">],</span>
                <span class="n">snapshot</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Snapshot&quot;</span><span class="p">],</span>
                <span class="n">dataset_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span>
                <span class="n">version_rid</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Description&quot;</span><span class="p">],</span>
                <span class="n">execution_rid</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">version_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">version_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">current_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetVersion</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the current version of the specified dataset_table.</span>

<span class="sd">        Return the most recent version of the dataset. It is important to remember that this version</span>
<span class="sd">        captures the state of the catalog at the time the version was created, not the current state of the catalog.</span>
<span class="sd">        This means that its possible that the values associated with an object in the catalog may be different</span>
<span class="sd">        from the values of that object in the dataset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple with the semantic version of the dataset_table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_history</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">history</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DatasetVersion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ensure we return a DatasetVersion, not a string</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span><span class="o">.</span><span class="n">dataset_version</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">history</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span> <span class="k">if</span> <span class="n">versions</span> <span class="k">else</span> <span class="n">DatasetVersion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_chaise_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the Chaise URL for viewing this dataset in the browser.</span>

<span class="sd">        Returns:</span>
<span class="sd">            URL string for the dataset record in Chaise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">host_name</span><span class="si">}</span><span class="s2">/chaise/record/&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog_id</span><span class="si">}</span><span class="s2">/deriva-ml:Dataset/RID=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a markdown representation of this dataset.</span>

<span class="sd">        Returns a formatted markdown string with a link to the dataset,</span>
<span class="sd">        version, types, and description. Optionally includes nested children.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_children: If True, include direct child datasets.</span>
<span class="sd">            indent: Number of indent levels (each level is 2 spaces).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Markdown-formatted string.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; ds = ml.lookup_dataset(&quot;4HM&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(ds.to_markdown())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="n">indent</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="k">else</span> <span class="s2">&quot;n/a&quot;</span>
        <span class="n">types</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">- [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_chaise_url</span><span class="p">()</span><span class="si">}</span><span class="s2">) v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="n">types</span><span class="si">}</span><span class="s2">]&quot;</span>
        <span class="k">if</span> <span class="n">desc</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">show_children</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_children</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">show_children</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">display_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a formatted markdown representation of this dataset in Jupyter.</span>

<span class="sd">        Convenience method that calls to_markdown() and displays the result</span>
<span class="sd">        using IPython.display.Markdown.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_children: If True, include direct child datasets.</span>
<span class="sd">            indent: Number of indent levels (each level is 2 spaces).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; ds = ml.lookup_dataset(&quot;4HM&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ds.display_markdown(show_children=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>

        <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">show_children</span><span class="p">,</span> <span class="n">indent</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_dataset_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build a dependency graph of all related datasets and return in topological order.</span>

<span class="sd">        This method is used when incrementing dataset versions. Because datasets can be</span>
<span class="sd">        nested (parent-child relationships), changing the version of one dataset may</span>
<span class="sd">        require updating related datasets.</span>

<span class="sd">        The topological sort ensures that children are processed before parents,</span>
<span class="sd">        so version updates propagate correctly through the hierarchy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterable[Dataset]: Datasets in topological order (children before parents).</span>

<span class="sd">        Example:</span>
<span class="sd">            If dataset A contains nested dataset B, which contains C:</span>
<span class="sd">            A -&gt; B -&gt; C</span>
<span class="sd">            The returned order would be [C, B, A], ensuring C&#39;s version is</span>
<span class="sd">            updated before B&#39;s, and B&#39;s before A&#39;s.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ts</span><span class="p">:</span> <span class="n">TopologicalSorter</span> <span class="o">=</span> <span class="n">TopologicalSorter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_dataset_graph_1</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ts</span><span class="o">.</span><span class="n">static_order</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_dataset_graph_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ts</span><span class="p">:</span> <span class="n">TopologicalSorter</span><span class="p">,</span> <span class="n">visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursively build the dataset dependency graph.</span>

<span class="sd">        Uses topological sort where parents depend on their children, ensuring</span>
<span class="sd">        children are processed before parents in the resulting order.</span>

<span class="sd">        Args:</span>
<span class="sd">            ts: TopologicalSorter instance to add nodes and dependencies to.</span>
<span class="sd">            visited: Set of already-visited dataset RIDs to avoid cycles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
        <span class="c1"># Use current catalog state for graph traversal, not version snapshot.</span>
        <span class="c1"># Parent/child relationships need to reflect current state for version updates.</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_dataset_children_current</span><span class="p">()</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_dataset_parents_current</span><span class="p">()</span>

        <span class="c1"># Add this node with its children as dependencies.</span>
        <span class="c1"># This means: self depends on children, so children will be ordered before self.</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">children</span><span class="p">)</span>

        <span class="c1"># Recursively process children</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_build_dataset_graph_1</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span>

        <span class="c1"># Recursively process parents (they will depend on this node)</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">_build_dataset_graph_1</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">visited</span><span class="p">)</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">increment_dataset_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">component</span><span class="p">:</span> <span class="n">VersionPart</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetVersion</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Increments a dataset&#39;s version number.</span>

<span class="sd">        Creates a new version of the dataset by incrementing the specified version component</span>
<span class="sd">        (major, minor, or patch). The new version is recorded with an optional description</span>
<span class="sd">        and execution reference.</span>

<span class="sd">        Args:</span>
<span class="sd">            component: Which version component to increment (&#39;major&#39;, &#39;minor&#39;, or &#39;patch&#39;).</span>
<span class="sd">            description: Optional description of the changes in this version.</span>
<span class="sd">            execution_rid: Optional execution RID to associate with this version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetVersion: The new version number.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If dataset_rid is invalid or version increment fails.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; new_version = ml.increment_dataset_version(</span>
<span class="sd">            ...     dataset_rid=&quot;1-abc123&quot;,</span>
<span class="sd">            ...     component=&quot;minor&quot;,</span>
<span class="sd">            ...     description=&quot;Added new samples&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;New version: {new_version}&quot;)  # e.g., &quot;1.2.0&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Find all the datasets that are reachable from this dataset and determine their new version numbers.</span>
        <span class="n">related_datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_dataset_graph</span><span class="p">())</span>
        <span class="n">version_update_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DatasetSpec</span><span class="p">(</span>
                <span class="n">rid</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">current_version</span><span class="o">.</span><span class="n">increment_version</span><span class="p">(</span><span class="n">component</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">related_datasets</span>
        <span class="p">]</span>
        <span class="n">Dataset</span><span class="o">.</span><span class="n">_insert_dataset_versions</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="p">,</span> <span class="n">version_update_list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">d</span><span class="o">.</span><span class="n">version</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">version_update_list</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">rid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">))</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_members</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lists members of a dataset.</span>

<span class="sd">        Returns a dictionary mapping member types to lists of member records. Can optionally</span>
<span class="sd">        recurse through nested datasets and limit the number of results.</span>

<span class="sd">        Args:</span>
<span class="sd">            recurse: Whether to include members of nested datasets. Defaults to False.</span>
<span class="sd">            limit: Maximum number of members to return per type. None for no limit.</span>
<span class="sd">            _visited: Internal parameter to track visited datasets and prevent infinite recursion.</span>
<span class="sd">            version: Dataset version to list members from. Defaults to the current version.</span>
<span class="sd">            **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Dictionary mapping member types to lists of members.</span>
<span class="sd">                Each member is a dictionary containing the record&#39;s attributes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If dataset_rid is invalid.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; members = ml.list_dataset_members(&quot;1-abc123&quot;, recurse=True)</span>
<span class="sd">            &gt;&gt;&gt; for type_name, records in members.items():</span>
<span class="sd">            ...     print(f&quot;{type_name}: {len(records)} records&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize visited set for recursion guard</span>
        <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Prevent infinite recursion by checking if we&#39;ve already visited this dataset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>

        <span class="c1"># Look at each of the element types that might be in the dataset_table and get the list of rid for them from</span>
        <span class="c1"># the appropriate association table.</span>
        <span class="n">members</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">assoc_table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">():</span>
            <span class="n">other_fkey</span> <span class="o">=</span> <span class="n">assoc_table</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">target_table</span> <span class="o">=</span> <span class="n">other_fkey</span><span class="o">.</span><span class="n">pk_table</span>
            <span class="n">member_table</span> <span class="o">=</span> <span class="n">assoc_table</span><span class="o">.</span><span class="n">table</span>

            <span class="c1"># Look at domain tables and nested datasets.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">target_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">target_table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span> <span class="ow">or</span> <span class="n">target_table</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;File&quot;</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">member_column</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Nested_Dataset&quot;</span> <span class="k">if</span> <span class="n">target_table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span> <span class="k">else</span> <span class="n">other_fkey</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>
            <span class="c1"># Use the actual referenced column from the FK definition, not always &quot;RID&quot;.</span>
            <span class="c1"># e.g. isa:Dataset_file.file -&gt; isa:file.id (integer), not RID.</span>
            <span class="n">target_column</span> <span class="o">=</span> <span class="n">other_fkey</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

            <span class="n">target_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">target_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">target_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">member_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">member_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">member_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

            <span class="n">path</span> <span class="o">=</span> <span class="n">member_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">member_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">link</span><span class="p">(</span>
                <span class="n">target_path</span><span class="p">,</span>
                <span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="n">member_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">member_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">target_column</span><span class="p">]),</span>
            <span class="p">)</span>
            <span class="n">target_entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>
            <span class="n">members</span><span class="p">[</span><span class="n">target_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">target_entities</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recurse</span> <span class="ow">and</span> <span class="n">target_table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="p">:</span>
                <span class="c1"># Get the members for all the nested datasets and add to the member list.</span>
                <span class="n">nested_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">target_entities</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ds_rid</span> <span class="ow">in</span> <span class="n">nested_datasets</span><span class="p">:</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">ds_rid</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">list_dataset_members</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">members</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_denormalize_datapath</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Denormalize dataset members by joining related tables.</span>

<span class="sd">        This method creates a &quot;wide table&quot; view by joining related tables together using</span>
<span class="sd">        the Deriva datapath API, producing rows that contain columns from all specified</span>
<span class="sd">        tables. The result has outer join semantics - rows from tables without FK</span>
<span class="sd">        relationships are included with NULL values for unrelated columns.</span>

<span class="sd">        The method:</span>
<span class="sd">        1. Gets the list of dataset members for each included table</span>
<span class="sd">        2. For each member in the first table, follows foreign key relationships to</span>
<span class="sd">           get related records from other tables</span>
<span class="sd">        3. Tables without FK connections to the first table are included with NULLs</span>
<span class="sd">        4. Includes nested dataset members recursively</span>

<span class="sd">        Args:</span>
<span class="sd">            include_tables: List of table names to include in the output.</span>
<span class="sd">            version: Dataset version to query. Defaults to current version.</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict[str, Any]: Rows with column names prefixed by table name (e.g., &quot;Image_Filename&quot;).</span>
<span class="sd">                Unrelated tables have NULL values for their columns.</span>

<span class="sd">        Note:</span>
<span class="sd">            Column names in the result are prefixed with the table name to avoid</span>
<span class="sd">            collisions (e.g., &quot;Image_Filename&quot;, &quot;Subject_RID&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Skip system columns in output</span>
        <span class="n">skip_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RCT&quot;</span><span class="p">,</span> <span class="s2">&quot;RMT&quot;</span><span class="p">,</span> <span class="s2">&quot;RCB&quot;</span><span class="p">,</span> <span class="s2">&quot;RMB&quot;</span><span class="p">}</span>

        <span class="c1"># Get all members for the included tables (recursively includes nested datasets)</span>
        <span class="n">members</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_members</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Build a lookup of columns for each table</span>
        <span class="n">table_columns</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">include_tables</span><span class="p">:</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
            <span class="n">table_columns</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip_columns</span>
            <span class="p">]</span>

        <span class="c1"># Find the primary table (first non-empty table in include_tables)</span>
        <span class="n">primary_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">include_tables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">members</span> <span class="ow">and</span> <span class="n">members</span><span class="p">[</span><span class="n">table_name</span><span class="p">]:</span>
                <span class="n">primary_table</span> <span class="o">=</span> <span class="n">table_name</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">primary_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># No data at all</span>
            <span class="k">return</span>

        <span class="n">primary_table_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">primary_table</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">members</span><span class="p">[</span><span class="n">primary_table</span><span class="p">]:</span>
            <span class="c1"># Build the row with all columns from all tables</span>
            <span class="n">row</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Add primary table columns</span>
            <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">table_columns</span><span class="p">[</span><span class="n">primary_table</span><span class="p">]:</span>
                <span class="n">prefixed_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">primary_table</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">row</span><span class="p">[</span><span class="n">prefixed_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>

            <span class="c1"># For each other table, try to join or add NULL values</span>
            <span class="k">for</span> <span class="n">other_table_name</span> <span class="ow">in</span> <span class="n">include_tables</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">other_table_name</span> <span class="o">==</span> <span class="n">primary_table</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">other_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">other_table_name</span><span class="p">)</span>
                <span class="n">other_cols</span> <span class="o">=</span> <span class="n">table_columns</span><span class="p">[</span><span class="n">other_table_name</span><span class="p">]</span>

                <span class="c1"># Initialize all columns to None (outer join behavior)</span>
                <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">other_cols</span><span class="p">:</span>
                    <span class="n">prefixed_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">other_table_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">prefixed_name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># Try to find FK relationship and join</span>
                <span class="k">if</span> <span class="n">other_table_name</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">relationship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_table_relationship</span><span class="p">(</span>
                            <span class="n">primary_table_obj</span><span class="p">,</span> <span class="n">other_table</span>
                        <span class="p">)</span>
                        <span class="n">fk_col</span><span class="p">,</span> <span class="n">pk_col</span> <span class="o">=</span> <span class="n">relationship</span>

                        <span class="c1"># Look up the related record</span>
                        <span class="n">fk_value</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fk_col</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">fk_value</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">other_member</span> <span class="ow">in</span> <span class="n">members</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">other_table_name</span><span class="p">,</span> <span class="p">[]):</span>
                                <span class="k">if</span> <span class="n">other_member</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk_col</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">fk_value</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="n">other_cols</span><span class="p">:</span>
                                        <span class="n">prefixed_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">other_table_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">col_name</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="n">row</span><span class="p">[</span><span class="n">prefixed_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">other_member</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col_name</span><span class="p">)</span>
                                    <span class="k">break</span>
                    <span class="k">except</span> <span class="n">DerivaMLException</span><span class="p">:</span>
                        <span class="c1"># No FK relationship - columns remain NULL (outer join)</span>
                        <span class="k">pass</span>

            <span class="k">yield</span> <span class="n">row</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">denormalize_as_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Denormalize the dataset into a single wide table (DataFrame).</span>

<span class="sd">        Denormalization transforms normalized relational data into a single &quot;wide table&quot;</span>
<span class="sd">        (also called a &quot;flat table&quot; or &quot;denormalized table&quot;) by joining related tables</span>
<span class="sd">        together. This produces a DataFrame where each row contains all related information</span>
<span class="sd">        from multiple source tables, with columns from each table combined side-by-side.</span>

<span class="sd">        Wide tables are the standard input format for most machine learning frameworks,</span>
<span class="sd">        which expect all features for a single observation to be in one row. This method</span>
<span class="sd">        bridges the gap between normalized database schemas and ML-ready tabular data.</span>

<span class="sd">        **How it works:**</span>

<span class="sd">        Tables are joined based on their foreign key relationships. For example, if</span>
<span class="sd">        Image has a foreign key to Subject, and Diagnosis has a foreign key to Image,</span>
<span class="sd">        then denormalizing [&quot;Subject&quot;, &quot;Image&quot;, &quot;Diagnosis&quot;] produces rows where each</span>
<span class="sd">        image appears with its subject&#39;s metadata and any associated diagnoses.</span>

<span class="sd">        **Column naming:**</span>

<span class="sd">        Column names are prefixed with the source table name using underscores</span>
<span class="sd">        to avoid collisions (e.g., &quot;Image_Filename&quot;, &quot;Subject_RID&quot;).</span>

<span class="sd">        Args:</span>
<span class="sd">            include_tables: List of table names to include in the output. Tables</span>
<span class="sd">                are joined based on their foreign key relationships.</span>
<span class="sd">                Order doesn&#39;t matter - the join order is determined automatically.</span>
<span class="sd">            version: Dataset version to query. Defaults to current version.</span>
<span class="sd">                Use this to get a reproducible snapshot of the data.</span>
<span class="sd">            **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Wide table with columns from all included tables.</span>

<span class="sd">        Example:</span>
<span class="sd">            Create a training dataset with images and their labels::</span>

<span class="sd">                &gt;&gt;&gt; # Get all images with their diagnoses in one table</span>
<span class="sd">                &gt;&gt;&gt; df = dataset.denormalize_as_dataframe([&quot;Image&quot;, &quot;Diagnosis&quot;])</span>
<span class="sd">                &gt;&gt;&gt; print(df.columns.tolist())</span>
<span class="sd">                [&#39;Image_RID&#39;, &#39;Image_Filename&#39;, &#39;Image_URL&#39;, &#39;Diagnosis_RID&#39;,</span>
<span class="sd">                 &#39;Diagnosis_Label&#39;, &#39;Diagnosis_Confidence&#39;]</span>

<span class="sd">                &gt;&gt;&gt; # Use with scikit-learn</span>
<span class="sd">                &gt;&gt;&gt; X = df[[&quot;Image_Filename&quot;]]  # Features</span>
<span class="sd">                &gt;&gt;&gt; y = df[&quot;Diagnosis_Label&quot;]    # Labels</span>

<span class="sd">            Include subject metadata for stratified splitting::</span>

<span class="sd">                &gt;&gt;&gt; df = dataset.denormalize_as_dataframe(</span>
<span class="sd">                ...     [&quot;Subject&quot;, &quot;Image&quot;, &quot;Diagnosis&quot;]</span>
<span class="sd">                ... )</span>
<span class="sd">                &gt;&gt;&gt; # Now df has Subject_Age, Subject_Gender, etc.</span>
<span class="sd">                &gt;&gt;&gt; # for stratified train/test splits by subject</span>

<span class="sd">        See Also:</span>
<span class="sd">            denormalize_as_dict: Generator version for memory-efficient processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_denormalize_datapath</span><span class="p">(</span><span class="n">include_tables</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">denormalize_as_dict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Denormalize the dataset and yield rows as dictionaries.</span>

<span class="sd">        This is a memory-efficient alternative to denormalize_as_dataframe() that</span>
<span class="sd">        yields one row at a time as a dictionary instead of loading all data into</span>
<span class="sd">        a DataFrame. Use this when processing large datasets that may not fit in</span>
<span class="sd">        memory, or when you want to process rows incrementally.</span>

<span class="sd">        Like denormalize_as_dataframe(), this produces a &quot;wide table&quot; representation</span>
<span class="sd">        where each yielded dictionary contains all columns from the joined tables.</span>
<span class="sd">        See denormalize_as_dataframe() for detailed explanation of how denormalization</span>
<span class="sd">        works.</span>

<span class="sd">        **Column naming:**</span>

<span class="sd">        Column names are prefixed with the source table name using underscores</span>
<span class="sd">        to avoid collisions (e.g., &quot;Image_Filename&quot;, &quot;Subject_RID&quot;).</span>

<span class="sd">        Args:</span>
<span class="sd">            include_tables: List of table names to include in the output.</span>
<span class="sd">                Tables are joined based on their foreign key relationships.</span>
<span class="sd">            version: Dataset version to query. Defaults to current version.</span>
<span class="sd">            **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">        Yields:</span>
<span class="sd">            dict[str, Any]: Dictionary representing one row of the wide table.</span>
<span class="sd">                Keys are column names in &quot;Table_Column&quot; format.</span>

<span class="sd">        Example:</span>
<span class="sd">            Process images one at a time for training::</span>

<span class="sd">                &gt;&gt;&gt; for row in dataset.denormalize_as_dict([&quot;Image&quot;, &quot;Diagnosis&quot;]):</span>
<span class="sd">                ...     # Load and preprocess each image</span>
<span class="sd">                ...     img = load_image(row[&quot;Image_Filename&quot;])</span>
<span class="sd">                ...     label = row[&quot;Diagnosis_Label&quot;]</span>
<span class="sd">                ...     yield img, label  # Feed to training loop</span>

<span class="sd">            Count labels without loading all data into memory::</span>

<span class="sd">                &gt;&gt;&gt; from collections import Counter</span>
<span class="sd">                &gt;&gt;&gt; labels = Counter()</span>
<span class="sd">                &gt;&gt;&gt; for row in dataset.denormalize_as_dict([&quot;Image&quot;, &quot;Diagnosis&quot;]):</span>
<span class="sd">                ...     labels[row[&quot;Diagnosis_Label&quot;]] += 1</span>
<span class="sd">                &gt;&gt;&gt; print(labels)</span>
<span class="sd">                Counter({&#39;Normal&#39;: 450, &#39;Abnormal&#39;: 150})</span>

<span class="sd">        See Also:</span>
<span class="sd">            denormalize_as_dataframe: Returns all data as a pandas DataFrame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denormalize_datapath</span><span class="p">(</span><span class="n">include_tables</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_dataset_members</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">members</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]],</span>
        <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds members to a dataset.</span>

<span class="sd">        Associates one or more records with a dataset. Members can be provided in two forms:</span>

<span class="sd">        **List of RIDs (simpler but slower):**</span>
<span class="sd">        When `members` is a list of RIDs, each RID is resolved to determine which table</span>
<span class="sd">        it belongs to. This uses batch RID resolution for efficiency, but still requires</span>
<span class="sd">        querying the catalog to identify each RID&#39;s table.</span>

<span class="sd">        **Dictionary by table name (faster, recommended for large datasets):**</span>
<span class="sd">        When `members` is a dict mapping table names to lists of RIDs, no RID resolution</span>
<span class="sd">        is needed. The RIDs are inserted directly into the dataset. Use this form when</span>
<span class="sd">        you already know which table each RID belongs to.</span>

<span class="sd">        **Important:** Members can only be added from tables that have been registered as</span>
<span class="sd">        dataset element types. Use :meth:`DerivaML.add_dataset_element_type` to register</span>
<span class="sd">        a table before adding its records to datasets.</span>

<span class="sd">        Adding members automatically increments the dataset&#39;s minor version.</span>

<span class="sd">        Args:</span>
<span class="sd">            members: Either:</span>
<span class="sd">                - list[RID]: List of RIDs to add. Each RID will be resolved to find its table.</span>
<span class="sd">                - dict[str, list[RID]]: Mapping of table names to RID lists. Skips resolution.</span>
<span class="sd">            validate: Whether to validate that members don&#39;t already exist. Defaults to True.</span>
<span class="sd">            description: Optional description of the member additions.</span>
<span class="sd">            execution_rid: Optional execution RID to associate with changes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If:</span>
<span class="sd">                - Any RID is invalid or cannot be resolved</span>
<span class="sd">                - Any RID belongs to a table that isn&#39;t registered as a dataset element type</span>
<span class="sd">                - Adding members would create a cycle (for nested datasets)</span>
<span class="sd">                - Validation finds duplicate members (when validate=True)</span>

<span class="sd">        See Also:</span>
<span class="sd">            :meth:`DerivaML.add_dataset_element_type`: Register a table as a dataset element type.</span>
<span class="sd">            :meth:`DerivaML.list_dataset_element_types`: List registered dataset element types.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Using a list of RIDs (simpler):</span>
<span class="sd">                &gt;&gt;&gt; dataset.add_dataset_members(</span>
<span class="sd">                ...     members=[&quot;1-ABC&quot;, &quot;1-DEF&quot;, &quot;1-GHI&quot;],</span>
<span class="sd">                ...     description=&quot;Added sample images&quot;</span>
<span class="sd">                ... )</span>

<span class="sd">            Using a dict by table name (faster for large datasets):</span>
<span class="sd">                &gt;&gt;&gt; dataset.add_dataset_members(</span>
<span class="sd">                ...     members={</span>
<span class="sd">                ...         &quot;Image&quot;: [&quot;1-ABC&quot;, &quot;1-DEF&quot;],</span>
<span class="sd">                ...         &quot;Subject&quot;: [&quot;2-XYZ&quot;]</span>
<span class="sd">                ...     },</span>
<span class="sd">                ...     description=&quot;Added images and subjects&quot;</span>
<span class="sd">                ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="s2">&quot;Updated dataset via add_dataset_members&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_dataset_cycle</span><span class="p">(</span><span class="n">member_rid</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">            Args:</span>
<span class="sd">              member_rid:</span>
<span class="sd">              path: (Default value = None)</span>

<span class="sd">            Returns:</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">member_rid</span> <span class="ow">in</span> <span class="n">path</span>

        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="n">existing_rids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_members</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">:=</span> <span class="nb">set</span><span class="p">(</span><span class="n">existing_rids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempting to add existing member to dataset_table </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Now go through every rid to be added to the data set and sort them based on what association table entries</span>
        <span class="c1"># need to be made.</span>
        <span class="n">dataset_elements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Build map of valid element tables to their association tables</span>
        <span class="n">associations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">())</span>
        <span class="n">association_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">associations</span><span class="p">}</span>

        <span class="c1"># Get a list of all the object types that can be linked to a dataset_table.</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>

            <span class="c1"># Get candidate tables for batch resolution (only tables that can be dataset elements)</span>
            <span class="n">candidate_tables</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">association_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span>

            <span class="c1"># Batch resolve all RIDs at once instead of one-by-one</span>
            <span class="n">rid_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">resolve_rids</span><span class="p">(</span><span class="n">members</span><span class="p">,</span> <span class="n">candidate_tables</span><span class="o">=</span><span class="n">candidate_tables</span><span class="p">)</span>

            <span class="c1"># Group by table and validate</span>
            <span class="k">for</span> <span class="n">rid</span><span class="p">,</span> <span class="n">rid_info</span> <span class="ow">in</span> <span class="n">rid_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">association_map</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID table: </span><span class="si">{</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not part of dataset_table&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span> <span class="ow">and</span> <span class="n">check_dataset_cycle</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">rid</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Creating cycle of datasets is not allowed&quot;</span><span class="p">)</span>
                <span class="n">dataset_elements</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_elements</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ms</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">members</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># Now make the entries into the association tables.</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">dataset_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Determine schema: ML schema for Dataset/File, otherwise use the table&#39;s actual schema</span>
            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;File&quot;</span><span class="p">:</span>
                <span class="n">schema_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Find the table and use its schema</span>
                <span class="n">table_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                <span class="n">schema_name</span> <span class="o">=</span> <span class="n">table_obj</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span>
            <span class="n">schema_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
            <span class="n">fk_column</span> <span class="o">=</span> <span class="s2">&quot;Nested_Dataset&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span> <span class="k">else</span> <span class="n">table</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                <span class="c1"># Find out the name of the column in the association table.</span>
                <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">association_map</span><span class="p">[</span><span class="n">table</span><span class="p">]]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="p">[{</span><span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span> <span class="n">fk_column</span><span class="p">:</span> <span class="n">e</span><span class="p">}</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
            <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_dataset_members</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">members</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">],</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove members from this dataset.</span>

<span class="sd">        Removes the specified members from the dataset. In addition to removing members,</span>
<span class="sd">        the minor version number of the dataset is incremented and the description,</span>
<span class="sd">        if provided, is applied to that new version.</span>

<span class="sd">        Args:</span>
<span class="sd">            members: List of member RIDs to remove from the dataset.</span>
<span class="sd">            description: Optional description of the removal operation.</span>
<span class="sd">            execution_rid: Optional RID of execution associated with this operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If any RID is invalid or not part of this dataset.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; dataset.delete_dataset_members(</span>
<span class="sd">            ...     members=[&quot;1-ABC&quot;, &quot;1-DEF&quot;],</span>
<span class="sd">            ...     description=&quot;Removed corrupted samples&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="s2">&quot;Deleted dataset members&quot;</span>

        <span class="c1"># Go through every rid to be deleted and sort them based on what association table entries</span>
        <span class="c1"># need to be removed.</span>
        <span class="n">dataset_elements</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">association_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="c1"># Get a list of all the object types that can be linked to a dataset.</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid RID: </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">association_map</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID table: </span><span class="si">{</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not part of dataset&quot;</span><span class="p">)</span>
            <span class="n">dataset_elements</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>

        <span class="c1"># Delete the entries from the association tables.</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">dataset_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Determine schema: ML schema for Dataset, otherwise use the table&#39;s actual schema</span>
            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
                <span class="n">schema_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Find the table and use its schema</span>
                <span class="n">table_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
                <span class="n">schema_name</span> <span class="o">=</span> <span class="n">table_obj</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span>
            <span class="n">schema_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
            <span class="n">fk_column</span> <span class="o">=</span> <span class="s2">&quot;Nested_Dataset&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span> <span class="k">else</span> <span class="n">table</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                <span class="n">atable_path</span> <span class="o">=</span> <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">association_map</span><span class="p">[</span><span class="n">table</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">entity</span> <span class="o">=</span> <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">fk_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">e</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="n">entity</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
            <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_parents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a dataset_table RID, return a list of RIDs of the parent datasets if this is included in a</span>
<span class="sd">        nested dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            recurse: If True, recursively return all ancestor datasets.</span>
<span class="sd">            _visited: Internal parameter to track visited datasets and prevent infinite recursion.</span>
<span class="sd">            version: Dataset version to list parents from. Defaults to the current version.</span>
<span class="sd">            **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of parent datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize visited set for recursion guard</span>
        <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># Prevent infinite recursion by checking if we&#39;ve already visited this dataset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>

        <span class="c1"># Get association table for nested datasets</span>
        <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">atable_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Dataset</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Nested_Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="n">parents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">list_dataset_parents</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">parents</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_children</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given a dataset_table RID, return a list of RIDs for any nested datasets.</span>

<span class="sd">        Args:</span>
<span class="sd">            recurse: If True, return a list of nested datasets RIDs.</span>
<span class="sd">            _visited: Internal parameter to track visited datasets and prevent infinite recursion.</span>
<span class="sd">            version: Dataset version to list children from. Defaults to the current version.</span>
<span class="sd">            **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">        Returns:</span>
<span class="sd">          list of nested dataset RIDs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize visited set for recursion guard</span>
        <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">version</span> <span class="o">=</span> <span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">version</span>
        <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">dataset_dataset_path</span> <span class="o">=</span> <span class="p">(</span>
           <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Dataset&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">nested_datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset_dataset_path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">find_children</span><span class="p">(</span><span class="n">rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]:</span>
            <span class="c1"># Prevent infinite recursion by checking if we&#39;ve already visited this dataset</span>
            <span class="k">if</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>

            <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;Nested_Dataset&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">nested_datasets</span> <span class="k">if</span> <span class="n">child</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rid</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                    <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_children</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">children</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span> <span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">find_children</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_list_dataset_parents_current</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return parent datasets using current catalog state (not version snapshot).</span>

<span class="sd">        Used by _build_dataset_graph_1 to find all related datasets for version updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">atable_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Dataset</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Nested_Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_list_dataset_children_current</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return child datasets using current catalog state (not version snapshot).</span>

<span class="sd">        Used by _build_dataset_graph_1 to find all related datasets for version updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dataset_dataset_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Dataset&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">nested_datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset_dataset_path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">find_children</span><span class="p">(</span><span class="n">rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;Nested_Dataset&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">nested_datasets</span> <span class="k">if</span> <span class="n">child</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rid</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span> <span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">find_children</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_executions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all executions associated with this dataset.</span>

<span class="sd">        Returns all executions that used this dataset as input. This is</span>
<span class="sd">        tracked through the Dataset_Execution association table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Execution objects associated with this dataset.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; dataset = ml.lookup_dataset(&quot;1-abc123&quot;)</span>
<span class="sd">            &gt;&gt;&gt; executions = dataset.list_executions()</span>
<span class="sd">            &gt;&gt;&gt; for exe in executions:</span>
<span class="sd">            ...     print(f&quot;Execution {exe.execution_rid}: {exe.status}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Import here to avoid circular dependency</span>

        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">dataset_execution_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Execution</span>

        <span class="c1"># Query for all executions associated with this dataset</span>
        <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">dataset_execution_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dataset_execution_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
            <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_execution</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_insert_dataset_versions</span><span class="p">(</span>
        <span class="n">ml_instance</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
        <span class="n">dataset_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetSpec</span><span class="p">],</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert new version records for a list of datasets.</span>

<span class="sd">        This internal method creates Dataset_Version records in the catalog for</span>
<span class="sd">        each dataset in the list. It also captures a catalog snapshot timestamp</span>
<span class="sd">        to associate with these versions.</span>

<span class="sd">        The version record links:</span>
<span class="sd">        - The dataset RID to its new version number</span>
<span class="sd">        - An optional description of what changed</span>
<span class="sd">        - An optional execution that triggered the version change</span>
<span class="sd">        - The catalog snapshot time for reproducibility</span>

<span class="sd">        Args:</span>
<span class="sd">            ml_instance: The catalog instance to insert versions into.</span>
<span class="sd">            dataset_list: List of DatasetSpec objects containing RID and version info.</span>
<span class="sd">            description: Optional description of the version change.</span>
<span class="sd">            execution_rid: Optional execution RID to associate with the version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema_path</span> <span class="o">=</span> <span class="n">ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span>

        <span class="c1"># Insert version records for all datasets in the list</span>
        <span class="n">version_records</span> <span class="o">=</span> <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span>
                    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">version</span><span class="p">),</span>
                    <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;Execution&quot;</span><span class="p">:</span> <span class="n">execution_rid</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">dataset_list</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">version_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">version_records</span><span class="p">)</span>

        <span class="c1"># Capture the current catalog snapshot timestamp. This allows us to</span>
        <span class="c1"># recreate the exact state of the catalog when this version was created.</span>
        <span class="n">snap</span> <span class="o">=</span> <span class="n">ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;snaptime&quot;</span><span class="p">]</span>

        <span class="c1"># Update version records with the snapshot timestamp</span>
        <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">[{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">],</span> <span class="s2">&quot;Snapshot&quot;</span><span class="p">:</span> <span class="n">snap</span><span class="p">}</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">version_records</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Update each dataset&#39;s current version pointer to the new version record</span>
        <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">([{</span><span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span> <span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">version_records</span><span class="p">])</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_dataset_bag</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">materialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_minid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">exclude_tables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetBag</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Downloads a dataset to the local filesystem and optionally creates a MINID.</span>

<span class="sd">        Downloads a dataset to the local file system. If the dataset has a version set, that version is used.</span>
<span class="sd">        If the dataset has a version and a version is provided, the version specified takes precedence.</span>

<span class="sd">        The exported bag contains all data reachable from this dataset&#39;s members by following</span>
<span class="sd">        foreign key relationships (both incoming and outgoing). Starting from each member element</span>
<span class="sd">        type, the export traverses all FK-connected tables, with vocabulary tables acting as</span>
<span class="sd">        natural path terminators. Only paths starting from element types that have members in</span>
<span class="sd">        this dataset are included.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: Dataset version to download. If not specified, the version must be set in the dataset.</span>
<span class="sd">            materialize: If True, materialize the dataset after downloading.</span>
<span class="sd">            use_minid: If True, upload the bag to S3 and create a MINID for the dataset.</span>
<span class="sd">                Requires s3_bucket to be configured on the catalog. Defaults to False.</span>
<span class="sd">            exclude_tables: Optional set of table names to exclude from FK path traversal</span>
<span class="sd">                during bag export. Tables in this set will not be visited, pruning branches</span>
<span class="sd">                of the FK graph that pass through them. Useful for avoiding query timeouts</span>
<span class="sd">                caused by expensive joins through large or unnecessary tables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetBag: Object containing:</span>
<span class="sd">                - path: Local filesystem path to downloaded dataset</span>
<span class="sd">                - rid: Dataset&#39;s Resource Identifier</span>
<span class="sd">                - minid: Dataset&#39;s Minimal Viable Identifier (if use_minid=True)</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If use_minid=True but s3_bucket is not configured on the catalog.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Download without MINID (default):</span>
<span class="sd">                &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;)</span>
<span class="sd">                &gt;&gt;&gt; print(f&quot;Downloaded to {bag.path}&quot;)</span>

<span class="sd">            Download with MINID (requires s3_bucket configured):</span>
<span class="sd">                &gt;&gt;&gt; # Catalog must be created with s3_bucket=&quot;s3://my-bucket&quot;</span>
<span class="sd">                &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;, use_minid=True)</span>

<span class="sd">            Exclude tables that cause query timeouts:</span>
<span class="sd">                &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;, exclude_tables={&quot;Process&quot;})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

        <span class="c1"># Validate use_minid requires s3_bucket configuration</span>
        <span class="k">if</span> <span class="n">use_minid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">s3_bucket</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="s2">&quot;Cannot use use_minid=True without s3_bucket configured. &quot;</span>
                <span class="s2">&quot;Configure s3_bucket when creating the DerivaML instance to enable MINID support.&quot;</span>
            <span class="p">)</span>

        <span class="n">minid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_minid</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_minid</span><span class="o">=</span><span class="n">use_minid</span><span class="p">,</span> <span class="n">exclude_tables</span><span class="o">=</span><span class="n">exclude_tables</span><span class="p">)</span>

        <span class="n">bag_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_materialize_dataset_bag</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">use_minid</span><span class="o">=</span><span class="n">use_minid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">materialize</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dataset_minid</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">use_minid</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.model.deriva_ml_database</span><span class="w"> </span><span class="kn">import</span> <span class="n">DerivaMLDatabase</span>
        <span class="n">db_model</span> <span class="o">=</span> <span class="n">DatabaseModel</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">bag_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">working_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DerivaMLDatabase</span><span class="p">(</span><span class="n">db_model</span><span class="p">)</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_version_snapshot_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivaMLCatalog</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a catalog instance bound to a specific version&#39;s snapshot.</span>

<span class="sd">        Dataset versions are associated with catalog snapshots, which represent</span>
<span class="sd">        the exact state of the catalog at the time the version was created.</span>
<span class="sd">        This method returns a catalog instance that queries against that snapshot,</span>
<span class="sd">        ensuring reproducible access to historical data.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_version: The version to get a snapshot for, or None to use</span>
<span class="sd">                the current catalog state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DerivaMLCatalog: Either a snapshot-bound catalog or the current catalog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_version</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">dataset_version</span> <span class="o">=</span> <span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">dataset_version</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataset_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog_snapshot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog_id</span><span class="p">(</span><span class="n">dataset_version</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_version_snapshot_catalog_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the catalog ID with snapshot suffix for a specific version.</span>

<span class="sd">        Constructs a catalog identifier in the format &quot;catalog_id@snapshot_time&quot;</span>
<span class="sd">        that can be used to access the catalog state at the time the version</span>
<span class="sd">        was created.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: The dataset version to get the snapshot for.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Catalog ID with snapshot suffix (e.g., &quot;1@2023-01-15T10:30:00&quot;).</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If the specified version doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version_record</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_history</span><span class="p">()</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">dataset_version</span> <span class="o">==</span> <span class="n">version</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset version </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2"> not found for dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">catalog_id</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">version_record</span><span class="o">.</span><span class="n">snapshot</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">version_record</span><span class="o">.</span><span class="n">snapshot</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">catalog_id</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_download_dataset_minid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minid</span><span class="p">:</span> <span class="n">DatasetMinid</span><span class="p">,</span> <span class="n">use_minid</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download and extract a dataset bag from a MINID or direct URL.</span>

<span class="sd">        This method handles the download of a BDBag archive, either from S3 storage</span>
<span class="sd">        (if using MINIDs) or directly from the catalog server. Downloaded bags are</span>
<span class="sd">        cached by checksum to avoid redundant downloads.</span>

<span class="sd">        Args:</span>
<span class="sd">            minid: DatasetMinid containing the bag URL and metadata.</span>
<span class="sd">            use_minid: If True, download from S3 using the MINID URL.</span>
<span class="sd">                If False, download directly from the catalog server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path: The path to the extracted and validated bag directory.</span>

<span class="sd">        Note:</span>
<span class="sd">            Bags are cached in the cache_dir with the naming convention:</span>
<span class="sd">            &quot;{dataset_rid}_{checksum}/Dataset_{dataset_rid}&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check to see if we have an existing idempotent materialization of the desired bag. If so, then reuse</span>
        <span class="c1"># it.  If not, then we need to extract the contents of the archive into our cache directory.</span>
        <span class="n">bag_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">checksum</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">bag_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using cached bag for  </span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2"> Version:</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">bag_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Dataset_</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Either bag hasn&#39;t been downloaded yet, or we are not using a Minid, so we don&#39;t know the checksum yet.</span>
        <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_minid</span><span class="p">:</span>
                <span class="c1"># Get bag from S3</span>
                <span class="n">bag_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">minid</span><span class="o">.</span><span class="n">bag_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                <span class="n">archive_path</span> <span class="o">=</span> <span class="n">fetch_single_file</span><span class="p">(</span><span class="n">minid</span><span class="o">.</span><span class="n">bag_url</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="n">bag_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">minid</span><span class="o">.</span><span class="n">bag_url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;file://&quot;</span><span class="p">):</span>
                <span class="c1"># Client-side generated bag  already local</span>
                <span class="n">archive_path</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">minid</span><span class="o">.</span><span class="n">bag_url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">exporter</span> <span class="o">=</span> <span class="n">DerivaExport</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">deriva_server</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
                <span class="n">archive_path</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">retrieve_file</span><span class="p">(</span><span class="n">minid</span><span class="o">.</span><span class="n">bag_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_minid</span><span class="p">:</span>
                <span class="n">hashes</span> <span class="o">=</span> <span class="n">hash_utils</span><span class="o">.</span><span class="n">compute_file_hashes</span><span class="p">(</span><span class="n">archive_path</span><span class="p">,</span> <span class="n">hashes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">,</span> <span class="s2">&quot;sha256&quot;</span><span class="p">])</span>
                <span class="n">checksum</span> <span class="o">=</span> <span class="n">hashes</span><span class="p">[</span><span class="s2">&quot;sha256&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bag_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">checksum</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">bag_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using cached bag for  </span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2"> Version:</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">bag_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;Dataset_</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">bag_path</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">extract_bag</span><span class="p">(</span><span class="n">archive_path</span><span class="p">,</span> <span class="n">bag_dir</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">validate_bag_structure</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataset_minid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span><span class="p">,</span> <span class="n">use_minid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_tables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new MINID (Minimal Viable Identifier) for the dataset.</span>

<span class="sd">        This method generates a BDBag export of the dataset and optionally</span>
<span class="sd">        registers it with a MINID service for persistent identification.</span>
<span class="sd">        The bag is uploaded to S3 storage when using MINIDs.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: The dataset version to create a MINID for.</span>
<span class="sd">            use_minid: If True, register with MINID service and upload to S3.</span>
<span class="sd">                If False, just generate the bag and return a local URL.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: URL to the MINID landing page (if use_minid=True) or</span>
<span class="sd">                the direct bag download URL.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="c1"># Generate a download specification file for the current catalog schema. By default, this spec</span>
            <span class="c1"># will generate a minid and place the bag into S3 storage.</span>
            <span class="n">spec_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;download_spec.json&quot;</span>
            <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="n">downloader</span> <span class="o">=</span> <span class="n">CatalogGraph</span><span class="p">(</span>
                <span class="n">version_snapshot_catalog</span><span class="p">,</span>
                <span class="n">s3_bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">s3_bucket</span><span class="p">,</span>
                <span class="n">use_minid</span><span class="o">=</span><span class="n">use_minid</span><span class="p">,</span>
                <span class="n">exclude_tables</span><span class="o">=</span><span class="n">exclude_tables</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">generate_dataset_download_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">spec_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Downloading dataset </span><span class="si">%s</span><span class="s2"> for catalog: </span><span class="si">%s</span><span class="s2">@</span><span class="si">%s</span><span class="s2">&quot;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="s2">&quot;minid&quot;</span> <span class="k">if</span> <span class="n">use_minid</span> <span class="k">else</span> <span class="s2">&quot;bag&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">use_minid</span><span class="p">:</span>
                <span class="c1"># Server-side export: generates bag, uploads to S3, registers MINID.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">exporter</span> <span class="o">=</span> <span class="n">DerivaExport</span><span class="p">(</span>
                        <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">deriva_server</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                        <span class="n">config_file</span><span class="o">=</span><span class="n">spec_file</span><span class="p">,</span>
                        <span class="n">output_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">,</span>
                        <span class="n">defer_download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">610</span><span class="p">),</span>
                        <span class="n">envars</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">},</span>
                    <span class="p">)</span>
                    <span class="n">minid_page_url</span> <span class="o">=</span> <span class="n">exporter</span><span class="o">.</span><span class="n">export</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span> <span class="p">(</span>
                    <span class="n">DerivaDownloadError</span><span class="p">,</span>
                    <span class="n">DerivaDownloadConfigurationError</span><span class="p">,</span>
                    <span class="n">DerivaDownloadAuthenticationError</span><span class="p">,</span>
                    <span class="n">DerivaDownloadAuthorizationError</span><span class="p">,</span>
                    <span class="n">DerivaDownloadTimeoutError</span><span class="p">,</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="n">format_exception</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="c1"># Update version table with MINID.</span>
                <span class="n">version_path</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Version&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">version_rid</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_history</span><span class="p">()</span> <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">dataset_version</span> <span class="o">==</span> <span class="n">version</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">version_rid</span>
                <span class="n">version_path</span><span class="o">.</span><span class="n">update</span><span class="p">([{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="n">version_rid</span><span class="p">,</span> <span class="s2">&quot;Minid&quot;</span><span class="p">:</span> <span class="n">minid_page_url</span><span class="p">}])</span>
                <span class="k">return</span> <span class="n">minid_page_url</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Client-side download: runs queries locally with paged query support</span>
                <span class="c1"># for automatic retry on query timeout errors. This avoids server-side</span>
                <span class="c1"># export lock contention and gives better control over query execution.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_bag_client</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_dataset_bag_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dataset bag using client-side download.</span>

<span class="sd">        Executes ERMrest queries directly using ErmrestCatalog.get_as_file() with</span>
<span class="sd">        paged query support, building a BDBag from the results.</span>

<span class="sd">        If any CSV data query fails (e.g., due to server-side query timeouts on deep</span>
<span class="sd">        multi-table joins), the method raises a DerivaMLException listing the failed</span>
<span class="sd">        tables and suggesting that the user add those records as direct dataset members.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: The dataset version to export.</span>
<span class="sd">            spec: The download specification dict (from generate_dataset_download_spec).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A file:// URI pointing to the generated bag zip archive.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If any data query fails during export.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

        <span class="kn">from</span><span class="w"> </span><span class="nn">deriva.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">DerivaServer</span><span class="p">,</span> <span class="n">get_credential</span>

        <span class="n">snapshot_catalog_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog_id</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">deriva_server</span><span class="o">.</span><span class="n">server</span>
        <span class="n">protocol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">deriva_server</span><span class="o">.</span><span class="n">scheme</span>

        <span class="c1"># Connect to the snapshot catalog</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">get_credential</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">DerivaServer</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">hostname</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
        <span class="n">catalog</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">connect_ermrest</span><span class="p">(</span><span class="n">snapshot_catalog_id</span><span class="p">)</span>

        <span class="c1"># Build bag in a persistent directory (survives for _download_dataset_minid)</span>
        <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">working_dir</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;client_export&quot;</span> <span class="o">/</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())[:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">tmp_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Format environment variables</span>
        <span class="n">envars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">}</span>
        <span class="n">bag_config</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bag&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">bag_name</span> <span class="o">=</span> <span class="n">bag_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bag_name&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Dataset_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">envars</span><span class="p">)</span>
        <span class="n">bag_path</span> <span class="o">=</span> <span class="n">tmp_dir</span> <span class="o">/</span> <span class="n">bag_name</span>
        <span class="n">bag_algorithms</span> <span class="o">=</span> <span class="n">bag_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bag_algorithms&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;md5&quot;</span><span class="p">])</span>

        <span class="c1"># Create the bag</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">ensure_bag_path_exists</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bag_path</span><span class="p">))</span>
        <span class="n">bag</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">make_bag</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bag_path</span><span class="p">),</span> <span class="n">algs</span><span class="o">=</span><span class="n">bag_algorithms</span><span class="p">,</span> <span class="n">idempotent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Process query_processors from the spec</span>
        <span class="n">query_processors</span> <span class="o">=</span> <span class="n">spec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;catalog&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_processors&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">failed_queries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skipped_empty</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fetch_entries</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># (url, length, rel_path, md5) tuples for fetch.txt</span>

        <span class="k">for</span> <span class="n">qp</span> <span class="ow">in</span> <span class="n">query_processors</span><span class="p">:</span>
            <span class="n">processor_name</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;processor&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;processor_params&quot;</span><span class="p">,</span> <span class="p">{})</span>

            <span class="k">if</span> <span class="n">processor_name</span> <span class="o">==</span> <span class="s2">&quot;env&quot;</span><span class="p">:</span>
                <span class="c1"># Environment variable processors  execute and capture values</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">query_path</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">query_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">envars</span><span class="p">)</span>
                <span class="n">query_keys</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_keys&quot;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">query_path</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                        <span class="c1"># Root query returns catalog metadata including snaptime</span>
                        <span class="n">resp</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">resp</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_path</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">resp</span><span class="p">:</span>
                        <span class="n">resp</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">resp</span> <span class="ow">and</span> <span class="n">query_keys</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">query_keys</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
                                <span class="n">envars</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Failed to execute env query </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">query_path</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">processor_name</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
                <span class="c1"># JSON query (e.g., schema dump)</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">query_path</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">query_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">envars</span><span class="p">)</span>
                <span class="c1"># Output path becomes filename with .json extension</span>
                <span class="n">dest_file</span> <span class="o">=</span> <span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="p">(</span><span class="n">output_path</span> <span class="o">+</span> <span class="s2">&quot;.json&quot;</span><span class="p">)</span>
                <span class="n">dest_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_path</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="n">dest_file</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to download </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2"> from snapshot catalog &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">query_path</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

            <span class="k">elif</span> <span class="n">processor_name</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
                <span class="c1"># Data query  use paged mode for resilience</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">query_path</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">query_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">envars</span><span class="p">)</span>
                <span class="n">paged</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;paged_query&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                <span class="n">dest_dir</span> <span class="o">=</span> <span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="n">output_path</span>
                <span class="n">dest_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">dest_file</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">dest_dir</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">catalog</span><span class="o">.</span><span class="n">get_as_file</span><span class="p">(</span>
                        <span class="n">query_path</span><span class="p">,</span>
                        <span class="n">dest_file</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/csv&quot;</span><span class="p">},</span>
                        <span class="n">delete_if_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">paged</span><span class="o">=</span><span class="n">paged</span><span class="p">,</span>
                        <span class="n">page_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dest_file</span><span class="p">):</span>
                        <span class="n">skipped_empty</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Tolerate individual query failures  log and continue.</span>
                    <span class="c1"># This handles snapshot catalog timeouts for large joins.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Query failed for </span><span class="si">%s</span><span class="s2"> (will be missing from bag): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">output_path</span><span class="p">,</span>
                        <span class="n">e</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">failed_queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
                    <span class="c1"># Clean up partial file if it exists</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dest_file</span><span class="p">):</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dest_file</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">processor_name</span> <span class="o">==</span> <span class="s2">&quot;fetch&quot;</span><span class="p">:</span>
                <span class="c1"># Asset file references  write entries to fetch.txt for lazy materialization.</span>
                <span class="c1"># The actual binary files are downloaded later by bdbag.materialize() when</span>
                <span class="c1"># materialize=True is set on download_dataset_bag().</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;query_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;output_path&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">query_path</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">query_path</span> <span class="o">=</span> <span class="n">query_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">envars</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">resp</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_path</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">:</span>
                        <span class="n">url</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
                        <span class="n">filename</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;filename&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                        <span class="n">length</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;length&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">md5</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;md5&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">asset_rid</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asset_rid&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="c1"># Build the full URL for the asset</span>
                        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
                            <span class="n">asset_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">hostname</span><span class="si">}{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">asset_url</span> <span class="o">=</span> <span class="n">url</span>
                        <span class="c1"># Build relative path within bag data directory</span>
                        <span class="n">file_output_path</span> <span class="o">=</span> <span class="n">output_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">asset_rid</span><span class="o">=</span><span class="n">asset_rid</span><span class="p">)</span>
                        <span class="n">rel_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data/</span><span class="si">{</span><span class="n">file_output_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="c1"># Add to fetch.txt entries</span>
                        <span class="n">fetch_entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">asset_url</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">,</span> <span class="n">md5</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Asset query failed for </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="c1"># Remove empty directories left behind by empty/failed queries</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span><span class="p">),</span> <span class="n">topdown</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dirnames</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">filenames</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="n">failed_queries</span><span class="p">:</span>
            <span class="c1"># Extract table names from output paths (format: &quot;schema/table&quot;)</span>
            <span class="n">failed_tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">q</span> <span class="k">else</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">failed_queries</span><span class="p">]</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Dataset bag export failed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">failed_queries</span><span class="p">)</span><span class="si">}</span><span class="s2"> queries timed out or &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;failed for tables: </span><span class="si">{</span><span class="n">failed_tables</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;This typically happens when deep multi-table joins exceed server query &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;time limits. To fix this, add the desired records as direct dataset &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;members using add_dataset_members() with the relevant table&#39;s RIDs. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;For example, if Image data is missing, register Image as a dataset &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;element type (add_dataset_element_type(&#39;Image&#39;)) and add Image RIDs &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;as members so they are exported via a direct association path rather &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;than a deep FK join. Failed paths: </span><span class="si">{</span><span class="n">failed_queries</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Write fetch.txt for remote asset references.</span>
        <span class="c1"># BDBag&#39;s materialize() handles directory creation for fetch targets.</span>
        <span class="k">if</span> <span class="n">fetch_entries</span><span class="p">:</span>
            <span class="n">fetch_file</span> <span class="o">=</span> <span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;fetch.txt&quot;</span>
            <span class="k">with</span> <span class="n">fetch_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">url</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">rel_path</span><span class="p">,</span> <span class="n">md5</span> <span class="ow">in</span> <span class="n">fetch_entries</span><span class="p">:</span>
                    <span class="n">length_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="k">if</span> <span class="n">length</span> <span class="k">else</span> <span class="s2">&quot;-&quot;</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">length_str</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">rel_path</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Wrote </span><span class="si">%d</span><span class="s2"> fetch entries for remote assets&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fetch_entries</span><span class="p">))</span>

        <span class="c1"># Update and archive the bag</span>
        <span class="n">bdb</span><span class="o">.</span><span class="n">make_bag</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bag_path</span><span class="p">),</span> <span class="n">algs</span><span class="o">=</span><span class="n">bag_algorithms</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">idempotent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">archive_path</span> <span class="o">=</span> <span class="n">bdb</span><span class="o">.</span><span class="n">archive_bag</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bag_path</span><span class="p">),</span> <span class="n">bag_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bag_archiver&quot;</span><span class="p">,</span> <span class="s2">&quot;zip&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">archive_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_dataset_minid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span><span class="p">,</span>
        <span class="n">create</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">use_minid</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">exclude_tables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetMinid</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or create a MINID for the specified dataset version.</span>

<span class="sd">        This method retrieves the MINID associated with a specific dataset version,</span>
<span class="sd">        optionally creating one if it doesn&#39;t exist.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: The dataset version to get the MINID for.</span>
<span class="sd">            create: If True, create a new MINID if one doesn&#39;t already exist.</span>
<span class="sd">                If False, raise an exception if no MINID exists.</span>
<span class="sd">            use_minid: If True, use the MINID service for persistent identification.</span>
<span class="sd">                If False, generate a direct download URL without MINID registration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetMinid: Object containing the MINID URL, checksum, and metadata.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If the version doesn&#39;t exist, or if create=False</span>
<span class="sd">                and no MINID exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Find dataset version record</span>
        <span class="n">version_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
        <span class="n">history</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_history</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version_record</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">history</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">dataset_version</span> <span class="o">==</span> <span class="n">version_str</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Version </span><span class="si">{</span><span class="n">version_str</span><span class="si">}</span><span class="s2"> does not exist for RID </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check or create MINID</span>
        <span class="n">minid_url</span> <span class="o">=</span> <span class="n">version_record</span><span class="o">.</span><span class="n">minid</span>
        <span class="c1"># If we either don&#39;t have a MINID, or we have a MINID, but we don&#39;t want to use it, generate a new one.</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">minid_url</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">use_minid</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">create</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minid for dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2"> doesn&#39;t exist&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_minid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating new MINID for dataset </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
            <span class="n">minid_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_dataset_minid</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">use_minid</span><span class="o">=</span><span class="n">use_minid</span><span class="p">,</span> <span class="n">exclude_tables</span><span class="o">=</span><span class="n">exclude_tables</span><span class="p">)</span>

        <span class="c1"># Return based on MINID usage</span>
        <span class="k">if</span> <span class="n">use_minid</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_minid_metadata</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">minid_url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">DatasetMinid</span><span class="p">(</span>
            <span class="n">dataset_version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
            <span class="n">RID</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">version_record</span><span class="o">.</span><span class="n">snapshot</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="n">minid_url</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_minid_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetMinid</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch MINID metadata from the MINID service.</span>

<span class="sd">        Args:</span>
<span class="sd">            version: The dataset version associated with this MINID.</span>
<span class="sd">            url: The MINID landing page URL.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetMinid: Parsed metadata including bag URL, checksum, and identifiers.</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.HTTPError: If the MINID service request fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">})</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">DatasetMinid</span><span class="p">(</span><span class="n">dataset_version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="o">**</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_materialize_dataset_bag</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">minid</span><span class="p">:</span> <span class="n">DatasetMinid</span><span class="p">,</span>
        <span class="n">use_minid</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Materialize a dataset bag by downloading all referenced files.</span>

<span class="sd">        This method downloads a BDBag and then &quot;materializes&quot; it by fetching</span>
<span class="sd">        all files referenced in the bag&#39;s fetch.txt manifest. This includes</span>
<span class="sd">        data files, assets, and any other content referenced by the bag.</span>

<span class="sd">        Progress is reported through callbacks that update the execution status</span>
<span class="sd">        if this download is associated with an execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            minid: DatasetMinid containing the bag URL and metadata.</span>
<span class="sd">            use_minid: If True, download from S3 using the MINID URL.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path: The path to the fully materialized bag directory.</span>

<span class="sd">        Note:</span>
<span class="sd">            Materialization status is cached via a &#39;validated_check.txt&#39; marker</span>
<span class="sd">            file to avoid re-downloading already-materialized bags.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Update the current status for this execution in the catalog&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">!=</span> <span class="n">DRY_RUN_RID</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                            <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                            <span class="s2">&quot;Status_Detail&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">fetch_progress_callback</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Materializing bag: </span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> file(s) downloaded.&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">:</span>
                <span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">validation_progress_callback</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">total</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Validating bag: </span><span class="si">{</span><span class="n">current</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s2"> file(s) validated.&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">:</span>
                <span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># request metadata</span>
        <span class="n">bag_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dataset_minid</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">use_minid</span><span class="p">)</span>
        <span class="n">bag_dir</span> <span class="o">=</span> <span class="n">bag_path</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">validated_check</span> <span class="o">=</span> <span class="n">bag_dir</span> <span class="o">/</span> <span class="s2">&quot;validated_check.txt&quot;</span>

        <span class="c1"># If this bag has already been validated, our work is done.  Otherwise, materialize the bag.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validated_check</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Materializing bag </span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2"> Version:</span><span class="si">{</span><span class="n">minid</span><span class="o">.</span><span class="n">dataset_version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Ensure parent directories exist for all fetch entries</span>
            <span class="n">fetch_file</span> <span class="o">=</span> <span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;fetch.txt&quot;</span>
            <span class="k">if</span> <span class="n">fetch_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">fetch_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">parts</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">rel_path</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="p">(</span><span class="n">bag_path</span> <span class="o">/</span> <span class="n">rel_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bdb</span><span class="o">.</span><span class="n">materialize</span><span class="p">(</span>
                <span class="n">bag_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span>
                <span class="n">fetch_callback</span><span class="o">=</span><span class="n">fetch_progress_callback</span><span class="p">,</span>
                <span class="n">validation_callback</span><span class="o">=</span><span class="n">validation_progress_callback</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">validated_check</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.dataset.dataset.Dataset.current_version" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">current_version</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">current_version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve the current version of the specified dataset_table.</p>
<p>Return the most recent version of the dataset. It is important to remember that this version
captures the state of the catalog at the time the version was created, not the current state of the catalog.
This means that its possible that the values associated with an object in the catalog may be different
from the values of that object in the dataset.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple with the semantic version of the dataset_table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.dataset.dataset.Dataset.dataset_types" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dataset_types</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">dataset_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the dataset types from the catalog.</p>
<p>This property fetches the current dataset types directly from the catalog,
ensuring consistency when multiple Dataset instances reference the same
dataset or when types are modified externally.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dataset type term names from the Dataset_Type vocabulary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.__eq__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__eq__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check equality based on dataset RID.</p>
<p>Two Dataset objects are considered equal if they reference the same
dataset RID, regardless of other attributes like version or types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td>
                  <code><span title="object">object</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object to compare with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if other is a Dataset with the same RID, False otherwise.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns NotImplemented for non-Dataset objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check equality based on dataset RID.</span>

<span class="sd">    Two Dataset objects are considered equal if they reference the same</span>
<span class="sd">    dataset RID, regardless of other attributes like version or types.</span>

<span class="sd">    Args:</span>
<span class="sd">        other: Object to compare with.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if other is a Dataset with the same RID, False otherwise.</span>
<span class="sd">        Returns NotImplemented for non-Dataset objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">dataset_rid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.__hash__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__hash__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__hash__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return hash based on dataset RID for use in sets and as dict keys.</p>
<p>This allows Dataset objects to be stored in sets and used as dictionary keys.
Two Dataset objects with the same RID will hash to the same value.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return hash based on dataset RID for use in sets and as dict keys.</span>

<span class="sd">    This allows Dataset objects to be stored in sets and used as dictionary keys.</span>
<span class="sd">    Two Dataset objects with the same RID will hash to the same value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
    <span class="n">dataset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a Dataset object from an existing dataset in the catalog.</p>
<p>This constructor wraps an existing dataset record. To create a new dataset
in the catalog, use the static method Dataset.create_dataset() instead.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>catalog</code>
            </td>
            <td>
                  <code><span title="deriva_ml.interfaces.DerivaMLCatalog">DerivaMLCatalog</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DerivaMLCatalog instance containing this dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The RID of the existing dataset record.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description of the dataset's purpose and contents.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>execution_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional execution RID that created or is associated with this dataset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h4 id="deriva_ml.dataset.dataset.Dataset.__init__--wrap-an-existing-dataset">Wrap an existing dataset</h4>
<p>dataset = Dataset(catalog=ml, dataset_rid="4HM")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
    <span class="n">dataset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a Dataset object from an existing dataset in the catalog.</span>

<span class="sd">    This constructor wraps an existing dataset record. To create a new dataset</span>
<span class="sd">    in the catalog, use the static method Dataset.create_dataset() instead.</span>

<span class="sd">    Args:</span>
<span class="sd">        catalog: The DerivaMLCatalog instance containing this dataset.</span>
<span class="sd">        dataset_rid: The RID of the existing dataset record.</span>
<span class="sd">        description: Human-readable description of the dataset&#39;s purpose and contents.</span>
<span class="sd">        execution_rid: Optional execution RID that created or is associated with this dataset.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Wrap an existing dataset</span>
<span class="sd">        &gt;&gt;&gt; dataset = Dataset(catalog=ml, dataset_rid=&quot;4HM&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="o">=</span> <span class="n">dataset_rid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">execution_rid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span> <span class="o">=</span> <span class="n">catalog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__repr__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a string representation of the Dataset for debugging.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a string representation of the Dataset for debugging.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;deriva_ml.Dataset object at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span><span class="si">}</span><span class="s2">: rid=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;version=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="si">}</span><span class="s2">&#39;, types=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.add_dataset_members" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_dataset_members</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_dataset_members</span><span class="p">(</span>
    <span class="n">members</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span>
    <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]],</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adds members to a dataset.</p>
<p>Associates one or more records with a dataset. Members can be provided in two forms:</p>
<p><strong>List of RIDs (simpler but slower):</strong>
When <code>members</code> is a list of RIDs, each RID is resolved to determine which table
it belongs to. This uses batch RID resolution for efficiency, but still requires
querying the catalog to identify each RID's table.</p>
<p><strong>Dictionary by table name (faster, recommended for large datasets):</strong>
When <code>members</code> is a dict mapping table names to lists of RIDs, no RID resolution
is needed. The RIDs are inserted directly into the dataset. Use this form when
you already know which table each RID belongs to.</p>
<p><strong>Important:</strong> Members can only be added from tables that have been registered as
dataset element types. Use :meth:<code>DerivaML.add_dataset_element_type</code> to register
a table before adding its records to datasets.</p>
<p>Adding members automatically increments the dataset's minor version.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>members</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.core.constants.RID">RID</span>] | <span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="deriva_ml.core.constants.RID">RID</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Either:
- list[RID]: List of RIDs to add. Each RID will be resolved to find its table.
- dict[str, list[RID]]: Mapping of table names to RID lists. Skips resolution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validate</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to validate that members don't already exist. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional description of the member additions.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>execution_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional execution RID to associate with changes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If:
- Any RID is invalid or cannot be resolved
- Any RID belongs to a table that isn't registered as a dataset element type
- Adding members would create a cycle (for nested datasets)
- Validation finds duplicate members (when validate=True)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="see-also" open>
  <summary>See Also</summary>
  <p>:meth:<code>DerivaML.add_dataset_element_type</code>: Register a table as a dataset element type.
:meth:<code>DerivaML.list_dataset_element_types</code>: List registered dataset element types.</p>
</details>

<p><span class="doc-section-title">Examples:</span></p>
    <p>Using a list of RIDs (simpler):
    &gt;&gt;&gt; dataset.add_dataset_members(
    ...     members=["1-ABC", "1-DEF", "1-GHI"],
    ...     description="Added sample images"
    ... )</p>
<p>Using a dict by table name (faster for large datasets):
    &gt;&gt;&gt; dataset.add_dataset_members(
    ...     members={
    ...         "Image": ["1-ABC", "1-DEF"],
    ...         "Subject": ["2-XYZ"]
    ...     },
    ...     description="Added images and subjects"
    ... )</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_dataset_members</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">members</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]],</span>
    <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds members to a dataset.</span>

<span class="sd">    Associates one or more records with a dataset. Members can be provided in two forms:</span>

<span class="sd">    **List of RIDs (simpler but slower):**</span>
<span class="sd">    When `members` is a list of RIDs, each RID is resolved to determine which table</span>
<span class="sd">    it belongs to. This uses batch RID resolution for efficiency, but still requires</span>
<span class="sd">    querying the catalog to identify each RID&#39;s table.</span>

<span class="sd">    **Dictionary by table name (faster, recommended for large datasets):**</span>
<span class="sd">    When `members` is a dict mapping table names to lists of RIDs, no RID resolution</span>
<span class="sd">    is needed. The RIDs are inserted directly into the dataset. Use this form when</span>
<span class="sd">    you already know which table each RID belongs to.</span>

<span class="sd">    **Important:** Members can only be added from tables that have been registered as</span>
<span class="sd">    dataset element types. Use :meth:`DerivaML.add_dataset_element_type` to register</span>
<span class="sd">    a table before adding its records to datasets.</span>

<span class="sd">    Adding members automatically increments the dataset&#39;s minor version.</span>

<span class="sd">    Args:</span>
<span class="sd">        members: Either:</span>
<span class="sd">            - list[RID]: List of RIDs to add. Each RID will be resolved to find its table.</span>
<span class="sd">            - dict[str, list[RID]]: Mapping of table names to RID lists. Skips resolution.</span>
<span class="sd">        validate: Whether to validate that members don&#39;t already exist. Defaults to True.</span>
<span class="sd">        description: Optional description of the member additions.</span>
<span class="sd">        execution_rid: Optional execution RID to associate with changes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If:</span>
<span class="sd">            - Any RID is invalid or cannot be resolved</span>
<span class="sd">            - Any RID belongs to a table that isn&#39;t registered as a dataset element type</span>
<span class="sd">            - Adding members would create a cycle (for nested datasets)</span>
<span class="sd">            - Validation finds duplicate members (when validate=True)</span>

<span class="sd">    See Also:</span>
<span class="sd">        :meth:`DerivaML.add_dataset_element_type`: Register a table as a dataset element type.</span>
<span class="sd">        :meth:`DerivaML.list_dataset_element_types`: List registered dataset element types.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Using a list of RIDs (simpler):</span>
<span class="sd">            &gt;&gt;&gt; dataset.add_dataset_members(</span>
<span class="sd">            ...     members=[&quot;1-ABC&quot;, &quot;1-DEF&quot;, &quot;1-GHI&quot;],</span>
<span class="sd">            ...     description=&quot;Added sample images&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        Using a dict by table name (faster for large datasets):</span>
<span class="sd">            &gt;&gt;&gt; dataset.add_dataset_members(</span>
<span class="sd">            ...     members={</span>
<span class="sd">            ...         &quot;Image&quot;: [&quot;1-ABC&quot;, &quot;1-DEF&quot;],</span>
<span class="sd">            ...         &quot;Subject&quot;: [&quot;2-XYZ&quot;]</span>
<span class="sd">            ...     },</span>
<span class="sd">            ...     description=&quot;Added images and subjects&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="s2">&quot;Updated dataset via add_dataset_members&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_dataset_cycle</span><span class="p">(</span><span class="n">member_rid</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">          member_rid:</span>
<span class="sd">          path: (Default value = None)</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">member_rid</span> <span class="ow">in</span> <span class="n">path</span>

    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="n">existing_rids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_members</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="o">:=</span> <span class="nb">set</span><span class="p">(</span><span class="n">existing_rids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">members</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Attempting to add existing member to dataset_table </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Now go through every rid to be added to the data set and sort them based on what association table entries</span>
    <span class="c1"># need to be made.</span>
    <span class="n">dataset_elements</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Build map of valid element tables to their association tables</span>
    <span class="n">associations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">())</span>
    <span class="n">association_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">associations</span><span class="p">}</span>

    <span class="c1"># Get a list of all the object types that can be linked to a dataset_table.</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">members</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>

        <span class="c1"># Get candidate tables for batch resolution (only tables that can be dataset elements)</span>
        <span class="n">candidate_tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">association_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="c1"># Batch resolve all RIDs at once instead of one-by-one</span>
        <span class="n">rid_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">resolve_rids</span><span class="p">(</span><span class="n">members</span><span class="p">,</span> <span class="n">candidate_tables</span><span class="o">=</span><span class="n">candidate_tables</span><span class="p">)</span>

        <span class="c1"># Group by table and validate</span>
        <span class="k">for</span> <span class="n">rid</span><span class="p">,</span> <span class="n">rid_info</span> <span class="ow">in</span> <span class="n">rid_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">association_map</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID table: </span><span class="si">{</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not part of dataset_table&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span> <span class="ow">and</span> <span class="n">check_dataset_cycle</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">rid</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Creating cycle of datasets is not allowed&quot;</span><span class="p">)</span>
            <span class="n">dataset_elements</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataset_elements</span> <span class="o">=</span> <span class="p">{</span><span class="n">t</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ms</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">members</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="c1"># Now make the entries into the association tables.</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">dataset_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Determine schema: ML schema for Dataset/File, otherwise use the table&#39;s actual schema</span>
        <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span> <span class="ow">or</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;File&quot;</span><span class="p">:</span>
            <span class="n">schema_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Find the table and use its schema</span>
            <span class="n">table_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">schema_name</span> <span class="o">=</span> <span class="n">table_obj</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span>
        <span class="n">schema_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
        <span class="n">fk_column</span> <span class="o">=</span> <span class="s2">&quot;Nested_Dataset&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span> <span class="k">else</span> <span class="n">table</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
            <span class="c1"># Find out the name of the column in the association table.</span>
            <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">association_map</span><span class="p">[</span><span class="n">table</span><span class="p">]]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[{</span><span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span> <span class="n">fk_column</span><span class="p">:</span> <span class="n">e</span><span class="p">}</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
        <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.add_dataset_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_dataset_type</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_dataset_type</span><span class="p">(</span>
    <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">,</span>
    <span class="n">_skip_version_increment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a dataset type to this dataset.</p>
<p>Adds a type term to this dataset if it's not already present. The term must
exist in the Dataset_Type vocabulary. Also increments the dataset's minor
version to reflect the metadata change.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="VocabularyTerm (deriva_ml.core.definitions.VocabularyTerm)" href="../deriva_definitions/#deriva_ml.core.definitions.VocabularyTerm">VocabularyTerm</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Term name (string) or VocabularyTerm object from Dataset_Type vocabulary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_skip_version_increment</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to skip version increment when
called from add_dataset_types (which handles versioning itself).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLInvalidTerm (deriva_ml.core.exceptions.DerivaMLInvalidTerm)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLInvalidTerm">DerivaMLInvalidTerm</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the term doesn't exist in the Dataset_Type vocabulary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>dataset.add_dataset_type("Training")
dataset.add_dataset_type("Validation")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_dataset_type</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">,</span>
    <span class="n">_skip_version_increment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a dataset type to this dataset.</span>

<span class="sd">    Adds a type term to this dataset if it&#39;s not already present. The term must</span>
<span class="sd">    exist in the Dataset_Type vocabulary. Also increments the dataset&#39;s minor</span>
<span class="sd">    version to reflect the metadata change.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_type: Term name (string) or VocabularyTerm object from Dataset_Type vocabulary.</span>
<span class="sd">        _skip_version_increment: Internal parameter to skip version increment when</span>
<span class="sd">            called from add_dataset_types (which handles versioning itself).</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLInvalidTerm: If the term doesn&#39;t exist in the Dataset_Type vocabulary.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; dataset.add_dataset_type(&quot;Training&quot;)</span>
<span class="sd">        &gt;&gt;&gt; dataset.add_dataset_type(&quot;Validation&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert to VocabularyTerm if needed (validates the term exists)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">VocabularyTerm</span><span class="p">):</span>
        <span class="n">vocab_term</span> <span class="o">=</span> <span class="n">dataset_type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vocab_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">)</span>

    <span class="c1"># Check if already present</span>
    <span class="k">if</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Insert into association table</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">atable_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_type_association_table</span><span class="p">()</span>
    <span class="n">atable_path</span><span class="o">.</span><span class="n">insert</span><span class="p">([{</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">:</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">}])</span>

    <span class="c1"># Increment minor version to reflect metadata change (unless called from add_dataset_types)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_skip_version_increment</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
            <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Added dataset type: </span><span class="si">{</span><span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.add_dataset_types" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_dataset_types</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_dataset_types</span><span class="p">(</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="n">VocabularyTerm</span>
    <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">],</span>
    <span class="n">_skip_version_increment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add one or more dataset types to this dataset.</p>
<p>Convenience method for adding multiple types at once. Each term must exist
in the Dataset_Type vocabulary. Types that are already associated with the
dataset are silently skipped. Increments the dataset's minor version once
after all types are added.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_types</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="VocabularyTerm (deriva_ml.core.definitions.VocabularyTerm)" href="../deriva_definitions/#deriva_ml.core.definitions.VocabularyTerm">VocabularyTerm</a> | <span title="list">list</span>[<span title="str">str</span> | <a class="autorefs autorefs-internal" title="VocabularyTerm (deriva_ml.core.definitions.VocabularyTerm)" href="../deriva_definitions/#deriva_ml.core.definitions.VocabularyTerm">VocabularyTerm</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Single term or list of terms. Can be strings (term names)
or VocabularyTerm objects.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_skip_version_increment</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to skip version increment
(used during initial dataset creation).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLInvalidTerm (deriva_ml.core.exceptions.DerivaMLInvalidTerm)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLInvalidTerm">DerivaMLInvalidTerm</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any term doesn't exist in the Dataset_Type vocabulary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>dataset.add_dataset_types(["Training", "Image"])
dataset.add_dataset_types("Testing")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_dataset_types</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">],</span>
    <span class="n">_skip_version_increment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add one or more dataset types to this dataset.</span>

<span class="sd">    Convenience method for adding multiple types at once. Each term must exist</span>
<span class="sd">    in the Dataset_Type vocabulary. Types that are already associated with the</span>
<span class="sd">    dataset are silently skipped. Increments the dataset&#39;s minor version once</span>
<span class="sd">    after all types are added.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_types: Single term or list of terms. Can be strings (term names)</span>
<span class="sd">            or VocabularyTerm objects.</span>
<span class="sd">        _skip_version_increment: Internal parameter to skip version increment</span>
<span class="sd">            (used during initial dataset creation).</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLInvalidTerm: If any term doesn&#39;t exist in the Dataset_Type vocabulary.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; dataset.add_dataset_types([&quot;Training&quot;, &quot;Image&quot;])</span>
<span class="sd">        &gt;&gt;&gt; dataset.add_dataset_types(&quot;Testing&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize input to a list</span>
    <span class="n">types_to_add</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset_types</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_types</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">dataset_types</span>

    <span class="c1"># Track which types were actually added (not already present)</span>
    <span class="n">added_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">types_to_add</span><span class="p">:</span>
        <span class="c1"># Get term name before calling add_dataset_type</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">VocabularyTerm</span><span class="p">):</span>
            <span class="n">term_name</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">term_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">term</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Check if already present before adding</span>
        <span class="k">if</span> <span class="n">term_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_type</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">_skip_version_increment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">added_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">term_name</span><span class="p">)</span>

    <span class="c1"># Increment version once for all added types (if any were added)</span>
    <span class="k">if</span> <span class="n">added_types</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">_skip_version_increment</span><span class="p">:</span>
        <span class="n">type_names</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">added_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
            <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Added dataset type(s): </span><span class="si">{</span><span class="n">type_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.create_dataset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_dataset</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">create_dataset</span><span class="p">(</span>
    <span class="n">ml_instance</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a new dataset in the catalog.</p>
<p>Creates a dataset with specified types and description. The dataset must be
associated with an execution for provenance tracking.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ml_instance</code>
            </td>
            <td>
                  <code><span title="deriva_ml.interfaces.DerivaMLCatalog">DerivaMLCatalog</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DerivaMLCatalog instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>execution_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Execution RID to associate with dataset creation (required).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_types</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One or more dataset type terms from Dataset_Type vocabulary.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the dataset's purpose and contents.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional initial version number. Defaults to 0.1.0.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Dataset</code></td>            <td>
                  <code><span title="typing.Self">Self</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The newly created dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dataset_types are invalid or creation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with ml.create_execution(config) as exe:
...     dataset = exe.create_dataset(
...         dataset_types=["experiment", "raw_data"],
...         description="RNA sequencing experiment data",
...         version=DatasetVersion(1, 0, 0)
...     )</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_dataset</span><span class="p">(</span>
    <span class="n">ml_instance</span><span class="p">:</span> <span class="n">DerivaMLCatalog</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a new dataset in the catalog.</span>

<span class="sd">    Creates a dataset with specified types and description. The dataset must be</span>
<span class="sd">    associated with an execution for provenance tracking.</span>

<span class="sd">    Args:</span>
<span class="sd">        ml_instance: DerivaMLCatalog instance.</span>
<span class="sd">        execution_rid: Execution RID to associate with dataset creation (required).</span>
<span class="sd">        dataset_types: One or more dataset type terms from Dataset_Type vocabulary.</span>
<span class="sd">        description: Description of the dataset&#39;s purpose and contents.</span>
<span class="sd">        version: Optional initial version number. Defaults to 0.1.0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dataset: The newly created dataset.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If dataset_types are invalid or creation fails.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; with ml.create_execution(config) as exe:</span>
<span class="sd">        ...     dataset = exe.create_dataset(</span>
<span class="sd">        ...         dataset_types=[&quot;experiment&quot;, &quot;raw_data&quot;],</span>
<span class="sd">        ...         description=&quot;RNA sequencing experiment data&quot;,</span>
<span class="sd">        ...         version=DatasetVersion(1, 0, 0)</span>
<span class="sd">        ...     )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">version</span> <span class="ow">or</span> <span class="n">DatasetVersion</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Validate dataset types</span>
    <span class="n">ds_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset_types</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">dataset_types</span>
    <span class="n">dataset_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ds_types</span><span class="p">]</span>

    <span class="c1"># Create the entry for the new dataset_table and get its RID.</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="n">ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">dataset_table_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="n">dataset_rid</span> <span class="o">=</span> <span class="n">dataset_table_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                <span class="s2">&quot;Deleted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span>

    <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Execution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
        <span class="p">[{</span><span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="n">dataset_rid</span><span class="p">,</span> <span class="s2">&quot;Execution&quot;</span><span class="p">:</span> <span class="n">execution_rid</span><span class="p">}]</span>
    <span class="p">)</span>
    <span class="n">Dataset</span><span class="o">.</span><span class="n">_insert_dataset_versions</span><span class="p">(</span>
        <span class="n">ml_instance</span><span class="o">=</span><span class="n">ml_instance</span><span class="p">,</span>
        <span class="n">dataset_list</span><span class="o">=</span><span class="p">[</span><span class="n">DatasetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">dataset_rid</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)],</span>
        <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Initial dataset creation.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span>
        <span class="n">catalog</span><span class="o">=</span><span class="n">ml_instance</span><span class="p">,</span>
        <span class="n">dataset_rid</span><span class="o">=</span><span class="n">dataset_rid</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Skip version increment during initial creation (version already set above)</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">add_dataset_types</span><span class="p">(</span><span class="n">dataset_types</span><span class="p">,</span> <span class="n">_skip_version_increment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dataset</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.dataset_history" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dataset_history</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">dataset_history</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span>
    <span class="n">DatasetHistory</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieves the version history of a dataset.</p>
<p>Returns a chronological list of dataset versions, including their version numbers,
creation times, and associated metadata.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DatasetHistory (deriva_ml.dataset.aux_classes.DatasetHistory)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetHistory">DatasetHistory</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[DatasetHistory]: List of history entries, each containing:
- dataset_version: Version number (major.minor.patch)
- minid: Minimal Viable Identifier
- snapshot: Catalog snapshot time
- dataset_rid: Dataset Resource Identifier
- version_rid: Version Resource Identifier
- description: Version description
- execution_rid: Associated execution RID</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dataset_rid is not a valid dataset RID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>history = ml.dataset_history("1-abc123")
for entry in history:
...     print(f"Version {entry.dataset_version}: {entry.description}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dataset_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetHistory</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves the version history of a dataset.</span>

<span class="sd">    Returns a chronological list of dataset versions, including their version numbers,</span>
<span class="sd">    creation times, and associated metadata.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[DatasetHistory]: List of history entries, each containing:</span>
<span class="sd">            - dataset_version: Version number (major.minor.patch)</span>
<span class="sd">            - minid: Minimal Viable Identifier</span>
<span class="sd">            - snapshot: Catalog snapshot time</span>
<span class="sd">            - dataset_rid: Dataset Resource Identifier</span>
<span class="sd">            - version_rid: Version Resource Identifier</span>
<span class="sd">            - description: Version description</span>
<span class="sd">            - execution_rid: Associated execution RID</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If dataset_rid is not a valid dataset RID.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; history = ml.dataset_history(&quot;1-abc123&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for entry in history:</span>
<span class="sd">        ...     print(f&quot;Version {entry.dataset_version}: {entry.description}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">is_dataset_rid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID is not for a data set: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">version_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Version&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">DatasetHistory</span><span class="p">(</span>
            <span class="n">dataset_version</span><span class="o">=</span><span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Version&quot;</span><span class="p">]),</span>
            <span class="n">minid</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Minid&quot;</span><span class="p">],</span>
            <span class="n">snapshot</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Snapshot&quot;</span><span class="p">],</span>
            <span class="n">dataset_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span>
            <span class="n">version_rid</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Description&quot;</span><span class="p">],</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">version_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">version_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.delete_dataset_members" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">delete_dataset_members</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">delete_dataset_members</span><span class="p">(</span>
    <span class="n">members</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">],</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove members from this dataset.</p>
<p>Removes the specified members from the dataset. In addition to removing members,
the minor version number of the dataset is incremented and the description,
if provided, is applied to that new version.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>members</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.core.constants.RID">RID</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of member RIDs to remove from the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional description of the removal operation.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>execution_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional RID of execution associated with this operation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If any RID is invalid or not part of this dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>dataset.delete_dataset_members(
...     members=["1-ABC", "1-DEF"],
...     description="Removed corrupted samples"
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_dataset_members</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">members</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">],</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove members from this dataset.</span>

<span class="sd">    Removes the specified members from the dataset. In addition to removing members,</span>
<span class="sd">    the minor version number of the dataset is incremented and the description,</span>
<span class="sd">    if provided, is applied to that new version.</span>

<span class="sd">    Args:</span>
<span class="sd">        members: List of member RIDs to remove from the dataset.</span>
<span class="sd">        description: Optional description of the removal operation.</span>
<span class="sd">        execution_rid: Optional RID of execution associated with this operation.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If any RID is invalid or not part of this dataset.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; dataset.delete_dataset_members(</span>
<span class="sd">        ...     members=[&quot;1-ABC&quot;, &quot;1-DEF&quot;],</span>
<span class="sd">        ...     description=&quot;Removed corrupted samples&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="s2">&quot;Deleted dataset members&quot;</span>

    <span class="c1"># Go through every rid to be deleted and sort them based on what association table entries</span>
    <span class="c1"># need to be removed.</span>
    <span class="n">dataset_elements</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">association_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="c1"># Get a list of all the object types that can be linked to a dataset.</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">members</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid RID: </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">association_map</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID table: </span><span class="si">{</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> not part of dataset&quot;</span><span class="p">)</span>
        <span class="n">dataset_elements</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>

    <span class="c1"># Delete the entries from the association tables.</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">table</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">dataset_elements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Determine schema: ML schema for Dataset, otherwise use the table&#39;s actual schema</span>
        <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
            <span class="n">schema_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Find the table and use its schema</span>
            <span class="n">table_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">schema_name</span> <span class="o">=</span> <span class="n">table_obj</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span>
        <span class="n">schema_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
        <span class="n">fk_column</span> <span class="o">=</span> <span class="s2">&quot;Nested_Dataset&quot;</span> <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s2">&quot;Dataset&quot;</span> <span class="k">else</span> <span class="n">table</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
            <span class="n">atable_path</span> <span class="o">=</span> <span class="n">schema_path</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">association_map</span><span class="p">[</span><span class="n">table</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">fk_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">e</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">entity</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">increment_dataset_version</span><span class="p">(</span>
        <span class="n">VersionPart</span><span class="o">.</span><span class="n">minor</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.denormalize_as_dataframe" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">denormalize_as_dataframe</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">denormalize_as_dataframe</span><span class="p">(</span>
    <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Denormalize the dataset into a single wide table (DataFrame).</p>
<p>Denormalization transforms normalized relational data into a single "wide table"
(also called a "flat table" or "denormalized table") by joining related tables
together. This produces a DataFrame where each row contains all related information
from multiple source tables, with columns from each table combined side-by-side.</p>
<p>Wide tables are the standard input format for most machine learning frameworks,
which expect all features for a single observation to be in one row. This method
bridges the gap between normalized database schemas and ML-ready tabular data.</p>
<p><strong>How it works:</strong></p>
<p>Tables are joined based on their foreign key relationships. For example, if
Image has a foreign key to Subject, and Diagnosis has a foreign key to Image,
then denormalizing ["Subject", "Image", "Diagnosis"] produces rows where each
image appears with its subject's metadata and any associated diagnoses.</p>
<p><strong>Column naming:</strong></p>
<p>Column names are prefixed with the source table name using underscores
to avoid collisions (e.g., "Image_Filename", "Subject_RID").</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>include_tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of table names to include in the output. Tables
are joined based on their foreign key relationships.
Order doesn't matter - the join order is determined automatically.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version to query. Defaults to current version.
Use this to get a reproducible snapshot of the data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments (ignored, for protocol compatibility).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Wide table with columns from all included tables.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Create a training dataset with images and their labels::</p>
<pre><code>&gt;&gt;&gt; # Get all images with their diagnoses in one table
&gt;&gt;&gt; df = dataset.denormalize_as_dataframe(["Image", "Diagnosis"])
&gt;&gt;&gt; print(df.columns.tolist())
['Image_RID', 'Image_Filename', 'Image_URL', 'Diagnosis_RID',
 'Diagnosis_Label', 'Diagnosis_Confidence']

&gt;&gt;&gt; # Use with scikit-learn
&gt;&gt;&gt; X = df[["Image_Filename"]]  # Features
&gt;&gt;&gt; y = df["Diagnosis_Label"]    # Labels
</code></pre>
<p>Include subject metadata for stratified splitting::</p>
<pre><code>&gt;&gt;&gt; df = dataset.denormalize_as_dataframe(
...     ["Subject", "Image", "Diagnosis"]
... )
&gt;&gt;&gt; # Now df has Subject_Age, Subject_Gender, etc.
&gt;&gt;&gt; # for stratified train/test splits by subject
</code></pre>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p>denormalize_as_dict: Generator version for memory-efficient processing.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">denormalize_as_dataframe</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Denormalize the dataset into a single wide table (DataFrame).</span>

<span class="sd">    Denormalization transforms normalized relational data into a single &quot;wide table&quot;</span>
<span class="sd">    (also called a &quot;flat table&quot; or &quot;denormalized table&quot;) by joining related tables</span>
<span class="sd">    together. This produces a DataFrame where each row contains all related information</span>
<span class="sd">    from multiple source tables, with columns from each table combined side-by-side.</span>

<span class="sd">    Wide tables are the standard input format for most machine learning frameworks,</span>
<span class="sd">    which expect all features for a single observation to be in one row. This method</span>
<span class="sd">    bridges the gap between normalized database schemas and ML-ready tabular data.</span>

<span class="sd">    **How it works:**</span>

<span class="sd">    Tables are joined based on their foreign key relationships. For example, if</span>
<span class="sd">    Image has a foreign key to Subject, and Diagnosis has a foreign key to Image,</span>
<span class="sd">    then denormalizing [&quot;Subject&quot;, &quot;Image&quot;, &quot;Diagnosis&quot;] produces rows where each</span>
<span class="sd">    image appears with its subject&#39;s metadata and any associated diagnoses.</span>

<span class="sd">    **Column naming:**</span>

<span class="sd">    Column names are prefixed with the source table name using underscores</span>
<span class="sd">    to avoid collisions (e.g., &quot;Image_Filename&quot;, &quot;Subject_RID&quot;).</span>

<span class="sd">    Args:</span>
<span class="sd">        include_tables: List of table names to include in the output. Tables</span>
<span class="sd">            are joined based on their foreign key relationships.</span>
<span class="sd">            Order doesn&#39;t matter - the join order is determined automatically.</span>
<span class="sd">        version: Dataset version to query. Defaults to current version.</span>
<span class="sd">            Use this to get a reproducible snapshot of the data.</span>
<span class="sd">        **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Wide table with columns from all included tables.</span>

<span class="sd">    Example:</span>
<span class="sd">        Create a training dataset with images and their labels::</span>

<span class="sd">            &gt;&gt;&gt; # Get all images with their diagnoses in one table</span>
<span class="sd">            &gt;&gt;&gt; df = dataset.denormalize_as_dataframe([&quot;Image&quot;, &quot;Diagnosis&quot;])</span>
<span class="sd">            &gt;&gt;&gt; print(df.columns.tolist())</span>
<span class="sd">            [&#39;Image_RID&#39;, &#39;Image_Filename&#39;, &#39;Image_URL&#39;, &#39;Diagnosis_RID&#39;,</span>
<span class="sd">             &#39;Diagnosis_Label&#39;, &#39;Diagnosis_Confidence&#39;]</span>

<span class="sd">            &gt;&gt;&gt; # Use with scikit-learn</span>
<span class="sd">            &gt;&gt;&gt; X = df[[&quot;Image_Filename&quot;]]  # Features</span>
<span class="sd">            &gt;&gt;&gt; y = df[&quot;Diagnosis_Label&quot;]    # Labels</span>

<span class="sd">        Include subject metadata for stratified splitting::</span>

<span class="sd">            &gt;&gt;&gt; df = dataset.denormalize_as_dataframe(</span>
<span class="sd">            ...     [&quot;Subject&quot;, &quot;Image&quot;, &quot;Diagnosis&quot;]</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; # Now df has Subject_Age, Subject_Gender, etc.</span>
<span class="sd">            &gt;&gt;&gt; # for stratified train/test splits by subject</span>

<span class="sd">    See Also:</span>
<span class="sd">        denormalize_as_dict: Generator version for memory-efficient processing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_denormalize_datapath</span><span class="p">(</span><span class="n">include_tables</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.denormalize_as_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">denormalize_as_dict</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">denormalize_as_dict</span><span class="p">(</span>
    <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span>
    <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Denormalize the dataset and yield rows as dictionaries.</p>
<p>This is a memory-efficient alternative to denormalize_as_dataframe() that
yields one row at a time as a dictionary instead of loading all data into
a DataFrame. Use this when processing large datasets that may not fit in
memory, or when you want to process rows incrementally.</p>
<p>Like denormalize_as_dataframe(), this produces a "wide table" representation
where each yielded dictionary contains all columns from the joined tables.
See denormalize_as_dataframe() for detailed explanation of how denormalization
works.</p>
<p><strong>Column naming:</strong></p>
<p>Column names are prefixed with the source table name using underscores
to avoid collisions (e.g., "Image_Filename", "Subject_RID").</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>include_tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of table names to include in the output.
Tables are joined based on their foreign key relationships.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version to query. Defaults to current version.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments (ignored, for protocol compatibility).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, Any]: Dictionary representing one row of the wide table.
Keys are column names in "Table_Column" format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Process images one at a time for training::</p>
<pre><code>&gt;&gt;&gt; for row in dataset.denormalize_as_dict(["Image", "Diagnosis"]):
...     # Load and preprocess each image
...     img = load_image(row["Image_Filename"])
...     label = row["Diagnosis_Label"]
...     yield img, label  # Feed to training loop
</code></pre>
<p>Count labels without loading all data into memory::</p>
<pre><code>&gt;&gt;&gt; from collections import Counter
&gt;&gt;&gt; labels = Counter()
&gt;&gt;&gt; for row in dataset.denormalize_as_dict(["Image", "Diagnosis"]):
...     labels[row["Diagnosis_Label"]] += 1
&gt;&gt;&gt; print(labels)
Counter({'Normal': 450, 'Abnormal': 150})
</code></pre>
</details>

<details class="see-also" open>
  <summary>See Also</summary>
  <p>denormalize_as_dataframe: Returns all data as a pandas DataFrame.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span>
<span class="normal">998</span>
<span class="normal">999</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">denormalize_as_dict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Denormalize the dataset and yield rows as dictionaries.</span>

<span class="sd">    This is a memory-efficient alternative to denormalize_as_dataframe() that</span>
<span class="sd">    yields one row at a time as a dictionary instead of loading all data into</span>
<span class="sd">    a DataFrame. Use this when processing large datasets that may not fit in</span>
<span class="sd">    memory, or when you want to process rows incrementally.</span>

<span class="sd">    Like denormalize_as_dataframe(), this produces a &quot;wide table&quot; representation</span>
<span class="sd">    where each yielded dictionary contains all columns from the joined tables.</span>
<span class="sd">    See denormalize_as_dataframe() for detailed explanation of how denormalization</span>
<span class="sd">    works.</span>

<span class="sd">    **Column naming:**</span>

<span class="sd">    Column names are prefixed with the source table name using underscores</span>
<span class="sd">    to avoid collisions (e.g., &quot;Image_Filename&quot;, &quot;Subject_RID&quot;).</span>

<span class="sd">    Args:</span>
<span class="sd">        include_tables: List of table names to include in the output.</span>
<span class="sd">            Tables are joined based on their foreign key relationships.</span>
<span class="sd">        version: Dataset version to query. Defaults to current version.</span>
<span class="sd">        **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">    Yields:</span>
<span class="sd">        dict[str, Any]: Dictionary representing one row of the wide table.</span>
<span class="sd">            Keys are column names in &quot;Table_Column&quot; format.</span>

<span class="sd">    Example:</span>
<span class="sd">        Process images one at a time for training::</span>

<span class="sd">            &gt;&gt;&gt; for row in dataset.denormalize_as_dict([&quot;Image&quot;, &quot;Diagnosis&quot;]):</span>
<span class="sd">            ...     # Load and preprocess each image</span>
<span class="sd">            ...     img = load_image(row[&quot;Image_Filename&quot;])</span>
<span class="sd">            ...     label = row[&quot;Diagnosis_Label&quot;]</span>
<span class="sd">            ...     yield img, label  # Feed to training loop</span>

<span class="sd">        Count labels without loading all data into memory::</span>

<span class="sd">            &gt;&gt;&gt; from collections import Counter</span>
<span class="sd">            &gt;&gt;&gt; labels = Counter()</span>
<span class="sd">            &gt;&gt;&gt; for row in dataset.denormalize_as_dict([&quot;Image&quot;, &quot;Diagnosis&quot;]):</span>
<span class="sd">            ...     labels[row[&quot;Diagnosis_Label&quot;]] += 1</span>
<span class="sd">            &gt;&gt;&gt; print(labels)</span>
<span class="sd">            Counter({&#39;Normal&#39;: 450, &#39;Abnormal&#39;: 150})</span>

<span class="sd">    See Also:</span>
<span class="sd">        denormalize_as_dataframe: Returns all data as a pandas DataFrame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denormalize_datapath</span><span class="p">(</span><span class="n">include_tables</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.display_markdown" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">display_markdown</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">display_markdown</span><span class="p">(</span>
    <span class="n">show_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Display a formatted markdown representation of this dataset in Jupyter.</p>
<p>Convenience method that calls to_markdown() and displays the result
using IPython.display.Markdown.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>show_children</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, include direct child datasets.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indent</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of indent levels (each level is 2 spaces).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>ds = ml.lookup_dataset("4HM")
ds.display_markdown(show_children=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">display_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display a formatted markdown representation of this dataset in Jupyter.</span>

<span class="sd">    Convenience method that calls to_markdown() and displays the result</span>
<span class="sd">    using IPython.display.Markdown.</span>

<span class="sd">    Args:</span>
<span class="sd">        show_children: If True, include direct child datasets.</span>
<span class="sd">        indent: Number of indent levels (each level is 2 spaces).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; ds = ml.lookup_dataset(&quot;4HM&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ds.display_markdown(show_children=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>

    <span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">show_children</span><span class="p">,</span> <span class="n">indent</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.download_dataset_bag" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">download_dataset_bag</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">download_dataset_bag</span><span class="p">(</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">materialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_minid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_tables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetBag</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Downloads a dataset to the local filesystem and optionally creates a MINID.</p>
<p>Downloads a dataset to the local file system. If the dataset has a version set, that version is used.
If the dataset has a version and a version is provided, the version specified takes precedence.</p>
<p>The exported bag contains all data reachable from this dataset's members by following
foreign key relationships (both incoming and outgoing). Starting from each member element
type, the export traverses all FK-connected tables, with vocabulary tables acting as
natural path terminators. Only paths starting from element types that have members in
this dataset are included.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version to download. If not specified, the version must be set in the dataset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>materialize</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, materialize the dataset after downloading.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_minid</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, upload the bag to S3 and create a MINID for the dataset.
Requires s3_bucket to be configured on the catalog. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_tables</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional set of table names to exclude from FK path traversal
during bag export. Tables in this set will not be visited, pruning branches
of the FK graph that pass through them. Useful for avoiding query timeouts
caused by expensive joins through large or unnecessary tables.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DatasetBag</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetBag (deriva_ml.dataset.dataset_bag.DatasetBag)" href="../dataset_bag/#deriva_ml.dataset.dataset_bag.DatasetBag">DatasetBag</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object containing:
- path: Local filesystem path to downloaded dataset
- rid: Dataset's Resource Identifier
- minid: Dataset's Minimal Viable Identifier (if use_minid=True)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If use_minid=True but s3_bucket is not configured on the catalog.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Download without MINID (default):
    &gt;&gt;&gt; bag = dataset.download_dataset_bag(version="1.0.0")
    &gt;&gt;&gt; print(f"Downloaded to {bag.path}")</p>
<p>Download with MINID (requires s3_bucket configured):
    &gt;&gt;&gt; # Catalog must be created with s3_bucket="s3://my-bucket"
    &gt;&gt;&gt; bag = dataset.download_dataset_bag(version="1.0.0", use_minid=True)</p>
<p>Exclude tables that cause query timeouts:
    &gt;&gt;&gt; bag = dataset.download_dataset_bag(version="1.0.0", exclude_tables={"Process"})</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_dataset_bag</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">materialize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_minid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">exclude_tables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetBag</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads a dataset to the local filesystem and optionally creates a MINID.</span>

<span class="sd">    Downloads a dataset to the local file system. If the dataset has a version set, that version is used.</span>
<span class="sd">    If the dataset has a version and a version is provided, the version specified takes precedence.</span>

<span class="sd">    The exported bag contains all data reachable from this dataset&#39;s members by following</span>
<span class="sd">    foreign key relationships (both incoming and outgoing). Starting from each member element</span>
<span class="sd">    type, the export traverses all FK-connected tables, with vocabulary tables acting as</span>
<span class="sd">    natural path terminators. Only paths starting from element types that have members in</span>
<span class="sd">    this dataset are included.</span>

<span class="sd">    Args:</span>
<span class="sd">        version: Dataset version to download. If not specified, the version must be set in the dataset.</span>
<span class="sd">        materialize: If True, materialize the dataset after downloading.</span>
<span class="sd">        use_minid: If True, upload the bag to S3 and create a MINID for the dataset.</span>
<span class="sd">            Requires s3_bucket to be configured on the catalog. Defaults to False.</span>
<span class="sd">        exclude_tables: Optional set of table names to exclude from FK path traversal</span>
<span class="sd">            during bag export. Tables in this set will not be visited, pruning branches</span>
<span class="sd">            of the FK graph that pass through them. Useful for avoiding query timeouts</span>
<span class="sd">            caused by expensive joins through large or unnecessary tables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DatasetBag: Object containing:</span>
<span class="sd">            - path: Local filesystem path to downloaded dataset</span>
<span class="sd">            - rid: Dataset&#39;s Resource Identifier</span>
<span class="sd">            - minid: Dataset&#39;s Minimal Viable Identifier (if use_minid=True)</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If use_minid=True but s3_bucket is not configured on the catalog.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Download without MINID (default):</span>
<span class="sd">            &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Downloaded to {bag.path}&quot;)</span>

<span class="sd">        Download with MINID (requires s3_bucket configured):</span>
<span class="sd">            &gt;&gt;&gt; # Catalog must be created with s3_bucket=&quot;s3://my-bucket&quot;</span>
<span class="sd">            &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;, use_minid=True)</span>

<span class="sd">        Exclude tables that cause query timeouts:</span>
<span class="sd">            &gt;&gt;&gt; bag = dataset.download_dataset_bag(version=&quot;1.0.0&quot;, exclude_tables={&quot;Process&quot;})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="c1"># Validate use_minid requires s3_bucket configuration</span>
    <span class="k">if</span> <span class="n">use_minid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">s3_bucket</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
            <span class="s2">&quot;Cannot use use_minid=True without s3_bucket configured. &quot;</span>
            <span class="s2">&quot;Configure s3_bucket when creating the DerivaML instance to enable MINID support.&quot;</span>
        <span class="p">)</span>

    <span class="n">minid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_minid</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">use_minid</span><span class="o">=</span><span class="n">use_minid</span><span class="p">,</span> <span class="n">exclude_tables</span><span class="o">=</span><span class="n">exclude_tables</span><span class="p">)</span>

    <span class="n">bag_path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_materialize_dataset_bag</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">use_minid</span><span class="o">=</span><span class="n">use_minid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">materialize</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_download_dataset_minid</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">use_minid</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.model.deriva_ml_database</span><span class="w"> </span><span class="kn">import</span> <span class="n">DerivaMLDatabase</span>
    <span class="n">db_model</span> <span class="o">=</span> <span class="n">DatabaseModel</span><span class="p">(</span><span class="n">minid</span><span class="p">,</span> <span class="n">bag_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">working_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DerivaMLDatabase</span><span class="p">(</span><span class="n">db_model</span><span class="p">)</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.find_features" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_features</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_features</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Feature</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find features associated with a table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table to find features for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="Feature (deriva_ml.feature.Feature)" href="../feature/#deriva_ml.feature.Feature">Feature</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterable of Feature objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find features associated with a table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table to find features for.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Iterable of Feature objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">find_features</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.get_chaise_url" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_chaise_url</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_chaise_url</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the Chaise URL for viewing this dataset in the browser.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL string for the dataset record in Chaise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_chaise_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the Chaise URL for viewing this dataset in the browser.</span>

<span class="sd">    Returns:</span>
<span class="sd">        URL string for the dataset record in Chaise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">host_name</span><span class="si">}</span><span class="s2">/chaise/record/&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog_id</span><span class="si">}</span><span class="s2">/deriva-ml:Dataset/RID=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.increment_dataset_version" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">increment_dataset_version</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">increment_dataset_version</span><span class="p">(</span>
    <span class="n">component</span><span class="p">:</span> <span class="n">VersionPart</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetVersion</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Increments a dataset's version number.</p>
<p>Creates a new version of the dataset by incrementing the specified version component
(major, minor, or patch). The new version is recorded with an optional description
and execution reference.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>component</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="VersionPart (deriva_ml.dataset.aux_classes.VersionPart)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.VersionPart">VersionPart</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Which version component to increment ('major', 'minor', or 'patch').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional description of the changes in this version.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>execution_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.constants.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional execution RID to associate with this version.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DatasetVersion</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The new version number.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dataset_rid is invalid or version increment fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>new_version = ml.increment_dataset_version(
...     dataset_rid="1-abc123",
...     component="minor",
...     description="Added new samples"
... )
print(f"New version: {new_version}")  # e.g., "1.2.0"</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">increment_dataset_version</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">component</span><span class="p">:</span> <span class="n">VersionPart</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">execution_rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetVersion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Increments a dataset&#39;s version number.</span>

<span class="sd">    Creates a new version of the dataset by incrementing the specified version component</span>
<span class="sd">    (major, minor, or patch). The new version is recorded with an optional description</span>
<span class="sd">    and execution reference.</span>

<span class="sd">    Args:</span>
<span class="sd">        component: Which version component to increment (&#39;major&#39;, &#39;minor&#39;, or &#39;patch&#39;).</span>
<span class="sd">        description: Optional description of the changes in this version.</span>
<span class="sd">        execution_rid: Optional execution RID to associate with this version.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DatasetVersion: The new version number.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If dataset_rid is invalid or version increment fails.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; new_version = ml.increment_dataset_version(</span>
<span class="sd">        ...     dataset_rid=&quot;1-abc123&quot;,</span>
<span class="sd">        ...     component=&quot;minor&quot;,</span>
<span class="sd">        ...     description=&quot;Added new samples&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;New version: {new_version}&quot;)  # e.g., &quot;1.2.0&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Find all the datasets that are reachable from this dataset and determine their new version numbers.</span>
    <span class="n">related_datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_dataset_graph</span><span class="p">())</span>
    <span class="n">version_update_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">DatasetSpec</span><span class="p">(</span>
            <span class="n">rid</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">current_version</span><span class="o">.</span><span class="n">increment_version</span><span class="p">(</span><span class="n">component</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">related_datasets</span>
    <span class="p">]</span>
    <span class="n">Dataset</span><span class="o">.</span><span class="n">_insert_dataset_versions</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="p">,</span> <span class="n">version_update_list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span> <span class="n">execution_rid</span><span class="o">=</span><span class="n">execution_rid</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">((</span><span class="n">d</span><span class="o">.</span><span class="n">version</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">version_update_list</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">rid</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.list_dataset_children" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_dataset_children</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_dataset_children</span><span class="p">(</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Given a dataset_table RID, return a list of RIDs for any nested datasets.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>recurse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return a list of nested datasets RIDs.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_visited</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="deriva_ml.core.constants.RID">RID</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to track visited datasets and prevent infinite recursion.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version to list children from. Defaults to the current version.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments (ignored, for protocol compatibility).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="typing.Self">Self</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of nested dataset RIDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_children</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a dataset_table RID, return a list of RIDs for any nested datasets.</span>

<span class="sd">    Args:</span>
<span class="sd">        recurse: If True, return a list of nested datasets RIDs.</span>
<span class="sd">        _visited: Internal parameter to track visited datasets and prevent infinite recursion.</span>
<span class="sd">        version: Dataset version to list children from. Defaults to the current version.</span>
<span class="sd">        **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">    Returns:</span>
<span class="sd">      list of nested dataset RIDs.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize visited set for recursion guard</span>
    <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="n">version</span> <span class="o">=</span> <span class="n">DatasetVersion</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">version</span>
    <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">dataset_dataset_path</span> <span class="o">=</span> <span class="p">(</span>
       <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset_Dataset&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">nested_datasets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset_dataset_path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_children</span><span class="p">(</span><span class="n">rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">RID</span><span class="p">]:</span>
        <span class="c1"># Prevent infinite recursion by checking if we&#39;ve already visited this dataset</span>
        <span class="k">if</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>

        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">child</span><span class="p">[</span><span class="s2">&quot;Nested_Dataset&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">nested_datasets</span> <span class="k">if</span> <span class="n">child</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">rid</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
                <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_children</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">children</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span> <span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">find_children</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.list_dataset_element_types" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_dataset_element_types</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_dataset_element_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">(</span>
    <span class="n">Iterable</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List the types of elements that can be contained in this dataset.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Iterable of Table objects representing element types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_element_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List the types of elements that can be contained in this dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Iterable of Table objects representing element types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">list_dataset_element_types</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.list_dataset_members" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_dataset_members</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_dataset_members</span><span class="p">(</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Lists members of a dataset.</p>
<p>Returns a dictionary mapping member types to lists of member records. Can optionally
recurse through nested datasets and limit the number of results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>recurse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include members of nested datasets. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of members to return per type. None for no limit.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_visited</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="deriva_ml.core.constants.RID">RID</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to track visited datasets and prevent infinite recursion.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version to list members from. Defaults to the current version.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments (ignored, for protocol compatibility).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, list[dict[str, Any]]]: Dictionary mapping member types to lists of members.
Each member is a dictionary containing the record's attributes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If dataset_rid is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>members = ml.list_dataset_members("1-abc123", recurse=True)
for type_name, records in members.items():
...     print(f"{type_name}: {len(records)} records")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_members</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lists members of a dataset.</span>

<span class="sd">    Returns a dictionary mapping member types to lists of member records. Can optionally</span>
<span class="sd">    recurse through nested datasets and limit the number of results.</span>

<span class="sd">    Args:</span>
<span class="sd">        recurse: Whether to include members of nested datasets. Defaults to False.</span>
<span class="sd">        limit: Maximum number of members to return per type. None for no limit.</span>
<span class="sd">        _visited: Internal parameter to track visited datasets and prevent infinite recursion.</span>
<span class="sd">        version: Dataset version to list members from. Defaults to the current version.</span>
<span class="sd">        **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, list[dict[str, Any]]]: Dictionary mapping member types to lists of members.</span>
<span class="sd">            Each member is a dictionary containing the record&#39;s attributes.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If dataset_rid is invalid.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; members = ml.list_dataset_members(&quot;1-abc123&quot;, recurse=True)</span>
<span class="sd">        &gt;&gt;&gt; for type_name, records in members.items():</span>
<span class="sd">        ...     print(f&quot;{type_name}: {len(records)} records&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize visited set for recursion guard</span>
    <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># Prevent infinite recursion by checking if we&#39;ve already visited this dataset</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>

    <span class="c1"># Look at each of the element types that might be in the dataset_table and get the list of rid for them from</span>
    <span class="c1"># the appropriate association table.</span>
    <span class="n">members</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">assoc_table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">():</span>
        <span class="n">other_fkey</span> <span class="o">=</span> <span class="n">assoc_table</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">target_table</span> <span class="o">=</span> <span class="n">other_fkey</span><span class="o">.</span><span class="n">pk_table</span>
        <span class="n">member_table</span> <span class="o">=</span> <span class="n">assoc_table</span><span class="o">.</span><span class="n">table</span>

        <span class="c1"># Look at domain tables and nested datasets.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">target_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="n">target_table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span> <span class="ow">or</span> <span class="n">target_table</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;File&quot;</span>
        <span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">member_column</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Nested_Dataset&quot;</span> <span class="k">if</span> <span class="n">target_table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span> <span class="k">else</span> <span class="n">other_fkey</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="c1"># Use the actual referenced column from the FK definition, not always &quot;RID&quot;.</span>
        <span class="c1"># e.g. isa:Dataset_file.file -&gt; isa:file.id (integer), not RID.</span>
        <span class="n">target_column</span> <span class="o">=</span> <span class="n">other_fkey</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

        <span class="n">target_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">target_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">target_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">member_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">member_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">member_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">member_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">member_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">link</span><span class="p">(</span>
            <span class="n">target_path</span><span class="p">,</span>
            <span class="n">on</span><span class="o">=</span><span class="p">(</span><span class="n">member_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">member_column</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">target_column</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">target_entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>
        <span class="n">members</span><span class="p">[</span><span class="n">target_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">target_entities</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recurse</span> <span class="ow">and</span> <span class="n">target_table</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_table</span><span class="p">:</span>
            <span class="c1"># Get the members for all the nested datasets and add to the member list.</span>
            <span class="n">nested_datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">target_entities</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ds_rid</span> <span class="ow">in</span> <span class="n">nested_datasets</span><span class="p">:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">ds_rid</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">list_dataset_members</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">members</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">members</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.list_dataset_parents" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_dataset_parents</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_dataset_parents</span><span class="p">(</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Given a dataset_table RID, return a list of RIDs of the parent datasets if this is included in a
nested dataset.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>recurse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, recursively return all ancestor datasets.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_visited</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="deriva_ml.core.constants.RID">RID</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to track visited datasets and prevent infinite recursion.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version to list parents from. Defaults to the current version.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments (ignored, for protocol compatibility).</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="typing.Self">Self</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of parent datasets.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_parents</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Self</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a dataset_table RID, return a list of RIDs of the parent datasets if this is included in a</span>
<span class="sd">    nested dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        recurse: If True, recursively return all ancestor datasets.</span>
<span class="sd">        _visited: Internal parameter to track visited datasets and prevent infinite recursion.</span>
<span class="sd">        version: Dataset version to list parents from. Defaults to the current version.</span>
<span class="sd">        **kwargs: Additional arguments (ignored, for protocol compatibility).</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of parent datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize visited set for recursion guard</span>
    <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># Prevent infinite recursion by checking if we&#39;ve already visited this dataset</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>

    <span class="c1"># Get association table for nested datasets</span>
    <span class="n">version_snapshot_catalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_snapshot_catalog</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">atable_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Dataset</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">version_snapshot_catalog</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Nested_Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="o">.</span><span class="n">copy</span><span class="p">():</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">list_dataset_parents</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">parents</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.list_executions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_executions</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_executions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s1">&#39;Execution&#39;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all executions associated with this dataset.</p>
<p>Returns all executions that used this dataset as input. This is
tracked through the Dataset_Execution association table.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[&#39;Execution&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Execution objects associated with this dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>dataset = ml.lookup_dataset("1-abc123")
executions = dataset.list_executions()
for exe in executions:
...     print(f"Execution {exe.execution_rid}: {exe.status}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_executions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all executions associated with this dataset.</span>

<span class="sd">    Returns all executions that used this dataset as input. This is</span>
<span class="sd">    tracked through the Dataset_Execution association table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Execution objects associated with this dataset.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; dataset = ml.lookup_dataset(&quot;1-abc123&quot;)</span>
<span class="sd">        &gt;&gt;&gt; executions = dataset.list_executions()</span>
<span class="sd">        &gt;&gt;&gt; for exe in executions:</span>
<span class="sd">        ...     print(f&quot;Execution {exe.execution_rid}: {exe.status}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Import here to avoid circular dependency</span>

    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">dataset_execution_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Execution</span>

    <span class="c1"># Query for all executions associated with this dataset</span>
    <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">dataset_execution_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dataset_execution_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span>
        <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
        <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_execution</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.remove_dataset_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">remove_dataset_type</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_dataset_type</span><span class="p">(</span>
    <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove a dataset type from this dataset.</p>
<p>Removes a type term from this dataset if it's currently associated. The term
must exist in the Dataset_Type vocabulary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_type</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="VocabularyTerm (deriva_ml.core.definitions.VocabularyTerm)" href="../deriva_definitions/#deriva_ml.core.definitions.VocabularyTerm">VocabularyTerm</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Term name (string) or VocabularyTerm object from Dataset_Type vocabulary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLInvalidTerm (deriva_ml.core.exceptions.DerivaMLInvalidTerm)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLInvalidTerm">DerivaMLInvalidTerm</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the term doesn't exist in the Dataset_Type vocabulary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>dataset.remove_dataset_type("Training")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_dataset_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">VocabularyTerm</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a dataset type from this dataset.</span>

<span class="sd">    Removes a type term from this dataset if it&#39;s currently associated. The term</span>
<span class="sd">    must exist in the Dataset_Type vocabulary.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_type: Term name (string) or VocabularyTerm object from Dataset_Type vocabulary.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLInvalidTerm: If the term doesn&#39;t exist in the Dataset_Type vocabulary.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; dataset.remove_dataset_type(&quot;Training&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert to VocabularyTerm if needed (validates the term exists)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">VocabularyTerm</span><span class="p">):</span>
        <span class="n">vocab_term</span> <span class="o">=</span> <span class="n">dataset_type</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vocab_term</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">)</span>

    <span class="c1"># Check if present</span>
    <span class="k">if</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Delete from association table</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">atable_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dataset_type_association_table</span><span class="p">()</span>
    <span class="n">atable_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">atable_path</span><span class="o">.</span><span class="n">Dataset_Type</span> <span class="o">==</span> <span class="n">vocab_term</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.dataset.dataset.Dataset.to_markdown" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">to_markdown</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_markdown</span><span class="p">(</span>
    <span class="n">show_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a markdown representation of this dataset.</p>
<p>Returns a formatted markdown string with a link to the dataset,
version, types, and description. Optionally includes nested children.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>show_children</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, include direct child datasets.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indent</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of indent levels (each level is 2 spaces).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Markdown-formatted string.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>ds = ml.lookup_dataset("4HM")
print(ds.to_markdown())</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/dataset/dataset.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_children</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a markdown representation of this dataset.</span>

<span class="sd">    Returns a formatted markdown string with a link to the dataset,</span>
<span class="sd">    version, types, and description. Optionally includes nested children.</span>

<span class="sd">    Args:</span>
<span class="sd">        show_children: If True, include direct child datasets.</span>
<span class="sd">        indent: Number of indent levels (each level is 2 spaces).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Markdown-formatted string.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; ds = ml.lookup_dataset(&quot;4HM&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(ds.to_markdown())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;  &quot;</span> <span class="o">*</span> <span class="n">indent</span>
    <span class="n">version</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span> <span class="k">else</span> <span class="s2">&quot;n/a&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_types</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

    <span class="n">line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">- [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_rid</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_chaise_url</span><span class="p">()</span><span class="si">}</span><span class="s2">) v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="n">types</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="n">types</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="k">if</span> <span class="n">desc</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">show_children</span><span class="p">:</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_dataset_children</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">(</span><span class="n">show_children</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../deriva_model/" class="md-footer__link md-footer__link--prev" aria-label="Previous: DerivaModel">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                DerivaModel
              </div>
            </div>
          </a>
        
        
          
          <a href="../dataset_bag/" class="md-footer__link md-footer__link--next" aria-label="Next: DatasetBag">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                DatasetBag
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>