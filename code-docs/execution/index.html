
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://informatics-isi-edu.github.io/deriva-ml/code-docs/execution/">
      
      
        <link rel="prev" href="../dataset_aux_classes/">
      
      
        <link rel="next" href="../execution_configuration/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Execution - DerivaML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-execution-class-in-derivaml" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DerivaML" class="md-header__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DerivaML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Execution
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DerivaML" class="md-nav__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    DerivaML
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview of DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deriva_ml_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installing deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/identifiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identifying things in deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/file-assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog Annotations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/execution-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring an Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/hydra-zen-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hydra-zen Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/running-models-and-notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Models and Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using DerivaML with Jupyter Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sample Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sample Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Library Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Library Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Classes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Classes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_ml_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaModel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Datasets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_bag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DatasetBag
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_split/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Splitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_aux_classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Auxiliary Classes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Execution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.AssetRID" class="md-nav__link">
    <span class="md-ellipsis">
      
        AssetRID
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.AssetSpec" class="md-nav__link">
    <span class="md-ellipsis">
      
        AssetSpec
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.AssetSpecConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        AssetSpecConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.BaseConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        DerivaMLModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivaMLModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__call__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel.__call__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel.__call__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList" class="md-nav__link">
    <span class="md-ellipsis">
      
        DescribedList
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DescribedList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--after-instantiation-usage-is-identical-to-a-regular-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        After instantiation, usage is identical to a regular list:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--configassets0-3wmg" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets[0] # "3WMG"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--lenconfigassets-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        len(config.assets) # 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--for-rid-in-configassets" class="md-nav__link">
    <span class="md-ellipsis">
      
        for rid in config.assets: ...
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--configassetsdescription-model-weights-from" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets.description # "Model weights from..."
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.database_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        database_catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execution_record" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution_record
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.status" class="md-nav__link">
    <span class="md-ellipsis">
      
        status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.working_dir" class="md-nav__link">
    <span class="md-ellipsis">
      
        working_dir
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __enter__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __exit__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.add_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.add_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.add_nested_execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_nested_execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.asset_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        asset_file_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.create_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.download_asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.download_dataset_bag" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_dataset_bag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execution_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execution_stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution_stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.is_nested" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_nested
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.is_parent" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_parent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_input_datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_input_datasets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_nested_executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_nested_executions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_parent_executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_parent_executions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.table_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        table_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.update_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        upload_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        upload_execution_outputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="upload_execution_outputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs--upload-after-the-context-manager-exits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upload AFTER the context manager exits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs--upload-large-files-with-increased-timeout-30-min-per-chunk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upload large files with increased timeout (30 min per chunk)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs--override-cleanup-setting-for-this-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Override cleanup setting for this execution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      
        ExecutionConfiguration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExecutionConfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration--plain-rids-backward-compatible" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plain RIDs (backward compatible)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration--mixed-cached-model-weights-uncached-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mixed: cached model weights + uncached embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration.load_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration.validate_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_assets
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.MultirunSpec" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultirunSpec
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __setattr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.get_dynamic_version" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dynamic_version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.get_url_and_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_url_and_checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.setup_url_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        setup_url_checksum
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_model_config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_model_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_all_multirun_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_all_multirun_configs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_multirun_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_multirun_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_notebook_configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_notebook_configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration--load-all-project-configs-into-hydra-store" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load all project configs into hydra store
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration--get-resolved-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get resolved configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration--use-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use the configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.list_multirun_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_multirun_configs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.load_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_configs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.load_configs--in-your-main-script-or-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        In your main script or notebook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.load_configs--or" class="md-nav__link">
    <span class="md-ellipsis">
      
        or
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.notebook_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        notebook_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.reset_multirun_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset_multirun_state
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_notebook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_notebook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--simple-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simple usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--access-config-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access config values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--use-ml-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use ml and execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--at-the-end-of-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        At the end of notebook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description" class="md-nav__link">
    <span class="md-ellipsis">
      
        with_description
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="with_description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--assets-with-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Assets with description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--datasets-with-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Datasets with description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--after-instantiation" class="md-nav__link">
    <span class="md-ellipsis">
      
        After instantiation:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--configassets-is-a-describedlist" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets is a DescribedList
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--configassets0-3wmg" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets[0] # "3WMG"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--configassetsdescription-model-weights-from" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets.description # "Model weights from..."
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExecutionConfiguration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Definitions & Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.AssetRID" class="md-nav__link">
    <span class="md-ellipsis">
      
        AssetRID
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.AssetSpec" class="md-nav__link">
    <span class="md-ellipsis">
      
        AssetSpec
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.AssetSpecConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        AssetSpecConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.BaseConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        DerivaMLModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivaMLModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Attributes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __call__
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__call__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel.__call__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DerivaMLModel.__call__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList" class="md-nav__link">
    <span class="md-ellipsis">
      
        DescribedList
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DescribedList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--after-instantiation-usage-is-identical-to-a-regular-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        After instantiation, usage is identical to a regular list:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--configassets0-3wmg" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets[0] # "3WMG"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--lenconfigassets-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        len(config.assets) # 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--for-rid-in-configassets" class="md-nav__link">
    <span class="md-ellipsis">
      
        for rid in config.assets: ...
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList--configassetsdescription-model-weights-from" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets.description # "Model weights from..."
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.DescribedList.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __repr__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Execution
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.database_catalog" class="md-nav__link">
    <span class="md-ellipsis">
      
        database_catalog
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execution_record" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution_record
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.status" class="md-nav__link">
    <span class="md-ellipsis">
      
        status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.working_dir" class="md-nav__link">
    <span class="md-ellipsis">
      
        working_dir
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __enter__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __exit__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.add_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.add_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.add_nested_execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_nested_execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.asset_file_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        asset_file_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.create_dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_dataset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.download_asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.download_dataset_bag" class="md-nav__link">
    <span class="md-ellipsis">
      
        download_dataset_bag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        execute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execution_start" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution_start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.execution_stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        execution_stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.is_nested" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_nested
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.is_parent" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_parent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_input_datasets" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_input_datasets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_nested_executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_nested_executions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.list_parent_executions" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_parent_executions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.table_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        table_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.update_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        upload_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      
        upload_execution_outputs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="upload_execution_outputs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs--upload-after-the-context-manager-exits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upload AFTER the context manager exits
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs--upload-large-files-with-increased-timeout-30-min-per-chunk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upload large files with increased timeout (30 min per chunk)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Execution.upload_execution_outputs--override-cleanup-setting-for-this-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Override cleanup setting for this execution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration" class="md-nav__link">
    <span class="md-ellipsis">
      
        ExecutionConfiguration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExecutionConfiguration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration--plain-rids-backward-compatible" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plain RIDs (backward compatible)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration--mixed-cached-model-weights-uncached-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mixed: cached model weights + uncached embeddings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration.load_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.ExecutionConfiguration.validate_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_assets
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.MultirunSpec" class="md-nav__link">
    <span class="md-ellipsis">
      
        MultirunSpec
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Workflow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Workflow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __setattr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.get_dynamic_version" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dynamic_version
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.get_url_and_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_url_and_checksum
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.Workflow.setup_url_checksum" class="md-nav__link">
    <span class="md-ellipsis">
      
        setup_url_checksum
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_model_config
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="create_model_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.create_model_config--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_all_multirun_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_all_multirun_configs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_multirun_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_multirun_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_notebook_configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_notebook_configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration--load-all-project-configs-into-hydra-store" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load all project configs into hydra store
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration--get-resolved-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get resolved configuration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.get_notebook_configuration--use-the-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use the configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.list_multirun_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_multirun_configs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.load_configs" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_configs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="load_configs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.load_configs--in-your-main-script-or-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        In your main script or notebook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.load_configs--or" class="md-nav__link">
    <span class="md-ellipsis">
      
        or
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.notebook_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        notebook_config
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.reset_multirun_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset_multirun_state
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_model
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_model--examples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Examples
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        run_notebook
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="run_notebook">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--simple-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Simple usage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--access-config-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Access config values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--use-ml-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use ml and execution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.run_notebook--at-the-end-of-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      
        At the end of notebook
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description" class="md-nav__link">
    <span class="md-ellipsis">
      
        with_description
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="with_description">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--assets-with-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Assets with description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--datasets-with-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Datasets with description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--after-instantiation" class="md-nav__link">
    <span class="md-ellipsis">
      
        After instantiation:
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--configassets-is-a-describedlist" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets is a DescribedList
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--configassets0-3wmg" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets[0] # "3WMG"
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.execution.with_description--configassetsdescription-model-weights-from" class="md-nav__link">
    <span class="md-ellipsis">
      
        config.assets.description # "Model weights from..."
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="documentation-for-execution-class-in-derivaml">Documentation for Execution class in DerivaML</h1>


<div class="doc doc-object doc-module">



<a id="deriva_ml.execution"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.AssetRID" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AssetRID</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code></p>



        <p>A string subclass representing an asset Resource ID with optional description.</p>
<p>.. deprecated::
    Use :class:<code>AssetSpec</code> instead for new code. <code>AssetRID</code> is retained
    for backward compatibility.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.AssetRID.rid">rid</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Resource ID string identifying the asset in Deriva.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.AssetRID.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional human-readable description of the asset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>asset = AssetRID("3RA", "Pretrained model weights")
print(asset)  # "3RA"
print(asset.description)  # "Pretrained model weights"</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/execution_configuration.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AssetRID</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A string subclass representing an asset Resource ID with optional description.</span>

<span class="sd">    .. deprecated::</span>
<span class="sd">        Use :class:`AssetSpec` instead for new code. ``AssetRID`` is retained</span>
<span class="sd">        for backward compatibility.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        rid: The Resource ID string identifying the asset in Deriva.</span>
<span class="sd">        description: Optional human-readable description of the asset.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; asset = AssetRID(&quot;3RA&quot;, &quot;Pretrained model weights&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(asset)  # &quot;3RA&quot;</span>
<span class="sd">        &gt;&gt;&gt; print(asset.description)  # &quot;Pretrained model weights&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rid</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.AssetSpec" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AssetSpec</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>



        <p>Specification for an asset in execution configurations.</p>
<p>Used to reference assets as inputs to executions, similar to how
DatasetSpec is used for datasets. Supports optional checksum-based
caching for large assets like model weights.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.AssetSpec.rid">rid</span></code></td>
            <td>
                  <code><span title="deriva_ml.core.definitions.RID">RID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource Identifier of the asset.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.AssetSpec.asset_role">asset_role</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Role of the asset ("Input" or "Output"). Defaults to "Input".</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.AssetSpec.cache">cache</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, cache the downloaded asset by MD5 checksum in the
DerivaML cache directory. Cached assets are reused across executions
when the checksum matches, avoiding repeated downloads of large files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>spec = AssetSpec(rid="3JSE")
spec = AssetSpec(rid="3JSE", cache=True)  # enable caching</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/asset/aux_classes.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AssetSpec</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Specification for an asset in execution configurations.</span>

<span class="sd">    Used to reference assets as inputs to executions, similar to how</span>
<span class="sd">    DatasetSpec is used for datasets. Supports optional checksum-based</span>
<span class="sd">    caching for large assets like model weights.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        rid: Resource Identifier of the asset.</span>
<span class="sd">        asset_role: Role of the asset (&quot;Input&quot; or &quot;Output&quot;). Defaults to &quot;Input&quot;.</span>
<span class="sd">        cache: If True, cache the downloaded asset by MD5 checksum in the</span>
<span class="sd">            DerivaML cache directory. Cached assets are reused across executions</span>
<span class="sd">            when the checksum matches, avoiding repeated downloads of large files.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; spec = AssetSpec(rid=&quot;3JSE&quot;)</span>
<span class="sd">        &gt;&gt;&gt; spec = AssetSpec(rid=&quot;3JSE&quot;, cache=True)  # enable caching</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rid</span><span class="p">:</span> <span class="n">RID</span>
    <span class="n">asset_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Input&quot;</span>
    <span class="n">cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_bare_rid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow bare RID string as shorthand.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;rid&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">}</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.AssetSpecConfig" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AssetSpecConfig</span>


</h2>


    <div class="doc doc-contents ">



        <p>Hydra-zen configuration interface for AssetSpec.</p>
<p>Use in hydra-zen store definitions to specify assets with caching:</p>
<pre><code>&gt;&gt;&gt; from hydra_zen import store
&gt;&gt;&gt; asset_store = store(group="assets")
&gt;&gt;&gt; asset_store(
...     [AssetSpecConfig(rid="6-EPNR", cache=True)],
...     name="cached_weights",
... )
</code></pre>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/asset/aux_classes.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@hydrated_dataclass</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AssetSpecConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hydra-zen configuration interface for AssetSpec.</span>

<span class="sd">    Use in hydra-zen store definitions to specify assets with caching:</span>

<span class="sd">        &gt;&gt;&gt; from hydra_zen import store</span>
<span class="sd">        &gt;&gt;&gt; asset_store = store(group=&quot;assets&quot;)</span>
<span class="sd">        &gt;&gt;&gt; asset_store(</span>
<span class="sd">        ...     [AssetSpecConfig(rid=&quot;6-EPNR&quot;, cache=True)],</span>
<span class="sd">        ...     name=&quot;cached_weights&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rid</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.BaseConfig" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BaseConfig</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Base configuration for DerivaML applications.</p>
<p>This dataclass defines the common configuration structure shared by
both script execution and notebook modes. Project-specific configs
should inherit from this class to get the standard DerivaML fields.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Fields use <code>Any</code> type annotations because several DerivaML types
(DerivaMLConfig, DatasetSpec) are Pydantic models which are not
compatible with OmegaConf structured configs. The actual types at
runtime are documented below.</p>
</details>

<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.BaseConfig.deriva_ml">deriva_ml</span></code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DerivaML connection configuration (DerivaMLConfig at runtime).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.BaseConfig.datasets">datasets</span></code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of dataset specifications (list[DatasetSpec] at runtime).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.BaseConfig.assets">assets</span></code></td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of asset RIDs to load (list[str] at runtime).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.BaseConfig.dry_run">dry_run</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, skip catalog writes (for testing/debugging).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.BaseConfig.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description of this run.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.BaseConfig.config_choices">config_choices</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping config group names to selected config names.
This is automatically populated by get_notebook_configuration() with the
Hydra runtime choices (e.g., {"model_config": "cifar10_quick", "assets": "roc_quick"}).
Useful for tracking which configurations were used in an execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from dataclasses import dataclass
from deriva_ml.execution import BaseConfig</p>
<p>@dataclass
... class MyConfig(BaseConfig):
...     learning_rate: float = 0.001
...     epochs: int = 10</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BaseConfig</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base configuration for DerivaML applications.</span>

<span class="sd">    This dataclass defines the common configuration structure shared by</span>
<span class="sd">    both script execution and notebook modes. Project-specific configs</span>
<span class="sd">    should inherit from this class to get the standard DerivaML fields.</span>

<span class="sd">    Note:</span>
<span class="sd">        Fields use ``Any`` type annotations because several DerivaML types</span>
<span class="sd">        (DerivaMLConfig, DatasetSpec) are Pydantic models which are not</span>
<span class="sd">        compatible with OmegaConf structured configs. The actual types at</span>
<span class="sd">        runtime are documented below.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        deriva_ml: DerivaML connection configuration (DerivaMLConfig at runtime).</span>
<span class="sd">        datasets: List of dataset specifications (list[DatasetSpec] at runtime).</span>
<span class="sd">        assets: List of asset RIDs to load (list[str] at runtime).</span>
<span class="sd">        dry_run: If True, skip catalog writes (for testing/debugging).</span>
<span class="sd">        description: Human-readable description of this run.</span>
<span class="sd">        config_choices: Dictionary mapping config group names to selected config names.</span>
<span class="sd">            This is automatically populated by get_notebook_configuration() with the</span>
<span class="sd">            Hydra runtime choices (e.g., {&quot;model_config&quot;: &quot;cifar10_quick&quot;, &quot;assets&quot;: &quot;roc_quick&quot;}).</span>
<span class="sd">            Useful for tracking which configurations were used in an execution.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from dataclasses import dataclass</span>
<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution import BaseConfig</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; @dataclass</span>
<span class="sd">        ... class MyConfig(BaseConfig):</span>
<span class="sd">        ...     learning_rate: float = 0.001</span>
<span class="sd">        ...     epochs: int = 10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">deriva_ml</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">datasets</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">assets</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">config_choices</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.DerivaMLModel" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DerivaMLModel</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for model functions compatible with DerivaML's run_model().</p>
<p>A model function must accept keyword arguments <code>ml_instance</code> and <code>execution</code>
that are injected at runtime by run_model(). All other parameters are
configured via Hydra and passed through the model_config.</p>
<p>The model function is responsible for:
1. Downloading input datasets via execution.download_dataset_bag()
2. Performing the ML computation (training, inference, etc.)
3. Registering output files via execution.asset_file_path()</p>
<p>Output files registered with asset_file_path() are automatically uploaded
to the catalog after the model completes.</p>
<h4 id="deriva_ml.execution.DerivaMLModel--attributes">Attributes</h4>
<p>This protocol defines a callable signature, not attributes.</p>
<h4 id="deriva_ml.execution.DerivaMLModel--examples">Examples</h4>
<p>Basic model function:</p>
<pre><code>def my_model(
    epochs: int = 10,
    ml_instance: DerivaML = None,
    execution: Execution = None,
) -&gt; None:
    # Training logic here
    pass
</code></pre>
<p>With domain-specific DerivaML subclass:</p>
<pre><code>def eyeai_model(
    threshold: float = 0.5,
    ml_instance: EyeAI = None,  # EyeAI is a DerivaML subclass
    execution: Execution = None,
) -&gt; None:
    # Can use EyeAI-specific methods
    ml_instance.some_eyeai_method()
</code></pre>
<p>Checking protocol compliance:</p>
<pre><code>&gt;&gt;&gt; from deriva_ml.execution.model_protocol import DerivaMLModel
&gt;&gt;&gt; isinstance(my_model, DerivaMLModel)
True
</code></pre>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/model_protocol.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@runtime_checkable</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DerivaMLModel</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol for model functions compatible with DerivaML&#39;s run_model().</span>

<span class="sd">    A model function must accept keyword arguments `ml_instance` and `execution`</span>
<span class="sd">    that are injected at runtime by run_model(). All other parameters are</span>
<span class="sd">    configured via Hydra and passed through the model_config.</span>

<span class="sd">    The model function is responsible for:</span>
<span class="sd">    1. Downloading input datasets via execution.download_dataset_bag()</span>
<span class="sd">    2. Performing the ML computation (training, inference, etc.)</span>
<span class="sd">    3. Registering output files via execution.asset_file_path()</span>

<span class="sd">    Output files registered with asset_file_path() are automatically uploaded</span>
<span class="sd">    to the catalog after the model completes.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    This protocol defines a callable signature, not attributes.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Basic model function:</span>

<span class="sd">        def my_model(</span>
<span class="sd">            epochs: int = 10,</span>
<span class="sd">            ml_instance: DerivaML = None,</span>
<span class="sd">            execution: Execution = None,</span>
<span class="sd">        ) -&gt; None:</span>
<span class="sd">            # Training logic here</span>
<span class="sd">            pass</span>

<span class="sd">    With domain-specific DerivaML subclass:</span>

<span class="sd">        def eyeai_model(</span>
<span class="sd">            threshold: float = 0.5,</span>
<span class="sd">            ml_instance: EyeAI = None,  # EyeAI is a DerivaML subclass</span>
<span class="sd">            execution: Execution = None,</span>
<span class="sd">        ) -&gt; None:</span>
<span class="sd">            # Can use EyeAI-specific methods</span>
<span class="sd">            ml_instance.some_eyeai_method()</span>

<span class="sd">    Checking protocol compliance:</span>

<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution.model_protocol import DerivaMLModel</span>
<span class="sd">        &gt;&gt;&gt; isinstance(my_model, DerivaMLModel)</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">ml_instance</span><span class="p">:</span> <span class="s2">&quot;DerivaML&quot;</span><span class="p">,</span>
        <span class="n">execution</span><span class="p">:</span> <span class="s2">&quot;Execution&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the model within a DerivaML execution context.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args : Any</span>
<span class="sd">            Positional arguments (typically not used; prefer keyword args).</span>
<span class="sd">        ml_instance : DerivaML</span>
<span class="sd">            The DerivaML instance (or subclass like EyeAI) connected to the</span>
<span class="sd">            catalog. Use this for catalog operations not available through</span>
<span class="sd">            the execution context.</span>
<span class="sd">        execution : Execution</span>
<span class="sd">            The execution context manager. Provides:</span>
<span class="sd">            - execution.datasets: List of input DatasetSpec objects</span>
<span class="sd">            - execution.download_dataset_bag(): Download dataset as BDBag</span>
<span class="sd">            - execution.asset_file_path(): Register output file for upload</span>
<span class="sd">            - execution.working_dir: Path to local working directory</span>
<span class="sd">        **kwargs : Any</span>
<span class="sd">            Model-specific parameters configured via Hydra.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">            Models should not return values. Results are captured through:</span>
<span class="sd">            - Files registered with asset_file_path() (uploaded to catalog)</span>
<span class="sd">            - Datasets created with execution.create_dataset()</span>
<span class="sd">            - Status updates via execution.update_status()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.DerivaMLModel.__call__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__call__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__call__</span><span class="p">(</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">ml_instance</span><span class="p">:</span> <span class="s2">&quot;DerivaML&quot;</span><span class="p">,</span>
    <span class="n">execution</span><span class="p">:</span> <span class="s2">&quot;Execution&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the model within a DerivaML execution context.</p>
<h5 id="deriva_ml.execution.DerivaMLModel.__call__--parameters">Parameters</h5>
<p><em>args : Any
    Positional arguments (typically not used; prefer keyword args).
ml_instance : DerivaML
    The DerivaML instance (or subclass like EyeAI) connected to the
    catalog. Use this for catalog operations not available through
    the execution context.
execution : Execution
    The execution context manager. Provides:
    - execution.datasets: List of input DatasetSpec objects
    - execution.download_dataset_bag(): Download dataset as BDBag
    - execution.asset_file_path(): Register output file for upload
    - execution.working_dir: Path to local working directory
</em>*kwargs : Any
    Model-specific parameters configured via Hydra.</p>
<h5 id="deriva_ml.execution.DerivaMLModel.__call__--returns">Returns</h5>
<p>None
    Models should not return values. Results are captured through:
    - Files registered with asset_file_path() (uploaded to catalog)
    - Datasets created with execution.create_dataset()
    - Status updates via execution.update_status()</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/model_protocol.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">ml_instance</span><span class="p">:</span> <span class="s2">&quot;DerivaML&quot;</span><span class="p">,</span>
    <span class="n">execution</span><span class="p">:</span> <span class="s2">&quot;Execution&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the model within a DerivaML execution context.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args : Any</span>
<span class="sd">        Positional arguments (typically not used; prefer keyword args).</span>
<span class="sd">    ml_instance : DerivaML</span>
<span class="sd">        The DerivaML instance (or subclass like EyeAI) connected to the</span>
<span class="sd">        catalog. Use this for catalog operations not available through</span>
<span class="sd">        the execution context.</span>
<span class="sd">    execution : Execution</span>
<span class="sd">        The execution context manager. Provides:</span>
<span class="sd">        - execution.datasets: List of input DatasetSpec objects</span>
<span class="sd">        - execution.download_dataset_bag(): Download dataset as BDBag</span>
<span class="sd">        - execution.asset_file_path(): Register output file for upload</span>
<span class="sd">        - execution.working_dir: Path to local working directory</span>
<span class="sd">    **kwargs : Any</span>
<span class="sd">        Model-specific parameters configured via Hydra.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Models should not return values. Results are captured through:</span>
<span class="sd">        - Files registered with asset_file_path() (uploaded to catalog)</span>
<span class="sd">        - Datasets created with execution.create_dataset()</span>
<span class="sd">        - Status updates via execution.update_status()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.DescribedList" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DescribedList</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="list">list</span></code></p>



        <p>A list with an attached description.</p>
<p>This class extends list to add a <code>description</code> attribute while maintaining
full list compatibility. This allows configuration values (like asset RIDs
or dataset specs) to carry documentation without changing how they're used.</p>
<p>When stored in hydra-zen and resolved via <code>instantiate()</code>, the result is a
DescribedList that behaves like a regular list but has a <code>description</code> attribute.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.DescribedList.description">description</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description of this configuration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from hydra_zen import store
from deriva_ml.execution import with_description</p>
<p>asset_store = store(group="assets")
asset_store(
...     with_description(
...         ["3WMG", "3XPA"],
...         "Model weights from quick and extended training",
...     ),
...     name="comparison_weights",
... )</p>
<h3 id="deriva_ml.execution.DescribedList--after-instantiation-usage-is-identical-to-a-regular-list">After instantiation, usage is identical to a regular list:</h3>
<h3 id="deriva_ml.execution.DescribedList--configassets0-3wmg">config.assets[0]  # "3WMG"</h3>
<h3 id="deriva_ml.execution.DescribedList--lenconfigassets-2">len(config.assets)  # 2</h3>
<h3 id="deriva_ml.execution.DescribedList--for-rid-in-configassets">for rid in config.assets: ...</h3>
<h3 id="deriva_ml.execution.DescribedList--configassetsdescription-model-weights-from">config.assets.description  # "Model weights from..."</h3>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DescribedList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list with an attached description.</span>

<span class="sd">    This class extends list to add a `description` attribute while maintaining</span>
<span class="sd">    full list compatibility. This allows configuration values (like asset RIDs</span>
<span class="sd">    or dataset specs) to carry documentation without changing how they&#39;re used.</span>

<span class="sd">    When stored in hydra-zen and resolved via `instantiate()`, the result is a</span>
<span class="sd">    DescribedList that behaves like a regular list but has a `description` attribute.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        description: Human-readable description of this configuration.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from hydra_zen import store</span>
<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution import with_description</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; asset_store = store(group=&quot;assets&quot;)</span>
<span class="sd">        &gt;&gt;&gt; asset_store(</span>
<span class="sd">        ...     with_description(</span>
<span class="sd">        ...         [&quot;3WMG&quot;, &quot;3XPA&quot;],</span>
<span class="sd">        ...         &quot;Model weights from quick and extended training&quot;,</span>
<span class="sd">        ...     ),</span>
<span class="sd">        ...     name=&quot;comparison_weights&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # After instantiation, usage is identical to a regular list:</span>
<span class="sd">        &gt;&gt;&gt; # config.assets[0]  # &quot;3WMG&quot;</span>
<span class="sd">        &gt;&gt;&gt; # len(config.assets)  # 2</span>
<span class="sd">        &gt;&gt;&gt; # for rid in config.assets: ...</span>
<span class="sd">        &gt;&gt;&gt; # config.assets.description  # &quot;Model weights from...&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a DescribedList.</span>

<span class="sd">        Args:</span>
<span class="sd">            items: Initial list items. If None, creates empty list.</span>
<span class="sd">            description: Human-readable description of this list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">items</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return string representation including description.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DescribedList(</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">!r}</span><span class="s2">, description=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">!r}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DescribedList(</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.DescribedList.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a DescribedList.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>items</code>
            </td>
            <td>
                  <code><span title="list">list</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial list items. If None, creates empty list.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description of this list.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a DescribedList.</span>

<span class="sd">    Args:</span>
<span class="sd">        items: Initial list items. If None, creates empty list.</span>
<span class="sd">        description: Human-readable description of this list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">items</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.DescribedList.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__repr__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return string representation including description.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return string representation including description.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DescribedList(</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">!r}</span><span class="s2">, description=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="si">!r}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;DescribedList(</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.Execution" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Execution</span>


</h2>


    <div class="doc doc-contents ">



        <p>Manages the lifecycle and context of a DerivaML execution.</p>
<p>An Execution represents a computational or manual process within DerivaML. It provides:
- Dataset materialization and access
- Asset management (inputs and outputs)
- Status tracking and updates
- Provenance recording
- Result upload and cataloging</p>
<p>The class handles downloading required datasets and assets, tracking execution state,
and managing the upload of results. Every dataset and file generated is associated
with an execution record for provenance tracking.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.dataset_rids">dataset_rids</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.core.definitions.RID">RID</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RIDs of datasets used in the execution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.datasets">datasets</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DatasetBag (deriva_ml.dataset.dataset_bag.DatasetBag)" href="../dataset_bag/#deriva_ml.dataset.dataset_bag.DatasetBag">DatasetBag</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Materialized dataset objects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.configuration">configuration</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExecutionConfiguration (deriva_ml.execution.execution_configuration.ExecutionConfiguration)" href="../execution_configuration/#deriva_ml.execution.execution_configuration.ExecutionConfiguration">ExecutionConfiguration</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Execution settings and parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.workflow_rid">workflow_rid</span></code></td>
            <td>
                  <code><span title="deriva_ml.core.definitions.RID">RID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RID of the associated workflow.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="status


  
      property
      writable
   (deriva_ml.execution.Execution.status)" href="#deriva_ml.execution.Execution.status">status</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Status (deriva_ml.core.definitions.Status)" href="../deriva_definitions/#deriva_ml.core.definitions.Status">Status</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current execution status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.asset_paths">asset_paths</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.asset.aux_classes.AssetFilePath">AssetFilePath</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paths to execution assets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.start_time">start_time</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When execution started.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Execution.stop_time">stop_time</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When execution completed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>The context manager handles start/stop timing. Upload must be called AFTER
the context manager exits::</p>
<pre><code>&gt;&gt;&gt; config = ExecutionConfiguration(
...     workflow="analysis",
...     description="Process samples",
... )
&gt;&gt;&gt; with ml.create_execution(config) as execution:
...     bag = execution.download_dataset_bag(dataset_spec)
...     # Run analysis using bag.path
...     output_path = execution.asset_file_path("Model", "model.pt")
...     # Write results to output_path
...
&gt;&gt;&gt; # IMPORTANT: Call upload AFTER exiting the context manager
&gt;&gt;&gt; execution.upload_execution_outputs()
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Execution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages the lifecycle and context of a DerivaML execution.</span>

<span class="sd">    An Execution represents a computational or manual process within DerivaML. It provides:</span>
<span class="sd">    - Dataset materialization and access</span>
<span class="sd">    - Asset management (inputs and outputs)</span>
<span class="sd">    - Status tracking and updates</span>
<span class="sd">    - Provenance recording</span>
<span class="sd">    - Result upload and cataloging</span>

<span class="sd">    The class handles downloading required datasets and assets, tracking execution state,</span>
<span class="sd">    and managing the upload of results. Every dataset and file generated is associated</span>
<span class="sd">    with an execution record for provenance tracking.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        dataset_rids (list[RID]): RIDs of datasets used in the execution.</span>
<span class="sd">        datasets (list[DatasetBag]): Materialized dataset objects.</span>
<span class="sd">        configuration (ExecutionConfiguration): Execution settings and parameters.</span>
<span class="sd">        workflow_rid (RID): RID of the associated workflow.</span>
<span class="sd">        status (Status): Current execution status.</span>
<span class="sd">        asset_paths (list[AssetFilePath]): Paths to execution assets.</span>
<span class="sd">        start_time (datetime | None): When execution started.</span>
<span class="sd">        stop_time (datetime | None): When execution completed.</span>

<span class="sd">    Example:</span>
<span class="sd">        The context manager handles start/stop timing. Upload must be called AFTER</span>
<span class="sd">        the context manager exits::</span>

<span class="sd">            &gt;&gt;&gt; config = ExecutionConfiguration(</span>
<span class="sd">            ...     workflow=&quot;analysis&quot;,</span>
<span class="sd">            ...     description=&quot;Process samples&quot;,</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; with ml.create_execution(config) as execution:</span>
<span class="sd">            ...     bag = execution.download_dataset_bag(dataset_spec)</span>
<span class="sd">            ...     # Run analysis using bag.path</span>
<span class="sd">            ...     output_path = execution.asset_file_path(&quot;Model&quot;, &quot;model.pt&quot;)</span>
<span class="sd">            ...     # Write results to output_path</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; # IMPORTANT: Call upload AFTER exiting the context manager</span>
<span class="sd">            &gt;&gt;&gt; execution.upload_execution_outputs()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">configuration</span><span class="p">:</span> <span class="n">ExecutionConfiguration</span><span class="p">,</span>
        <span class="n">ml_object</span><span class="p">:</span> <span class="n">DerivaML</span><span class="p">,</span>
        <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reload</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes an Execution instance.</span>

<span class="sd">        Creates a new execution or reloads an existing one. Initializes the execution</span>
<span class="sd">        environment, downloads required datasets, and sets up asset tracking.</span>

<span class="sd">        Args:</span>
<span class="sd">            configuration: Settings and parameters for the execution.</span>
<span class="sd">            ml_object: DerivaML instance managing the execution.</span>
<span class="sd">            workflow: Optional Workflow object. If not specified, the workflow is taken from</span>
<span class="sd">                the ExecutionConfiguration object. Must be a Workflow object, not a RID.</span>
<span class="sd">            reload: Optional RID of existing execution to reload.</span>
<span class="sd">            dry_run: If True, don&#39;t create catalog records or upload results.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If initialization fails, configuration is invalid,</span>
<span class="sd">                or workflow is not a Workflow object.</span>

<span class="sd">        Example:</span>
<span class="sd">            Create an execution with a workflow::</span>

<span class="sd">                &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">                &gt;&gt;&gt; config = ExecutionConfiguration(</span>
<span class="sd">                ...     workflow=workflow,</span>
<span class="sd">                ...     description=&quot;Process data&quot;</span>
<span class="sd">                ... )</span>
<span class="sd">                &gt;&gt;&gt; execution = Execution(config, ml)</span>

<span class="sd">            Or pass workflow separately::</span>

<span class="sd">                &gt;&gt;&gt; workflow = ml.lookup_workflow_by_url(</span>
<span class="sd">                ...     &quot;https://github.com/org/repo/blob/abc123/analysis.py&quot;</span>
<span class="sd">                ... )</span>
<span class="sd">                &gt;&gt;&gt; config = ExecutionConfiguration(description=&quot;Run analysis&quot;)</span>
<span class="sd">                &gt;&gt;&gt; execution = Execution(config, ml, workflow=workflow)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">asset_paths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span> <span class="o">=</span> <span class="n">ml_object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">ml_object</span><span class="o">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">ml_object</span><span class="o">.</span><span class="n">_logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="p">:</span> <span class="n">ExecutionRecord</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Lazily created after RID is assigned</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetBag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">working_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">cache_dir</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="s2">&quot;DerivaML working_dir is not set. &quot;</span>
                <span class="s2">&quot;Ensure the DerivaML instance was initialized with a valid working_dir.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span> <span class="o">=</span> <span class="n">dry_run</span>

        <span class="c1"># Make sure we have a valid Workflow object.</span>
        <span class="k">if</span> <span class="n">workflow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Workflow must be specified either in configuration or as a parameter&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Workflow must be a Workflow object, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Use ml.lookup_workflow(rid) or ml.lookup_workflow_by_url(url) to get a Workflow object.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Validate workflow type and register in catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">workflow_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">workflow_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">add_workflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span> <span class="k">else</span> <span class="n">DRY_RUN_RID</span>
        <span class="p">)</span>

        <span class="c1"># Validate the datasets and assets to be valid.</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Dataset specified in execution configuration is not a dataset&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">assets</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Asset specified in execution configuration is not an asset table&quot;</span><span class="p">)</span>

        <span class="n">schema_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reload</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">reload</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">==</span> <span class="n">DRY_RUN_RID</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">DRY_RUN_RID</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">schema_path</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                        <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rid_path</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_SAVE_EXECUTION_RID&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># Put execution_rid into the provided file path so we can find it later.</span>
            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">rid_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">host_name</span><span class="p">,</span>
                        <span class="s2">&quot;catalog_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">catalog_id</span><span class="p">,</span>
                        <span class="s2">&quot;workflow_rid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span><span class="p">,</span>
                        <span class="s2">&quot;execution_rid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">f</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Create a directory for execution rid so we can recover the state in case of a crash.</span>
        <span class="n">execution_root</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">exec_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

        <span class="c1"># Create the ExecutionRecord to handle catalog state operations</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="o">=</span> <span class="n">ExecutionRecord</span><span class="p">(</span>
                <span class="n">execution_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">,</span>
                <span class="n">status</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">created</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="n">_ml_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="p">,</span>
                <span class="n">_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_execution</span><span class="p">(</span><span class="n">reload</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_runtime_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">runtime_env_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_file_path</span><span class="p">(</span>
            <span class="n">asset_name</span><span class="o">=</span><span class="s2">&quot;Execution_Metadata&quot;</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;environment_snapshot_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">,</span>
            <span class="n">asset_types</span><span class="o">=</span><span class="n">ExecMetadataType</span><span class="o">.</span><span class="n">runtime_env</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">runtime_env_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">get_execution_environment</span><span class="p">(),</span> <span class="n">fp</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_hydra_config_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload hydra assets to the catalog with Hydra_Config type.&quot;&quot;&quot;</span>
        <span class="n">hydra_runtime_output_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">hydra_runtime_output_dir</span>
        <span class="k">if</span> <span class="n">hydra_runtime_output_dir</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">hydra_runtime_output_dir</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">hydra_asset</span> <span class="ow">in</span> <span class="n">hydra_runtime_output_dir</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">hydra_asset</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                    <span class="k">continue</span>
                <span class="c1"># Register file for upload (side effect); result intentionally unused</span>
                <span class="c1"># Use Hydra_Config type for Hydra YAML configuration files</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">asset_file_path</span><span class="p">(</span>
                    <span class="n">asset_name</span><span class="o">=</span><span class="n">MLAsset</span><span class="o">.</span><span class="n">execution_metadata</span><span class="p">,</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="n">hydra_runtime_output_dir</span> <span class="o">/</span> <span class="n">hydra_asset</span><span class="p">,</span>
                    <span class="n">rename_file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;hydra-</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">hydra_asset</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">asset_types</span><span class="o">=</span><span class="n">ExecMetadataType</span><span class="o">.</span><span class="n">hydra_config</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reload</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the execution environment.</span>

<span class="sd">        Sets up the working directory, downloads required datasets and assets,</span>
<span class="sd">        and saves initial configuration metadata.</span>

<span class="sd">        Args:</span>
<span class="sd">            reload: Optional RID of a previously initialized execution to reload.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If initialization fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Materialize bdbag</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">initializing</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Materialize bag </span><span class="si">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">rid</span><span class="si">}</span><span class="s2">... &quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">download_dataset_bag</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>

        <span class="c1"># Update execution info</span>
        <span class="n">schema_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rids</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">reload</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">):</span>
            <span class="n">schema_path</span><span class="o">.</span><span class="n">Dataset_Execution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[{</span><span class="s2">&quot;Dataset&quot;</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;Execution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">}</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rids</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Download assets....</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="s2">&quot;Downloading assets ...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">asset_paths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">asset_spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">assets</span><span class="p">:</span>
            <span class="n">asset_rid</span> <span class="o">=</span> <span class="n">asset_spec</span><span class="o">.</span><span class="n">rid</span>
            <span class="n">use_cache</span> <span class="o">=</span> <span class="n">asset_spec</span><span class="o">.</span><span class="n">cache</span>
            <span class="n">asset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">asset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span>
            <span class="n">dest_dir</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">execution_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">working_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;downloaded-assets&quot;</span> <span class="o">/</span> <span class="n">asset_table</span>
            <span class="p">)</span>
            <span class="n">dest_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">asset_paths</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">asset_table</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_asset</span><span class="p">(</span>
                    <span class="n">asset_rid</span><span class="o">=</span><span class="n">asset_rid</span><span class="p">,</span>
                    <span class="n">dest_dir</span><span class="o">=</span><span class="n">dest_dir</span><span class="p">,</span>
                    <span class="n">update_catalog</span><span class="o">=</span><span class="ow">not</span> <span class="p">(</span><span class="n">reload</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">),</span>
                    <span class="n">use_cache</span><span class="o">=</span><span class="n">use_cache</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Save configuration details and upload (skip in dry_run mode)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">reload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="c1"># Save DerivaML configuration with Deriva_Config type</span>
            <span class="n">cfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_file_path</span><span class="p">(</span>
                <span class="n">asset_name</span><span class="o">=</span><span class="n">MLAsset</span><span class="o">.</span><span class="n">execution_metadata</span><span class="p">,</span>
                <span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;configuration.json&quot;</span><span class="p">,</span>
                <span class="n">asset_types</span><span class="o">=</span><span class="n">ExecMetadataType</span><span class="o">.</span><span class="n">deriva_config</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">cfile</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">),</span> <span class="n">config_file</span><span class="p">)</span>
            <span class="c1"># Only try to copy uv.lock if git_root is available (local workflow)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">git_root</span><span class="p">:</span>
                <span class="n">lock_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">git_root</span><span class="p">)</span> <span class="o">/</span> <span class="s2">&quot;uv.lock&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lock_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">lock_file</span> <span class="ow">and</span> <span class="n">lock_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asset_file_path</span><span class="p">(</span>
                    <span class="n">asset_name</span><span class="o">=</span><span class="n">MLAsset</span><span class="o">.</span><span class="n">execution_metadata</span><span class="p">,</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="n">lock_file</span><span class="p">,</span>
                    <span class="n">asset_types</span><span class="o">=</span><span class="n">ExecMetadataType</span><span class="o">.</span><span class="n">execution_config</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_upload_hydra_config_assets</span><span class="p">()</span>

            <span class="c1"># save runtime env</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_runtime_environment</span><span class="p">()</span>

            <span class="c1"># Now upload the files so we have the info in case the execution fails.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_execution_dirs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">pending</span><span class="p">,</span> <span class="s2">&quot;Initialize status finished.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Status</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current execution status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Status: The current status (Created, Running, Completed, Failed, etc.).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">status</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

    <span class="nd">@status</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Status</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the execution status.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: The new status value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">execution_record</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionRecord</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ExecutionRecord for catalog operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ExecutionRecord if not in dry_run mode, None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">working_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the working directory for the execution.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_root</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_execution_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the root directory for this execution&#39;s files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the execution-specific directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">execution_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_feature_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the root directory for feature files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the feature directory within the execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">feature_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_asset_root</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the root directory for asset files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path to the asset directory within the execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">asset_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">database_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivaMLDatabase</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a catalog-like interface for downloaded datasets.</span>

<span class="sd">        Returns a DerivaMLDatabase that implements the DerivaMLCatalog</span>
<span class="sd">        protocol, allowing the same code to work with both live catalogs</span>
<span class="sd">        and downloaded bags.</span>

<span class="sd">        This is useful for writing code that can operate on either a live</span>
<span class="sd">        catalog (via DerivaML) or on downloaded bags (via DerivaMLDatabase).</span>

<span class="sd">        Returns:</span>
<span class="sd">            DerivaMLDatabase wrapping the primary downloaded dataset&#39;s model,</span>
<span class="sd">            or None if no datasets have been downloaded.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; with ml.create_execution(config) as exe:</span>
<span class="sd">            ...     if exe.database_catalog:</span>
<span class="sd">            ...         db = exe.database_catalog</span>
<span class="sd">            ...         # Use same interface as DerivaML</span>
<span class="sd">            ...         dataset = db.lookup_dataset(&quot;4HM&quot;)</span>
<span class="sd">            ...         term = db.lookup_term(&quot;Diagnosis&quot;, &quot;cancer&quot;)</span>
<span class="sd">            ...     else:</span>
<span class="sd">            ...         # No datasets downloaded, use live catalog</span>
<span class="sd">            ...         pass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="c1"># Use the first dataset&#39;s model as the primary</span>
        <span class="k">return</span> <span class="n">DerivaMLDatabase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DerivaML&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the live catalog (DerivaML) instance for this execution.</span>

<span class="sd">        This provides access to the live catalog for operations that require</span>
<span class="sd">        catalog connectivity, such as looking up datasets or other read operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DerivaML: The live catalog instance.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; with ml.create_execution(config) as exe:</span>
<span class="sd">            ...     # Use live catalog for lookups</span>
<span class="sd">            ...     existing_dataset = exe.catalog.lookup_dataset(&quot;1-ABC&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_dataset_bag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetBag</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Downloads and materializes a dataset for use in the execution.</span>

<span class="sd">        Downloads the specified dataset as a BDBag and materializes it in the execution&#39;s</span>
<span class="sd">        working directory. The dataset version is determined by the DatasetSpec.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset: Specification of the dataset to download, including version and</span>
<span class="sd">                materialization options.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DatasetBag: Object containing:</span>
<span class="sd">                - path: Local filesystem path to downloaded dataset</span>
<span class="sd">                - rid: Dataset&#39;s Resource Identifier</span>
<span class="sd">                - minid: Dataset&#39;s Minimal Viable Identifier</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If download or materialization fails.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; spec = DatasetSpec(rid=&quot;1-abc123&quot;, version=&quot;1.2.0&quot;)</span>
<span class="sd">            &gt;&gt;&gt; bag = execution.download_dataset_bag(spec)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Downloaded to {bag.path}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">download_dataset_bag</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="nd">@validate_call</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the execution&#39;s status in the catalog.</span>

<span class="sd">        Records a new status and associated message in the catalog, allowing remote</span>
<span class="sd">        tracking of execution progress.</span>

<span class="sd">        Args:</span>
<span class="sd">            status: New status value (e.g., running, completed, failed).</span>
<span class="sd">            msg: Description of the status change or current state.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If status update fails.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; execution.update_status(Status.running, &quot;Processing sample 1 of 10&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Delegate to ExecutionRecord for catalog updates</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback for cases where ExecutionRecord isn&#39;t available</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                        <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="s2">&quot;Status_Detail&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execution_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marks the execution as started.</span>

<span class="sd">        Records the start time and updates the execution&#39;s status to &#39;running&#39;.</span>
<span class="sd">        This should be called before beginning the main execution work.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; execution.execution_start()</span>
<span class="sd">            &gt;&gt;&gt; try:</span>
<span class="sd">            ...     # Run analysis</span>
<span class="sd">            ...     execution.execution_stop()</span>
<span class="sd">            ... except Exception:</span>
<span class="sd">            ...     execution.update_status(Status.failed, &quot;Analysis error&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">initializing</span><span class="p">,</span> <span class="s2">&quot;Start execution  ...&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execution_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Marks the execution as completed.</span>

<span class="sd">        Records the stop time and updates the execution&#39;s status to &#39;completed&#39;.</span>
<span class="sd">        This should be called after all execution work is finished.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; try:</span>
<span class="sd">            ...     # Run analysis</span>
<span class="sd">            ...     execution.execution_stop()</span>
<span class="sd">            ... except Exception:</span>
<span class="sd">            ...     execution.update_status(Status.failed, &quot;Analysis error&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="n">hours</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">duration</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">H </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">min </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">sec&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">completed</span><span class="p">,</span> <span class="s2">&quot;Algorithm execution ended.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">[{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">}]</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_upload_execution_dirs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">UploadProgress</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload execution assets at _working_dir/Execution_asset.</span>

<span class="sd">        This routine uploads the contents of the</span>
<span class="sd">        Execution_Asset directory and then updates the execution_asset table in the ML schema to have references</span>
<span class="sd">        to these newly uploaded files.</span>

<span class="sd">        Args:</span>
<span class="sd">            progress_callback: Optional callback function to receive upload progress updates.</span>
<span class="sd">                Called with UploadProgress objects containing file information and progress.</span>
<span class="sd">            max_retries: Maximum number of retry attempts for failed uploads (default: 3).</span>
<span class="sd">            retry_delay: Initial delay in seconds between retries, doubles with each attempt (default: 5.0).</span>
<span class="sd">            timeout: Tuple of (connect_timeout, read_timeout) in seconds. Default is (600, 600).</span>
<span class="sd">                Note: urllib3 uses connect_timeout as the socket timeout during request body</span>
<span class="sd">                writes, so it must be large enough for a full chunk upload.</span>
<span class="sd">            chunk_size: Optional chunk size in bytes for hatrac uploads. If provided,</span>
<span class="sd">                large files will be uploaded in chunks of this size.</span>

<span class="sd">        Returns:</span>
<span class="sd">          dict: Results of the upload operation.</span>

<span class="sd">        Raises:</span>
<span class="sd">          DerivaMLException: If there is an issue when uploading the assets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="s2">&quot;Uploading execution files...&quot;</span><span class="p">)</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">upload_directory</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_asset_root</span><span class="p">,</span>
                <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
                <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
                <span class="n">retry_delay</span><span class="o">=</span><span class="n">retry_delay</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="n">DerivaMLException</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">format_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to upload execution_assets: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">asset_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">asset_table</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">normalize_asset_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

            <span class="n">asset_map</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">asset_table</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AssetFilePath</span><span class="p">(</span>
                    <span class="n">asset_path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span>
                    <span class="n">asset_table</span><span class="o">=</span><span class="n">asset_table</span><span class="p">,</span>
                    <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">,</span>
                    <span class="n">asset_metadata</span><span class="o">=</span><span class="p">{</span>
                        <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">status</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">asset_metadata</span><span class="p">(</span><span class="n">asset_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">},</span>
                    <span class="n">asset_types</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">asset_rid</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_asset_execution_table</span><span class="p">(</span><span class="n">asset_map</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="s2">&quot;Updating features...&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_feature_root</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*.jsonl&quot;</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">is_feature_dir</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_feature_table</span><span class="p">(</span>
                <span class="n">target_table</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;target_table&quot;</span><span class="p">],</span>
                <span class="n">feature_name</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;feature_name&quot;</span><span class="p">],</span>
                <span class="n">feature_file</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
                <span class="n">uploaded_files</span><span class="o">=</span><span class="n">asset_map</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="s2">&quot;Upload assets complete&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">asset_map</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">download_asset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">asset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">update_catalog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetFilePath</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download an asset from a URL and place it in a local directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            asset_rid: RID of the asset.</span>
<span class="sd">            dest_dir: Destination directory for the asset.</span>
<span class="sd">            update_catalog: Whether to update the catalog execution information after downloading.</span>
<span class="sd">            use_cache: If True, check the cache directory for a previously downloaded copy</span>
<span class="sd">                with a matching MD5 checksum before downloading. Cached copies are stored</span>
<span class="sd">                in ``cache_dir/assets/{rid}_{md5}/`` and symlinked into the destination.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An AssetFilePath with the path to the downloaded (or cached) asset file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">asset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">asset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">asset_table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID </span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2">  is not for an asset table.&quot;</span><span class="p">)</span>

        <span class="n">asset_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">retrieve_rid</span><span class="p">(</span><span class="n">asset_rid</span><span class="p">)</span>
        <span class="n">asset_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">asset_record</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">asset_metadata</span><span class="p">(</span><span class="n">asset_table</span><span class="p">)}</span>
        <span class="n">asset_url</span> <span class="o">=</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;URL&quot;</span><span class="p">]</span>
        <span class="n">asset_filename</span> <span class="o">=</span> <span class="n">dest_dir</span> <span class="o">/</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span>

        <span class="c1"># Check cache before downloading</span>
        <span class="n">cache_hit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
            <span class="n">md5</span> <span class="o">=</span> <span class="n">asset_record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MD5&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">md5</span><span class="p">:</span>
                <span class="n">asset_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="s2">&quot;assets&quot;</span>
                <span class="n">asset_cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">cached_file</span> <span class="o">=</span> <span class="n">asset_cache_dir</span> <span class="o">/</span> <span class="n">cache_key</span> <span class="o">/</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cached_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="c1"># Cache hit  symlink from cache to destination</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using cached asset </span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2"> (MD5: </span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">asset_filename</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">asset_filename</span><span class="o">.</span><span class="n">is_symlink</span><span class="p">():</span>
                        <span class="n">asset_filename</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                    <span class="n">asset_filename</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">cached_file</span><span class="p">)</span>
                    <span class="n">cache_hit</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_hit</span><span class="p">:</span>
            <span class="n">hs</span> <span class="o">=</span> <span class="n">HatracStore</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">host_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">credential</span><span class="p">)</span>
            <span class="n">hs</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">asset_url</span><span class="p">,</span> <span class="n">destfilename</span><span class="o">=</span><span class="n">asset_filename</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>

            <span class="c1"># Store in cache for future use</span>
            <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
                <span class="n">md5</span> <span class="o">=</span> <span class="n">asset_record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MD5&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">md5</span><span class="p">:</span>
                    <span class="n">asset_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="s2">&quot;assets&quot;</span>
                    <span class="n">asset_cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="n">cache_entry_dir</span> <span class="o">=</span> <span class="n">asset_cache_dir</span> <span class="o">/</span> <span class="n">cache_key</span>
                    <span class="n">cache_entry_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">cached_file</span> <span class="o">=</span> <span class="n">cache_entry_dir</span> <span class="o">/</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span>
                    <span class="c1"># Move file to cache, then symlink back</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">asset_filename</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">cached_file</span><span class="p">))</span>
                    <span class="n">asset_filename</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">cached_file</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cached asset </span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2"> (MD5: </span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

        <span class="n">asset_type_table</span><span class="p">,</span> <span class="n">_col_l</span><span class="p">,</span> <span class="n">_col_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">find_association</span><span class="p">(</span><span class="n">asset_table</span><span class="p">,</span> <span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_type</span><span class="p">)</span>
        <span class="n">type_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">asset_type_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">asset_type_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">asset_types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asset_type</span><span class="p">[</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_type</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">asset_type</span> <span class="ow">in</span> <span class="n">type_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">type_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">asset_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="n">asset_rid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">type_path</span><span class="o">.</span><span class="n">Asset_Type</span><span class="p">)</span>
            <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">]</span>

        <span class="n">asset_path</span> <span class="o">=</span> <span class="n">AssetFilePath</span><span class="p">(</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">asset_filename</span><span class="p">,</span>
            <span class="n">asset_rid</span><span class="o">=</span><span class="n">asset_rid</span><span class="p">,</span>
            <span class="n">asset_path</span><span class="o">=</span><span class="n">asset_filename</span><span class="p">,</span>
            <span class="n">asset_metadata</span><span class="o">=</span><span class="n">asset_metadata</span><span class="p">,</span>
            <span class="n">asset_table</span><span class="o">=</span><span class="n">asset_table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">asset_types</span><span class="o">=</span><span class="n">asset_types</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">update_catalog</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_asset_execution_table</span><span class="p">(</span>
                <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">asset_path</span><span class="p">]},</span>
                <span class="n">asset_role</span><span class="o">=</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">asset_path</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">upload_assets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">assets_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">FileUploadState</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uploads assets from a directory to the catalog.</span>

<span class="sd">        Scans the specified directory for assets and uploads them to the catalog,</span>
<span class="sd">        recording their metadata and types. Assets are organized by their types</span>
<span class="sd">        and associated with the execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            assets_dir: Directory containing assets to upload.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[Any, FileUploadState] | None: Mapping of assets to their upload states,</span>
<span class="sd">                or None if no assets were found.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If upload fails or assets are invalid.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; states = execution.upload_assets(&quot;output/results&quot;)</span>
<span class="sd">            &gt;&gt;&gt; for asset, state in states.items():</span>
<span class="sd">            ...     print(f&quot;{asset}: {state}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">path_to_asset</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Pull the asset name out of a path to that asset in the filesystem&quot;&quot;&quot;</span>
            <span class="n">components</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">components</span><span class="p">[</span><span class="n">components</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;asset&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Look for asset in the path to find the name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">assets_dir</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Directory does not have name of an asset table.&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">upload_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">assets_dir</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">path_to_asset</span><span class="p">(</span><span class="n">p</span><span class="p">):</span> <span class="n">r</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">upload_execution_outputs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">clean_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">UploadProgress</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uploads all outputs from the execution to the catalog.</span>

<span class="sd">        Scans the execution&#39;s output directories for assets, features, and other results,</span>
<span class="sd">        then uploads them to the catalog. Can optionally clean up the output folders</span>
<span class="sd">        after successful upload.</span>

<span class="sd">        IMPORTANT: This method must be called AFTER exiting the context manager, not inside it.</span>
<span class="sd">        The context manager handles execution timing (start/stop), while this method handles</span>
<span class="sd">        the separate upload step.</span>

<span class="sd">        Args:</span>
<span class="sd">            clean_folder: Whether to delete output folders after upload. If None (default),</span>
<span class="sd">                uses the DerivaML instance&#39;s clean_execution_dir setting. Pass True/False</span>
<span class="sd">                to override for this specific execution.</span>
<span class="sd">            progress_callback: Optional callback function to receive upload progress updates.</span>
<span class="sd">                Called with UploadProgress objects containing file name, bytes uploaded,</span>
<span class="sd">                total bytes, percent complete, phase, and status message.</span>
<span class="sd">            max_retries: Maximum number of retry attempts for failed uploads (default: 3).</span>
<span class="sd">            retry_delay: Initial delay in seconds between retries, doubles with each attempt (default: 5.0).</span>
<span class="sd">            timeout: Tuple of (connect_timeout, read_timeout) in seconds. Default is (600, 600).</span>
<span class="sd">                Note: urllib3 uses connect_timeout as the socket timeout during request body</span>
<span class="sd">                writes, so it must be large enough for a full chunk upload.</span>
<span class="sd">            chunk_size: Optional chunk size in bytes for hatrac uploads. If provided,</span>
<span class="sd">                large files will be uploaded in chunks of this size.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[AssetFilePath]]: Mapping of asset types to their file paths.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If upload fails or outputs are invalid.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; with ml.create_execution(config) as execution:</span>
<span class="sd">            ...     # Do ML work, register output files with asset_file_path()</span>
<span class="sd">            ...     path = execution.asset_file_path(&quot;Model&quot;, &quot;model.pt&quot;)</span>
<span class="sd">            ...     # Write to path...</span>
<span class="sd">            ...</span>
<span class="sd">            &gt;&gt;&gt; # Upload AFTER the context manager exits</span>
<span class="sd">            &gt;&gt;&gt; def my_callback(progress):</span>
<span class="sd">            ...     print(f&quot;Uploading {progress.file_name}: {progress.percent_complete:.1f}%&quot;)</span>
<span class="sd">            &gt;&gt;&gt; outputs = execution.upload_execution_outputs(progress_callback=my_callback)</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Upload large files with increased timeout (30 min per chunk)</span>
<span class="sd">            &gt;&gt;&gt; outputs = execution.upload_execution_outputs(timeout=(6, 1800))</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            &gt;&gt;&gt; # Override cleanup setting for this execution</span>
<span class="sd">            &gt;&gt;&gt; outputs = execution.upload_execution_outputs(clean_folder=False)  # Keep files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Use DerivaML instance setting if not explicitly provided</span>
        <span class="k">if</span> <span class="n">clean_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">clean_folder</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="p">,</span> <span class="s1">&#39;clean_execution_dir&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_execution_dirs</span><span class="p">(</span>
                <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
                <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
                <span class="n">retry_delay</span><span class="o">=</span><span class="n">retry_delay</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">completed</span><span class="p">,</span> <span class="s2">&quot;Successfully end the execution.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">clean_folder</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clean_folder_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execution_root</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">format_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_clean_folder_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">remove_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clean up folder contents and optionally the folder itself.</span>

<span class="sd">        Removes all files and subdirectories within the specified folder.</span>
<span class="sd">        Uses retry logic for Windows compatibility where files may be temporarily locked.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_path: Path to the folder to clean.</span>
<span class="sd">            remove_folder: If True (default), also remove the folder itself after</span>
<span class="sd">                cleaning its contents. If False, only remove contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MAX_RETRIES</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">RETRY_DELAY</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># seconds</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">remove_with_retry</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">is_dir</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_dir</span><span class="p">:</span>
                        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to remove </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">RETRY_DELAY</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># First remove all contents</span>
            <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">entries</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_symlink</span><span class="p">():</span>
                        <span class="n">remove_with_retry</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">is_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">remove_with_retry</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>

            <span class="c1"># Then remove the folder itself if requested</span>
            <span class="k">if</span> <span class="n">remove_folder</span><span class="p">:</span>
                <span class="n">remove_with_retry</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">is_dir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to clean folder </span><span class="si">{</span><span class="n">folder_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_feature_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">target_table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">feature_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">uploaded_files</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the feature table with values from a JSONL file.</span>

<span class="sd">        Reads feature values from a file and inserts them into the catalog,</span>
<span class="sd">        replacing file paths with the RIDs of uploaded assets.</span>

<span class="sd">        Args:</span>
<span class="sd">            target_table: Name of the table the feature is defined on.</span>
<span class="sd">            feature_name: Name of the feature to update.</span>
<span class="sd">            feature_file: Path to JSONL file containing feature values.</span>
<span class="sd">            uploaded_files: Map from asset table names to their uploaded AssetFilePath objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get the column names of all the Feature columns that should be the RID of an asset</span>
        <span class="n">asset_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">feature_record_class</span><span class="p">(</span><span class="n">target_table</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">asset_columns</span>
        <span class="p">]</span>

        <span class="c1"># Get the names of the columns in the feature that are assets.</span>
        <span class="n">asset_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">feature_record_class</span><span class="p">(</span><span class="n">target_table</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">asset_columns</span>
        <span class="p">]</span>

        <span class="n">feature_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">feature_record_class</span><span class="p">(</span><span class="n">target_table</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_table</span><span class="o">.</span><span class="n">name</span>
        <span class="n">asset_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">asset_table</span><span class="p">,</span> <span class="n">asset</span><span class="o">.</span><span class="n">file_name</span><span class="p">):</span> <span class="n">asset</span><span class="o">.</span><span class="n">asset_rid</span>
            <span class="k">for</span> <span class="n">asset_table</span><span class="p">,</span> <span class="n">assets</span> <span class="ow">in</span> <span class="n">uploaded_files</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span>
        <span class="p">}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">map_path</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Go through the asset columns and replace the file name with the RID for the uploaded file.&quot;&quot;&quot;</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">asset_columns</span><span class="p">:</span>
                <span class="n">e</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">asset_map</span><span class="p">[</span><span class="n">normalize_asset_dir</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">c</span><span class="p">])]</span>
            <span class="k">return</span> <span class="n">e</span>

        <span class="c1"># Load the JSON file that has the set of records that contain the feature values.</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">feature_file</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">feature_values</span><span class="p">:</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="p">[</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">feature_values</span><span class="p">]</span>
        <span class="c1"># Update the asset columns in the feature and add to the catalog.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">domain_path</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">feature_table</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">([</span><span class="n">map_path</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">],</span> <span class="n">on_conflict_skip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_asset_execution_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">uploaded_assets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]],</span>
        <span class="n">asset_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Output&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add entry to the association table connecting an asset to an execution RID</span>

<span class="sd">        Args:</span>
<span class="sd">            uploaded_assets: Dictionary whose key is the name of an asset table and whose value is a list of RIDs for</span>
<span class="sd">                newly added assets to that table.</span>
<span class="sd">             asset_role: A term or list of terms from the Asset_Role vocabulary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure the asset role is in the controlled vocabulary table.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="c1"># Don&#39;t do any updates of we are doing a dry run.</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_role</span><span class="p">,</span> <span class="n">asset_role</span><span class="p">)</span>

        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">asset_table</span><span class="p">,</span> <span class="n">asset_list</span> <span class="ow">in</span> <span class="n">uploaded_assets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">asset_table_name</span> <span class="o">=</span> <span class="n">asset_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Peel off the schema from the asset table</span>
            <span class="n">asset_exe</span><span class="p">,</span> <span class="n">asset_fk</span><span class="p">,</span> <span class="n">execution_fk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">find_association</span><span class="p">(</span><span class="n">asset_table_name</span><span class="p">,</span> <span class="s2">&quot;Execution&quot;</span><span class="p">)</span>
            <span class="n">asset_exe_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">asset_exe</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">asset_exe</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

            <span class="n">asset_exe_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="n">asset_fk</span><span class="p">:</span> <span class="n">asset_path</span><span class="o">.</span><span class="n">asset_rid</span><span class="p">,</span>
                        <span class="n">execution_fk</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                        <span class="s2">&quot;Asset_Role&quot;</span><span class="p">:</span> <span class="n">asset_role</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">asset_path</span> <span class="ow">in</span> <span class="n">asset_list</span>
                <span class="p">],</span>
                <span class="n">on_conflict_skip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Now add in the type names via the asset_asset_type association table.</span>
            <span class="c1"># Get the list of types for each file in the asset.</span>
            <span class="k">if</span> <span class="n">asset_role</span> <span class="o">==</span> <span class="s2">&quot;Input&quot;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">asset_type_map</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">with</span> <span class="n">Path</span><span class="p">(</span>
                <span class="n">asset_type_path</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">asset_table_name</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">asset_type_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">asset_type_file</span><span class="p">:</span>
                    <span class="n">asset_type_map</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">asset_path</span> <span class="ow">in</span> <span class="n">asset_list</span><span class="p">:</span>
                <span class="n">asset_path</span><span class="o">.</span><span class="n">asset_types</span> <span class="o">=</span> <span class="n">asset_type_map</span><span class="p">[</span><span class="n">asset_path</span><span class="o">.</span><span class="n">file_name</span><span class="p">]</span>

            <span class="n">asset_asset_type</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">find_association</span><span class="p">(</span><span class="n">asset_table_name</span><span class="p">,</span> <span class="s2">&quot;Asset_Type&quot;</span><span class="p">)</span>
            <span class="n">type_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">asset_asset_type</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">asset_asset_type</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

            <span class="n">type_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span><span class="n">asset_table_name</span><span class="p">:</span> <span class="n">asset</span><span class="o">.</span><span class="n">asset_rid</span><span class="p">,</span> <span class="s2">&quot;Asset_Type&quot;</span><span class="p">:</span> <span class="n">t</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">asset_list</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">asset_type_map</span><span class="p">[</span><span class="n">asset</span><span class="o">.</span><span class="n">file_name</span><span class="p">]</span>
                <span class="p">],</span>
                <span class="n">on_conflict_skip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">asset_file_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">asset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">asset_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">copy_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">rename_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetFilePath</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a pathlib Path to the directory in which to place files for the specified execution_asset type.</span>

<span class="sd">        Given the name of an asset table, and a file name, register the file for upload and return a path to that</span>
<span class="sd">        file in the upload directory.  In addition to the filename, additional asset metadata and file asset types may</span>
<span class="sd">        be specified.</span>

<span class="sd">        This routine has three modes, depending on if file_name refers to an existing file.  If it doesn&#39;t, a path</span>
<span class="sd">        to a new file with the specified name is returned.  The caller can then open that file for writing.</span>

<span class="sd">        If the provided filename refers to an existing file and the copy_file argument is False (the default), then the</span>
<span class="sd">        returned path contains a symbolic link to that file.  If the copy_file argument is True, then the contents of</span>
<span class="sd">        file_name are copied into the target directory.</span>

<span class="sd">        Args:</span>
<span class="sd">            asset_name: Type of asset to be uploaded.  Must be a term in Asset_Type controlled vocabulary.</span>
<span class="sd">            file_name: Name of file to be uploaded.</span>
<span class="sd">            asset_types: Type of asset to be uploaded.  Defaults to the name of the asset.</span>
<span class="sd">            copy_file: Whether to copy the file rather than creating a symbolic link.</span>
<span class="sd">            rename_file: If provided, the file will be renamed to this name if the file already exists..</span>
<span class="sd">            **kwargs: Any additional metadata values that may be part of the asset table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path in which to place asset files.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaException: If the asset type is not defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">asset_name</span><span class="p">):</span>
            <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> is not an asset&quot;</span><span class="p">)</span>

        <span class="n">asset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">asset_name</span><span class="p">)</span>

        <span class="n">asset_types</span> <span class="o">=</span> <span class="n">asset_types</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Asset_Type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">asset_name</span>
        <span class="n">asset_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset_types</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">asset_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">asset_types</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">asset_types</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_type</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

        <span class="c1"># Determine if we will need to rename an existing file as the asset.</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;_implementations.log&quot;</span><span class="p">:</span>
            <span class="c1"># There is a funny bug with S3 hatrac if we have the leading _ in the filename.</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;-implementations.log&quot;</span><span class="p">)</span>

        <span class="c1"># Resolve relative paths to absolute paths to ensure exists() and symlink work correctly</span>
        <span class="c1"># regardless of the current working directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="n">target_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rename_file</span><span class="p">)</span> <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">rename_file</span> <span class="k">else</span> <span class="n">file_name</span>
        <span class="n">asset_path</span> <span class="o">=</span> <span class="n">asset_file_path</span><span class="p">(</span>
            <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span>
            <span class="n">exec_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
            <span class="n">asset_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">asset_name</span><span class="p">),</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">target_name</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">copy_file</span><span class="p">:</span>
                <span class="n">asset_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">asset_path</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
                    <span class="c1"># Fallback to copy if symlink fails (common on Windows)</span>
                    <span class="n">asset_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>

        <span class="c1"># Persist the asset types into a file</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">asset_type_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span> <span class="n">asset_table</span><span class="p">))</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">asset_type_file</span><span class="p">:</span>
            <span class="n">asset_type_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="n">target_name</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">asset_types</span><span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">AssetFilePath</span><span class="p">(</span>
            <span class="n">asset_path</span><span class="o">=</span><span class="n">asset_path</span><span class="p">,</span>
            <span class="n">asset_table</span><span class="o">=</span><span class="n">asset_name</span><span class="p">,</span>
            <span class="n">file_name</span><span class="o">=</span><span class="n">target_name</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">asset_metadata</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="n">asset_types</span><span class="o">=</span><span class="n">asset_types</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">table_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a local file path to a CSV to add values to a table on upload.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Name of table to be uploaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Pathlib path to the file in which to place table values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find which domain schema contains this table</span>
        <span class="n">table_schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">domain_schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">domain_schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">domain_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                    <span class="n">table_schema</span> <span class="o">=</span> <span class="n">domain_schema</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">table_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Table &#39;</span><span class="si">{}</span><span class="s2">&#39; not found in any domain schema&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">table_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">table_schema</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Execution</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initiate an execution with the provided configuration. Can be used in a context manager.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@validate_call</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FeatureRecord</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds feature records to the catalog.</span>

<span class="sd">        Associates feature records with this execution and uploads them to the catalog.</span>
<span class="sd">        Features represent measurable properties or characteristics of records.</span>

<span class="sd">        NOTE: The catalog is not updated until upload_execution_outputs() is called.</span>

<span class="sd">        Args:</span>
<span class="sd">            features: Feature records to add, each containing a value and metadata.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If feature addition fails or features are invalid.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; feature = FeatureRecord(value=&quot;high&quot;, confidence=0.95)</span>
<span class="sd">            &gt;&gt;&gt; execution.add_features([feature])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure feature list is homogeneous:</span>
        <span class="n">sorted_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">sorted_features</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">sorted_features</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_features</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FeatureRecord</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Update feature records to include current execution_rid</span>
        <span class="n">first_row</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="n">first_row</span><span class="o">.</span><span class="n">feature</span>
        <span class="c1"># Use the schema from the feature table</span>
        <span class="n">feature_schema</span> <span class="o">=</span> <span class="n">feature</span><span class="o">.</span><span class="n">feature_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span>
        <span class="n">json_path</span> <span class="o">=</span> <span class="n">feature_value_path</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span>
            <span class="n">schema</span><span class="o">=</span><span class="n">feature_schema</span><span class="p">,</span>
            <span class="n">target_table</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">target_table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">feature_name</span><span class="o">=</span><span class="n">feature</span><span class="o">.</span><span class="n">feature_name</span><span class="p">,</span>
            <span class="n">exec_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">json_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">feature</span><span class="o">.</span><span class="n">Execution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_input_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all datasets that were inputs to this execution.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Dataset objects that were used as inputs.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; for ds in execution.list_input_datasets():</span>
<span class="sd">            ...     print(f&quot;Input: {ds.dataset_rid} - {ds.description}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_input_datasets</span><span class="p">()</span>

        <span class="c1"># Fallback for dry_run mode</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">dataset_exec</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Execution</span>

        <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">dataset_exec</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dataset_exec</span><span class="o">.</span><span class="n">Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
            <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Asset&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all assets that were inputs or outputs of this execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            asset_role: Optional filter: &quot;Input&quot; or &quot;Output&quot;. If None, returns all.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of Asset objects associated with this execution.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; inputs = execution.list_assets(asset_role=&quot;Input&quot;)</span>
<span class="sd">            &gt;&gt;&gt; outputs = execution.list_assets(asset_role=&quot;Output&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_assets</span><span class="p">(</span><span class="n">asset_role</span><span class="o">=</span><span class="n">asset_role</span><span class="p">)</span>

        <span class="c1"># Fallback for dry_run mode</span>

        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">asset_exec</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Asset_Execution</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">asset_exec</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">asset_exec</span><span class="o">.</span><span class="n">Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">asset_role</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">asset_exec</span><span class="o">.</span><span class="n">Asset_Role</span> <span class="o">==</span> <span class="n">asset_role</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>

        <span class="n">assets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">asset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_asset</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;Execution_Asset&quot;</span><span class="p">])</span>
                <span class="n">assets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># Skip assets that can&#39;t be looked up</span>
        <span class="k">return</span> <span class="n">assets</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new dataset with specified types.</span>

<span class="sd">        Creates a dataset associated with this execution for provenance tracking.</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_types: One or more dataset type terms from Dataset_Type vocabulary.</span>
<span class="sd">            description: Markdown description of the dataset being created.</span>
<span class="sd">            version: Dataset version. Defaults to 0.1.0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The newly created Dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
            <span class="n">ml_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="p">,</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
            <span class="n">dataset_types</span><span class="o">=</span><span class="n">dataset_types</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_files</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">files</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FileSpec</span><span class="p">],</span>
        <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds files to the catalog with their metadata.</span>

<span class="sd">        Registers files in the catalog along with their metadata (MD5, length, URL) and associates them with</span>
<span class="sd">        specified file types.</span>

<span class="sd">        Args:</span>
<span class="sd">            files: File specifications containing MD5 checksum, length, and URL.</span>
<span class="sd">            dataset_types: One or more dataset type terms from File_Type vocabulary.</span>
<span class="sd">            description: Description of the files.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RID: Dataset  that identifies newly added files. Will be nested to mirror original directory structure</span>
<span class="sd">            of the files.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLInvalidTerm: If file_types are invalid or execution_rid is not an execution record.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Add a single file type:</span>
<span class="sd">                &gt;&gt;&gt; files = [FileSpec(url=&quot;path/to/file.txt&quot;, md5=&quot;abc123&quot;, length=1000)]</span>
<span class="sd">                &gt;&gt;&gt; rids = exe.add_files(files, file_types=&quot;text&quot;)</span>

<span class="sd">            Add multiple file types:</span>
<span class="sd">                &gt;&gt;&gt; rids = exe.add_files(</span>
<span class="sd">                ...     files=[FileSpec(url=&quot;image.png&quot;, md5=&quot;def456&quot;, length=2000)],</span>
<span class="sd">                ...     file_types=[&quot;image&quot;, &quot;png&quot;],</span>
<span class="sd">                ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span>
            <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
            <span class="n">dataset_types</span><span class="o">=</span><span class="n">dataset_types</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># =========================================================================</span>
    <span class="c1"># Execution Nesting Methods</span>
    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_nested_execution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nested_execution</span><span class="p">:</span> <span class="s2">&quot;Execution | ExecutionRecord | RID&quot;</span><span class="p">,</span>
        <span class="n">sequence</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a nested (child) execution to this execution.</span>

<span class="sd">        Creates a parent-child relationship between this execution and another.</span>
<span class="sd">        This is useful for grouping related executions, such as parameter sweeps</span>
<span class="sd">        or pipeline stages.</span>

<span class="sd">        Args:</span>
<span class="sd">            nested_execution: The child execution to add (Execution, ExecutionRecord, or RID).</span>
<span class="sd">            sequence: Optional ordering index (0, 1, 2...). Use None for parallel executions.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If the association cannot be created.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; parent_exec = ml.create_execution(parent_config)</span>
<span class="sd">            &gt;&gt;&gt; child_exec = ml.create_execution(child_config)</span>
<span class="sd">            &gt;&gt;&gt; parent_exec.add_nested_execution(child_exec, sequence=0)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Get the RID from the nested execution</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested_execution</span><span class="p">,</span> <span class="n">Execution</span><span class="p">):</span>
            <span class="n">nested_rid</span> <span class="o">=</span> <span class="n">nested_execution</span><span class="o">.</span><span class="n">execution_rid</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested_execution</span><span class="p">,</span> <span class="n">ExecutionRecord</span><span class="p">):</span>
            <span class="n">nested_rid</span> <span class="o">=</span> <span class="n">nested_execution</span><span class="o">.</span><span class="n">execution_rid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nested_rid</span> <span class="o">=</span> <span class="n">nested_execution</span>

        <span class="c1"># Delegate to ExecutionRecord if available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">add_nested_execution</span><span class="p">(</span><span class="n">nested_rid</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback for cases without execution record</span>
            <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
            <span class="n">execution_execution</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Execution</span>

            <span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Execution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                <span class="s2">&quot;Nested_Execution&quot;</span><span class="p">:</span> <span class="n">nested_rid</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">record</span><span class="p">[</span><span class="s2">&quot;Sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span>

            <span class="n">execution_execution</span><span class="o">.</span><span class="n">insert</span><span class="p">([</span><span class="n">record</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_nested_executions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ExecutionRecord&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all nested (child) executions of this execution.</span>

<span class="sd">        Args:</span>
<span class="sd">            recurse: If True, recursively return all descendant executions.</span>
<span class="sd">            _visited: Internal parameter to track visited executions and prevent infinite recursion.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of nested ExecutionRecord objects, ordered by sequence if available.</span>
<span class="sd">            To get full Execution objects with lifecycle management, use restore_execution().</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; children = parent_exec.list_nested_executions()</span>
<span class="sd">            &gt;&gt;&gt; all_descendants = parent_exec.list_nested_executions(recurse=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_nested_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

        <span class="c1"># Fallback for dry_run mode</span>
        <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">execution_execution</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Execution</span>

        <span class="c1"># Query for nested executions, ordered by sequence</span>
        <span class="n">nested</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">execution_execution</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">execution_execution</span><span class="o">.</span><span class="n">Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
            <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Sort by sequence (None values at the end)</span>
        <span class="n">nested</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sequence&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sequence&quot;</span><span class="p">)))</span>

        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">nested</span><span class="p">:</span>
            <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_execution</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;Nested_Execution&quot;</span><span class="p">])</span>
            <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">list_nested_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">children</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_parent_executions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ExecutionRecord&quot;</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all parent executions that contain this execution as a nested child.</span>

<span class="sd">        Args:</span>
<span class="sd">            recurse: If True, recursively return all ancestor executions.</span>
<span class="sd">            _visited: Internal parameter to track visited executions and prevent infinite recursion.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of parent ExecutionRecord objects.</span>
<span class="sd">            To get full Execution objects with lifecycle management, use restore_execution().</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; parents = child_exec.list_parent_executions()</span>
<span class="sd">            &gt;&gt;&gt; all_ancestors = child_exec.list_parent_executions(recurse=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_parent_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

        <span class="c1"># Fallback for dry_run mode</span>
        <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">execution_execution</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Execution</span>

        <span class="n">parent_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">execution_execution</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">execution_execution</span><span class="o">.</span><span class="n">Nested_Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
            <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
            <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">parents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">parent_records</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_execution</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">])</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="n">parents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">list_parent_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">parents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this execution is nested within another execution.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this execution has at least one parent execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">is_nested</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_parent_executions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this execution has nested child executions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if this execution has at least one nested execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">is_parent</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_nested_executions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">&quot;caching_dir: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;_working_dir: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;execution_rid: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;workflow_rid: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;asset_paths: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">asset_paths</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;configuration: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method invoked when entering the context.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - self: The instance itself.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_start</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method invoked when exiting the context.</span>

<span class="sd">        Args:</span>
<span class="sd">           exc_type: Exception type.</span>
<span class="sd">           exc_value: Exception value.</span>
<span class="sd">           exc_tb: Exception traceback.</span>

<span class="sd">        Returns:</span>
<span class="sd">           bool: True if execution completed successfully, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exc_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="s2">&quot;Successfully run Ml.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">execution_stop</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span>
                <span class="n">Status</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Exception type: </span><span class="si">{</span><span class="n">exc_type</span><span class="si">}</span><span class="s2">, Exception value: </span><span class="si">{</span><span class="n">exc_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception type: </span><span class="si">{</span><span class="n">exc_type</span><span class="si">}</span><span class="s2">, Exception value: </span><span class="si">{</span><span class="n">exc_value</span><span class="si">}</span><span class="s2">, Exception traceback: </span><span class="si">{</span><span class="n">exc_tb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.execution.Execution.catalog" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">catalog</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">catalog</span><span class="p">:</span> <span class="s1">&#39;DerivaML&#39;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the live catalog (DerivaML) instance for this execution.</p>
<p>This provides access to the live catalog for operations that require
catalog connectivity, such as looking up datasets or other read operations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DerivaML</code></td>            <td>
                  <code>&#39;DerivaML&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The live catalog instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with ml.create_execution(config) as exe:
...     # Use live catalog for lookups
...     existing_dataset = exe.catalog.lookup_dataset("1-ABC")</p>
</blockquote>
</blockquote>
</blockquote>
</details>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.execution.Execution.database_catalog" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">database_catalog</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">database_catalog</span><span class="p">:</span> <span class="p">(</span>
    <span class="n">DerivaMLDatabase</span> <span class="o">|</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get a catalog-like interface for downloaded datasets.</p>
<p>Returns a DerivaMLDatabase that implements the DerivaMLCatalog
protocol, allowing the same code to work with both live catalogs
and downloaded bags.</p>
<p>This is useful for writing code that can operate on either a live
catalog (via DerivaML) or on downloaded bags (via DerivaMLDatabase).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.model.deriva_ml_database.DerivaMLDatabase">DerivaMLDatabase</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DerivaMLDatabase wrapping the primary downloaded dataset's model,</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.model.deriva_ml_database.DerivaMLDatabase">DerivaMLDatabase</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>or None if no datasets have been downloaded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with ml.create_execution(config) as exe:
...     if exe.database_catalog:
...         db = exe.database_catalog
...         # Use same interface as DerivaML
...         dataset = db.lookup_dataset("4HM")
...         term = db.lookup_term("Diagnosis", "cancer")
...     else:
...         # No datasets downloaded, use live catalog
...         pass</p>
</blockquote>
</blockquote>
</blockquote>
</details>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.execution.Execution.execution_record" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">execution_record</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">execution_record</span><span class="p">:</span> <span class="n">ExecutionRecord</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the ExecutionRecord for catalog operations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.execution.execution_record.ExecutionRecord">ExecutionRecord</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ExecutionRecord if not in dry_run mode, None otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.execution.Execution.status" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">status</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">status</span><span class="p">:</span> <span class="n">Status</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the current execution status.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Status</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Status (deriva_ml.core.definitions.Status)" href="../deriva_definitions/#deriva_ml.core.definitions.Status">Status</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current status (Created, Running, Completed, Failed, etc.).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.execution.Execution.working_dir" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">working_dir</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">working_dir</span><span class="p">:</span> <span class="n">Path</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the working directory for the execution.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.__enter__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__enter__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__enter__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Method invoked when entering the context.</p>
<p>Returns:
- self: The instance itself.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method invoked when entering the context.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - self: The instance itself.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_start</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.__exit__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__exit__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__exit__</span><span class="p">(</span>
    <span class="n">exc_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">exc_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">exc_tb</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Method invoked when exiting the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>exc_type</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception type.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exc_value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exc_tb</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exception traceback.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if execution completed successfully, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method invoked when exiting the context.</span>

<span class="sd">    Args:</span>
<span class="sd">       exc_type: Exception type.</span>
<span class="sd">       exc_value: Exception value.</span>
<span class="sd">       exc_tb: Exception traceback.</span>

<span class="sd">    Returns:</span>
<span class="sd">       bool: True if execution completed successfully, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exc_type</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="s2">&quot;Successfully run Ml.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span>
            <span class="n">Status</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Exception type: </span><span class="si">{</span><span class="n">exc_type</span><span class="si">}</span><span class="s2">, Exception value: </span><span class="si">{</span><span class="n">exc_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception type: </span><span class="si">{</span><span class="n">exc_type</span><span class="si">}</span><span class="s2">, Exception value: </span><span class="si">{</span><span class="n">exc_value</span><span class="si">}</span><span class="s2">, Exception traceback: </span><span class="si">{</span><span class="n">exc_tb</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">configuration</span><span class="p">:</span> <span class="n">ExecutionConfiguration</span><span class="p">,</span>
    <span class="n">ml_object</span><span class="p">:</span> <span class="n">DerivaML</span><span class="p">,</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reload</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initializes an Execution instance.</p>
<p>Creates a new execution or reloads an existing one. Initializes the execution
environment, downloads required datasets, and sets up asset tracking.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>configuration</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ExecutionConfiguration (deriva_ml.execution.execution_configuration.ExecutionConfiguration)" href="../execution_configuration/#deriva_ml.execution.execution_configuration.ExecutionConfiguration">ExecutionConfiguration</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Settings and parameters for the execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ml_object</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaML (deriva_ml.core.base.DerivaML)" href="../deriva_ml_base/#deriva_ml.core.DerivaML">DerivaML</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DerivaML instance managing the execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>workflow</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Workflow (deriva_ml.execution.workflow.Workflow)" href="../workflow/#deriva_ml.execution.workflow.Workflow">Workflow</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional Workflow object. If not specified, the workflow is taken from
the ExecutionConfiguration object. Must be a Workflow object, not a RID.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reload</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.definitions.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional RID of existing execution to reload.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dry_run</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, don't create catalog records or upload results.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If initialization fails, configuration is invalid,
or workflow is not a Workflow object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Create an execution with a workflow::</p>
<pre><code>&gt;&gt;&gt; workflow = ml.lookup_workflow("2-ABC1")
&gt;&gt;&gt; config = ExecutionConfiguration(
...     workflow=workflow,
...     description="Process data"
... )
&gt;&gt;&gt; execution = Execution(config, ml)
</code></pre>
<p>Or pass workflow separately::</p>
<pre><code>&gt;&gt;&gt; workflow = ml.lookup_workflow_by_url(
...     "https://github.com/org/repo/blob/abc123/analysis.py"
... )
&gt;&gt;&gt; config = ExecutionConfiguration(description="Run analysis")
&gt;&gt;&gt; execution = Execution(config, ml, workflow=workflow)
</code></pre>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">configuration</span><span class="p">:</span> <span class="n">ExecutionConfiguration</span><span class="p">,</span>
    <span class="n">ml_object</span><span class="p">:</span> <span class="n">DerivaML</span><span class="p">,</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reload</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes an Execution instance.</span>

<span class="sd">    Creates a new execution or reloads an existing one. Initializes the execution</span>
<span class="sd">    environment, downloads required datasets, and sets up asset tracking.</span>

<span class="sd">    Args:</span>
<span class="sd">        configuration: Settings and parameters for the execution.</span>
<span class="sd">        ml_object: DerivaML instance managing the execution.</span>
<span class="sd">        workflow: Optional Workflow object. If not specified, the workflow is taken from</span>
<span class="sd">            the ExecutionConfiguration object. Must be a Workflow object, not a RID.</span>
<span class="sd">        reload: Optional RID of existing execution to reload.</span>
<span class="sd">        dry_run: If True, don&#39;t create catalog records or upload results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If initialization fails, configuration is invalid,</span>
<span class="sd">            or workflow is not a Workflow object.</span>

<span class="sd">    Example:</span>
<span class="sd">        Create an execution with a workflow::</span>

<span class="sd">            &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; config = ExecutionConfiguration(</span>
<span class="sd">            ...     workflow=workflow,</span>
<span class="sd">            ...     description=&quot;Process data&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; execution = Execution(config, ml)</span>

<span class="sd">        Or pass workflow separately::</span>

<span class="sd">            &gt;&gt;&gt; workflow = ml.lookup_workflow_by_url(</span>
<span class="sd">            ...     &quot;https://github.com/org/repo/blob/abc123/analysis.py&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; config = ExecutionConfiguration(description=&quot;Run analysis&quot;)</span>
<span class="sd">            &gt;&gt;&gt; execution = Execution(config, ml, workflow=workflow)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">asset_paths</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="n">configuration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span> <span class="o">=</span> <span class="n">ml_object</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">ml_object</span><span class="o">.</span><span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">ml_object</span><span class="o">.</span><span class="n">_logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">Status</span><span class="o">.</span><span class="n">created</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="p">:</span> <span class="n">ExecutionRecord</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Lazily created after RID is assigned</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_rids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetBag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">working_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">cache_dir</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
            <span class="s2">&quot;DerivaML working_dir is not set. &quot;</span>
            <span class="s2">&quot;Ensure the DerivaML instance was initialized with a valid working_dir.&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span> <span class="o">=</span> <span class="n">dry_run</span>

    <span class="c1"># Make sure we have a valid Workflow object.</span>
    <span class="k">if</span> <span class="n">workflow</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">workflow</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Workflow must be specified either in configuration or as a parameter&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">,</span> <span class="n">Workflow</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Workflow must be a Workflow object, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">. &quot;</span>
            <span class="s2">&quot;Use ml.lookup_workflow(rid) or ml.lookup_workflow_by_url(url) to get a Workflow object.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Validate workflow type and register in catalog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">workflow_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="o">.</span><span class="n">workflow_type</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">add_workflow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span> <span class="k">else</span> <span class="n">DRY_RUN_RID</span>
    <span class="p">)</span>

    <span class="c1"># Validate the datasets and assets to be valid.</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">datasets</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Dataset specified in execution configuration is not a dataset&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">assets</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Asset specified in execution configuration is not an asset table&quot;</span><span class="p">)</span>

    <span class="n">schema_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">reload</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">reload</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">==</span> <span class="n">DRY_RUN_RID</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">DRY_RUN_RID</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="o">=</span> <span class="n">schema_path</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rid_path</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_SAVE_EXECUTION_RID&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Put execution_rid into the provided file path so we can find it later.</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">rid_path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;hostname&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">host_name</span><span class="p">,</span>
                    <span class="s2">&quot;catalog_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">catalog_id</span><span class="p">,</span>
                    <span class="s2">&quot;workflow_rid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">workflow_rid</span><span class="p">,</span>
                    <span class="s2">&quot;execution_rid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">f</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># Create a directory for execution rid so we can recover the state in case of a crash.</span>
    <span class="n">execution_root</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">exec_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

    <span class="c1"># Create the ExecutionRecord to handle catalog state operations</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="o">=</span> <span class="n">ExecutionRecord</span><span class="p">(</span>
            <span class="n">execution_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
            <span class="n">workflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">workflow</span><span class="p">,</span>
            <span class="n">status</span><span class="o">=</span><span class="n">Status</span><span class="o">.</span><span class="n">created</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="n">_ml_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="p">,</span>
            <span class="n">_logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_execution</span><span class="p">(</span><span class="n">reload</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.add_features" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_features</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_features</span><span class="p">(</span>
    <span class="n">features</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FeatureRecord</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adds feature records to the catalog.</p>
<p>Associates feature records with this execution and uploads them to the catalog.
Features represent measurable properties or characteristics of records.</p>
<p>NOTE: The catalog is not updated until upload_execution_outputs() is called.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>features</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="FeatureRecord (deriva_ml.feature.FeatureRecord)" href="../feature/#deriva_ml.feature.FeatureRecord">FeatureRecord</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feature records to add, each containing a value and metadata.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If feature addition fails or features are invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>feature = FeatureRecord(value="high", confidence=0.95)
execution.add_features([feature])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FeatureRecord</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds feature records to the catalog.</span>

<span class="sd">    Associates feature records with this execution and uploads them to the catalog.</span>
<span class="sd">    Features represent measurable properties or characteristics of records.</span>

<span class="sd">    NOTE: The catalog is not updated until upload_execution_outputs() is called.</span>

<span class="sd">    Args:</span>
<span class="sd">        features: Feature records to add, each containing a value and metadata.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If feature addition fails or features are invalid.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; feature = FeatureRecord(value=&quot;high&quot;, confidence=0.95)</span>
<span class="sd">        &gt;&gt;&gt; execution.add_features([feature])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make sure feature list is homogeneous:</span>
    <span class="n">sorted_features</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">sorted_features</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">sorted_features</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_features</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.add_files" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_files</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_files</span><span class="p">(</span>
    <span class="n">files</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FileSpec</span><span class="p">],</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adds files to the catalog with their metadata.</p>
<p>Registers files in the catalog along with their metadata (MD5, length, URL) and associates them with
specified file types.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>files</code>
            </td>
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="FileSpec (deriva_ml.core.definitions.FileSpec)" href="../deriva_definitions/#deriva_ml.core.definitions.FileSpec">FileSpec</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>File specifications containing MD5 checksum, length, and URL.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset_types</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One or more dataset type terms from File_Type vocabulary.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the files.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>RID</code></td>            <td>
                  <code>&#39;Dataset&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset  that identifies newly added files. Will be nested to mirror original directory structure</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>&#39;Dataset&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>of the files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLInvalidTerm (deriva_ml.core.exceptions.DerivaMLInvalidTerm)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLInvalidTerm">DerivaMLInvalidTerm</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If file_types are invalid or execution_rid is not an execution record.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Add a single file type:
    &gt;&gt;&gt; files = [FileSpec(url="path/to/file.txt", md5="abc123", length=1000)]
    &gt;&gt;&gt; rids = exe.add_files(files, file_types="text")</p>
<p>Add multiple file types:
    &gt;&gt;&gt; rids = exe.add_files(
    ...     files=[FileSpec(url="image.png", md5="def456", length=2000)],
    ...     file_types=["image", "png"],
    ... )</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_files</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">files</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">FileSpec</span><span class="p">],</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds files to the catalog with their metadata.</span>

<span class="sd">    Registers files in the catalog along with their metadata (MD5, length, URL) and associates them with</span>
<span class="sd">    specified file types.</span>

<span class="sd">    Args:</span>
<span class="sd">        files: File specifications containing MD5 checksum, length, and URL.</span>
<span class="sd">        dataset_types: One or more dataset type terms from File_Type vocabulary.</span>
<span class="sd">        description: Description of the files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        RID: Dataset  that identifies newly added files. Will be nested to mirror original directory structure</span>
<span class="sd">        of the files.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLInvalidTerm: If file_types are invalid or execution_rid is not an execution record.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Add a single file type:</span>
<span class="sd">            &gt;&gt;&gt; files = [FileSpec(url=&quot;path/to/file.txt&quot;, md5=&quot;abc123&quot;, length=1000)]</span>
<span class="sd">            &gt;&gt;&gt; rids = exe.add_files(files, file_types=&quot;text&quot;)</span>

<span class="sd">        Add multiple file types:</span>
<span class="sd">            &gt;&gt;&gt; rids = exe.add_files(</span>
<span class="sd">            ...     files=[FileSpec(url=&quot;image.png&quot;, md5=&quot;def456&quot;, length=2000)],</span>
<span class="sd">            ...     file_types=[&quot;image&quot;, &quot;png&quot;],</span>
<span class="sd">            ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">add_files</span><span class="p">(</span>
        <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="n">dataset_types</span><span class="o">=</span><span class="n">dataset_types</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.add_nested_execution" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_nested_execution</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_nested_execution</span><span class="p">(</span>
    <span class="n">nested_execution</span><span class="p">:</span> <span class="s2">&quot;Execution | ExecutionRecord | RID&quot;</span><span class="p">,</span>
    <span class="n">sequence</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a nested (child) execution to this execution.</p>
<p>Creates a parent-child relationship between this execution and another.
This is useful for grouping related executions, such as parameter sweeps
or pipeline stages.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nested_execution</code>
            </td>
            <td>
                  <code>&#39;Execution | ExecutionRecord | RID&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The child execution to add (Execution, ExecutionRecord, or RID).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sequence</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional ordering index (0, 1, 2...). Use None for parallel executions.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the association cannot be created.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>parent_exec = ml.create_execution(parent_config)
child_exec = ml.create_execution(child_config)
parent_exec.add_nested_execution(child_exec, sequence=0)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_nested_execution</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">nested_execution</span><span class="p">:</span> <span class="s2">&quot;Execution | ExecutionRecord | RID&quot;</span><span class="p">,</span>
    <span class="n">sequence</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a nested (child) execution to this execution.</span>

<span class="sd">    Creates a parent-child relationship between this execution and another.</span>
<span class="sd">    This is useful for grouping related executions, such as parameter sweeps</span>
<span class="sd">    or pipeline stages.</span>

<span class="sd">    Args:</span>
<span class="sd">        nested_execution: The child execution to add (Execution, ExecutionRecord, or RID).</span>
<span class="sd">        sequence: Optional ordering index (0, 1, 2...). Use None for parallel executions.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If the association cannot be created.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; parent_exec = ml.create_execution(parent_config)</span>
<span class="sd">        &gt;&gt;&gt; child_exec = ml.create_execution(child_config)</span>
<span class="sd">        &gt;&gt;&gt; parent_exec.add_nested_execution(child_exec, sequence=0)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Get the RID from the nested execution</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested_execution</span><span class="p">,</span> <span class="n">Execution</span><span class="p">):</span>
        <span class="n">nested_rid</span> <span class="o">=</span> <span class="n">nested_execution</span><span class="o">.</span><span class="n">execution_rid</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nested_execution</span><span class="p">,</span> <span class="n">ExecutionRecord</span><span class="p">):</span>
        <span class="n">nested_rid</span> <span class="o">=</span> <span class="n">nested_execution</span><span class="o">.</span><span class="n">execution_rid</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nested_rid</span> <span class="o">=</span> <span class="n">nested_execution</span>

    <span class="c1"># Delegate to ExecutionRecord if available</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">add_nested_execution</span><span class="p">(</span><span class="n">nested_rid</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="n">sequence</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fallback for cases without execution record</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">execution_execution</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Execution</span>

        <span class="n">record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Execution&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
            <span class="s2">&quot;Nested_Execution&quot;</span><span class="p">:</span> <span class="n">nested_rid</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">record</span><span class="p">[</span><span class="s2">&quot;Sequence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence</span>

        <span class="n">execution_execution</span><span class="o">.</span><span class="n">insert</span><span class="p">([</span><span class="n">record</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.asset_file_path" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">asset_file_path</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">asset_file_path</span><span class="p">(</span>
    <span class="n">asset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">asset_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">copy_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rename_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetFilePath</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a pathlib Path to the directory in which to place files for the specified execution_asset type.</p>
<p>Given the name of an asset table, and a file name, register the file for upload and return a path to that
file in the upload directory.  In addition to the filename, additional asset metadata and file asset types may
be specified.</p>
<p>This routine has three modes, depending on if file_name refers to an existing file.  If it doesn't, a path
to a new file with the specified name is returned.  The caller can then open that file for writing.</p>
<p>If the provided filename refers to an existing file and the copy_file argument is False (the default), then the
returned path contains a symbolic link to that file.  If the copy_file argument is True, then the contents of
file_name are copied into the target directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>asset_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of asset to be uploaded.  Must be a term in Asset_Type controlled vocabulary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of file to be uploaded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>asset_types</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of asset to be uploaded.  Defaults to the name of the asset.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>copy_file</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to copy the file rather than creating a symbolic link.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rename_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If provided, the file will be renamed to this name if the file already exists..</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Any additional metadata values that may be part of the asset table.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.asset.aux_classes.AssetFilePath">AssetFilePath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path in which to place asset files.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="DerivaException">DerivaException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the asset type is not defined.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">asset_file_path</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">asset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">asset_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">copy_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rename_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetFilePath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a pathlib Path to the directory in which to place files for the specified execution_asset type.</span>

<span class="sd">    Given the name of an asset table, and a file name, register the file for upload and return a path to that</span>
<span class="sd">    file in the upload directory.  In addition to the filename, additional asset metadata and file asset types may</span>
<span class="sd">    be specified.</span>

<span class="sd">    This routine has three modes, depending on if file_name refers to an existing file.  If it doesn&#39;t, a path</span>
<span class="sd">    to a new file with the specified name is returned.  The caller can then open that file for writing.</span>

<span class="sd">    If the provided filename refers to an existing file and the copy_file argument is False (the default), then the</span>
<span class="sd">    returned path contains a symbolic link to that file.  If the copy_file argument is True, then the contents of</span>
<span class="sd">    file_name are copied into the target directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        asset_name: Type of asset to be uploaded.  Must be a term in Asset_Type controlled vocabulary.</span>
<span class="sd">        file_name: Name of file to be uploaded.</span>
<span class="sd">        asset_types: Type of asset to be uploaded.  Defaults to the name of the asset.</span>
<span class="sd">        copy_file: Whether to copy the file rather than creating a symbolic link.</span>
<span class="sd">        rename_file: If provided, the file will be renamed to this name if the file already exists..</span>
<span class="sd">        **kwargs: Any additional metadata values that may be part of the asset table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Path in which to place asset files.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaException: If the asset type is not defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">asset_name</span><span class="p">):</span>
        <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">asset_name</span><span class="si">}</span><span class="s2"> is not an asset&quot;</span><span class="p">)</span>

    <span class="n">asset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">asset_name</span><span class="p">)</span>

    <span class="n">asset_types</span> <span class="o">=</span> <span class="n">asset_types</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Asset_Type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">asset_name</span>
    <span class="n">asset_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">asset_types</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">asset_types</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">asset_types</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">asset_types</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_type</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

    <span class="c1"># Determine if we will need to rename an existing file as the asset.</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;_implementations.log&quot;</span><span class="p">:</span>
        <span class="c1"># There is a funny bug with S3 hatrac if we have the leading _ in the filename.</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">with_name</span><span class="p">(</span><span class="s2">&quot;-implementations.log&quot;</span><span class="p">)</span>

    <span class="c1"># Resolve relative paths to absolute paths to ensure exists() and symlink work correctly</span>
    <span class="c1"># regardless of the current working directory</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_name</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="n">target_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">rename_file</span><span class="p">)</span> <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">rename_file</span> <span class="k">else</span> <span class="n">file_name</span>
    <span class="n">asset_path</span> <span class="o">=</span> <span class="n">asset_file_path</span><span class="p">(</span>
        <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span>
        <span class="n">exec_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="n">asset_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">asset_name</span><span class="p">),</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">target_name</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">file_name</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">copy_file</span><span class="p">:</span>
            <span class="n">asset_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">asset_path</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">PermissionError</span><span class="p">):</span>
                <span class="c1"># Fallback to copy if symlink fails (common on Windows)</span>
                <span class="n">asset_path</span><span class="o">.</span><span class="n">write_bytes</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">read_bytes</span><span class="p">())</span>

    <span class="c1"># Persist the asset types into a file</span>
    <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">asset_type_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span> <span class="n">asset_table</span><span class="p">))</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">asset_type_file</span><span class="p">:</span>
        <span class="n">asset_type_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="n">target_name</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">asset_types</span><span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">AssetFilePath</span><span class="p">(</span>
        <span class="n">asset_path</span><span class="o">=</span><span class="n">asset_path</span><span class="p">,</span>
        <span class="n">asset_table</span><span class="o">=</span><span class="n">asset_name</span><span class="p">,</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">target_name</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">asset_metadata</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">asset_types</span><span class="o">=</span><span class="n">asset_types</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.create_dataset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_dataset</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">create_dataset</span><span class="p">(</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new dataset with specified types.</p>
<p>Creates a dataset associated with this execution for provenance tracking.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset_types</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>One or more dataset type terms from Dataset_Type vocabulary.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Markdown description of the dataset being created.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetVersion (deriva_ml.dataset.aux_classes.DatasetVersion)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetVersion">DatasetVersion</a> | <span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset version. Defaults to 0.1.0.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Dataset (deriva_ml.dataset.dataset.Dataset)" href="../dataset/#deriva_ml.dataset.dataset.Dataset">Dataset</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The newly created Dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">dataset_types</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="n">DatasetVersion</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new dataset with specified types.</span>

<span class="sd">    Creates a dataset associated with this execution for provenance tracking.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset_types: One or more dataset type terms from Dataset_Type vocabulary.</span>
<span class="sd">        description: Markdown description of the dataset being created.</span>
<span class="sd">        version: Dataset version. Defaults to 0.1.0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The newly created Dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
        <span class="n">ml_instance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="p">,</span>
        <span class="n">execution_rid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
        <span class="n">dataset_types</span><span class="o">=</span><span class="n">dataset_types</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.download_asset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">download_asset</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">download_asset</span><span class="p">(</span>
    <span class="n">asset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span>
    <span class="n">dest_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">update_catalog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetFilePath</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Download an asset from a URL and place it in a local directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>asset_rid</code>
            </td>
            <td>
                  <code><span title="deriva_ml.core.definitions.RID">RID</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RID of the asset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dest_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Destination directory for the asset.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_catalog</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to update the catalog execution information after downloading.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_cache</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, check the cache directory for a previously downloaded copy
with a matching MD5 checksum before downloading. Cached copies are stored
in <code>cache_dir/assets/{rid}_{md5}/</code> and symlinked into the destination.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.asset.aux_classes.AssetFilePath">AssetFilePath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An AssetFilePath with the path to the downloaded (or cached) asset file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_asset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">asset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span> <span class="n">dest_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">update_catalog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AssetFilePath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download an asset from a URL and place it in a local directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        asset_rid: RID of the asset.</span>
<span class="sd">        dest_dir: Destination directory for the asset.</span>
<span class="sd">        update_catalog: Whether to update the catalog execution information after downloading.</span>
<span class="sd">        use_cache: If True, check the cache directory for a previously downloaded copy</span>
<span class="sd">            with a matching MD5 checksum before downloading. Cached copies are stored</span>
<span class="sd">            in ``cache_dir/assets/{rid}_{md5}/`` and symlinked into the destination.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An AssetFilePath with the path to the downloaded (or cached) asset file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">asset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">asset_rid</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">asset_table</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RID </span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2">  is not for an asset table.&quot;</span><span class="p">)</span>

    <span class="n">asset_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">retrieve_rid</span><span class="p">(</span><span class="n">asset_rid</span><span class="p">)</span>
    <span class="n">asset_metadata</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">asset_record</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">asset_metadata</span><span class="p">(</span><span class="n">asset_table</span><span class="p">)}</span>
    <span class="n">asset_url</span> <span class="o">=</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;URL&quot;</span><span class="p">]</span>
    <span class="n">asset_filename</span> <span class="o">=</span> <span class="n">dest_dir</span> <span class="o">/</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span>

    <span class="c1"># Check cache before downloading</span>
    <span class="n">cache_hit</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
        <span class="n">md5</span> <span class="o">=</span> <span class="n">asset_record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MD5&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">md5</span><span class="p">:</span>
            <span class="n">asset_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="s2">&quot;assets&quot;</span>
            <span class="n">asset_cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">cached_file</span> <span class="o">=</span> <span class="n">asset_cache_dir</span> <span class="o">/</span> <span class="n">cache_key</span> <span class="o">/</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cached_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="c1"># Cache hit  symlink from cache to destination</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using cached asset </span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2"> (MD5: </span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">asset_filename</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="n">asset_filename</span><span class="o">.</span><span class="n">is_symlink</span><span class="p">():</span>
                    <span class="n">asset_filename</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
                <span class="n">asset_filename</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">cached_file</span><span class="p">)</span>
                <span class="n">cache_hit</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cache_hit</span><span class="p">:</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="n">HatracStore</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">host_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">credential</span><span class="p">)</span>
        <span class="n">hs</span><span class="o">.</span><span class="n">get_obj</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">asset_url</span><span class="p">,</span> <span class="n">destfilename</span><span class="o">=</span><span class="n">asset_filename</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>

        <span class="c1"># Store in cache for future use</span>
        <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
            <span class="n">md5</span> <span class="o">=</span> <span class="n">asset_record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MD5&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">md5</span><span class="p">:</span>
                <span class="n">asset_cache_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">cache_dir</span> <span class="o">/</span> <span class="s2">&quot;assets&quot;</span>
                <span class="n">asset_cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">cache_entry_dir</span> <span class="o">=</span> <span class="n">asset_cache_dir</span> <span class="o">/</span> <span class="n">cache_key</span>
                <span class="n">cache_entry_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">cached_file</span> <span class="o">=</span> <span class="n">cache_entry_dir</span> <span class="o">/</span> <span class="n">asset_record</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span>
                <span class="c1"># Move file to cache, then symlink back</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">asset_filename</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">cached_file</span><span class="p">))</span>
                <span class="n">asset_filename</span><span class="o">.</span><span class="n">symlink_to</span><span class="p">(</span><span class="n">cached_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cached asset </span><span class="si">{</span><span class="n">asset_rid</span><span class="si">}</span><span class="s2"> (MD5: </span><span class="si">{</span><span class="n">md5</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="n">asset_type_table</span><span class="p">,</span> <span class="n">_col_l</span><span class="p">,</span> <span class="n">_col_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">find_association</span><span class="p">(</span><span class="n">asset_table</span><span class="p">,</span> <span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_type</span><span class="p">)</span>
    <span class="n">type_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">asset_type_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">asset_type_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
    <span class="n">asset_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">asset_type</span><span class="p">[</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">asset_type</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">asset_type</span> <span class="ow">in</span> <span class="n">type_path</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">type_path</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">asset_table</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="n">asset_rid</span><span class="p">)</span>
        <span class="o">.</span><span class="n">attributes</span><span class="p">(</span><span class="n">type_path</span><span class="o">.</span><span class="n">Asset_Type</span><span class="p">)</span>
        <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">]</span>

    <span class="n">asset_path</span> <span class="o">=</span> <span class="n">AssetFilePath</span><span class="p">(</span>
        <span class="n">file_name</span><span class="o">=</span><span class="n">asset_filename</span><span class="p">,</span>
        <span class="n">asset_rid</span><span class="o">=</span><span class="n">asset_rid</span><span class="p">,</span>
        <span class="n">asset_path</span><span class="o">=</span><span class="n">asset_filename</span><span class="p">,</span>
        <span class="n">asset_metadata</span><span class="o">=</span><span class="n">asset_metadata</span><span class="p">,</span>
        <span class="n">asset_table</span><span class="o">=</span><span class="n">asset_table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">asset_types</span><span class="o">=</span><span class="n">asset_types</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">update_catalog</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_asset_execution_table</span><span class="p">(</span>
            <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">asset_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">asset_table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">asset_path</span><span class="p">]},</span>
            <span class="n">asset_role</span><span class="o">=</span><span class="s2">&quot;Input&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">asset_path</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.download_dataset_bag" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">download_dataset_bag</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">download_dataset_bag</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetSpec</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetBag</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Downloads and materializes a dataset for use in the execution.</p>
<p>Downloads the specified dataset as a BDBag and materializes it in the execution's
working directory. The dataset version is determined by the DatasetSpec.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetSpec (deriva_ml.dataset.aux_classes.DatasetSpec)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetSpec">DatasetSpec</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Specification of the dataset to download, including version and
materialization options.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>DatasetBag</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="DatasetBag (deriva_ml.dataset.dataset_bag.DatasetBag)" href="../dataset_bag/#deriva_ml.dataset.dataset_bag.DatasetBag">DatasetBag</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object containing:
- path: Local filesystem path to downloaded dataset
- rid: Dataset's Resource Identifier
- minid: Dataset's Minimal Viable Identifier</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If download or materialization fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>spec = DatasetSpec(rid="1-abc123", version="1.2.0")
bag = execution.download_dataset_bag(spec)
print(f"Downloaded to {bag.path}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">download_dataset_bag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">DatasetSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DatasetBag</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Downloads and materializes a dataset for use in the execution.</span>

<span class="sd">    Downloads the specified dataset as a BDBag and materializes it in the execution&#39;s</span>
<span class="sd">    working directory. The dataset version is determined by the DatasetSpec.</span>

<span class="sd">    Args:</span>
<span class="sd">        dataset: Specification of the dataset to download, including version and</span>
<span class="sd">            materialization options.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DatasetBag: Object containing:</span>
<span class="sd">            - path: Local filesystem path to downloaded dataset</span>
<span class="sd">            - rid: Dataset&#39;s Resource Identifier</span>
<span class="sd">            - minid: Dataset&#39;s Minimal Viable Identifier</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If download or materialization fails.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; spec = DatasetSpec(rid=&quot;1-abc123&quot;, version=&quot;1.2.0&quot;)</span>
<span class="sd">        &gt;&gt;&gt; bag = execution.download_dataset_bag(spec)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Downloaded to {bag.path}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">download_dataset_bag</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Execution</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initiate an execution with the provided configuration. Can be used in a context manager.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Execution</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initiate an execution with the provided configuration. Can be used in a context manager.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">execution_start</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.execution_start" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execution_start</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execution_start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Marks the execution as started.</p>
<p>Records the start time and updates the execution's status to 'running'.
This should be called before beginning the main execution work.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>execution.execution_start()
try:
...     # Run analysis
...     execution.execution_stop()
... except Exception:
...     execution.update_status(Status.failed, "Analysis error")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execution_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Marks the execution as started.</span>

<span class="sd">    Records the start time and updates the execution&#39;s status to &#39;running&#39;.</span>
<span class="sd">    This should be called before beginning the main execution work.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; execution.execution_start()</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        ...     # Run analysis</span>
<span class="sd">        ...     execution.execution_stop()</span>
<span class="sd">        ... except Exception:</span>
<span class="sd">        ...     execution.update_status(Status.failed, &quot;Analysis error&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">initializing</span><span class="p">,</span> <span class="s2">&quot;Start execution  ...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.execution_stop" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execution_stop</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execution_stop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Marks the execution as completed.</p>
<p>Records the stop time and updates the execution's status to 'completed'.
This should be called after all execution work is finished.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>try:
...     # Run analysis
...     execution.execution_stop()
... except Exception:
...     execution.update_status(Status.failed, "Analysis error")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">execution_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Marks the execution as completed.</span>

<span class="sd">    Records the stop time and updates the execution&#39;s status to &#39;completed&#39;.</span>
<span class="sd">    This should be called after all execution work is finished.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        ...     # Run analysis</span>
<span class="sd">        ...     execution.execution_stop()</span>
<span class="sd">        ... except Exception:</span>
<span class="sd">        ...     execution.update_status(Status.failed, &quot;Analysis error&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
    <span class="n">hours</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">duration</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">(),</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">remainder</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">H </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">min </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">sec&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">completed</span><span class="p">,</span> <span class="s2">&quot;Algorithm execution ended.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">[{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span> <span class="s2">&quot;Duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">}]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.is_nested" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_nested</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_nested</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if this execution is nested within another execution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if this execution has at least one parent execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_nested</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this execution is nested within another execution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if this execution has at least one parent execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">is_nested</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_parent_executions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.is_parent" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_parent</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_parent</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if this execution has nested child executions.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if this execution has at least one nested execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this execution has nested child executions.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if this execution has at least one nested execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">is_parent</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_nested_executions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.list_assets" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_assets</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_assets</span><span class="p">(</span>
    <span class="n">asset_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Asset&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all assets that were inputs or outputs of this execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>asset_role</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional filter: "Input" or "Output". If None, returns all.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[&#39;Asset&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Asset objects associated with this execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>inputs = execution.list_assets(asset_role="Input")
outputs = execution.list_assets(asset_role="Output")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">asset_role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;Asset&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all assets that were inputs or outputs of this execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        asset_role: Optional filter: &quot;Input&quot; or &quot;Output&quot;. If None, returns all.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Asset objects associated with this execution.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; inputs = execution.list_assets(asset_role=&quot;Input&quot;)</span>
<span class="sd">        &gt;&gt;&gt; outputs = execution.list_assets(asset_role=&quot;Output&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_assets</span><span class="p">(</span><span class="n">asset_role</span><span class="o">=</span><span class="n">asset_role</span><span class="p">)</span>

    <span class="c1"># Fallback for dry_run mode</span>

    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">asset_exec</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Asset_Execution</span>

    <span class="n">query</span> <span class="o">=</span> <span class="n">asset_exec</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">asset_exec</span><span class="o">.</span><span class="n">Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">asset_role</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">asset_exec</span><span class="o">.</span><span class="n">Asset_Role</span> <span class="o">==</span> <span class="n">asset_role</span><span class="p">)</span>

    <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())</span>

    <span class="n">assets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">asset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_asset</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;Execution_Asset&quot;</span><span class="p">])</span>
            <span class="n">assets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asset</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># Skip assets that can&#39;t be looked up</span>
    <span class="k">return</span> <span class="n">assets</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.list_input_datasets" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_input_datasets</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_input_datasets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all datasets that were inputs to this execution.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="Dataset (deriva_ml.dataset.dataset.Dataset)" href="../dataset/#deriva_ml.dataset.dataset.Dataset">Dataset</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Dataset objects that were used as inputs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>for ds in execution.list_input_datasets():
...     print(f"Input: {ds.dataset_rid} - {ds.description}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_input_datasets</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all datasets that were inputs to this execution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of Dataset objects that were used as inputs.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; for ds in execution.list_input_datasets():</span>
<span class="sd">        ...     print(f&quot;Input: {ds.dataset_rid} - {ds.description}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_input_datasets</span><span class="p">()</span>

    <span class="c1"># Fallback for dry_run mode</span>
    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">dataset_exec</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Dataset_Execution</span>

    <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">dataset_exec</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">dataset_exec</span><span class="o">.</span><span class="n">Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
        <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
        <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_dataset</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.list_nested_executions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_nested_executions</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_nested_executions</span><span class="p">(</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ExecutionRecord&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all nested (child) executions of this execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>recurse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, recursively return all descendant executions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_visited</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="deriva_ml.core.definitions.RID">RID</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to track visited executions and prevent infinite recursion.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[&#39;ExecutionRecord&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of nested ExecutionRecord objects, ordered by sequence if available.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[&#39;ExecutionRecord&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>To get full Execution objects with lifecycle management, use restore_execution().</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>children = parent_exec.list_nested_executions()
all_descendants = parent_exec.list_nested_executions(recurse=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_nested_executions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ExecutionRecord&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all nested (child) executions of this execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        recurse: If True, recursively return all descendant executions.</span>
<span class="sd">        _visited: Internal parameter to track visited executions and prevent infinite recursion.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of nested ExecutionRecord objects, ordered by sequence if available.</span>
<span class="sd">        To get full Execution objects with lifecycle management, use restore_execution().</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; children = parent_exec.list_nested_executions()</span>
<span class="sd">        &gt;&gt;&gt; all_descendants = parent_exec.list_nested_executions(recurse=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_nested_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

    <span class="c1"># Fallback for dry_run mode</span>
    <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">execution_execution</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Execution</span>

    <span class="c1"># Query for nested executions, ordered by sequence</span>
    <span class="n">nested</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">execution_execution</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">execution_execution</span><span class="o">.</span><span class="n">Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
        <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
        <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># Sort by sequence (None values at the end)</span>
    <span class="n">nested</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sequence&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Sequence&quot;</span><span class="p">)))</span>

    <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">nested</span><span class="p">:</span>
        <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_execution</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;Nested_Execution&quot;</span><span class="p">])</span>
        <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">list_nested_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">children</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.list_parent_executions" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_parent_executions</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_parent_executions</span><span class="p">(</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ExecutionRecord&quot;</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all parent executions that contain this execution as a nested child.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>recurse</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, recursively return all ancestor executions.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_visited</code>
            </td>
            <td>
                  <code><span title="set">set</span>[<span title="deriva_ml.core.definitions.RID">RID</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Internal parameter to track visited executions and prevent infinite recursion.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[&#39;ExecutionRecord&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of parent ExecutionRecord objects.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[&#39;ExecutionRecord&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>To get full Execution objects with lifecycle management, use restore_execution().</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>parents = child_exec.list_parent_executions()
all_ancestors = child_exec.list_parent_executions(recurse=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_parent_executions</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">_visited</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;ExecutionRecord&quot;</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all parent executions that contain this execution as a nested child.</span>

<span class="sd">    Args:</span>
<span class="sd">        recurse: If True, recursively return all ancestor executions.</span>
<span class="sd">        _visited: Internal parameter to track visited executions and prevent infinite recursion.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of parent ExecutionRecord objects.</span>
<span class="sd">        To get full Execution objects with lifecycle management, use restore_execution().</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; parents = child_exec.list_parent_executions()</span>
<span class="sd">        &gt;&gt;&gt; all_ancestors = child_exec.list_parent_executions(recurse=True)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">list_parent_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

    <span class="c1"># Fallback for dry_run mode</span>
    <span class="k">if</span> <span class="n">_visited</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span> <span class="ow">in</span> <span class="n">_visited</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>

    <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
    <span class="n">execution_execution</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution_Execution</span>

    <span class="n">parent_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">execution_execution</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">execution_execution</span><span class="o">.</span><span class="n">Nested_Execution</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">)</span>
        <span class="o">.</span><span class="n">entities</span><span class="p">()</span>
        <span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">parents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">parent_records</span><span class="p">:</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">lookup_execution</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;Execution&quot;</span><span class="p">])</span>
        <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">list_parent_executions</span><span class="p">(</span><span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">_visited</span><span class="o">=</span><span class="n">_visited</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">parents</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.table_path" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">table_path</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">table_path</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a local file path to a CSV to add values to a table on upload.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of table to be uploaded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pathlib path to the file in which to place table values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">table_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a local file path to a CSV to add values to a table on upload.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Name of table to be uploaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Pathlib path to the file in which to place table values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find which domain schema contains this table</span>
    <span class="n">table_schema</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">domain_schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">domain_schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">domain_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">table_schema</span> <span class="o">=</span> <span class="n">domain_schema</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="n">table_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Table &#39;</span><span class="si">{}</span><span class="s2">&#39; not found in any domain schema&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">table_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_working_dir</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">table_schema</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">table</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.update_status" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_status</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update_status</span><span class="p">(</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Updates the execution's status in the catalog.</p>
<p>Records a new status and associated message in the catalog, allowing remote
tracking of execution progress.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Status (deriva_ml.core.definitions.Status)" href="../deriva_definitions/#deriva_ml.core.definitions.Status">Status</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New status value (e.g., running, completed, failed).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>msg</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the status change or current state.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If status update fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>execution.update_status(Status.running, "Processing sample 1 of 10")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Status</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the execution&#39;s status in the catalog.</span>

<span class="sd">    Records a new status and associated message in the catalog, allowing remote</span>
<span class="sd">    tracking of execution progress.</span>

<span class="sd">    Args:</span>
<span class="sd">        status: New status value (e.g., running, completed, failed).</span>
<span class="sd">        msg: Description of the status change or current state.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If status update fails.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; execution.update_status(Status.running, &quot;Processing sample 1 of 10&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Delegate to ExecutionRecord for catalog updates</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_execution_record</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fallback for cases where ExecutionRecord isn&#39;t available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Execution</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_rid</span><span class="p">,</span>
                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s2">&quot;Status_Detail&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.upload_assets" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">upload_assets</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">upload_assets</span><span class="p">(</span>
    <span class="n">assets_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">FileUploadState</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Uploads assets from a directory to the catalog.</p>
<p>Scans the specified directory for assets and uploads them to the catalog,
recording their metadata and types. Assets are organized by their types
and associated with the execution.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>assets_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory containing assets to upload.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="typing.Any">Any</span>, <a class="autorefs autorefs-internal" title="FileUploadState (deriva_ml.core.definitions.FileUploadState)" href="../deriva_definitions/#deriva_ml.core.definitions.FileUploadState">FileUploadState</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[Any, FileUploadState] | None: Mapping of assets to their upload states,
or None if no assets were found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If upload fails or assets are invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>states = execution.upload_assets("output/results")
for asset, state in states.items():
...     print(f"{asset}: {state}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">upload_assets</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">assets_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">FileUploadState</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uploads assets from a directory to the catalog.</span>

<span class="sd">    Scans the specified directory for assets and uploads them to the catalog,</span>
<span class="sd">    recording their metadata and types. Assets are organized by their types</span>
<span class="sd">    and associated with the execution.</span>

<span class="sd">    Args:</span>
<span class="sd">        assets_dir: Directory containing assets to upload.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[Any, FileUploadState] | None: Mapping of assets to their upload states,</span>
<span class="sd">            or None if no assets were found.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If upload fails or assets are invalid.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; states = execution.upload_assets(&quot;output/results&quot;)</span>
<span class="sd">        &gt;&gt;&gt; for asset, state in states.items():</span>
<span class="sd">        ...     print(f&quot;{asset}: {state}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">path_to_asset</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pull the asset name out of a path to that asset in the filesystem&quot;&quot;&quot;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">components</span><span class="p">[</span><span class="n">components</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;asset&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Look for asset in the path to find the name</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">assets_dir</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Directory does not have name of an asset table.&quot;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">upload_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">,</span> <span class="n">assets_dir</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">path_to_asset</span><span class="p">(</span><span class="n">p</span><span class="p">):</span> <span class="n">r</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Execution.upload_execution_outputs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">upload_execution_outputs</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">upload_execution_outputs</span><span class="p">(</span>
    <span class="n">clean_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span><span class="n">UploadProgress</span><span class="p">],</span> <span class="kc">None</span>
    <span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Uploads all outputs from the execution to the catalog.</p>
<p>Scans the execution's output directories for assets, features, and other results,
then uploads them to the catalog. Can optionally clean up the output folders
after successful upload.</p>
<p>IMPORTANT: This method must be called AFTER exiting the context manager, not inside it.
The context manager handles execution timing (start/stop), while this method handles
the separate upload step.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>clean_folder</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to delete output folders after upload. If None (default),
uses the DerivaML instance's clean_execution_dir setting. Pass True/False
to override for this specific execution.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progress_callback</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="UploadProgress


  
      dataclass
   (deriva_ml.core.definitions.UploadProgress)" href="../deriva_definitions/#deriva_ml.core.definitions.UploadProgress">UploadProgress</a>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional callback function to receive upload progress updates.
Called with UploadProgress objects containing file name, bytes uploaded,
total bytes, percent complete, phase, and status message.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_retries</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of retry attempts for failed uploads (default: 3).</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>retry_delay</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial delay in seconds between retries, doubles with each attempt (default: 5.0).</p>
              </div>
            </td>
            <td>
                  <code>5.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>timeout</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (connect_timeout, read_timeout) in seconds. Default is (600, 600).
Note: urllib3 uses connect_timeout as the socket timeout during request body
writes, so it must be large enough for a full chunk upload.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chunk_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional chunk size in bytes for hatrac uploads. If provided,
large files will be uploaded in chunks of this size.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="deriva_ml.asset.aux_classes.AssetFilePath">AssetFilePath</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict[str, list[AssetFilePath]]: Mapping of asset types to their file paths.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If upload fails or outputs are invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>with ml.create_execution(config) as execution:
...     # Do ML work, register output files with asset_file_path()
...     path = execution.asset_file_path("Model", "model.pt")
...     # Write to path...
...</p>
<h4 id="deriva_ml.execution.Execution.upload_execution_outputs--upload-after-the-context-manager-exits">Upload AFTER the context manager exits</h4>
<p>def my_callback(progress):
...     print(f"Uploading {progress.file_name}: {progress.percent_complete:.1f}%")
outputs = execution.upload_execution_outputs(progress_callback=my_callback)</p>
<h4 id="deriva_ml.execution.Execution.upload_execution_outputs--upload-large-files-with-increased-timeout-30-min-per-chunk">Upload large files with increased timeout (30 min per chunk)</h4>
<p>outputs = execution.upload_execution_outputs(timeout=(6, 1800))</p>
<h4 id="deriva_ml.execution.Execution.upload_execution_outputs--override-cleanup-setting-for-this-execution">Override cleanup setting for this execution</h4>
<p>outputs = execution.upload_execution_outputs(clean_folder=False)  # Keep files</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">upload_execution_outputs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">clean_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">UploadProgress</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">retry_delay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
    <span class="n">timeout</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetFilePath</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Uploads all outputs from the execution to the catalog.</span>

<span class="sd">    Scans the execution&#39;s output directories for assets, features, and other results,</span>
<span class="sd">    then uploads them to the catalog. Can optionally clean up the output folders</span>
<span class="sd">    after successful upload.</span>

<span class="sd">    IMPORTANT: This method must be called AFTER exiting the context manager, not inside it.</span>
<span class="sd">    The context manager handles execution timing (start/stop), while this method handles</span>
<span class="sd">    the separate upload step.</span>

<span class="sd">    Args:</span>
<span class="sd">        clean_folder: Whether to delete output folders after upload. If None (default),</span>
<span class="sd">            uses the DerivaML instance&#39;s clean_execution_dir setting. Pass True/False</span>
<span class="sd">            to override for this specific execution.</span>
<span class="sd">        progress_callback: Optional callback function to receive upload progress updates.</span>
<span class="sd">            Called with UploadProgress objects containing file name, bytes uploaded,</span>
<span class="sd">            total bytes, percent complete, phase, and status message.</span>
<span class="sd">        max_retries: Maximum number of retry attempts for failed uploads (default: 3).</span>
<span class="sd">        retry_delay: Initial delay in seconds between retries, doubles with each attempt (default: 5.0).</span>
<span class="sd">        timeout: Tuple of (connect_timeout, read_timeout) in seconds. Default is (600, 600).</span>
<span class="sd">            Note: urllib3 uses connect_timeout as the socket timeout during request body</span>
<span class="sd">            writes, so it must be large enough for a full chunk upload.</span>
<span class="sd">        chunk_size: Optional chunk size in bytes for hatrac uploads. If provided,</span>
<span class="sd">            large files will be uploaded in chunks of this size.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, list[AssetFilePath]]: Mapping of asset types to their file paths.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If upload fails or outputs are invalid.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; with ml.create_execution(config) as execution:</span>
<span class="sd">        ...     # Do ML work, register output files with asset_file_path()</span>
<span class="sd">        ...     path = execution.asset_file_path(&quot;Model&quot;, &quot;model.pt&quot;)</span>
<span class="sd">        ...     # Write to path...</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; # Upload AFTER the context manager exits</span>
<span class="sd">        &gt;&gt;&gt; def my_callback(progress):</span>
<span class="sd">        ...     print(f&quot;Uploading {progress.file_name}: {progress.percent_complete:.1f}%&quot;)</span>
<span class="sd">        &gt;&gt;&gt; outputs = execution.upload_execution_outputs(progress_callback=my_callback)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Upload large files with increased timeout (30 min per chunk)</span>
<span class="sd">        &gt;&gt;&gt; outputs = execution.upload_execution_outputs(timeout=(6, 1800))</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Override cleanup setting for this execution</span>
<span class="sd">        &gt;&gt;&gt; outputs = execution.upload_execution_outputs(clean_folder=False)  # Keep files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dry_run</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="c1"># Use DerivaML instance setting if not explicitly provided</span>
    <span class="k">if</span> <span class="n">clean_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">clean_folder</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_object</span><span class="p">,</span> <span class="s1">&#39;clean_execution_dir&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_execution_dirs</span><span class="p">(</span>
            <span class="n">progress_callback</span><span class="o">=</span><span class="n">progress_callback</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="o">=</span><span class="n">max_retries</span><span class="p">,</span>
            <span class="n">retry_delay</span><span class="o">=</span><span class="n">retry_delay</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">completed</span><span class="p">,</span> <span class="s2">&quot;Successfully end the execution.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clean_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_folder_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_execution_root</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uploaded_assets</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">format_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">Status</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.ExecutionConfiguration" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ExecutionConfiguration</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>



        <p>Configuration for a DerivaML execution.</p>
<p>Defines the complete configuration for a computational or manual process in DerivaML,
including required datasets, input assets, workflow definition, and parameters.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.ExecutionConfiguration.datasets">datasets</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="DatasetSpec (deriva_ml.dataset.aux_classes.DatasetSpec)" href="../dataset_aux_classes/#deriva_ml.dataset.aux_classes.DatasetSpec">DatasetSpec</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset specifications, each containing:
- rid: Dataset Resource Identifier
- version: Version to use
- materialize: Whether to extract dataset contents</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.ExecutionConfiguration.assets">assets</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="AssetSpec (deriva_ml.asset.aux_classes.AssetSpec)" href="#deriva_ml.execution.AssetSpec">AssetSpec</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Asset specifications. Each element can be:
- A plain RID string (no caching)
- An <code>AssetSpec(rid=..., cache=True)</code> for checksum-based caching</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.ExecutionConfiguration.workflow">workflow</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Workflow (deriva_ml.execution.workflow.Workflow)" href="../workflow/#deriva_ml.execution.workflow.Workflow">Workflow</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Workflow object defining the computational process.
Use <code>ml.lookup_workflow(rid)</code> or <code>ml.lookup_workflow_by_url(url)</code> to get
a Workflow object from a RID or URL. Defaults to <code>None</code>, which means the
workflow must be provided via the <code>workflow</code> parameter of
<code>ml.create_execution()</code> instead. If no workflow is specified in either
place, a <code>DerivaMLException</code> is raised at execution creation time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.ExecutionConfiguration.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of execution purpose (supports Markdown).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.ExecutionConfiguration.argv">argv</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Command line arguments used to start execution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.ExecutionConfiguration.config_choices">config_choices</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hydra config group choices that were selected.
Maps group names to selected config names (e.g., {"model_config": "cifar10_quick"}).
Automatically populated by run_model() and get_notebook_configuration().</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="deriva_ml.execution.ExecutionConfiguration--plain-rids-backward-compatible">Plain RIDs (backward compatible)</h3>
<p>config = ExecutionConfiguration(assets=["6-EPNR", "6-EP56"])</p>
<h3 id="deriva_ml.execution.ExecutionConfiguration--mixed-cached-model-weights-uncached-embeddings">Mixed: cached model weights + uncached embeddings</h3>
<p>config = ExecutionConfiguration(
...     assets=[
...         AssetSpec(rid="6-EPNR", cache=True),
...         "6-EP56",
...     ]
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/execution_configuration.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ExecutionConfiguration</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration for a DerivaML execution.</span>

<span class="sd">    Defines the complete configuration for a computational or manual process in DerivaML,</span>
<span class="sd">    including required datasets, input assets, workflow definition, and parameters.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        datasets (list[DatasetSpec]): Dataset specifications, each containing:</span>
<span class="sd">            - rid: Dataset Resource Identifier</span>
<span class="sd">            - version: Version to use</span>
<span class="sd">            - materialize: Whether to extract dataset contents</span>
<span class="sd">        assets (list[AssetSpec]): Asset specifications. Each element can be:</span>
<span class="sd">            - A plain RID string (no caching)</span>
<span class="sd">            - An ``AssetSpec(rid=..., cache=True)`` for checksum-based caching</span>
<span class="sd">        workflow (Workflow | None): Workflow object defining the computational process.</span>
<span class="sd">            Use ``ml.lookup_workflow(rid)`` or ``ml.lookup_workflow_by_url(url)`` to get</span>
<span class="sd">            a Workflow object from a RID or URL. Defaults to ``None``, which means the</span>
<span class="sd">            workflow must be provided via the ``workflow`` parameter of</span>
<span class="sd">            ``ml.create_execution()`` instead. If no workflow is specified in either</span>
<span class="sd">            place, a ``DerivaMLException`` is raised at execution creation time.</span>
<span class="sd">        description (str): Description of execution purpose (supports Markdown).</span>
<span class="sd">        argv (list[str]): Command line arguments used to start execution.</span>
<span class="sd">        config_choices (dict[str, str]): Hydra config group choices that were selected.</span>
<span class="sd">            Maps group names to selected config names (e.g., {&quot;model_config&quot;: &quot;cifar10_quick&quot;}).</span>
<span class="sd">            Automatically populated by run_model() and get_notebook_configuration().</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Plain RIDs (backward compatible)</span>
<span class="sd">        &gt;&gt;&gt; config = ExecutionConfiguration(assets=[&quot;6-EPNR&quot;, &quot;6-EP56&quot;])</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Mixed: cached model weights + uncached embeddings</span>
<span class="sd">        &gt;&gt;&gt; config = ExecutionConfiguration(</span>
<span class="sd">        ...     assets=[</span>
<span class="sd">        ...         AssetSpec(rid=&quot;6-EPNR&quot;, cache=True),</span>
<span class="sd">        ...         &quot;6-EP56&quot;,</span>
<span class="sd">        ...     ]</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DatasetSpec</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">assets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AssetSpec</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">argv</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">config_choices</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_assets</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize asset entries to AssetSpec objects.</span>

<span class="sd">        Accepts plain RID strings, AssetRID objects, DictConfig from Hydra,</span>
<span class="sd">        AssetSpec objects, or dicts with &#39;rid&#39; and optional &#39;cache&#39; keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">AssetSpec</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># Dict with rid/cache keys (e.g., from JSON config)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">DictConfig</span><span class="p">):</span>
                <span class="c1"># OmegaConf DictConfig from Hydra  may have rid+cache or just rid</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;rid&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Legacy DictConfig with just .rid attribute (AssetRID-style)</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">AssetRID</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">rid</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">v</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Unknown type  try string coercion</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_configuration</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionConfiguration</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates an ExecutionConfiguration from a JSON file.</span>

<span class="sd">        Loads and parses a JSON configuration file into an ExecutionConfiguration</span>
<span class="sd">        instance. The file should contain a valid configuration specification.</span>

<span class="sd">        Args:</span>
<span class="sd">            path: Path to JSON configuration file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ExecutionConfiguration: Loaded configuration instance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If JSON file is invalid or missing required fields.</span>
<span class="sd">            FileNotFoundError: If configuration file doesn&#39;t exist.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; config = ExecutionConfiguration.load_configuration(Path(&quot;config.json&quot;))</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Workflow: {config.workflow}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Datasets: {len(config.datasets)}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ExecutionConfiguration</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.ExecutionConfiguration.load_configuration" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_configuration</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_configuration</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionConfiguration</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates an ExecutionConfiguration from a JSON file.</p>
<p>Loads and parses a JSON configuration file into an ExecutionConfiguration
instance. The file should contain a valid configuration specification.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to JSON configuration file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ExecutionConfiguration</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="ExecutionConfiguration (deriva_ml.execution.execution_configuration.ExecutionConfiguration)" href="../execution_configuration/#deriva_ml.execution.execution_configuration.ExecutionConfiguration">ExecutionConfiguration</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Loaded configuration instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If JSON file is invalid or missing required fields.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="FileNotFoundError">FileNotFoundError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If configuration file doesn't exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>config = ExecutionConfiguration.load_configuration(Path("config.json"))
print(f"Workflow: {config.workflow}")
print(f"Datasets: {len(config.datasets)}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution_configuration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load_configuration</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExecutionConfiguration</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates an ExecutionConfiguration from a JSON file.</span>

<span class="sd">    Loads and parses a JSON configuration file into an ExecutionConfiguration</span>
<span class="sd">    instance. The file should contain a valid configuration specification.</span>

<span class="sd">    Args:</span>
<span class="sd">        path: Path to JSON configuration file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ExecutionConfiguration: Loaded configuration instance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If JSON file is invalid or missing required fields.</span>
<span class="sd">        FileNotFoundError: If configuration file doesn&#39;t exist.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; config = ExecutionConfiguration.load_configuration(Path(&quot;config.json&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Workflow: {config.workflow}&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Datasets: {len(config.datasets)}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ExecutionConfiguration</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.ExecutionConfiguration.validate_assets" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_assets</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_assets</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Normalize asset entries to AssetSpec objects.</p>
<p>Accepts plain RID strings, AssetRID objects, DictConfig from Hydra,
AssetSpec objects, or dicts with 'rid' and optional 'cache' keys.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/execution_configuration.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_assets</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize asset entries to AssetSpec objects.</span>

<span class="sd">    Accepts plain RID strings, AssetRID objects, DictConfig from Hydra,</span>
<span class="sd">    AssetSpec objects, or dicts with &#39;rid&#39; and optional &#39;cache&#39; keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">AssetSpec</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="c1"># Dict with rid/cache keys (e.g., from JSON config)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">DictConfig</span><span class="p">):</span>
            <span class="c1"># OmegaConf DictConfig from Hydra  may have rid+cache or just rid</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;rid&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Legacy DictConfig with just .rid attribute (AssetRID-style)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;cache&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">AssetRID</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">rid</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="n">v</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Unknown type  try string coercion</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssetSpec</span><span class="p">(</span><span class="n">rid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.MultirunSpec" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MultirunSpec</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Specification for a multirun experiment.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.MultirunSpec.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for this multirun configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.MultirunSpec.overrides">overrides</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of Hydra override strings (same syntax as command line).
Examples:
- "+experiment=cifar10_quick,cifar10_extended"
- "model_config.learning_rate=0.0001,0.001,0.01"
- "model_config.epochs=5,10,25,50"</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.MultirunSpec.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rich description for the parent execution. Supports full
markdown formatting (headers, tables, bold, etc.).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/multirun_config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultirunSpec</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Specification for a multirun experiment.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name: Unique identifier for this multirun configuration.</span>
<span class="sd">        overrides: List of Hydra override strings (same syntax as command line).</span>
<span class="sd">            Examples:</span>
<span class="sd">            - &quot;+experiment=cifar10_quick,cifar10_extended&quot;</span>
<span class="sd">            - &quot;model_config.learning_rate=0.0001,0.001,0.01&quot;</span>
<span class="sd">            - &quot;model_config.epochs=5,10,25,50&quot;</span>
<span class="sd">        description: Rich description for the parent execution. Supports full</span>
<span class="sd">            markdown formatting (headers, tables, bold, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.execution.Workflow" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Workflow</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>



        <p>Represents a computational workflow in DerivaML.</p>
<p>A workflow defines a computational process or analysis pipeline. Each workflow has
a unique identifier, source code location, and type. Workflows are typically
associated with Git repositories for version control.</p>
<p>When a Workflow is retrieved via <code>lookup_workflow(rid)</code> or <code>lookup_workflow_by_url()</code>,
it is bound to a catalog and its <code>description</code> and <code>workflow_type</code> properties become
writable. Setting these properties will update the catalog record. If the catalog is
read-only (a snapshot), attempting to set them will raise a <code>DerivaMLException</code>.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable name of the workflow.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.url">url</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URI to the workflow source code (typically a GitHub URL).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.workflow_type">workflow_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of workflow (must be a controlled vocabulary term).
When the workflow is bound to a writable catalog, setting this property
will update the catalog record. The new value must be a valid term from
the Workflow_Type vocabulary.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.version">version</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Version identifier (semantic versioning).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of workflow purpose and behavior.
When the workflow is bound to a writable catalog, setting this property
will update the catalog record.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.rid">rid</span></code></td>
            <td>
                  <code><span title="deriva_ml.core.definitions.RID">RID</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resource Identifier if registered in catalog.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.checksum">checksum</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Git hash of workflow source code.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.execution.Workflow.is_notebook">is_notebook</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether workflow is a Jupyter notebook.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>The recommended way to create a Workflow is via :meth:<code>DerivaML.create_workflow()
&lt;deriva_ml.DerivaML.create_workflow&gt;</code>, which validates the workflow type against
the catalog vocabulary::</p>
<pre><code>&gt;&gt;&gt; workflow = ml.create_workflow(
...     name="RNA Analysis",
...     workflow_type="python_notebook",
...     description="RNA sequence analysis"
... )
</code></pre>
</details>

<details class="example" open>
  <summary>Example</summary>
  <p>Create a workflow directly (without catalog validation)::</p>
<pre><code>&gt;&gt;&gt; workflow = Workflow(
...     name="RNA Analysis",
...     url="https://github.com/org/repo/analysis.ipynb",
...     workflow_type="python_notebook",
...     version="1.0.0",
...     description="RNA sequence analysis"
... )
</code></pre>
<p>Look up an existing workflow by RID and update its properties::</p>
<pre><code>&gt;&gt;&gt; workflow = ml.lookup_workflow("2-ABC1")
&gt;&gt;&gt; workflow.description = "Updated description for RNA analysis"
&gt;&gt;&gt; workflow.workflow_type = "python_script"
&gt;&gt;&gt; print(workflow.description)
Updated description for RNA analysis
</code></pre>
<p>Look up by URL and update::</p>
<pre><code>&gt;&gt;&gt; url = "https://github.com/org/repo/blob/abc123/analysis.py"
&gt;&gt;&gt; workflow = ml.lookup_workflow_by_url(url)
&gt;&gt;&gt; workflow.description = "New description"
</code></pre>
<p>Attempting to update on a read-only catalog raises an error::</p>
<pre><code>&gt;&gt;&gt; snapshot_ml = ml.catalog_snapshot("2023-01-15T10:30:00")
&gt;&gt;&gt; workflow = snapshot_ml.lookup_workflow("2-ABC1")
&gt;&gt;&gt; workflow.description = "New description"  # Raises DerivaMLException
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/execution/workflow.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Workflow</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a computational workflow in DerivaML.</span>

<span class="sd">    A workflow defines a computational process or analysis pipeline. Each workflow has</span>
<span class="sd">    a unique identifier, source code location, and type. Workflows are typically</span>
<span class="sd">    associated with Git repositories for version control.</span>

<span class="sd">    When a Workflow is retrieved via ``lookup_workflow(rid)`` or ``lookup_workflow_by_url()``,</span>
<span class="sd">    it is bound to a catalog and its ``description`` and ``workflow_type`` properties become</span>
<span class="sd">    writable. Setting these properties will update the catalog record. If the catalog is</span>
<span class="sd">    read-only (a snapshot), attempting to set them will raise a ``DerivaMLException``.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Human-readable name of the workflow.</span>
<span class="sd">        url (str): URI to the workflow source code (typically a GitHub URL).</span>
<span class="sd">        workflow_type (str): Type of workflow (must be a controlled vocabulary term).</span>
<span class="sd">            When the workflow is bound to a writable catalog, setting this property</span>
<span class="sd">            will update the catalog record. The new value must be a valid term from</span>
<span class="sd">            the Workflow_Type vocabulary.</span>
<span class="sd">        version (str | None): Version identifier (semantic versioning).</span>
<span class="sd">        description (str | None): Description of workflow purpose and behavior.</span>
<span class="sd">            When the workflow is bound to a writable catalog, setting this property</span>
<span class="sd">            will update the catalog record.</span>
<span class="sd">        rid (RID | None): Resource Identifier if registered in catalog.</span>
<span class="sd">        checksum (str | None): Git hash of workflow source code.</span>
<span class="sd">        is_notebook (bool): Whether workflow is a Jupyter notebook.</span>

<span class="sd">    Note:</span>
<span class="sd">        The recommended way to create a Workflow is via :meth:`DerivaML.create_workflow()</span>
<span class="sd">        &lt;deriva_ml.DerivaML.create_workflow&gt;`, which validates the workflow type against</span>
<span class="sd">        the catalog vocabulary::</span>

<span class="sd">            &gt;&gt;&gt; workflow = ml.create_workflow(</span>
<span class="sd">            ...     name=&quot;RNA Analysis&quot;,</span>
<span class="sd">            ...     workflow_type=&quot;python_notebook&quot;,</span>
<span class="sd">            ...     description=&quot;RNA sequence analysis&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">    Example:</span>
<span class="sd">        Create a workflow directly (without catalog validation)::</span>

<span class="sd">            &gt;&gt;&gt; workflow = Workflow(</span>
<span class="sd">            ...     name=&quot;RNA Analysis&quot;,</span>
<span class="sd">            ...     url=&quot;https://github.com/org/repo/analysis.ipynb&quot;,</span>
<span class="sd">            ...     workflow_type=&quot;python_notebook&quot;,</span>
<span class="sd">            ...     version=&quot;1.0.0&quot;,</span>
<span class="sd">            ...     description=&quot;RNA sequence analysis&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        Look up an existing workflow by RID and update its properties::</span>

<span class="sd">            &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; workflow.description = &quot;Updated description for RNA analysis&quot;</span>
<span class="sd">            &gt;&gt;&gt; workflow.workflow_type = &quot;python_script&quot;</span>
<span class="sd">            &gt;&gt;&gt; print(workflow.description)</span>
<span class="sd">            Updated description for RNA analysis</span>

<span class="sd">        Look up by URL and update::</span>

<span class="sd">            &gt;&gt;&gt; url = &quot;https://github.com/org/repo/blob/abc123/analysis.py&quot;</span>
<span class="sd">            &gt;&gt;&gt; workflow = ml.lookup_workflow_by_url(url)</span>
<span class="sd">            &gt;&gt;&gt; workflow.description = &quot;New description&quot;</span>

<span class="sd">        Attempting to update on a read-only catalog raises an error::</span>

<span class="sd">            &gt;&gt;&gt; snapshot_ml = ml.catalog_snapshot(&quot;2023-01-15T10:30:00&quot;)</span>
<span class="sd">            &gt;&gt;&gt; workflow = snapshot_ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; workflow.description = &quot;New description&quot;  # Raises DerivaMLException</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">workflow_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">rid</span><span class="p">:</span> <span class="n">RID</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">checksum</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">is_notebook</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">git_root</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_ml_instance</span><span class="p">:</span> <span class="s2">&quot;DerivaMLCatalog | None&quot;</span> <span class="o">=</span> <span class="n">PrivateAttr</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">_logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span> <span class="o">=</span> <span class="n">PrivateAttr</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override setattr to intercept description and workflow_type updates.</span>

<span class="sd">        When the workflow is bound to a catalog (via lookup_workflow), setting</span>
<span class="sd">        the ``description`` or ``workflow_type`` properties will update the catalog</span>
<span class="sd">        record. If the catalog is read-only (a snapshot), a DerivaMLException is raised.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The attribute name being set.</span>
<span class="sd">            value: The value to set.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If attempting to set properties on a read-only</span>
<span class="sd">                catalog (snapshot), or if workflow_type is not a valid vocabulary term.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Update description::</span>

<span class="sd">                &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">                &gt;&gt;&gt; workflow.description = &quot;Updated description&quot;</span>

<span class="sd">            Update workflow type::</span>

<span class="sd">                &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">                &gt;&gt;&gt; workflow.workflow_type = &quot;python_notebook&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Only intercept updates after full initialization</span>
        <span class="c1"># Use __dict__ check to avoid recursion during Pydantic model construction</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;__pydantic_private__&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__pydantic_private__&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_ml_instance&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_description_in_catalog</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;workflow_type&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_workflow_type_in_catalog</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_writable_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check that the catalog is writable and workflow is registered.</span>

<span class="sd">        Args:</span>
<span class="sd">            operation: Description of the operation being attempted.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If the workflow is not registered (no RID),</span>
<span class="sd">                or if the catalog is read-only (a snapshot).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Import here to avoid circular dependency at module load</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">importlib</span>
        <span class="n">_deriva_core</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;deriva.core&quot;</span><span class="p">)</span>
        <span class="n">ErmrestSnapshot</span> <span class="o">=</span> <span class="n">_deriva_core</span><span class="o">.</span><span class="n">ErmrestSnapshot</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">: Workflow is not registered in the catalog (no RID)&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span> <span class="n">ErmrestSnapshot</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2"> on a read-only catalog snapshot. &quot;</span>
                <span class="s2">&quot;Use a writable catalog connection instead.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_description_in_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the description field in the catalog.</span>

<span class="sd">        This internal method is called when the description property is set</span>
<span class="sd">        on a catalog-bound Workflow object.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_description: The new description value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If the workflow is not registered (no RID),</span>
<span class="sd">                or if the catalog is read-only (a snapshot).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_writable_catalog</span><span class="p">(</span><span class="s2">&quot;update description&quot;</span><span class="p">)</span>

        <span class="c1"># Update the catalog record</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">workflow_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Workflow</span>
        <span class="n">workflow_path</span><span class="o">.</span><span class="n">update</span><span class="p">([{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">:</span> <span class="n">new_description</span><span class="p">}])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_workflow_type_in_catalog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_workflow_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the workflow_type field in the catalog.</span>

<span class="sd">        This internal method is called when the workflow_type property is set</span>
<span class="sd">        on a catalog-bound Workflow object. The new workflow type must be a valid</span>
<span class="sd">        term from the Workflow_Type vocabulary.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_workflow_type: The new workflow type (must be a valid vocabulary term).</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If the workflow is not registered (no RID),</span>
<span class="sd">                the catalog is read-only (a snapshot), or the workflow_type</span>
<span class="sd">                is not a valid vocabulary term.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_writable_catalog</span><span class="p">(</span><span class="s2">&quot;update workflow_type&quot;</span><span class="p">)</span>

        <span class="c1"># Validate that the new workflow type exists in vocabulary</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.core.definitions</span><span class="w"> </span><span class="kn">import</span> <span class="n">MLVocab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">lookup_term</span><span class="p">(</span><span class="n">MLVocab</span><span class="o">.</span><span class="n">workflow_type</span><span class="p">,</span> <span class="n">new_workflow_type</span><span class="p">)</span>

        <span class="c1"># Update the catalog record</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">pathBuilder</span><span class="p">()</span>
        <span class="n">workflow_path</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_ml_instance</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">Workflow</span>
        <span class="n">workflow_path</span><span class="o">.</span><span class="n">update</span><span class="p">([{</span><span class="s2">&quot;RID&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="s2">&quot;Workflow_Type&quot;</span><span class="p">:</span> <span class="n">new_workflow_type</span><span class="p">}])</span>

    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_url_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a workflow from the current execution context.</span>

<span class="sd">        Identifies the currently executing program (script or notebook) and creates</span>
<span class="sd">        a workflow definition. Automatically determines the Git repository information</span>
<span class="sd">        and source code checksum.</span>

<span class="sd">        The behavior can be configured using environment variables:</span>
<span class="sd">            - DERIVA_ML_WORKFLOW_URL: Override the detected workflow URL</span>
<span class="sd">            - DERIVA_ML_WORKFLOW_CHECKSUM: Override the computed checksum</span>
<span class="sd">            - DERIVA_MCP_IN_DOCKER: Set to &quot;true&quot; to use Docker metadata instead of git</span>

<span class="sd">        Docker environment variables (used when DERIVA_MCP_IN_DOCKER=true):</span>
<span class="sd">            - DERIVA_MCP_VERSION: Semantic version of the Docker image</span>
<span class="sd">            - DERIVA_MCP_GIT_COMMIT: Git commit hash at build time</span>
<span class="sd">            - DERIVA_MCP_IMAGE_DIGEST: Docker image digest (unique identifier)</span>
<span class="sd">            - DERIVA_MCP_IMAGE_NAME: Docker image name (e.g., ghcr.io/org/repo)</span>

<span class="sd">        Args:</span>

<span class="sd">        Returns:</span>
<span class="sd">            Workflow: New workflow instance with detected Git information.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If not in a Git repository or detection fails (non-Docker).</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; workflow = Workflow.create_workflow(</span>
<span class="sd">            ...     name=&quot;Sample Analysis&quot;,</span>
<span class="sd">            ...     workflow_type=&quot;python_script&quot;,</span>
<span class="sd">            ...     description=&quot;Process sample data&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span>

        <span class="c1"># Check if running in Docker container (no git repo available)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_IN_DOCKER&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
            <span class="c1"># Use Docker image metadata for provenance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Use image digest as checksum (unique identifier for the container)</span>
            <span class="c1"># Fall back to git commit if digest not available</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_IMAGE_DIGEST&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_GIT_COMMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Build URL pointing to the Docker image or source repo</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
                <span class="n">image_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;DERIVA_MCP_IMAGE_NAME&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;ghcr.io/informatics-isi-edu/deriva-ml-mcp&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">image_digest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_IMAGE_DIGEST&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">image_digest</span><span class="p">:</span>
                    <span class="c1"># URL format: image@sha256:digest</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">image_digest</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Fall back to source repo with git commit</span>
                    <span class="n">source_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/informatics-isi-edu/deriva-ml-mcp&quot;</span>
                    <span class="n">git_commit</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_GIT_COMMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_url</span><span class="si">}</span><span class="s2">/commit/</span><span class="si">{</span><span class="n">git_commit</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">git_commit</span> <span class="k">else</span> <span class="n">source_url</span>

            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Check to see if execution file info is being passed in by calling program (notebook runner)</span>
        <span class="k">if</span> <span class="s2">&quot;DERIVA_ML_WORKFLOW_URL&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DERIVA_ML_WORKFLOW_URL&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_WORKFLOW_CHECKSUM&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">notebook_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_NOTEBOOK_PATH&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">notebook_path</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">git_root</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_git_root</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">notebook_path</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_notebook</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Standard git detection for local development</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_notebook</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_python_script</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">get_url_and_checksum</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">git_root</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_git_root</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">get_dynamic_version</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">git_root</span> <span class="ow">or</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_url_and_checksum</span><span class="p">(</span><span class="n">executable_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determines the Git URL and checksum for a file.</span>

<span class="sd">        Computes the Git repository URL and file checksum for the specified path.</span>
<span class="sd">        For notebooks, strips cell outputs before computing the checksum.</span>

<span class="sd">        Args:</span>
<span class="sd">            executable_path: Path to the workflow file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[str, str]: (GitHub URL, Git object hash)</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If not in a Git repository.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; url, checksum = Workflow.get_url_and_checksum(Path(&quot;analysis.ipynb&quot;))</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;URL: {url}&quot;)</span>
<span class="sd">            &gt;&gt;&gt; print(f&quot;Checksum: {checksum}&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="s2">&quot;git rev-parse --is-inside-work-tree&quot;</span><span class="p">,</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Not executing in a Git repository.&quot;</span><span class="p">)</span>

        <span class="n">github_url</span><span class="p">,</span> <span class="n">is_dirty</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_github_url</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_dirty</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2"> has been modified since last commit. Consider commiting before executing&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If you are in a notebook, strip out the outputs before computing the checksum.</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;nbstripout -t </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2"> | git hash-object --stdin&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;ipynb&quot;</span> <span class="o">==</span> <span class="n">executable_path</span><span class="o">.</span><span class="n">suffix</span>
            <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;git hash-object </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">checksum</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">cmd</span><span class="p">,</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">executable_path</span> <span class="o">!=</span> <span class="s2">&quot;REPL&quot;</span>
            <span class="k">else</span> <span class="s2">&quot;1&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">github_url</span><span class="p">,</span> <span class="n">checksum</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_git_root</span><span class="p">(</span><span class="n">executable_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the root directory of the Git repository.</span>

<span class="sd">        Args:</span>
<span class="sd">            executable_path: Path to check for Git repository.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str | None: Absolute path to repository root, or None if not in repository.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;--show-toplevel&quot;</span><span class="p">],</span>
                <span class="n">cwd</span><span class="o">=</span><span class="n">executable_path</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">DEVNULL</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Not in a git repository</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_check_nbstrip_status</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if nbstripout is installed and configured.</span>

<span class="sd">        Verifies that the nbstripout tool is available and properly installed in the</span>
<span class="sd">        Git repository. Issues warnings if setup is incomplete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;nbstripout&quot;</span><span class="p">,</span> <span class="s2">&quot;--is-installed&quot;</span><span class="p">],</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">returncode</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;nbstripout is not installed in repository. Please run nbstripout --install&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="ne">FileNotFoundError</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;nbstripout is not found. Please install it with: pip install nbstripout&quot;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_notebook_path</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Gets the path of the currently executing notebook.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Path | None: Absolute path to current notebook, or None if not in notebook.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">server</span><span class="p">,</span> <span class="n">session</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_notebook_session</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">server</span> <span class="ow">and</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">relative_path</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s2">&quot;notebook&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
            <span class="c1"># Join the notebook directory with the relative path</span>
            <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">server</span><span class="p">[</span><span class="s2">&quot;root_dir&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">relative_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_notebook_session</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the absolute path of the current notebook.&quot;&quot;&quot;</span>
        <span class="c1"># Get the kernel&#39;s connection file and extract the kernel ID</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">connection_file</span> <span class="o">:=</span> <span class="n">Path</span><span class="p">(</span><span class="n">get_kernel_connection</span><span class="p">())</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Extract kernel ID from connection filename.</span>
        <span class="c1"># Standard Jupyter format: &quot;kernel-&lt;kernel_id&gt;.json&quot;</span>
        <span class="c1"># PyCharm/other formats may vary: &quot;&lt;kernel_id&gt;.json&quot; or other patterns</span>
        <span class="n">kernel_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">connection_file</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;kernel-&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">connection_file</span><span class="p">:</span>
            <span class="c1"># Standard format: kernel-&lt;uuid&gt;.json</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">connection_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">kernel_id</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fallback: assume filename (without extension) is the kernel ID</span>
            <span class="n">kernel_id</span> <span class="o">=</span> <span class="n">connection_file</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kernel_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Look through the running server sessions to find the matching kernel ID</span>
        <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">get_servers</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If a token is required for authentication, include it in headers</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
                    <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sessions_url</span> <span class="o">=</span> <span class="n">server</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;api/sessions&quot;</span>
                    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sessions_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
                    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                    <span class="n">sessions</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">e</span>
                <span class="k">for</span> <span class="n">sess</span> <span class="ow">in</span> <span class="n">sessions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">sess</span><span class="p">[</span><span class="s2">&quot;kernel&quot;</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">kernel_id</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">server</span><span class="p">,</span> <span class="n">sess</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">_e</span><span class="p">:</span>
                <span class="c1"># Ignore servers we can&#39;t connect to.</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_in_repl</span><span class="p">():</span>
        <span class="c1"># Standard Python interactive mode</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s2">&quot;ps1&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Interactive mode forced by -i</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">interactive</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># IPython / Jupyter detection</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">IPython</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_ipython</span>

            <span class="k">if</span> <span class="n">get_ipython</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_get_python_script</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the path to the currently executing script&quot;&quot;&quot;</span>
        <span class="n">is_notebook</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_notebook_path</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">_get_calling_module</span><span class="p">()),</span> <span class="n">is_notebook</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_github_url</span><span class="p">(</span><span class="n">executable_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a GitHub URL for the latest commit of the script from which this routine is called.</span>

<span class="sd">        This routine is used to be called from a script or notebook (e.g., python -m file). It assumes that</span>
<span class="sd">        the file is in a GitHub repository and committed.  It returns a URL to the last commited version of this</span>
<span class="sd">        file in GitHub.</span>

<span class="sd">        Returns: A tuple with the gethub_url and a boolean to indicate if uncommited changes</span>
<span class="sd">            have been made to the file.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Get repo URL from local GitHub repo.</span>
        <span class="k">if</span> <span class="n">executable_path</span> <span class="o">==</span> <span class="s2">&quot;REPL&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;REPL&quot;</span><span class="p">,</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;remote&quot;</span><span class="p">,</span> <span class="s2">&quot;get-url&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">],</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">cwd</span><span class="o">=</span><span class="n">executable_path</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">github_url</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">removesuffix</span><span class="p">(</span><span class="s2">&quot;.git&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;No GIT remote found&quot;</span><span class="p">)</span>

        <span class="c1"># Find the root directory for the repository</span>
        <span class="n">repo_root</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_git_root</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>

        <span class="c1"># Now check to see if a file has been modified since the last commit.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;--porcelain&quot;</span><span class="p">],</span>
                <span class="n">cwd</span><span class="o">=</span><span class="n">executable_path</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">is_dirty</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="s2">&quot;M &quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>  <span class="c1"># Returns True if the output indicates a modified file</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="n">is_dirty</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># If the Git command fails, assume no changes</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get SHA-1 hash of latest commit of the file in the repository&quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;--pretty=format:%H&quot;</span><span class="p">,</span> <span class="n">executable_path</span><span class="p">],</span>
            <span class="n">cwd</span><span class="o">=</span><span class="n">repo_root</span><span class="p">,</span>
            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">sha</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">github_url</span><span class="si">}</span><span class="s2">/blob/</span><span class="si">{</span><span class="n">sha</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">executable_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">repo_root</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">url</span><span class="p">,</span> <span class="n">is_dirty</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_dynamic_version</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dynamic version string based on VCS state (setuptools_scm),</span>
<span class="sd">        including dirty/uncommitted changes if configured.</span>

<span class="sd">        Works under uv / Python 3.10+ by forcing setuptools to use stdlib distutils.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1) Tell setuptools to use stdlib distutils (or no override) to avoid</span>
        <span class="c1">#    the &#39;_distutils_hack&#39; assertion you hit.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;SETUPTOOLS_USE_DISTUTILS&quot;</span><span class="p">,</span> <span class="s2">&quot;stdlib&quot;</span><span class="p">)</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
            <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;_distutils_hack&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">setuptools_scm</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_version</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># ImportError or anything environment-specific</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;setuptools_scm is not available: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Adjust this to point at your repo root if needed</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">get_version</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Workflow.__setattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__setattr__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__setattr__</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Override setattr to intercept description and workflow_type updates.</p>
<p>When the workflow is bound to a catalog (via lookup_workflow), setting
the <code>description</code> or <code>workflow_type</code> properties will update the catalog
record. If the catalog is read-only (a snapshot), a DerivaMLException is raised.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The attribute name being set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If attempting to set properties on a read-only
catalog (snapshot), or if workflow_type is not a valid vocabulary term.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Update description::</p>
<pre><code>&gt;&gt;&gt; workflow = ml.lookup_workflow("2-ABC1")
&gt;&gt;&gt; workflow.description = "Updated description"
</code></pre>
<p>Update workflow type::</p>
<pre><code>&gt;&gt;&gt; workflow = ml.lookup_workflow("2-ABC1")
&gt;&gt;&gt; workflow.workflow_type = "python_notebook"
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Override setattr to intercept description and workflow_type updates.</span>

<span class="sd">    When the workflow is bound to a catalog (via lookup_workflow), setting</span>
<span class="sd">    the ``description`` or ``workflow_type`` properties will update the catalog</span>
<span class="sd">    record. If the catalog is read-only (a snapshot), a DerivaMLException is raised.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The attribute name being set.</span>
<span class="sd">        value: The value to set.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If attempting to set properties on a read-only</span>
<span class="sd">            catalog (snapshot), or if workflow_type is not a valid vocabulary term.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Update description::</span>

<span class="sd">            &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; workflow.description = &quot;Updated description&quot;</span>

<span class="sd">        Update workflow type::</span>

<span class="sd">            &gt;&gt;&gt; workflow = ml.lookup_workflow(&quot;2-ABC1&quot;)</span>
<span class="sd">            &gt;&gt;&gt; workflow.workflow_type = &quot;python_notebook&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Only intercept updates after full initialization</span>
    <span class="c1"># Use __dict__ check to avoid recursion during Pydantic model construction</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="s2">&quot;__pydantic_private__&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;__pydantic_private__&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_ml_instance&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_description_in_catalog</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;workflow_type&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_workflow_type_in_catalog</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Workflow.get_dynamic_version" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_dynamic_version</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_dynamic_version</span><span class="p">(</span>
    <span class="n">root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a dynamic version string based on VCS state (setuptools_scm),
including dirty/uncommitted changes if configured.</p>
<p>Works under uv / Python 3.10+ by forcing setuptools to use stdlib distutils.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_dynamic_version</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dynamic version string based on VCS state (setuptools_scm),</span>
<span class="sd">    including dirty/uncommitted changes if configured.</span>

<span class="sd">    Works under uv / Python 3.10+ by forcing setuptools to use stdlib distutils.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1) Tell setuptools to use stdlib distutils (or no override) to avoid</span>
    <span class="c1">#    the &#39;_distutils_hack&#39; assertion you hit.</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;SETUPTOOLS_USE_DISTUTILS&quot;</span><span class="p">,</span> <span class="s2">&quot;stdlib&quot;</span><span class="p">)</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span>
        <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
        <span class="n">module</span><span class="o">=</span><span class="s2">&quot;_distutils_hack&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">setuptools_scm</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_version</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  <span class="c1"># ImportError or anything environment-specific</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;setuptools_scm is not available: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Adjust this to point at your repo root if needed</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">get_version</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Workflow.get_url_and_checksum" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_url_and_checksum</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_url_and_checksum</span><span class="p">(</span>
    <span class="n">executable_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Determines the Git URL and checksum for a file.</p>
<p>Computes the Git repository URL and file checksum for the specified path.
For notebooks, strips cell outputs before computing the checksum.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>executable_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the workflow file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[str, str]: (GitHub URL, Git object hash)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not in a Git repository.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>url, checksum = Workflow.get_url_and_checksum(Path("analysis.ipynb"))
print(f"URL: {url}")
print(f"Checksum: {checksum}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_url_and_checksum</span><span class="p">(</span><span class="n">executable_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines the Git URL and checksum for a file.</span>

<span class="sd">    Computes the Git repository URL and file checksum for the specified path.</span>
<span class="sd">    For notebooks, strips cell outputs before computing the checksum.</span>

<span class="sd">    Args:</span>
<span class="sd">        executable_path: Path to the workflow file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple[str, str]: (GitHub URL, Git object hash)</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If not in a Git repository.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; url, checksum = Workflow.get_url_and_checksum(Path(&quot;analysis.ipynb&quot;))</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;URL: {url}&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;Checksum: {checksum}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="s2">&quot;git rev-parse --is-inside-work-tree&quot;</span><span class="p">,</span>
            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Not executing in a Git repository.&quot;</span><span class="p">)</span>

    <span class="n">github_url</span><span class="p">,</span> <span class="n">is_dirty</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_github_url</span><span class="p">(</span><span class="n">executable_path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_dirty</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2"> has been modified since last commit. Consider commiting before executing&quot;</span>
        <span class="p">)</span>

    <span class="c1"># If you are in a notebook, strip out the outputs before computing the checksum.</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;nbstripout -t </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2"> | git hash-object --stdin&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;ipynb&quot;</span> <span class="o">==</span> <span class="n">executable_path</span><span class="o">.</span><span class="n">suffix</span>
        <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;git hash-object </span><span class="si">{</span><span class="n">executable_path</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="n">cmd</span><span class="p">,</span>
            <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">executable_path</span> <span class="o">!=</span> <span class="s2">&quot;REPL&quot;</span>
        <span class="k">else</span> <span class="s2">&quot;1&quot;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">github_url</span><span class="p">,</span> <span class="n">checksum</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.execution.Workflow.setup_url_checksum" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">setup_url_checksum</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">setup_url_checksum</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="s1">&#39;Workflow&#39;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Creates a workflow from the current execution context.</p>
<p>Identifies the currently executing program (script or notebook) and creates
a workflow definition. Automatically determines the Git repository information
and source code checksum.</p>


<details class="the-behavior-can-be-configured-using-environment-variables" open>
  <summary>The behavior can be configured using environment variables</summary>
  <ul>
<li>DERIVA_ML_WORKFLOW_URL: Override the detected workflow URL</li>
<li>DERIVA_ML_WORKFLOW_CHECKSUM: Override the computed checksum</li>
<li>DERIVA_MCP_IN_DOCKER: Set to "true" to use Docker metadata instead of git</li>
</ul>
</details>        <p>Docker environment variables (used when DERIVA_MCP_IN_DOCKER=true):
    - DERIVA_MCP_VERSION: Semantic version of the Docker image
    - DERIVA_MCP_GIT_COMMIT: Git commit hash at build time
    - DERIVA_MCP_IMAGE_DIGEST: Docker image digest (unique identifier)
    - DERIVA_MCP_IMAGE_NAME: Docker image name (e.g., ghcr.io/org/repo)</p>
<p>Args:</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Workflow</code></td>            <td>
                  <code>&#39;Workflow&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New workflow instance with detected Git information.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If not in a Git repository or detection fails (non-Docker).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>workflow = Workflow.create_workflow(
...     name="Sample Analysis",
...     workflow_type="python_script",
...     description="Process sample data"
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/workflow.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">setup_url_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a workflow from the current execution context.</span>

<span class="sd">    Identifies the currently executing program (script or notebook) and creates</span>
<span class="sd">    a workflow definition. Automatically determines the Git repository information</span>
<span class="sd">    and source code checksum.</span>

<span class="sd">    The behavior can be configured using environment variables:</span>
<span class="sd">        - DERIVA_ML_WORKFLOW_URL: Override the detected workflow URL</span>
<span class="sd">        - DERIVA_ML_WORKFLOW_CHECKSUM: Override the computed checksum</span>
<span class="sd">        - DERIVA_MCP_IN_DOCKER: Set to &quot;true&quot; to use Docker metadata instead of git</span>

<span class="sd">    Docker environment variables (used when DERIVA_MCP_IN_DOCKER=true):</span>
<span class="sd">        - DERIVA_MCP_VERSION: Semantic version of the Docker image</span>
<span class="sd">        - DERIVA_MCP_GIT_COMMIT: Git commit hash at build time</span>
<span class="sd">        - DERIVA_MCP_IMAGE_DIGEST: Docker image digest (unique identifier)</span>
<span class="sd">        - DERIVA_MCP_IMAGE_NAME: Docker image name (e.g., ghcr.io/org/repo)</span>

<span class="sd">    Args:</span>

<span class="sd">    Returns:</span>
<span class="sd">        Workflow: New workflow instance with detected Git information.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If not in a Git repository or detection fails (non-Docker).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; workflow = Workflow.create_workflow(</span>
<span class="sd">        ...     name=&quot;Sample Analysis&quot;,</span>
<span class="sd">        ...     workflow_type=&quot;python_script&quot;,</span>
<span class="sd">        ...     description=&quot;Process sample data&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">)</span>

    <span class="c1"># Check if running in Docker container (no git repo available)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_IN_DOCKER&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
        <span class="c1"># Use Docker image metadata for provenance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_VERSION&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Use image digest as checksum (unique identifier for the container)</span>
        <span class="c1"># Fall back to git commit if digest not available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_IMAGE_DIGEST&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_GIT_COMMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Build URL pointing to the Docker image or source repo</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;DERIVA_MCP_IMAGE_NAME&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ghcr.io/informatics-isi-edu/deriva-ml-mcp&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">image_digest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_IMAGE_DIGEST&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">image_digest</span><span class="p">:</span>
                <span class="c1"># URL format: image@sha256:digest</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">image_digest</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Fall back to source repo with git commit</span>
                <span class="n">source_url</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/informatics-isi-edu/deriva-ml-mcp&quot;</span>
                <span class="n">git_commit</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_MCP_GIT_COMMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">source_url</span><span class="si">}</span><span class="s2">/commit/</span><span class="si">{</span><span class="n">git_commit</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">git_commit</span> <span class="k">else</span> <span class="n">source_url</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># Check to see if execution file info is being passed in by calling program (notebook runner)</span>
    <span class="k">if</span> <span class="s2">&quot;DERIVA_ML_WORKFLOW_URL&quot;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DERIVA_ML_WORKFLOW_URL&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_WORKFLOW_CHECKSUM&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">notebook_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_NOTEBOOK_PATH&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">notebook_path</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">git_root</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_git_root</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">notebook_path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_notebook</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># Standard git detection for local development</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
        <span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_notebook</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_python_script</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">checksum</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">get_url_and_checksum</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">git_root</span> <span class="o">=</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">_get_git_root</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="n">Workflow</span><span class="o">.</span><span class="n">get_dynamic_version</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">git_root</span> <span class="ow">or</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()))</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.__getattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__getattr__</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Lazy import to avoid circular dependencies.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lazy import to avoid circular dependencies.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Execution&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.execution.execution</span><span class="w"> </span><span class="kn">import</span> <span class="n">Execution</span>

        <span class="k">return</span> <span class="n">Execution</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;module </span><span class="si">{</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> has no attribute </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.create_model_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_model_config</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">create_model_config</span><span class="p">(</span>
    <span class="n">ml_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;DerivaML&quot;</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Model execution&quot;</span><span class="p">,</span>
    <span class="n">hydra_defaults</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a hydra-zen configuration for run_model.</p>
<p>This helper creates a properly configured hydra-zen builds() for run_model
with the specified DerivaML class bound via partial application.</p>
<h4 id="deriva_ml.execution.create_model_config--parameters">Parameters</h4>
<p>ml_class : type[DerivaML], optional
    The DerivaML class (or subclass) to use. If None, uses the base DerivaML.</p>


<details class="description-" open>
  <summary>str, optional</summary>
  <p>Default description for executions. Can be overridden at runtime.</p>
</details>

<details class="hydra_defaults-" open>
  <summary>list, optional</summary>
  <p>Custom hydra defaults. If None, uses standard defaults for deriva_ml,
datasets, assets, workflow, and model_config groups.</p>
</details>        <h4 id="deriva_ml.execution.create_model_config--returns">Returns</h4>
<p>Any
    A hydra-zen builds() configuration ready to be registered with store().</p>
<h4 id="deriva_ml.execution.create_model_config--examples">Examples</h4>
<p>Basic usage with DerivaML:</p>
<pre><code>&gt;&gt;&gt; from deriva_ml.execution.runner import create_model_config
&gt;&gt;&gt; model_config = create_model_config()
&gt;&gt;&gt; store(model_config, name="deriva_model")
</code></pre>
<p>With a custom subclass:</p>
<pre><code>&gt;&gt;&gt; from eye_ai import EyeAI
&gt;&gt;&gt; model_config = create_model_config(EyeAI, description="EyeAI analysis")
&gt;&gt;&gt; store(model_config, name="eyeai_model")
</code></pre>
<p>With custom hydra defaults:</p>
<pre><code>&gt;&gt;&gt; model_config = create_model_config(
...     hydra_defaults=[
...         "_self_",
...         {"deriva_ml": "production"},
...         {"datasets": "full_dataset"},
...     ]
... )
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_model_config</span><span class="p">(</span>
    <span class="n">ml_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;DerivaML&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Model execution&quot;</span><span class="p">,</span>
    <span class="n">hydra_defaults</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a hydra-zen configuration for run_model.</span>

<span class="sd">    This helper creates a properly configured hydra-zen builds() for run_model</span>
<span class="sd">    with the specified DerivaML class bound via partial application.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ml_class : type[DerivaML], optional</span>
<span class="sd">        The DerivaML class (or subclass) to use. If None, uses the base DerivaML.</span>

<span class="sd">    description : str, optional</span>
<span class="sd">        Default description for executions. Can be overridden at runtime.</span>

<span class="sd">    hydra_defaults : list, optional</span>
<span class="sd">        Custom hydra defaults. If None, uses standard defaults for deriva_ml,</span>
<span class="sd">        datasets, assets, workflow, and model_config groups.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Any</span>
<span class="sd">        A hydra-zen builds() configuration ready to be registered with store().</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Basic usage with DerivaML:</span>

<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution.runner import create_model_config</span>
<span class="sd">        &gt;&gt;&gt; model_config = create_model_config()</span>
<span class="sd">        &gt;&gt;&gt; store(model_config, name=&quot;deriva_model&quot;)</span>

<span class="sd">    With a custom subclass:</span>

<span class="sd">        &gt;&gt;&gt; from eye_ai import EyeAI</span>
<span class="sd">        &gt;&gt;&gt; model_config = create_model_config(EyeAI, description=&quot;EyeAI analysis&quot;)</span>
<span class="sd">        &gt;&gt;&gt; store(model_config, name=&quot;eyeai_model&quot;)</span>

<span class="sd">    With custom hydra defaults:</span>

<span class="sd">        &gt;&gt;&gt; model_config = create_model_config(</span>
<span class="sd">        ...     hydra_defaults=[</span>
<span class="sd">        ...         &quot;_self_&quot;,</span>
<span class="sd">        ...         {&quot;deriva_ml&quot;: &quot;production&quot;},</span>
<span class="sd">        ...         {&quot;datasets&quot;: &quot;full_dataset&quot;},</span>
<span class="sd">        ...     ]</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

    <span class="k">if</span> <span class="n">hydra_defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hydra_defaults</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;_self_&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;deriva_ml&quot;</span><span class="p">:</span> <span class="s2">&quot;default_deriva&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;datasets&quot;</span><span class="p">:</span> <span class="s2">&quot;default_dataset&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;assets&quot;</span><span class="p">:</span> <span class="s2">&quot;default_asset&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;workflow&quot;</span><span class="p">:</span> <span class="s2">&quot;default_workflow&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;model_config&quot;</span><span class="p">:</span> <span class="s2">&quot;default_model&quot;</span><span class="p">},</span>
        <span class="p">]</span>

    <span class="c1"># Create a partial function with ml_class bound</span>
    <span class="k">if</span> <span class="n">ml_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">run_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">run_model</span><span class="p">,</span> <span class="n">ml_class</span><span class="o">=</span><span class="n">ml_class</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">run_func</span> <span class="o">=</span> <span class="n">run_model</span>

    <span class="k">return</span> <span class="n">builds</span><span class="p">(</span>
        <span class="n">run_func</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
        <span class="n">populate_full_signature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">hydra_defaults</span><span class="o">=</span><span class="n">hydra_defaults</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.get_all_multirun_configs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_all_multirun_configs</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_all_multirun_configs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span>
    <span class="nb">str</span><span class="p">,</span> <span class="n">MultirunSpec</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all registered multirun configurations.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <a class="autorefs autorefs-internal" title="MultirunSpec


  
      dataclass
   (deriva_ml.execution.multirun_config.MultirunSpec)" href="#deriva_ml.execution.MultirunSpec">MultirunSpec</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary mapping names to MultirunSpec instances.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/multirun_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_multirun_configs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">MultirunSpec</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all registered multirun configurations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary mapping names to MultirunSpec instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">_multirun_registry</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.get_multirun_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_multirun_config</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_multirun_config</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultirunSpec</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Look up a registered multirun configuration by name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the multirun configuration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="MultirunSpec


  
      dataclass
   (deriva_ml.execution.multirun_config.MultirunSpec)" href="#deriva_ml.execution.MultirunSpec">MultirunSpec</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The MultirunSpec if found, None otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/multirun_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_multirun_config</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultirunSpec</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look up a registered multirun configuration by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the multirun configuration.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The MultirunSpec if found, None otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_multirun_registry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.get_notebook_configuration" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_notebook_configuration</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_notebook_configuration</span><span class="p">(</span>
    <span class="n">config_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
    <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">job_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;notebook&quot;</span><span class="p">,</span>
    <span class="n">version_base</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.3&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load and return a hydra-zen configuration for use in notebooks.</p>
<p>This function is the notebook equivalent of <code>run_model</code>. While <code>run_model</code>
launches a full execution with model training, <code>get_notebook_configuration</code>
simply resolves the configuration and returns it for interactive use.</p>
<p>The function handles:
- Adding configurations to the hydra store
- Launching hydra-zen to resolve defaults and overrides
- Returning the instantiated configuration object</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_class</code>
            </td>
            <td>
                  <code><span title="type">type</span>[<span title="deriva_ml.execution.base_config.T">T</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The hydra-zen builds() class for the configuration.
This should be a class created with <code>builds(YourConfig, ...)</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the configuration in the hydra store.
Must match the name used when calling <code>store(config_class, name=...)</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of Hydra override strings (e.g., ["param=value"]).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>job_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name for the Hydra job (default: "notebook").</p>
              </div>
            </td>
            <td>
                  <code>&#39;notebook&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>version_base</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hydra version base (default: "1.3").</p>
              </div>
            </td>
            <td>
                  <code>&#39;1.3&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.execution.base_config.T">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instantiated configuration object with all defaults resolved.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>In your notebook's configuration module (e.g., <code>configs/roc_analysis.py</code>):</p>
<blockquote>
<blockquote>
<blockquote>
<p>from dataclasses import dataclass, field
from hydra_zen import builds, store
from deriva_ml.execution import BaseConfig</p>
<p>@dataclass
... class ROCAnalysisConfig(BaseConfig):
...     execution_rids: list[str] = field(default_factory=list)</p>
<p>ROCAnalysisConfigBuilds = builds(
...     ROCAnalysisConfig,
...     populate_full_signature=True,
...     hydra_defaults=["<em>self</em>", {"deriva_ml": "default_deriva"}],
... )
store(ROCAnalysisConfigBuilds, name="roc_analysis")</p>
</blockquote>
</blockquote>
</blockquote>
<p>In your notebook:</p>
<blockquote>
<blockquote>
<blockquote>
<p>from configs import load_all_configs
from configs.roc_analysis import ROCAnalysisConfigBuilds
from deriva_ml.execution import get_notebook_configuration</p>
<h3 id="deriva_ml.execution.get_notebook_configuration--load-all-project-configs-into-hydra-store">Load all project configs into hydra store</h3>
<p>load_all_configs()</p>
<h3 id="deriva_ml.execution.get_notebook_configuration--get-resolved-configuration">Get resolved configuration</h3>
<p>config = get_notebook_configuration(
...     ROCAnalysisConfigBuilds,
...     config_name="roc_analysis",
...     overrides=["execution_rids=[3JRC,3KT0]"],
... )</p>
<h3 id="deriva_ml.execution.get_notebook_configuration--use-the-configuration">Use the configuration</h3>
<p>print(config.execution_rids)  # ['3JRC', '3KT0']
print(config.deriva_ml.hostname)  # From default_deriva config</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="environment-variables" open>
  <summary>Environment Variables</summary>
  <p>DERIVA_ML_HYDRA_OVERRIDES: JSON-encoded list of override strings.
    When running via <code>deriva-ml-run-notebook</code>, this is automatically
    set from command-line arguments. Overrides from this environment
    variable are applied first, then any overrides passed directly
    to this function are applied (taking precedence).</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_notebook_configuration</span><span class="p">(</span>
    <span class="n">config_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
    <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">job_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;notebook&quot;</span><span class="p">,</span>
    <span class="n">version_base</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1.3&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load and return a hydra-zen configuration for use in notebooks.</span>

<span class="sd">    This function is the notebook equivalent of `run_model`. While `run_model`</span>
<span class="sd">    launches a full execution with model training, `get_notebook_configuration`</span>
<span class="sd">    simply resolves the configuration and returns it for interactive use.</span>

<span class="sd">    The function handles:</span>
<span class="sd">    - Adding configurations to the hydra store</span>
<span class="sd">    - Launching hydra-zen to resolve defaults and overrides</span>
<span class="sd">    - Returning the instantiated configuration object</span>

<span class="sd">    Args:</span>
<span class="sd">        config_class: The hydra-zen builds() class for the configuration.</span>
<span class="sd">            This should be a class created with `builds(YourConfig, ...)`.</span>
<span class="sd">        config_name: Name of the configuration in the hydra store.</span>
<span class="sd">            Must match the name used when calling `store(config_class, name=...)`.</span>
<span class="sd">        overrides: Optional list of Hydra override strings (e.g., [&quot;param=value&quot;]).</span>
<span class="sd">        job_name: Name for the Hydra job (default: &quot;notebook&quot;).</span>
<span class="sd">        version_base: Hydra version base (default: &quot;1.3&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The instantiated configuration object with all defaults resolved.</span>

<span class="sd">    Example:</span>
<span class="sd">        In your notebook&#39;s configuration module (e.g., `configs/roc_analysis.py`):</span>

<span class="sd">        &gt;&gt;&gt; from dataclasses import dataclass, field</span>
<span class="sd">        &gt;&gt;&gt; from hydra_zen import builds, store</span>
<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution import BaseConfig</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; @dataclass</span>
<span class="sd">        ... class ROCAnalysisConfig(BaseConfig):</span>
<span class="sd">        ...     execution_rids: list[str] = field(default_factory=list)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; ROCAnalysisConfigBuilds = builds(</span>
<span class="sd">        ...     ROCAnalysisConfig,</span>
<span class="sd">        ...     populate_full_signature=True,</span>
<span class="sd">        ...     hydra_defaults=[&quot;_self_&quot;, {&quot;deriva_ml&quot;: &quot;default_deriva&quot;}],</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; store(ROCAnalysisConfigBuilds, name=&quot;roc_analysis&quot;)</span>

<span class="sd">        In your notebook:</span>

<span class="sd">        &gt;&gt;&gt; from configs import load_all_configs</span>
<span class="sd">        &gt;&gt;&gt; from configs.roc_analysis import ROCAnalysisConfigBuilds</span>
<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution import get_notebook_configuration</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Load all project configs into hydra store</span>
<span class="sd">        &gt;&gt;&gt; load_all_configs()</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Get resolved configuration</span>
<span class="sd">        &gt;&gt;&gt; config = get_notebook_configuration(</span>
<span class="sd">        ...     ROCAnalysisConfigBuilds,</span>
<span class="sd">        ...     config_name=&quot;roc_analysis&quot;,</span>
<span class="sd">        ...     overrides=[&quot;execution_rids=[3JRC,3KT0]&quot;],</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Use the configuration</span>
<span class="sd">        &gt;&gt;&gt; print(config.execution_rids)  # [&#39;3JRC&#39;, &#39;3KT0&#39;]</span>
<span class="sd">        &gt;&gt;&gt; print(config.deriva_ml.hostname)  # From default_deriva config</span>

<span class="sd">    Environment Variables:</span>
<span class="sd">        DERIVA_ML_HYDRA_OVERRIDES: JSON-encoded list of override strings.</span>
<span class="sd">            When running via `deriva-ml-run-notebook`, this is automatically</span>
<span class="sd">            set from command-line arguments. Overrides from this environment</span>
<span class="sd">            variable are applied first, then any overrides passed directly</span>
<span class="sd">            to this function are applied (taking precedence).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure configs are in the hydra store</span>
    <span class="n">store</span><span class="o">.</span><span class="n">add_to_hydra_store</span><span class="p">(</span><span class="n">overwrite_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Collect overrides from environment variable (set by run_notebook CLI)</span>
    <span class="n">env_overrides_json</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DERIVA_ML_HYDRA_OVERRIDES&quot;</span><span class="p">)</span>
    <span class="n">env_overrides</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">env_overrides_json</span><span class="p">)</span> <span class="k">if</span> <span class="n">env_overrides_json</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="c1"># Merge overrides: env overrides first, then explicit overrides (higher precedence)</span>
    <span class="n">all_overrides</span> <span class="o">=</span> <span class="n">env_overrides</span> <span class="o">+</span> <span class="p">(</span><span class="n">overrides</span> <span class="ow">or</span> <span class="p">[])</span>

    <span class="c1"># Variables to capture from within the task function</span>
    <span class="n">captured_choices</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">captured_output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Define a task function that instantiates and returns the config</span>
    <span class="c1"># The cfg from launch() is an OmegaConf DictConfig, so we need to</span>
    <span class="c1"># use hydra_zen.instantiate() to convert it to actual Python objects</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">return_instantiated_config</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="k">nonlocal</span> <span class="n">captured_choices</span><span class="p">,</span> <span class="n">captured_output_dir</span>
        <span class="c1"># Capture the Hydra runtime choices (which config names were selected)</span>
        <span class="c1"># and runtime output directory (for uploading hydra config files)</span>
        <span class="c1"># Filter out None values (some Hydra internal groups have None choices)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">hydra.core.hydra_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">HydraConfig</span>
            <span class="n">hydra_cfg</span> <span class="o">=</span> <span class="n">HydraConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="n">hydra_cfg</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">choices</span>
            <span class="n">captured_choices</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">choices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
            <span class="n">captured_output_dir</span> <span class="o">=</span> <span class="n">hydra_cfg</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">output_dir</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># If HydraConfig is not available, leave choices empty</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">instantiate</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="c1"># Launch hydra-zen to resolve the configuration</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">launch</span><span class="p">(</span>
        <span class="n">config_class</span><span class="p">,</span>
        <span class="n">return_instantiated_config</span><span class="p">,</span>
        <span class="n">version_base</span><span class="o">=</span><span class="n">version_base</span><span class="p">,</span>
        <span class="n">config_name</span><span class="o">=</span><span class="n">config_name</span><span class="p">,</span>
        <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
        <span class="n">overrides</span><span class="o">=</span><span class="n">all_overrides</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Inject the captured choices into the config object</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">return_value</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;config_choices&quot;</span><span class="p">):</span>
        <span class="n">config</span><span class="o">.</span><span class="n">config_choices</span> <span class="o">=</span> <span class="n">captured_choices</span>

    <span class="c1"># Store the hydra output dir in module-level variable for run_notebook() to use.</span>
    <span class="c1"># This is NOT stored on the config because it&#39;s a runtime artifact, not a</span>
    <span class="c1"># configuration parameter, and adding it to the structured config causes</span>
    <span class="c1"># Hydra OmegaConf composition errors.</span>
    <span class="k">global</span> <span class="n">_captured_hydra_output_dir</span>
    <span class="n">_captured_hydra_output_dir</span> <span class="o">=</span> <span class="n">captured_output_dir</span>

    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.list_multirun_configs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_multirun_configs</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_multirun_configs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all registered multirun configuration names.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of registered multirun config names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/multirun_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_multirun_configs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all registered multirun configuration names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of registered multirun config names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">_multirun_registry</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.load_configs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_configs</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_configs</span><span class="p">(</span>
    <span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;configs&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Dynamically import all configuration modules from a package.</p>
<p>This function discovers and imports all Python modules in the specified
package. Each module is expected to register its configurations with
the hydra-zen store as a side effect of being imported.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>package_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the package containing config modules.
Default is "configs" which works for the standard project layout.</p>
              </div>
            </td>
            <td>
                  <code>&#39;configs&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of module names that were successfully loaded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ImportError">ImportError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If a config module fails to import.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="deriva_ml.execution.load_configs--in-your-main-script-or-notebook">In your main script or notebook</h3>
<p>from deriva_ml.execution import load_configs</p>
<p>load_configs()  # Loads from "configs" package</p>
<h3 id="deriva_ml.execution.load_configs--or">or</h3>
<p>load_configs("my_project.configs")  # Custom package</p>
</details>

<details class="note" open>
  <summary>Note</summary>
  <p>The "experiments" module (if present) is loaded last because it
typically depends on other configs being registered first.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_configs</span><span class="p">(</span><span class="n">package_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;configs&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamically import all configuration modules from a package.</span>

<span class="sd">    This function discovers and imports all Python modules in the specified</span>
<span class="sd">    package. Each module is expected to register its configurations with</span>
<span class="sd">    the hydra-zen store as a side effect of being imported.</span>

<span class="sd">    Args:</span>
<span class="sd">        package_name: Name of the package containing config modules.</span>
<span class="sd">            Default is &quot;configs&quot; which works for the standard project layout.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of module names that were successfully loaded.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ImportError: If a config module fails to import.</span>

<span class="sd">    Example:</span>
<span class="sd">        # In your main script or notebook</span>
<span class="sd">        from deriva_ml.execution import load_configs</span>

<span class="sd">        load_configs()  # Loads from &quot;configs&quot; package</span>
<span class="sd">        # or</span>
<span class="sd">        load_configs(&quot;my_project.configs&quot;)  # Custom package</span>

<span class="sd">    Note:</span>
<span class="sd">        The &quot;experiments&quot; module (if present) is loaded last because it</span>
<span class="sd">        typically depends on other configs being registered first.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loaded_modules</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">package</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">package_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="c1"># Package doesn&#39;t exist, return empty</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">package_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">package</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>

    <span class="c1"># Collect module names, recursing into subpackages</span>
    <span class="n">modules_to_load</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">module_info</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">package_dir</span><span class="p">)]):</span>
        <span class="k">if</span> <span class="n">module_info</span><span class="o">.</span><span class="n">ispkg</span><span class="p">:</span>
            <span class="c1"># Recurse into subpackages (e.g., configs/dev/)</span>
            <span class="n">sub_loaded</span> <span class="o">=</span> <span class="n">load_configs</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">module_info</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">loaded_modules</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sub_loaded</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">modules_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module_info</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Sort modules but ensure &#39;experiments&#39; is loaded last</span>
    <span class="n">modules_to_load</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;experiments&quot;</span> <span class="ow">in</span> <span class="n">modules_to_load</span><span class="p">:</span>
        <span class="n">modules_to_load</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;experiments&quot;</span><span class="p">)</span>
        <span class="n">modules_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;experiments&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">module_name</span> <span class="ow">in</span> <span class="n">modules_to_load</span><span class="p">:</span>
        <span class="n">full_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">package_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">module_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">full_name</span><span class="p">)</span>
        <span class="n">loaded_modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">full_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">loaded_modules</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.notebook_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">notebook_config</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">notebook_config</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseConfig</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">defaults</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">field_defaults</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Register a notebook configuration with simplified syntax.</p>
<p>This is the recommended way to create notebook configurations. It handles
all the hydra-zen boilerplate (builds, store, defaults) automatically.</p>
<p>For simple notebooks that only use BaseConfig fields (deriva_ml, datasets,
assets, etc.), just specify which defaults to use. For notebooks with
custom parameters, provide a config_class that inherits from BaseConfig.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration name. Used both as the hydra config name and
to look up the config in run_notebook().</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_class</code>
            </td>
            <td>
                  <code><span title="type">type</span>[<a class="autorefs autorefs-internal" title="BaseConfig


  
      dataclass
   (deriva_ml.execution.base_config.BaseConfig)" href="#deriva_ml.execution.BaseConfig">BaseConfig</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional dataclass inheriting from BaseConfig. If None,
uses BaseConfig directly (suitable for notebooks that only need
the standard fields).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>defaults</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping config group names to config names. These
override the base defaults. Common groups:
- "deriva_ml": Connection config (e.g., "default_deriva", "eye_ai")
- "datasets": Dataset config (e.g., "cifar10_training")
- "assets": Asset config (e.g., "model_weights")
- "workflow": Workflow config (e.g., "default_workflow")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**field_defaults</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Default values for fields in config_class.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The hydra-zen builds() class, in case you need to reference it directly.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Simple notebook using only standard fields:</p>
<pre><code># configs/roc_analysis.py
from deriva_ml.execution import notebook_config

notebook_config(
    "roc_analysis",
    defaults={"assets": "roc_comparison_probabilities"},
)
</code></pre>
<p>Notebook with custom parameters:</p>
<pre><code># configs/training_analysis.py
from dataclasses import dataclass
from deriva_ml.execution import BaseConfig, notebook_config

@dataclass
class TrainingAnalysisConfig(BaseConfig):
    learning_rate: float = 0.001
    batch_size: int = 32

notebook_config(
    "training_analysis",
    config_class=TrainingAnalysisConfig,
    defaults={"datasets": "cifar10_training"},
    learning_rate=0.01,  # Override default
)
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">notebook_config</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseConfig</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">defaults</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">field_defaults</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a notebook configuration with simplified syntax.</span>

<span class="sd">    This is the recommended way to create notebook configurations. It handles</span>
<span class="sd">    all the hydra-zen boilerplate (builds, store, defaults) automatically.</span>

<span class="sd">    For simple notebooks that only use BaseConfig fields (deriva_ml, datasets,</span>
<span class="sd">    assets, etc.), just specify which defaults to use. For notebooks with</span>
<span class="sd">    custom parameters, provide a config_class that inherits from BaseConfig.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Configuration name. Used both as the hydra config name and</span>
<span class="sd">            to look up the config in run_notebook().</span>
<span class="sd">        config_class: Optional dataclass inheriting from BaseConfig. If None,</span>
<span class="sd">            uses BaseConfig directly (suitable for notebooks that only need</span>
<span class="sd">            the standard fields).</span>
<span class="sd">        defaults: Dict mapping config group names to config names. These</span>
<span class="sd">            override the base defaults. Common groups:</span>
<span class="sd">            - &quot;deriva_ml&quot;: Connection config (e.g., &quot;default_deriva&quot;, &quot;eye_ai&quot;)</span>
<span class="sd">            - &quot;datasets&quot;: Dataset config (e.g., &quot;cifar10_training&quot;)</span>
<span class="sd">            - &quot;assets&quot;: Asset config (e.g., &quot;model_weights&quot;)</span>
<span class="sd">            - &quot;workflow&quot;: Workflow config (e.g., &quot;default_workflow&quot;)</span>
<span class="sd">        **field_defaults: Default values for fields in config_class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The hydra-zen builds() class, in case you need to reference it directly.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Simple notebook using only standard fields:</span>

<span class="sd">            # configs/roc_analysis.py</span>
<span class="sd">            from deriva_ml.execution import notebook_config</span>

<span class="sd">            notebook_config(</span>
<span class="sd">                &quot;roc_analysis&quot;,</span>
<span class="sd">                defaults={&quot;assets&quot;: &quot;roc_comparison_probabilities&quot;},</span>
<span class="sd">            )</span>

<span class="sd">        Notebook with custom parameters:</span>

<span class="sd">            # configs/training_analysis.py</span>
<span class="sd">            from dataclasses import dataclass</span>
<span class="sd">            from deriva_ml.execution import BaseConfig, notebook_config</span>

<span class="sd">            @dataclass</span>
<span class="sd">            class TrainingAnalysisConfig(BaseConfig):</span>
<span class="sd">                learning_rate: float = 0.001</span>
<span class="sd">                batch_size: int = 32</span>

<span class="sd">            notebook_config(</span>
<span class="sd">                &quot;training_analysis&quot;,</span>
<span class="sd">                config_class=TrainingAnalysisConfig,</span>
<span class="sd">                defaults={&quot;datasets&quot;: &quot;cifar10_training&quot;},</span>
<span class="sd">                learning_rate=0.01,  # Override default</span>
<span class="sd">            )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Use BaseConfig if no custom class provided</span>
    <span class="n">actual_class</span> <span class="o">=</span> <span class="n">config_class</span> <span class="ow">or</span> <span class="n">BaseConfig</span>

    <span class="c1"># Build the hydra defaults list</span>
    <span class="n">hydra_defaults</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;_self_&quot;</span><span class="p">]</span>

    <span class="c1"># Start with base defaults, then apply overrides</span>
    <span class="n">default_groups</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;deriva_ml&quot;</span><span class="p">:</span> <span class="s2">&quot;default_deriva&quot;</span><span class="p">,</span>
        <span class="s2">&quot;datasets&quot;</span><span class="p">:</span> <span class="s2">&quot;default_dataset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;assets&quot;</span><span class="p">:</span> <span class="s2">&quot;default_asset&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">defaults</span><span class="p">:</span>
        <span class="n">default_groups</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">config_name</span> <span class="ow">in</span> <span class="n">default_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">hydra_defaults</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">group</span><span class="p">:</span> <span class="n">config_name</span><span class="p">})</span>

    <span class="c1"># Create the hydra-zen builds() class</span>
    <span class="n">config_builds</span> <span class="o">=</span> <span class="n">builds</span><span class="p">(</span>
        <span class="n">actual_class</span><span class="p">,</span>
        <span class="n">populate_full_signature</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">hydra_defaults</span><span class="o">=</span><span class="n">hydra_defaults</span><span class="p">,</span>
        <span class="o">**</span><span class="n">field_defaults</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Register with hydra-zen store</span>
    <span class="n">store</span><span class="p">(</span><span class="n">config_builds</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Also register in our internal registry for run_notebook()</span>
    <span class="n">_notebook_configs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">config_builds</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config_builds</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.reset_multirun_state" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">reset_multirun_state</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">reset_multirun_state</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Reset the global multirun state.</p>
<p>This is primarily useful for testing to ensure clean state between tests.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reset_multirun_state</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the global multirun state.</span>

<span class="sd">    This is primarily useful for testing to ensure clean state between tests.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_multirun_state</span>
    <span class="n">_multirun_state</span><span class="o">.</span><span class="n">parent_execution_rid</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_multirun_state</span><span class="o">.</span><span class="n">parent_execution</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_multirun_state</span><span class="o">.</span><span class="n">ml_instance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_multirun_state</span><span class="o">.</span><span class="n">job_sequence</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_multirun_state</span><span class="o">.</span><span class="n">sweep_dir</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.run_model" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_model</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_model</span><span class="p">(</span>
    <span class="n">deriva_ml</span><span class="p">:</span> <span class="s2">&quot;DerivaMLConfig&quot;</span><span class="p">,</span>
    <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;DatasetSpec&quot;</span><span class="p">],</span>
    <span class="n">assets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">,</span>
    <span class="n">model_config</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ml_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;DerivaML&quot;</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">upload_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="n">upload_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50000000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute a machine learning model within a DerivaML execution context.</p>
<p>This function serves as the main entry point called by hydra-zen after
configuration resolution. It orchestrates the complete execution lifecycle:
connecting to Deriva, creating an execution record, running the model,
and uploading results.</p>
<p>In multirun mode, this function also:
- Creates a parent execution on the first job to group all sweep jobs
- Links each child execution to the parent with sequence ordering</p>
<h4 id="deriva_ml.execution.run_model--parameters">Parameters</h4>
<p>deriva_ml : DerivaMLConfig
    Configuration for the DerivaML connection. Contains server URL,
    catalog ID, credentials, and other connection parameters.</p>


<details class="datasets-" open>
  <summary>list[DatasetSpec]</summary>
  <p>Specifications for datasets to use in this execution. Each DatasetSpec
identifies a dataset in the Deriva catalog to be made available to
the model.</p>
</details>

<details class="assets-" open>
  <summary>list[RID]</summary>
  <p>Resource IDs (RIDs) of assets to include in the execution. Typically
used for model weight files, pretrained checkpoints, or other
artifacts needed by the model.</p>
</details>

<details class="description-" open>
  <summary>str</summary>
  <p>Human-readable description of this execution run. Stored in the
Deriva catalog for provenance tracking. In multirun mode, this is
also used for the parent execution if running via multirun_config.</p>
</details>

<details class="workflow-" open>
  <summary>Workflow</summary>
  <p>The workflow definition to associate with this execution. Defines
the computational pipeline and its metadata.</p>
</details>

<details class="model_config-" open>
  <summary>Any</summary>
  <p>A hydra-zen callable that wraps the actual model code. When called
with <code>ml_instance</code> and <code>execution</code> arguments, it runs the model
training or inference logic.</p>
</details>

<details class="dry_run-" open>
  <summary>bool, optional</summary>
  <p>If True, create the execution record but skip actual model execution.
Useful for testing configuration without running expensive computations.
Default is False.</p>
</details>

<details class="ml_class-" open>
  <summary>type[DerivaML], optional</summary>
  <p>The DerivaML class (or subclass) to instantiate. If None, uses the
base DerivaML class. Use this to instantiate domain-specific classes
like EyeAI or GUDMAP.</p>
</details>

<details class="upload_timeout-" open>
  <summary>int, optional</summary>
  <p>Timeout in seconds for each chunk upload. Default is 600 (10 min).
This value is used as both the connect and read timeout. Since urllib3
uses the connect timeout for socket writes, it must be large enough
to send a full chunk over the network.</p>
</details>

<details class="upload_chunk_size-" open>
  <summary>int, optional</summary>
  <p>Chunk size in bytes for hatrac uploads. Default is 50000000 (50 MB).
Larger chunks reduce overhead but require more memory.</p>
</details>        <h4 id="deriva_ml.execution.run_model--returns">Returns</h4>
<p>None
    Results are uploaded to the Deriva catalog as execution outputs.</p>
<h4 id="deriva_ml.execution.run_model--examples">Examples</h4>
<p>This function is typically not called directly, but through hydra:</p>
<pre><code># From command line:
python deriva_run.py +experiment=cifar10_cnn dry_run=True

# Multirun (creates parent + child executions):
python deriva_run.py --multirun +experiment=cifar10_quick,cifar10_extended

# With a custom DerivaML subclass (in your script):
from functools import partial
run_model_eyeai = partial(run_model, ml_class=EyeAI)
</code></pre>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/runner.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_model</span><span class="p">(</span>
    <span class="n">deriva_ml</span><span class="p">:</span> <span class="s2">&quot;DerivaMLConfig&quot;</span><span class="p">,</span>
    <span class="n">datasets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;DatasetSpec&quot;</span><span class="p">],</span>
    <span class="n">assets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">workflow</span><span class="p">:</span> <span class="s2">&quot;Workflow&quot;</span><span class="p">,</span>
    <span class="n">model_config</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ml_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;DerivaML&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">upload_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="n">upload_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50_000_000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Execute a machine learning model within a DerivaML execution context.</span>

<span class="sd">    This function serves as the main entry point called by hydra-zen after</span>
<span class="sd">    configuration resolution. It orchestrates the complete execution lifecycle:</span>
<span class="sd">    connecting to Deriva, creating an execution record, running the model,</span>
<span class="sd">    and uploading results.</span>

<span class="sd">    In multirun mode, this function also:</span>
<span class="sd">    - Creates a parent execution on the first job to group all sweep jobs</span>
<span class="sd">    - Links each child execution to the parent with sequence ordering</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    deriva_ml : DerivaMLConfig</span>
<span class="sd">        Configuration for the DerivaML connection. Contains server URL,</span>
<span class="sd">        catalog ID, credentials, and other connection parameters.</span>

<span class="sd">    datasets : list[DatasetSpec]</span>
<span class="sd">        Specifications for datasets to use in this execution. Each DatasetSpec</span>
<span class="sd">        identifies a dataset in the Deriva catalog to be made available to</span>
<span class="sd">        the model.</span>

<span class="sd">    assets : list[RID]</span>
<span class="sd">        Resource IDs (RIDs) of assets to include in the execution. Typically</span>
<span class="sd">        used for model weight files, pretrained checkpoints, or other</span>
<span class="sd">        artifacts needed by the model.</span>

<span class="sd">    description : str</span>
<span class="sd">        Human-readable description of this execution run. Stored in the</span>
<span class="sd">        Deriva catalog for provenance tracking. In multirun mode, this is</span>
<span class="sd">        also used for the parent execution if running via multirun_config.</span>

<span class="sd">    workflow : Workflow</span>
<span class="sd">        The workflow definition to associate with this execution. Defines</span>
<span class="sd">        the computational pipeline and its metadata.</span>

<span class="sd">    model_config : Any</span>
<span class="sd">        A hydra-zen callable that wraps the actual model code. When called</span>
<span class="sd">        with `ml_instance` and `execution` arguments, it runs the model</span>
<span class="sd">        training or inference logic.</span>

<span class="sd">    dry_run : bool, optional</span>
<span class="sd">        If True, create the execution record but skip actual model execution.</span>
<span class="sd">        Useful for testing configuration without running expensive computations.</span>
<span class="sd">        Default is False.</span>

<span class="sd">    ml_class : type[DerivaML], optional</span>
<span class="sd">        The DerivaML class (or subclass) to instantiate. If None, uses the</span>
<span class="sd">        base DerivaML class. Use this to instantiate domain-specific classes</span>
<span class="sd">        like EyeAI or GUDMAP.</span>

<span class="sd">    upload_timeout : int, optional</span>
<span class="sd">        Timeout in seconds for each chunk upload. Default is 600 (10 min).</span>
<span class="sd">        This value is used as both the connect and read timeout. Since urllib3</span>
<span class="sd">        uses the connect timeout for socket writes, it must be large enough</span>
<span class="sd">        to send a full chunk over the network.</span>

<span class="sd">    upload_chunk_size : int, optional</span>
<span class="sd">        Chunk size in bytes for hatrac uploads. Default is 50000000 (50 MB).</span>
<span class="sd">        Larger chunks reduce overhead but require more memory.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Results are uploaded to the Deriva catalog as execution outputs.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    This function is typically not called directly, but through hydra:</span>

<span class="sd">        # From command line:</span>
<span class="sd">        python deriva_run.py +experiment=cifar10_cnn dry_run=True</span>

<span class="sd">        # Multirun (creates parent + child executions):</span>
<span class="sd">        python deriva_run.py --multirun +experiment=cifar10_quick,cifar10_extended</span>

<span class="sd">        # With a custom DerivaML subclass (in your script):</span>
<span class="sd">        from functools import partial</span>
<span class="sd">        run_model_eyeai = partial(run_model, ml_class=EyeAI)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">_multirun_state</span>

    <span class="c1"># Import here to avoid circular imports</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml</span><span class="w"> </span><span class="kn">import</span> <span class="n">DerivaML</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.execution</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExecutionConfiguration</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Clear hydra&#39;s logging configuration</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Hydra sets up its own logging handlers which can interfere with DerivaML&#39;s</span>
    <span class="c1"># logging. Remove them to ensure consistent log output.</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>
        <span class="n">root</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Connect to the Deriva catalog</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Use the provided ml_class or default to DerivaML</span>
    <span class="k">if</span> <span class="n">ml_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ml_class</span> <span class="o">=</span> <span class="n">DerivaML</span>

    <span class="n">ml_instance</span> <span class="o">=</span> <span class="n">ml_class</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="n">deriva_ml</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Handle multirun mode - create parent execution on first job</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="n">is_multirun</span> <span class="o">=</span> <span class="n">_is_multirun</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_multirun</span> <span class="ow">and</span> <span class="n">_multirun_state</span><span class="o">.</span><span class="n">parent_execution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_create_parent_execution</span><span class="p">(</span><span class="n">ml_instance</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Capture Hydra runtime choices for provenance</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># The choices dict maps config group names to the selected config names</span>
    <span class="c1"># e.g., {&quot;model_config&quot;: &quot;cifar10_quick&quot;, &quot;datasets&quot;: &quot;cifar10_training&quot;}</span>
    <span class="c1"># Filter out None values (some Hydra internal groups have None choices)</span>
    <span class="n">config_choices</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">hydra_cfg</span> <span class="o">=</span> <span class="n">HydraConfig</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">config_choices</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">hydra_cfg</span><span class="o">.</span><span class="n">runtime</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">pass</span>  <span class="c1"># HydraConfig not available outside Hydra context</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Create the execution context</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># The ExecutionConfiguration bundles together all the inputs for this run:</span>
    <span class="c1"># which datasets to use, which assets (model weights, etc.), and metadata.</span>

    <span class="c1"># In multirun mode, enhance the description with job info</span>
    <span class="n">job_description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="k">if</span> <span class="n">is_multirun</span><span class="p">:</span>
        <span class="n">job_num</span> <span class="o">=</span> <span class="n">_get_job_num</span><span class="p">()</span>
        <span class="n">job_description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[Job </span><span class="si">{</span><span class="n">job_num</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">execution_config</span> <span class="o">=</span> <span class="n">ExecutionConfiguration</span><span class="p">(</span>
        <span class="n">datasets</span><span class="o">=</span><span class="n">datasets</span><span class="p">,</span>
        <span class="n">assets</span><span class="o">=</span><span class="n">assets</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">job_description</span><span class="p">,</span>
        <span class="n">config_choices</span><span class="o">=</span><span class="n">config_choices</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create the execution record in the catalog. This generates a unique</span>
    <span class="c1"># execution ID and sets up the working directories for this run.</span>
    <span class="n">execution</span> <span class="o">=</span> <span class="n">ml_instance</span><span class="o">.</span><span class="n">create_execution</span><span class="p">(</span>
        <span class="n">execution_config</span><span class="p">,</span>
        <span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
        <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span>
    <span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Link to parent execution in multirun mode</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="k">if</span> <span class="n">is_multirun</span> <span class="ow">and</span> <span class="n">_multirun_state</span><span class="o">.</span><span class="n">parent_execution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Get the current job sequence from the global state</span>
                <span class="n">job_sequence</span> <span class="o">=</span> <span class="n">_multirun_state</span><span class="o">.</span><span class="n">job_sequence</span>
                <span class="n">_multirun_state</span><span class="o">.</span><span class="n">parent_execution</span><span class="o">.</span><span class="n">add_nested_execution</span><span class="p">(</span>
                    <span class="n">execution</span><span class="p">,</span>
                    <span class="n">sequence</span><span class="o">=</span><span class="n">job_sequence</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Linked execution </span><span class="si">{</span><span class="n">execution</span><span class="o">.</span><span class="n">execution_rid</span><span class="si">}</span><span class="s2"> to parent &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_multirun_state</span><span class="o">.</span><span class="n">parent_execution_rid</span><span class="si">}</span><span class="s2"> (sequence=</span><span class="si">{</span><span class="n">job_sequence</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="c1"># Increment the sequence for the next job</span>
                <span class="n">_multirun_state</span><span class="o">.</span><span class="n">job_sequence</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to link execution to parent: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Run the model within the execution context</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># The context manager handles setup (downloading datasets, creating output</span>
    <span class="c1"># directories) and teardown (recording completion status, timing).</span>
    <span class="k">with</span> <span class="n">execution</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span> <span class="k">as</span> <span class="n">exec_context</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="c1"># In dry run mode, skip model execution but still test the setup</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Dry run mode: skipping model execution&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Invoke the model configuration callable. The model_config is a</span>
            <span class="c1"># hydra-zen wrapped function that has been partially configured with</span>
            <span class="c1"># all model-specific parameters (e.g., learning rate, batch size).</span>
            <span class="c1"># We provide the runtime context here.</span>
            <span class="n">model_config</span><span class="p">(</span><span class="n">ml_instance</span><span class="o">=</span><span class="n">ml_instance</span><span class="p">,</span> <span class="n">execution</span><span class="o">=</span><span class="n">exec_context</span><span class="p">)</span>

    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># Upload results to the catalog</span>
    <span class="c1"># ---------------------------------------------------------------------------</span>
    <span class="c1"># After the model completes, upload any output files (metrics, predictions,</span>
    <span class="c1"># model checkpoints) to the Deriva catalog for permanent storage.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
        <span class="n">uploaded_assets</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">upload_execution_outputs</span><span class="p">(</span>
            <span class="n">timeout</span><span class="o">=</span><span class="p">(</span><span class="n">upload_timeout</span><span class="p">,</span> <span class="n">upload_timeout</span><span class="p">),</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">upload_chunk_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Print summary of uploaded assets</span>
        <span class="n">total_files</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="k">for</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">uploaded_assets</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">total_files</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Uploaded </span><span class="si">{</span><span class="n">total_files</span><span class="si">}</span><span class="s2"> asset(s) to catalog:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">asset_type</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">uploaded_assets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">asset_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.run_notebook" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">run_notebook</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run_notebook</span><span class="p">(</span>
    <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">workflow_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Analysis Notebook&quot;</span><span class="p">,</span>
    <span class="n">ml_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">DerivaML</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;configs&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
    <span class="n">DerivaML</span><span class="p">,</span> <span class="n">Execution</span><span class="p">,</span> <span class="n">BaseConfig</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a notebook with DerivaML execution context.</p>
<p>This is the main entry point for notebooks. It handles all the setup:
1. Loads all config modules from the config package
2. Resolves the hydra-zen configuration
3. Creates the DerivaML connection
4. Creates a workflow and execution context
5. Downloads any specified datasets and assets</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the notebook configuration (registered via
notebook_config() or store()).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overrides</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of Hydra override strings
(e.g., ["assets=different_assets"]).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>workflow_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name for the workflow. Defaults to config_name.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>workflow_type</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of workflow (default: "Analysis Notebook").</p>
              </div>
            </td>
            <td>
                  <code>&#39;Analysis Notebook&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ml_class</code>
            </td>
            <td>
                  <code><span title="type">type</span>[<a class="autorefs autorefs-internal" title="DerivaML (deriva_ml.DerivaML)" href="../deriva_ml_base/#deriva_ml.core.DerivaML">DerivaML</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional DerivaML subclass to use. If None, uses DerivaML.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config_package</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Package containing config modules (default: "configs").</p>
              </div>
            </td>
            <td>
                  <code>&#39;configs&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaML (deriva_ml.DerivaML)" href="../deriva_ml_base/#deriva_ml.core.DerivaML">DerivaML</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (ml_instance, execution, config):</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Execution (deriva_ml.execution.Execution)" href="#deriva_ml.execution.Execution">Execution</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>ml_instance: Connected DerivaML (or subclass) instance</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="BaseConfig


  
      dataclass
   (deriva_ml.execution.base_config.BaseConfig)" href="#deriva_ml.execution.BaseConfig">BaseConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>execution: Execution context with downloaded inputs</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="DerivaML (deriva_ml.DerivaML)" href="../deriva_ml_base/#deriva_ml.core.DerivaML">DerivaML</a>, <a class="autorefs autorefs-internal" title="Execution (deriva_ml.execution.Execution)" href="#deriva_ml.execution.Execution">Execution</a>, <a class="autorefs autorefs-internal" title="BaseConfig


  
      dataclass
   (deriva_ml.execution.base_config.BaseConfig)" href="#deriva_ml.execution.BaseConfig">BaseConfig</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>config: Resolved configuration object</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="deriva_ml.execution.run_notebook--simple-usage">Simple usage</h3>
<p>from deriva_ml.execution import run_notebook</p>
<p>ml, execution, config = run_notebook("roc_analysis")</p>
<h3 id="deriva_ml.execution.run_notebook--access-config-values">Access config values</h3>
<p>print(config.assets)
print(config.deriva_ml.hostname)</p>
<h3 id="deriva_ml.execution.run_notebook--use-ml-and-execution">Use ml and execution</h3>
<p>for asset_table, paths in execution.asset_paths.items():
    for path in paths:
        print(f"Downloaded: {path.file_name}")</p>
<h3 id="deriva_ml.execution.run_notebook--at-the-end-of-notebook">At the end of notebook</h3>
<p>execution.upload_execution_outputs()</p>
</details>

<details class="example-with-overrides" open>
  <summary>Example with overrides</summary>
  <p>ml, execution, config = run_notebook(
    "roc_analysis",
    overrides=["assets=roc_quick_probabilities"],
)</p>
</details>

<details class="example-with-custom-ml-class" open>
  <summary>Example with custom ML class</summary>
  <p>from eye_ai import EyeAI</p>
<p>ml, execution, config = run_notebook(
    "eye_analysis",
    ml_class=EyeAI,
)</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_notebook</span><span class="p">(</span>
    <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">overrides</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">workflow_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">workflow_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Analysis Notebook&quot;</span><span class="p">,</span>
    <span class="n">ml_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="s2">&quot;DerivaML&quot;</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">config_package</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;configs&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s2">&quot;DerivaML&quot;</span><span class="p">,</span> <span class="s2">&quot;Execution&quot;</span><span class="p">,</span> <span class="n">BaseConfig</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a notebook with DerivaML execution context.</span>

<span class="sd">    This is the main entry point for notebooks. It handles all the setup:</span>
<span class="sd">    1. Loads all config modules from the config package</span>
<span class="sd">    2. Resolves the hydra-zen configuration</span>
<span class="sd">    3. Creates the DerivaML connection</span>
<span class="sd">    4. Creates a workflow and execution context</span>
<span class="sd">    5. Downloads any specified datasets and assets</span>

<span class="sd">    Args:</span>
<span class="sd">        config_name: Name of the notebook configuration (registered via</span>
<span class="sd">            notebook_config() or store()).</span>
<span class="sd">        overrides: Optional list of Hydra override strings</span>
<span class="sd">            (e.g., [&quot;assets=different_assets&quot;]).</span>
<span class="sd">        workflow_name: Name for the workflow. Defaults to config_name.</span>
<span class="sd">        workflow_type: Type of workflow (default: &quot;Analysis Notebook&quot;).</span>
<span class="sd">        ml_class: Optional DerivaML subclass to use. If None, uses DerivaML.</span>
<span class="sd">        config_package: Package containing config modules (default: &quot;configs&quot;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (ml_instance, execution, config):</span>
<span class="sd">        - ml_instance: Connected DerivaML (or subclass) instance</span>
<span class="sd">        - execution: Execution context with downloaded inputs</span>
<span class="sd">        - config: Resolved configuration object</span>

<span class="sd">    Example:</span>
<span class="sd">        # Simple usage</span>
<span class="sd">        from deriva_ml.execution import run_notebook</span>

<span class="sd">        ml, execution, config = run_notebook(&quot;roc_analysis&quot;)</span>

<span class="sd">        # Access config values</span>
<span class="sd">        print(config.assets)</span>
<span class="sd">        print(config.deriva_ml.hostname)</span>

<span class="sd">        # Use ml and execution</span>
<span class="sd">        for asset_table, paths in execution.asset_paths.items():</span>
<span class="sd">            for path in paths:</span>
<span class="sd">                print(f&quot;Downloaded: {path.file_name}&quot;)</span>

<span class="sd">        # At the end of notebook</span>
<span class="sd">        execution.upload_execution_outputs()</span>

<span class="sd">    Example with overrides:</span>
<span class="sd">        ml, execution, config = run_notebook(</span>
<span class="sd">            &quot;roc_analysis&quot;,</span>
<span class="sd">            overrides=[&quot;assets=roc_quick_probabilities&quot;],</span>
<span class="sd">        )</span>

<span class="sd">    Example with custom ML class:</span>
<span class="sd">        from eye_ai import EyeAI</span>

<span class="sd">        ml, execution, config = run_notebook(</span>
<span class="sd">            &quot;eye_analysis&quot;,</span>
<span class="sd">            ml_class=EyeAI,</span>
<span class="sd">        )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Import here to avoid circular imports</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml</span><span class="w"> </span><span class="kn">import</span> <span class="n">DerivaML</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.execution</span><span class="w"> </span><span class="kn">import</span> <span class="n">Execution</span><span class="p">,</span> <span class="n">ExecutionConfiguration</span>

    <span class="c1"># Load all config modules</span>
    <span class="n">load_configs</span><span class="p">(</span><span class="n">config_package</span><span class="p">)</span>

    <span class="c1"># Get the config builds class from our registry or try the store</span>
    <span class="k">if</span> <span class="n">config_name</span> <span class="ow">in</span> <span class="n">_notebook_configs</span><span class="p">:</span>
        <span class="n">config_builds</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_notebook_configs</span><span class="p">[</span><span class="n">config_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Fall back to looking up in hydra store by building a simple config</span>
        <span class="c1"># This handles configs registered the old way</span>
        <span class="n">config_builds</span> <span class="o">=</span> <span class="n">DerivaBaseConfig</span>

    <span class="c1"># Resolve the configuration</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">get_notebook_configuration</span><span class="p">(</span>
        <span class="n">config_builds</span><span class="p">,</span>
        <span class="n">config_name</span><span class="o">=</span><span class="n">config_name</span><span class="p">,</span>
        <span class="n">overrides</span><span class="o">=</span><span class="n">overrides</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create DerivaML instance, passing the hydra output dir captured during</span>
    <span class="c1"># config resolution so that hydra YAML configs get uploaded with the execution.</span>
    <span class="n">actual_ml_class</span> <span class="o">=</span> <span class="n">ml_class</span> <span class="ow">or</span> <span class="n">DerivaML</span>
    <span class="n">hydra_output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_captured_hydra_output_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">_captured_hydra_output_dir</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">ml</span> <span class="o">=</span> <span class="n">actual_ml_class</span><span class="p">(</span>
        <span class="n">hostname</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">deriva_ml</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
        <span class="n">catalog_id</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">deriva_ml</span><span class="o">.</span><span class="n">catalog_id</span><span class="p">,</span>
        <span class="n">hydra_runtime_output_dir</span><span class="o">=</span><span class="n">hydra_output_dir</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create workflow</span>
    <span class="n">actual_workflow_name</span> <span class="o">=</span> <span class="n">workflow_name</span> <span class="ow">or</span> <span class="n">config_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">create_workflow</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">actual_workflow_name</span><span class="p">,</span>
        <span class="n">workflow_type</span><span class="o">=</span><span class="n">workflow_type</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Running </span><span class="si">{</span><span class="n">config_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create execution configuration</span>
    <span class="n">exec_config</span> <span class="o">=</span> <span class="n">ExecutionConfiguration</span><span class="p">(</span>
        <span class="n">workflow</span><span class="o">=</span><span class="n">workflow</span><span class="p">,</span>
        <span class="n">datasets</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">datasets</span> <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">datasets</span> <span class="k">else</span> <span class="p">[],</span>
        <span class="n">assets</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">assets</span> <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">assets</span> <span class="k">else</span> <span class="p">[],</span>
        <span class="n">description</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">description</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;Execution of </span><span class="si">{</span><span class="n">config_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Create execution context (downloads inputs)</span>
    <span class="n">execution</span> <span class="o">=</span> <span class="n">Execution</span><span class="p">(</span><span class="n">configuration</span><span class="o">=</span><span class="n">exec_config</span><span class="p">,</span> <span class="n">ml_object</span><span class="o">=</span><span class="n">ml</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">dry_run</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ml</span><span class="p">,</span> <span class="n">execution</span><span class="p">,</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.execution.with_description" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">with_description</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">with_description</span><span class="p">(</span>
    <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a hydra-zen config for a list with an attached description.</p>
<p>Use this to add descriptions to configuration values like asset RIDs
or dataset specifications. The result is a hydra-zen config that, when
instantiated, produces a DescribedList.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>items</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List items (e.g., asset RIDs, dataset specs).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>description</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description of this configuration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A hydra-zen config that instantiates to a DescribedList.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>from hydra_zen import store
from deriva_ml.execution import with_description</p>
<h3 id="deriva_ml.execution.with_description--assets-with-description">Assets with description</h3>
<p>asset_store = store(group="assets")
asset_store(
...     with_description(
...         ["3WMG", "3XPA"],
...         "Model weights from quick and extended training runs",
...     ),
...     name="comparison_weights",
... )</p>
<h3 id="deriva_ml.execution.with_description--datasets-with-description">Datasets with description</h3>
<p>from deriva_ml.dataset import DatasetSpecConfig
datasets_store = store(group="datasets")
datasets_store(
...     with_description(
...         [DatasetSpecConfig(rid="28CT", version="0.21.0")],
...         "Complete CIFAR-10 dataset with 10,000 images",
...     ),
...     name="cifar10_complete",
... )</p>
<h3 id="deriva_ml.execution.with_description--after-instantiation">After instantiation:</h3>
<h3 id="deriva_ml.execution.with_description--configassets-is-a-describedlist">config.assets is a DescribedList</h3>
<h3 id="deriva_ml.execution.with_description--configassets0-3wmg">config.assets[0]  # "3WMG"</h3>
<h3 id="deriva_ml.execution.with_description--configassetsdescription-model-weights-from">config.assets.description  # "Model weights from..."</h3>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="note" open>
  <summary>Note</summary>
  <p>For model configs created with <code>builds()</code>, use the <code>zen_meta</code> parameter
instead:</p>
<blockquote>
<blockquote>
<blockquote>
<p>model_store(
...     Cifar10CNNConfig,
...     name="cifar10_quick",
...     epochs=3,
...     zen_meta={"description": "Quick training - 3 epochs"},
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/execution/base_config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">with_description</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a hydra-zen config for a list with an attached description.</span>

<span class="sd">    Use this to add descriptions to configuration values like asset RIDs</span>
<span class="sd">    or dataset specifications. The result is a hydra-zen config that, when</span>
<span class="sd">    instantiated, produces a DescribedList.</span>

<span class="sd">    Args:</span>
<span class="sd">        items: List items (e.g., asset RIDs, dataset specs).</span>
<span class="sd">        description: Human-readable description of this configuration.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A hydra-zen config that instantiates to a DescribedList.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; from hydra_zen import store</span>
<span class="sd">        &gt;&gt;&gt; from deriva_ml.execution import with_description</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Assets with description</span>
<span class="sd">        &gt;&gt;&gt; asset_store = store(group=&quot;assets&quot;)</span>
<span class="sd">        &gt;&gt;&gt; asset_store(</span>
<span class="sd">        ...     with_description(</span>
<span class="sd">        ...         [&quot;3WMG&quot;, &quot;3XPA&quot;],</span>
<span class="sd">        ...         &quot;Model weights from quick and extended training runs&quot;,</span>
<span class="sd">        ...     ),</span>
<span class="sd">        ...     name=&quot;comparison_weights&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Datasets with description</span>
<span class="sd">        &gt;&gt;&gt; from deriva_ml.dataset import DatasetSpecConfig</span>
<span class="sd">        &gt;&gt;&gt; datasets_store = store(group=&quot;datasets&quot;)</span>
<span class="sd">        &gt;&gt;&gt; datasets_store(</span>
<span class="sd">        ...     with_description(</span>
<span class="sd">        ...         [DatasetSpecConfig(rid=&quot;28CT&quot;, version=&quot;0.21.0&quot;)],</span>
<span class="sd">        ...         &quot;Complete CIFAR-10 dataset with 10,000 images&quot;,</span>
<span class="sd">        ...     ),</span>
<span class="sd">        ...     name=&quot;cifar10_complete&quot;,</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # After instantiation:</span>
<span class="sd">        &gt;&gt;&gt; # config.assets is a DescribedList</span>
<span class="sd">        &gt;&gt;&gt; # config.assets[0]  # &quot;3WMG&quot;</span>
<span class="sd">        &gt;&gt;&gt; # config.assets.description  # &quot;Model weights from...&quot;</span>

<span class="sd">    Note:</span>
<span class="sd">        For model configs created with `builds()`, use the `zen_meta` parameter</span>
<span class="sd">        instead:</span>

<span class="sd">        &gt;&gt;&gt; model_store(</span>
<span class="sd">        ...     Cifar10CNNConfig,</span>
<span class="sd">        ...     name=&quot;cifar10_quick&quot;,</span>
<span class="sd">        ...     epochs=3,</span>
<span class="sd">        ...     zen_meta={&quot;description&quot;: &quot;Quick training - 3 epochs&quot;},</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_DescribedListConfig</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../dataset_aux_classes/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Dataset Auxiliary Classes">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Dataset Auxiliary Classes
              </div>
            </div>
          </a>
        
        
          
          <a href="../execution_configuration/" class="md-footer__link md-footer__link--next" aria-label="Next: ExecutionConfiguration">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                ExecutionConfiguration
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>