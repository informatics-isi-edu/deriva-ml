
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://informatics-isi-edu.github.io/deriva-ml/code-docs/deriva_model/">
      
      
        <link rel="prev" href="../deriva_ml_base/">
      
      
        <link rel="next" href="../dataset/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>DerivaModel - DerivaML</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#derivamodel" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DerivaML" class="md-header__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DerivaML
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              DerivaModel
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DerivaML" class="md-nav__button md-logo" aria-label="DerivaML" data-md-component="logo">
      
  <img src="../../assets/deriva-logo.png" alt="logo">

    </a>
    DerivaML
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview of DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/deriva_ml_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installing deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/identifiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Identifying things in deriva-ml
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/file-assets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    File Assets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Catalog Annotations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/execution-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuring an Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/hydra-zen-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hydra-zen Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/running-models-and-notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Running Models and Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/notebooks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using DerivaML with Jupyter Notebooks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/cli-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Sample Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Sample Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Notebooks/DerivaML%20Vocabulary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML Vocabulary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Library Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Library Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Classes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Classes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_ml_base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    DerivaModel
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    DerivaModel
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.Aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aggregate
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.Aggregate--count-related-records" class="md-nav__link">
    <span class="md-ellipsis">
      
        Count related records
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.Aggregate--get-distinct-values-as-array" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get distinct values as array
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ArrayUxMode" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArrayUxMode
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource" class="md-nav__link">
    <span class="md-ellipsis">
      
        BagDataSource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BagDataSource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource--list-available-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        List available tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource--get-data-for-a-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get data for a table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.get_row_count" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_row_count
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.get_table_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.has_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.list_available_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_available_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource" class="md-nav__link">
    <span class="md-ellipsis">
      
        CatalogDataSource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CatalogDataSource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource--list-available-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        List available tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource--get-data-for-a-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get data for a table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.get_row_count" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_row_count
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.get_table_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.has_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.list_available_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_available_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        ColumnDisplay
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ColumnDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay--markdown-link" class="md-nav__link">
    <span class="md-ellipsis">
      
        Markdown link
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        compact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplayOptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        ColumnDisplayOptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader" class="md-nav__link">
    <span class="md-ellipsis">
      
        DataLoader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--phase-1-create-orm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Create ORM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--phase-2-fill-with-data-from-bag" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Fill with data from bag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--or-load-specific-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Or load specific tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--with-progress-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        With progress callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.get_load_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_load_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.load_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.load_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.validate_load_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_load_order
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource" class="md-nav__link">
    <span class="md-ellipsis">
      
        DataSource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataSource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource.get_table_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource.has_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource.list_available_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_available_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        DerivaModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivaModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.chaise_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        chaise_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.asset_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        asset_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.create_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_association" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_association
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_vocabularies" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_vocabularies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.get_schema_description" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_schema_description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_association" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_association
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_dataset_rid" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_dataset_rid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_domain_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_domain_schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_system_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_system_schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_vocabulary" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_vocabulary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.list_dataset_element_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_element_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.lookup_feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        lookup_feature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.name_to_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        name_to_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.vocab_columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        vocab_columns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.Display" class="md-nav__link">
    <span class="md-ellipsis">
      
        Display
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.Facet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Facet
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetList" class="md-nav__link">
    <span class="md-ellipsis">
      
        FacetList
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FacetList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetList.add" class="md-nav__link">
    <span class="md-ellipsis">
      
        add
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetRange" class="md-nav__link">
    <span class="md-ellipsis">
      
        FacetRange
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode" class="md-nav__link">
    <span class="md-ellipsis">
      
        FacetUxMode
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FacetUxMode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode--choice-based-facet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choice-based facet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode--range-based-facet-for-numeric-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Range-based facet for numeric values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode--check-presence-has-value-no-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check presence (has value / no value)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer" class="md-nav__link">
    <span class="md-ellipsis">
      
        ForeignKeyOrderer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ForeignKeyOrderer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--get-insertion-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get insertion order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--returns-subject-image-diagnosis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns: ['Subject', 'Image', 'Diagnosis']
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--get-all-tables-in-safe-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all tables in safe order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--get-fk-dependencies-for-a-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get FK dependencies for a table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--returns-subject-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns: {'Subject', 'Dataset', ...}
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.find_cycles" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_cycles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_all_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_all_tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_deletion_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_deletion_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_dependents" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dependents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_insertion_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_insertion_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.validate_insertion_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_insertion_order
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.InboundFK" class="md-nav__link">
    <span class="md-ellipsis">
      
        InboundFK
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.NameStyle" class="md-nav__link">
    <span class="md-ellipsis">
      
        NameStyle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NameStyle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.NameStyle--transform-subject_id-to-subject-id-with-title-case" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transform "Subject_ID" to "Subject Id" with title case
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.NameStyle.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.OutboundFK" class="md-nav__link">
    <span class="md-ellipsis">
      
        OutboundFK
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.PreFormat" class="md-nav__link">
    <span class="md-ellipsis">
      
        PreFormat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.PseudoColumn" class="md-nav__link">
    <span class="md-ellipsis">
      
        PseudoColumn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.PseudoColumnDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        PseudoColumnDisplay
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        SchemaBuilder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SchemaBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--create-orm-from-catalog-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create ORM from catalog model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--create-orm-from-schema-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create ORM from schema file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--use-the-orm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use the ORM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clean up
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder.build" class="md-nav__link">
    <span class="md-ellipsis">
      
        build
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM" class="md-nav__link">
    <span class="md-ellipsis">
      
        SchemaORM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SchemaORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__del__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __del__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __enter__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __exit__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.dispose" class="md-nav__link">
    <span class="md-ellipsis">
      
        dispose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.find_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_association_class" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_association_class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_orm_class" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_orm_class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_orm_class_for_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_orm_class_for_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_table_contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_contents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.is_association_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_association_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.list_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.SortKey" class="md-nav__link">
    <span class="md-ellipsis">
      
        SortKey
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SortKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SortKey.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        TableDisplay
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TableDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        compact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.row_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        row_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplayOptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        TableDisplayOptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.TemplateEngine" class="md-nav__link">
    <span class="md-ellipsis">
      
        TemplateEngine
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns" class="md-nav__link">
    <span class="md-ellipsis">
      
        VisibleColumns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VisibleColumns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        compact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.entry" class="md-nav__link">
    <span class="md-ellipsis">
      
        entry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.entry_create" class="md-nav__link">
    <span class="md-ellipsis">
      
        entry_create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.entry_edit" class="md-nav__link">
    <span class="md-ellipsis">
      
        entry_edit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        VisibleForeignKeys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VisibleForeignKeys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.fk_constraint" class="md-nav__link">
    <span class="md-ellipsis">
      
        fk_constraint
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Datasets
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Datasets
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_bag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DatasetBag
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_split/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Splitting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset_aux_classes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dataset Auxiliary Classes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Execution
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Execution
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execution_configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ExecutionConfiguration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Features
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Utilities
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Utilities
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deriva_definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Definitions & Types
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../upload/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Release Notes
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.Aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aggregate
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.Aggregate--count-related-records" class="md-nav__link">
    <span class="md-ellipsis">
      
        Count related records
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.Aggregate--get-distinct-values-as-array" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get distinct values as array
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ArrayUxMode" class="md-nav__link">
    <span class="md-ellipsis">
      
        ArrayUxMode
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource" class="md-nav__link">
    <span class="md-ellipsis">
      
        BagDataSource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BagDataSource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource--list-available-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        List available tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource--get-data-for-a-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get data for a table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.get_row_count" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_row_count
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.get_table_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.has_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.BagDataSource.list_available_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_available_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource" class="md-nav__link">
    <span class="md-ellipsis">
      
        CatalogDataSource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CatalogDataSource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource--list-available-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        List available tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource--get-data-for-a-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get data for a table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.get_row_count" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_row_count
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.get_table_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.has_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.CatalogDataSource.list_available_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_available_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        ColumnDisplay
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ColumnDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay--markdown-link" class="md-nav__link">
    <span class="md-ellipsis">
      
        Markdown link
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        compact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplay.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ColumnDisplayOptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        ColumnDisplayOptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader" class="md-nav__link">
    <span class="md-ellipsis">
      
        DataLoader
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--phase-1-create-orm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Create ORM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--phase-2-fill-with-data-from-bag" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Fill with data from bag
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--or-load-specific-tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Or load specific tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader--with-progress-callback" class="md-nav__link">
    <span class="md-ellipsis">
      
        With progress callback
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.get_load_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_load_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.load_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.load_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataLoader.validate_load_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_load_order
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource" class="md-nav__link">
    <span class="md-ellipsis">
      
        DataSource
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DataSource">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource.get_table_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource.has_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        has_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DataSource.list_available_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_available_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel" class="md-nav__link">
    <span class="md-ellipsis">
      
        DerivaModel
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DerivaModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.chaise_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        chaise_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.asset_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      
        asset_metadata
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.create_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_assets" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_assets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_association" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_association
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_features" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.find_vocabularies" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_vocabularies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.get_schema_description" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_schema_description
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_asset" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_asset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_association" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_association
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_dataset_rid" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_dataset_rid
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_domain_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_domain_schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_system_schema" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_system_schema
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.is_vocabulary" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_vocabulary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.list_dataset_element_types" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_dataset_element_types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.lookup_feature" class="md-nav__link">
    <span class="md-ellipsis">
      
        lookup_feature
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.name_to_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        name_to_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.DerivaModel.vocab_columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        vocab_columns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.Display" class="md-nav__link">
    <span class="md-ellipsis">
      
        Display
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.Facet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Facet
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetList" class="md-nav__link">
    <span class="md-ellipsis">
      
        FacetList
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FacetList">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetList.add" class="md-nav__link">
    <span class="md-ellipsis">
      
        add
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetRange" class="md-nav__link">
    <span class="md-ellipsis">
      
        FacetRange
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode" class="md-nav__link">
    <span class="md-ellipsis">
      
        FacetUxMode
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FacetUxMode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode--choice-based-facet" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choice-based facet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode--range-based-facet-for-numeric-values" class="md-nav__link">
    <span class="md-ellipsis">
      
        Range-based facet for numeric values
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.FacetUxMode--check-presence-has-value-no-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        Check presence (has value / no value)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer" class="md-nav__link">
    <span class="md-ellipsis">
      
        ForeignKeyOrderer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ForeignKeyOrderer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--get-insertion-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get insertion order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--returns-subject-image-diagnosis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns: ['Subject', 'Image', 'Diagnosis']
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--get-all-tables-in-safe-order" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get all tables in safe order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--get-fk-dependencies-for-a-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get FK dependencies for a table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer--returns-subject-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns: {'Subject', 'Dataset', ...}
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.find_cycles" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_cycles
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_all_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_all_tables
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_deletion_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_deletion_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_dependents" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dependents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.get_insertion_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_insertion_order
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.ForeignKeyOrderer.validate_insertion_order" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_insertion_order
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.InboundFK" class="md-nav__link">
    <span class="md-ellipsis">
      
        InboundFK
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.NameStyle" class="md-nav__link">
    <span class="md-ellipsis">
      
        NameStyle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NameStyle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.NameStyle--transform-subject_id-to-subject-id-with-title-case" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transform "Subject_ID" to "Subject Id" with title case
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.NameStyle.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.OutboundFK" class="md-nav__link">
    <span class="md-ellipsis">
      
        OutboundFK
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.PreFormat" class="md-nav__link">
    <span class="md-ellipsis">
      
        PreFormat
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.PseudoColumn" class="md-nav__link">
    <span class="md-ellipsis">
      
        PseudoColumn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.PseudoColumnDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        PseudoColumnDisplay
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        SchemaBuilder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SchemaBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--create-orm-from-catalog-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create ORM from catalog model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--create-orm-from-schema-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create ORM from schema file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--use-the-orm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Use the ORM
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder--clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clean up
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaBuilder.build" class="md-nav__link">
    <span class="md-ellipsis">
      
        build
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM" class="md-nav__link">
    <span class="md-ellipsis">
      
        SchemaORM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SchemaORM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__del__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __del__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__enter__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __enter__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__exit__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __exit__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.dispose" class="md-nav__link">
    <span class="md-ellipsis">
      
        dispose
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.find_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        find_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_association_class" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_association_class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_orm_class" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_orm_class
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_orm_class_for_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_orm_class_for_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.get_table_contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_table_contents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.is_association_table" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_association_table
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SchemaORM.list_tables" class="md-nav__link">
    <span class="md-ellipsis">
      
        list_tables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.SortKey" class="md-nav__link">
    <span class="md-ellipsis">
      
        SortKey
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SortKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.SortKey.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        TableDisplay
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TableDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        compact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.row_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        row_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplay.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.TableDisplayOptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        TableDisplayOptions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.TemplateEngine" class="md-nav__link">
    <span class="md-ellipsis">
      
        TemplateEngine
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns" class="md-nav__link">
    <span class="md-ellipsis">
      
        VisibleColumns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VisibleColumns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.compact" class="md-nav__link">
    <span class="md-ellipsis">
      
        compact
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.entry" class="md-nav__link">
    <span class="md-ellipsis">
      
        entry
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.entry_create" class="md-nav__link">
    <span class="md-ellipsis">
      
        entry_create
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.entry_edit" class="md-nav__link">
    <span class="md-ellipsis">
      
        entry_edit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleColumns.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys" class="md-nav__link">
    <span class="md-ellipsis">
      
        VisibleForeignKeys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VisibleForeignKeys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys.default" class="md-nav__link">
    <span class="md-ellipsis">
      
        default
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys.detailed" class="md-nav__link">
    <span class="md-ellipsis">
      
        detailed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deriva_ml.model.VisibleForeignKeys.set_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        set_context
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deriva_ml.model.fk_constraint" class="md-nav__link">
    <span class="md-ellipsis">
      
        fk_constraint
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="derivamodel">DerivaModel</h1>
<p>The DerivaModel class provides schema introspection and manipulation capabilities
for Deriva catalogs. It handles table relationships, associations, and catalog
structure management.</p>


<div class="doc doc-object doc-module">



<a id="deriva_ml.model"></a>
    <div class="doc doc-contents first">

        <p>Model module for DerivaML.</p>
<p>This module provides catalog and database model classes, as well as
handle wrappers for ERMrest model objects and annotation builders.</p>
<p>Key components:
- DerivaModel: Schema analysis utilities
- DatabaseModel: SQLite database from BDBag
- SchemaBuilder/SchemaORM: Create ORM from Deriva Model (Phase 1)
- DataLoader: Fill database from data source (Phase 2)
- DataSource: Protocol for data sources (BagDataSource, CatalogDataSource)
- ForeignKeyOrderer: Compute FK-safe insertion order</p>
<p>Lazy imports are used for DatabaseModel and DerivaMLDatabase to avoid
circular imports with the dataset module.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.Aggregate" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Aggregate</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>



        <p>Aggregation functions for pseudo-columns.</p>
<p>Used when a pseudo-column follows an inbound foreign key and returns
multiple values that need to be aggregated.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.Aggregate.MIN">MIN</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum value</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.Aggregate.MAX">MAX</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum value</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.Aggregate.CNT">CNT</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count of values</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.Aggregate.CNT_D">CNT_D</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count of distinct values</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.Aggregate.ARRAY">ARRAY</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of all values</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.Aggregate.ARRAY_D">ARRAY_D</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of distinct values</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="deriva_ml.model.Aggregate--count-related-records">Count related records</h3>
<p>pc = PseudoColumn(
...     source=[InboundFK("domain", "Sample_Subject_fkey"), "RID"],
...     aggregate=Aggregate.CNT,
...     markdown_name="Sample Count"
... )</p>
<h3 id="deriva_ml.model.Aggregate--get-distinct-values-as-array">Get distinct values as array</h3>
<p>pc = PseudoColumn(
...     source=[InboundFK("domain", "Tag_Item_fkey"), "Name"],
...     aggregate=Aggregate.ARRAY_D,
...     markdown_name="Tags"
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Aggregate</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregation functions for pseudo-columns.</span>

<span class="sd">    Used when a pseudo-column follows an inbound foreign key and returns</span>
<span class="sd">    multiple values that need to be aggregated.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        MIN: Minimum value</span>
<span class="sd">        MAX: Maximum value</span>
<span class="sd">        CNT: Count of values</span>
<span class="sd">        CNT_D: Count of distinct values</span>
<span class="sd">        ARRAY: Array of all values</span>
<span class="sd">        ARRAY_D: Array of distinct values</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Count related records</span>
<span class="sd">        &gt;&gt;&gt; pc = PseudoColumn(</span>
<span class="sd">        ...     source=[InboundFK(&quot;domain&quot;, &quot;Sample_Subject_fkey&quot;), &quot;RID&quot;],</span>
<span class="sd">        ...     aggregate=Aggregate.CNT,</span>
<span class="sd">        ...     markdown_name=&quot;Sample Count&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Get distinct values as array</span>
<span class="sd">        &gt;&gt;&gt; pc = PseudoColumn(</span>
<span class="sd">        ...     source=[InboundFK(&quot;domain&quot;, &quot;Tag_Item_fkey&quot;), &quot;Name&quot;],</span>
<span class="sd">        ...     aggregate=Aggregate.ARRAY_D,</span>
<span class="sd">        ...     markdown_name=&quot;Tags&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MIN</span> <span class="o">=</span> <span class="s2">&quot;min&quot;</span>
    <span class="n">MAX</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span>
    <span class="n">CNT</span> <span class="o">=</span> <span class="s2">&quot;cnt&quot;</span>
    <span class="n">CNT_D</span> <span class="o">=</span> <span class="s2">&quot;cnt_d&quot;</span>
    <span class="n">ARRAY</span> <span class="o">=</span> <span class="s2">&quot;array&quot;</span>
    <span class="n">ARRAY_D</span> <span class="o">=</span> <span class="s2">&quot;array_d&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.ArrayUxMode" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ArrayUxMode</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>



        <p>Display modes for array values in pseudo-columns.</p>
<p>Controls how arrays of values are rendered in the UI.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.ArrayUxMode.RAW">RAW</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw array display</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.ArrayUxMode.CSV">CSV</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Comma-separated values</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.ArrayUxMode.OLIST">OLIST</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ordered (numbered) list</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.ArrayUxMode.ULIST">ULIST</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unordered (bulleted) list</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>pc = PseudoColumn(
...     source=[InboundFK("domain", "Tag_Item_fkey"), "Name"],
...     aggregate=Aggregate.ARRAY,
...     display=PseudoColumnDisplay(array_ux_mode=ArrayUxMode.CSV)
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ArrayUxMode</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display modes for array values in pseudo-columns.</span>

<span class="sd">    Controls how arrays of values are rendered in the UI.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        RAW: Raw array display</span>
<span class="sd">        CSV: Comma-separated values</span>
<span class="sd">        OLIST: Ordered (numbered) list</span>
<span class="sd">        ULIST: Unordered (bulleted) list</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; pc = PseudoColumn(</span>
<span class="sd">        ...     source=[InboundFK(&quot;domain&quot;, &quot;Tag_Item_fkey&quot;), &quot;Name&quot;],</span>
<span class="sd">        ...     aggregate=Aggregate.ARRAY,</span>
<span class="sd">        ...     display=PseudoColumnDisplay(array_ux_mode=ArrayUxMode.CSV)</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RAW</span> <span class="o">=</span> <span class="s2">&quot;raw&quot;</span>
    <span class="n">CSV</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span>
    <span class="n">OLIST</span> <span class="o">=</span> <span class="s2">&quot;olist&quot;</span>
    <span class="n">ULIST</span> <span class="o">=</span> <span class="s2">&quot;ulist&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.BagDataSource" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BagDataSource</span>


</h2>


    <div class="doc doc-contents ">



        <p>DataSource implementation for BDBag directories.</p>
<p>Reads data from CSV files in a bag's data/ directory.
Handles asset URL localization via fetch.txt.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>source = BagDataSource(Path("/path/to/bag"))</p>
<h3 id="deriva_ml.model.BagDataSource--list-available-tables">List available tables</h3>
<p>print(source.list_available_tables())</p>
<h3 id="deriva_ml.model.BagDataSource--get-data-for-a-table">Get data for a table</h3>
<p>for row in source.get_table_data("Image"):
    print(row["Filename"])</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BagDataSource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DataSource implementation for BDBag directories.</span>

<span class="sd">    Reads data from CSV files in a bag&#39;s data/ directory.</span>
<span class="sd">    Handles asset URL localization via fetch.txt.</span>

<span class="sd">    Example:</span>
<span class="sd">        source = BagDataSource(Path(&quot;/path/to/bag&quot;))</span>

<span class="sd">        # List available tables</span>
<span class="sd">        print(source.list_available_tables())</span>

<span class="sd">        # Get data for a table</span>
<span class="sd">        for row in source.get_table_data(&quot;Image&quot;):</span>
<span class="sd">            print(row[&quot;Filename&quot;])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bag_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">asset_localization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize from a bag path.</span>

<span class="sd">        Args:</span>
<span class="sd">            bag_path: Path to BDBag directory.</span>
<span class="sd">            model: Optional ERMrest Model for schema info. If not provided,</span>
<span class="sd">                will try to load from bag&#39;s schema.json.</span>
<span class="sd">            asset_localization: Whether to localize asset URLs to local paths</span>
<span class="sd">                using fetch.txt mapping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>

        <span class="c1"># Load model if not provided</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">schema_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;schema.json&quot;</span>
            <span class="k">if</span> <span class="n">schema_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="s2">&quot;file-system&quot;</span><span class="p">,</span> <span class="n">schema_file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No schema.json found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># Build asset map for URL localization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_asset_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_asset_map</span><span class="p">()</span> <span class="k">if</span> <span class="n">asset_localization</span> <span class="k">else</span> <span class="p">{}</span>

        <span class="c1"># Cache of table name -&gt; list of csv file paths (multiple paths for nested datasets)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_csv_cache</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_csv_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build cache mapping table names to CSV file paths.</span>

<span class="sd">        Nested datasets can produce multiple CSV files for the same table</span>
<span class="sd">        at different directory depths. All paths are collected so that</span>
<span class="sd">        get_table_data() yields the union of all rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*.csv&quot;</span><span class="p">):</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">stem</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_asset_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build a map from remote URLs to local file paths using fetch.txt.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary mapping URL paths to local file paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fetch_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fetch_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;fetch.txt&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fetch_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No fetch.txt in bag </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">fetch_map</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">fetch_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># Rows in fetch.txt are tab-separated: URL, size, local_path</span>
                    <span class="n">fields</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">local_file</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="n">local_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">local_file</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="n">fetch_map</span><span class="p">[</span><span class="n">urlparse</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_path</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading fetch.txt: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fetch_map</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract table name from table object or string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Handle schema.table format</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">table</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_asset_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a table is an asset table (has Filename, URL, etc. columns).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">ASSET_COLUMNS</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_localize_asset_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace URL with local path in asset table row.</span>

<span class="sd">        Args:</span>
<span class="sd">            row: Dictionary of column values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Updated dictionary with localized file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;URL&quot;</span> <span class="ow">in</span> <span class="n">row</span> <span class="ow">and</span> <span class="s2">&quot;Filename&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;URL&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">url</span> <span class="ow">and</span> <span class="n">url</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asset_map</span><span class="p">:</span>
                <span class="n">row</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>  <span class="c1"># Copy to avoid mutating original</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asset_map</span><span class="p">[</span><span class="n">url</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">row</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read table data from CSV files.</span>

<span class="sd">        Nested datasets may produce multiple CSV files for the same table</span>
<span class="sd">        at different directory depths. This method yields rows from all of</span>
<span class="sd">        them so that the full dataset (including parent and child records)</span>
<span class="sd">        is loaded.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Dictionary per row with column names as keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">csv_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_files</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No CSV file found for table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">is_asset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_asset_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="k">with</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">is_asset</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asset_map</span><span class="p">:</span>
                        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_localize_asset_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">row</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if CSV exists for table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if CSV file exists for this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_available_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all CSV files in data directory.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of table names (without .csv extension).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_row_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of rows across all CSV files for a table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of data rows (excluding headers).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">csv_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># Count lines minus header</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">total</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.BagDataSource.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">bag_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">asset_localization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize from a bag path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bag_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to BDBag directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Model">Model</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional ERMrest Model for schema info. If not provided,
will try to load from bag's schema.json.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>asset_localization</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to localize asset URLs to local paths
using fetch.txt mapping.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bag_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">asset_localization</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize from a bag path.</span>

<span class="sd">    Args:</span>
<span class="sd">        bag_path: Path to BDBag directory.</span>
<span class="sd">        model: Optional ERMrest Model for schema info. If not provided,</span>
<span class="sd">            will try to load from bag&#39;s schema.json.</span>
<span class="sd">        asset_localization: Whether to localize asset URLs to local paths</span>
<span class="sd">            using fetch.txt mapping.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bag_path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span>

    <span class="c1"># Load model if not provided</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_path</span> <span class="o">/</span> <span class="s2">&quot;schema.json&quot;</span>
        <span class="k">if</span> <span class="n">schema_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="s2">&quot;file-system&quot;</span><span class="p">,</span> <span class="n">schema_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No schema.json found in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bag_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

    <span class="c1"># Build asset map for URL localization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_asset_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_asset_map</span><span class="p">()</span> <span class="k">if</span> <span class="n">asset_localization</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="c1"># Cache of table name -&gt; list of csv file paths (multiple paths for nested datasets)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_csv_cache</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.BagDataSource.get_row_count" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_row_count</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_row_count</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the number of rows across all CSV files for a table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of data rows (excluding headers).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_row_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the number of rows across all CSV files for a table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of data rows (excluding headers).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">csv_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_files</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="c1"># Count lines minus header</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">total</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.BagDataSource.get_table_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_table_data</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_table_data</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Read table data from CSV files.</p>
<p>Nested datasets may produce multiple CSV files for the same table
at different directory depths. This method yields rows from all of
them so that the full dataset (including parent and child records)
is loaded.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary per row with column names as keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read table data from CSV files.</span>

<span class="sd">    Nested datasets may produce multiple CSV files for the same table</span>
<span class="sd">    at different directory depths. This method yields rows from all of</span>
<span class="sd">    them so that the full dataset (including parent and child records)</span>
<span class="sd">    is loaded.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Dictionary per row with column names as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">csv_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_files</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No CSV file found for table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">is_asset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_asset_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">csv_file</span> <span class="ow">in</span> <span class="n">csv_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="k">with</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_asset</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_asset_map</span><span class="p">:</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_localize_asset_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">row</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.BagDataSource.has_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">has_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">has_table</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if CSV exists for table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if CSV file exists for this table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if CSV exists for table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if CSV file exists for this table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_name</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.BagDataSource.list_available_tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_available_tables</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_available_tables</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all CSV files in data directory.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of table names (without .csv extension).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_available_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all CSV files in data directory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of table names (without .csv extension).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_csv_cache</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.CatalogDataSource" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">CatalogDataSource</span>


</h2>


    <div class="doc doc-contents ">



        <p>DataSource implementation for remote Deriva catalog.</p>
<p>Fetches data via ERMrest API / datapath with pagination support.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>catalog = server.connect_ermrest(catalog_id)
source = CatalogDataSource(catalog, schemas=['domain', 'deriva-ml'])</p>
<h3 id="deriva_ml.model.CatalogDataSource--list-available-tables">List available tables</h3>
<p>print(source.list_available_tables())</p>
<h3 id="deriva_ml.model.CatalogDataSource--get-data-for-a-table">Get data for a table</h3>
<p>for row in source.get_table_data("Image"):
    print(row["Filename"])</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CatalogDataSource</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;DataSource implementation for remote Deriva catalog.</span>

<span class="sd">    Fetches data via ERMrest API / datapath with pagination support.</span>

<span class="sd">    Example:</span>
<span class="sd">        catalog = server.connect_ermrest(catalog_id)</span>
<span class="sd">        source = CatalogDataSource(catalog, schemas=[&#39;domain&#39;, &#39;deriva-ml&#39;])</span>

<span class="sd">        # List available tables</span>
<span class="sd">        print(source.list_available_tables())</span>

<span class="sd">        # Get data for a table</span>
<span class="sd">        for row in source.get_table_data(&quot;Image&quot;):</span>
<span class="sd">            print(row[&quot;Filename&quot;])</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">catalog</span><span class="p">:</span> <span class="n">ErmrestCatalog</span><span class="p">,</span>
        <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize from catalog connection.</span>

<span class="sd">        Args:</span>
<span class="sd">            catalog: ERMrest catalog connection.</span>
<span class="sd">            schemas: Schemas to fetch data from.</span>
<span class="sd">            batch_size: Number of rows per API request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="n">schemas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">getPathBuilder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">getCatalogModel</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_table_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get schema and table name for a table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (schema_name, table_name) or None if not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Handle schema.table format</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Search schemas for table</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">schema_name</span><span class="p">,</span> <span class="n">table</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch table data via ERMrest API.</span>

<span class="sd">        Uses pagination to handle large tables efficiently.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Dictionary per row with column names as keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_info</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> not found in schemas </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_info</span>

        <span class="c1"># Build path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

        <span class="c1"># Paginated fetch using RID ordering</span>
        <span class="n">last_rid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Build query with optional RID filter</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">last_rid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">RID</span> <span class="o">&gt;</span> <span class="n">last_rid</span><span class="p">)</span>

            <span class="c1"># Fetch batch ordered by RID</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">RID</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching from </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">entities</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
                <span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

            <span class="c1"># Track last RID for pagination</span>
            <span class="n">last_rid</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if table exists in catalog.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if table exists in configured schemas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_info</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_available_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all tables in configured schemas.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of fully-qualified table names (schema.table).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_row_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of rows in a table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of rows in the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_info</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_info</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use count aggregate</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">aggregates</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">RID</span><span class="o">.</span><span class="n">cnt</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error counting </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.CatalogDataSource.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">ErmrestCatalog</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize from catalog connection.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>catalog</code>
            </td>
            <td>
                  <code><span title="deriva.core.ErmrestCatalog">ErmrestCatalog</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ERMrest catalog connection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schemas</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schemas to fetch data from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows per API request.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="n">ErmrestCatalog</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize from catalog connection.</span>

<span class="sd">    Args:</span>
<span class="sd">        catalog: ERMrest catalog connection.</span>
<span class="sd">        schemas: Schemas to fetch data from.</span>
<span class="sd">        batch_size: Number of rows per API request.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">=</span> <span class="n">catalog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="n">schemas</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">getPathBuilder</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">getCatalogModel</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.CatalogDataSource.get_row_count" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_row_count</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_row_count</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the number of rows in a table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows in the table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_row_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the number of rows in a table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of rows in the table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_info</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_info</span>
    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use count aggregate</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">aggregates</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">RID</span><span class="o">.</span><span class="n">cnt</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">fetch</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error counting </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.CatalogDataSource.get_table_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_table_data</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_table_data</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Fetch table data via ERMrest API.</p>
<p>Uses pagination to handle large tables efficiently.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary per row with column names as keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch table data via ERMrest API.</span>

<span class="sd">    Uses pagination to handle large tables efficiently.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Dictionary per row with column names as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_info</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> not found in schemas </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">schema_name</span><span class="p">,</span> <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_info</span>

    <span class="c1"># Build path</span>
    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pb</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

    <span class="c1"># Paginated fetch using RID ordering</span>
    <span class="n">last_rid</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Build query with optional RID filter</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">last_rid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">RID</span> <span class="o">&gt;</span> <span class="n">last_rid</span><span class="p">)</span>

        <span class="c1"># Fetch batch ordered by RID</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">RID</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching from </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entities</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="c1"># Track last RID for pagination</span>
        <span class="n">last_rid</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;RID&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">:</span>
            <span class="k">break</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.CatalogDataSource.has_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">has_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">has_table</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if table exists in catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if table exists in configured schemas.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if table exists in catalog.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if table exists in configured schemas.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_table_info</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.CatalogDataSource.list_available_tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_available_tables</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_available_tables</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all tables in configured schemas.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of fully-qualified table names (schema.table).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_available_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all tables in configured schemas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of fully-qualified table names (schema.table).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.ColumnDisplay" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ColumnDisplay</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="deriva_ml.model.annotations.AnnotationBuilder">AnnotationBuilder</span></code></p>



        <p>Column-display annotation builder.</p>
<p>Controls how column values are rendered.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>cd = ColumnDisplay()
cd.default(ColumnDisplayOptions(
...     pre_format=PreFormat(format="%.2f")
... ))</p>
<h3 id="deriva_ml.model.ColumnDisplay--markdown-link">Markdown link</h3>
<p>cd = ColumnDisplay()
cd.default(ColumnDisplayOptions(
...     markdown_pattern="<a href="{{{_value}}}">Link</a>"
... ))</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ColumnDisplay</span><span class="p">(</span><span class="n">AnnotationBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Column-display annotation builder.</span>

<span class="sd">    Controls how column values are rendered.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; cd = ColumnDisplay()</span>
<span class="sd">        &gt;&gt;&gt; cd.default(ColumnDisplayOptions(</span>
<span class="sd">        ...     pre_format=PreFormat(format=&quot;%.2f&quot;)</span>
<span class="sd">        ... ))</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Markdown link</span>
<span class="sd">        &gt;&gt;&gt; cd = ColumnDisplay()</span>
<span class="sd">        &gt;&gt;&gt; cd.default(ColumnDisplayOptions(</span>
<span class="sd">        ...     markdown_pattern=&quot;[Link]({{{_value}}})&quot;</span>
<span class="sd">        ... ))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_COLUMN_DISPLAY</span>

    <span class="n">_contexts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ColumnDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set options for a context.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set default options.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set options for compact view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_COMPACT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set options for detailed view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ColumnDisplay.compact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compact</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">compact</span><span class="p">(</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set options for compact view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set options for compact view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_COMPACT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ColumnDisplay.default" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">default</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">default</span><span class="p">(</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set default options.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set default options.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ColumnDisplay.detailed" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">detailed</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">detailed</span><span class="p">(</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set options for detailed view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set options for detailed view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ColumnDisplay.set_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_context</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_context</span><span class="p">(</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set options for a context.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">ColumnDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ColumnDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set options for a context.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.ColumnDisplayOptions" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ColumnDisplayOptions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Options for displaying a column in a specific context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pre_format</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="PreFormat


  
      dataclass
   (deriva_ml.model.annotations.PreFormat)" href="#deriva_ml.model.PreFormat">PreFormat</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pre-formatting options</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>markdown_pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template for rendering</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_engine</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TemplateEngine (deriva_ml.model.annotations.TemplateEngine)" href="#deriva_ml.model.TemplateEngine">TemplateEngine</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template engine to use</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>column_order</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="SortKey


  
      dataclass
   (deriva_ml.model.annotations.SortKey)" href="#deriva_ml.model.SortKey">SortKey</a>] | <span title="typing.Literal">Literal</span>[False] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sort order, or False to disable</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ColumnDisplayOptions</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Options for displaying a column in a specific context.</span>

<span class="sd">    Args:</span>
<span class="sd">        pre_format: Pre-formatting options</span>
<span class="sd">        markdown_pattern: Template for rendering</span>
<span class="sd">        template_engine: Template engine to use</span>
<span class="sd">        column_order: Sort order, or False to disable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pre_format</span><span class="p">:</span> <span class="n">PreFormat</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">markdown_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">template_engine</span><span class="p">:</span> <span class="n">TemplateEngine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">column_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SortKey</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;pre_format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pre_format</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown_pattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_pattern</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;template_engine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_engine</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_order</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;column_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;column_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">SortKey</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_order</span>
                <span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.DataLoader" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DataLoader</span>


</h2>


    <div class="doc doc-contents ">



        <p>Loads data into a database with FK ordering.</p>
<p>Phase 2 of the two-phase database creation pattern. Takes a
SchemaORM (from Phase 1) and populates it from a DataSource.</p>
<p>Automatically orders tables by FK dependencies to ensure
referential integrity during loading.</p>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="deriva_ml.model.DataLoader--phase-1-create-orm">Phase 1: Create ORM</h3>
<p>orm = SchemaBuilder(model, schemas).build()</p>
<h3 id="deriva_ml.model.DataLoader--phase-2-fill-with-data-from-bag">Phase 2: Fill with data from bag</h3>
<p>source = BagDataSource(bag_path)
loader = DataLoader(orm, source)
counts = loader.load_tables()  # All tables
print(f"Loaded {sum(counts.values())} total rows")</p>
<h3 id="deriva_ml.model.DataLoader--or-load-specific-tables">Or load specific tables</h3>
<p>counts = loader.load_tables(['Subject', 'Image'])</p>
<h3 id="deriva_ml.model.DataLoader--with-progress-callback">With progress callback</h3>
<p>def on_progress(table, count, total):
    print(f"Loaded {table}: {count} rows")
loader.load_tables(progress_callback=on_progress)</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/data_loader.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DataLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads data into a database with FK ordering.</span>

<span class="sd">    Phase 2 of the two-phase database creation pattern. Takes a</span>
<span class="sd">    SchemaORM (from Phase 1) and populates it from a DataSource.</span>

<span class="sd">    Automatically orders tables by FK dependencies to ensure</span>
<span class="sd">    referential integrity during loading.</span>

<span class="sd">    Example:</span>
<span class="sd">        # Phase 1: Create ORM</span>
<span class="sd">        orm = SchemaBuilder(model, schemas).build()</span>

<span class="sd">        # Phase 2: Fill with data from bag</span>
<span class="sd">        source = BagDataSource(bag_path)</span>
<span class="sd">        loader = DataLoader(orm, source)</span>
<span class="sd">        counts = loader.load_tables()  # All tables</span>
<span class="sd">        print(f&quot;Loaded {sum(counts.values())} total rows&quot;)</span>

<span class="sd">        # Or load specific tables</span>
<span class="sd">        counts = loader.load_tables([&#39;Subject&#39;, &#39;Image&#39;])</span>

<span class="sd">        # With progress callback</span>
<span class="sd">        def on_progress(table, count, total):</span>
<span class="sd">            print(f&quot;Loaded {table}: {count} rows&quot;)</span>
<span class="sd">        loader.load_tables(progress_callback=on_progress)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">schema_orm</span><span class="p">:</span> <span class="n">SchemaORM</span><span class="p">,</span>
        <span class="n">data_source</span><span class="p">:</span> <span class="n">DataSource</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the loader.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema_orm: ORM structure from SchemaBuilder.</span>
<span class="sd">            data_source: Source of data to load (BagDataSource, CatalogDataSource, etc.).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orm</span> <span class="o">=</span> <span class="n">schema_orm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">data_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span> <span class="o">=</span> <span class="n">ForeignKeyOrderer</span><span class="p">(</span>
            <span class="n">schema_orm</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">schema_orm</span><span class="o">.</span><span class="n">schemas</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_tables</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load data into specified tables with FK ordering.</span>

<span class="sd">        Tables are automatically ordered by FK dependencies to ensure</span>
<span class="sd">        referenced tables are populated first.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Tables to load. If None, loads all tables that have</span>
<span class="sd">                data in the source.</span>
<span class="sd">            on_conflict: How to handle duplicate keys:</span>
<span class="sd">                - &quot;ignore&quot;: Skip rows with duplicate keys (default)</span>
<span class="sd">                - &quot;replace&quot;: Replace existing rows</span>
<span class="sd">                - &quot;error&quot;: Raise error on duplicates</span>
<span class="sd">            batch_size: Number of rows per insert batch.</span>
<span class="sd">            progress_callback: Optional callback(table_name, rows_loaded, total_tables)</span>
<span class="sd">                called after each table is loaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping table names to row counts loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine tables to load</span>
        <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Get all tables that have data in source</span>
            <span class="n">available</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">list_available_tables</span><span class="p">())</span>
            <span class="c1"># Filter to tables that exist in ORM</span>
            <span class="n">orm_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">list_tables</span><span class="p">())</span>

            <span class="c1"># Match available tables to ORM tables</span>
            <span class="n">tables_to_load</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">orm_table</span> <span class="ow">in</span> <span class="n">orm_tables</span><span class="p">:</span>
                <span class="c1"># Check both qualified and unqualified names</span>
                <span class="n">table_name</span> <span class="o">=</span> <span class="n">orm_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">orm_table</span> <span class="ow">in</span> <span class="n">available</span> <span class="ow">or</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">available</span><span class="p">:</span>
                    <span class="n">tables_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orm_table</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tables_to_load</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">t</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables</span>
            <span class="p">]</span>

        <span class="c1"># Compute insertion order</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ordered_tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">get_insertion_order</span><span class="p">(</span><span class="n">tables_to_load</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Some tables might not be in the model, just use original order</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not compute FK ordering: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ordered_tables</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables_to_load</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="c1"># Load in order</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">total_tables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordered_tables</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ordered_tables</span><span class="p">):</span>
            <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">on_conflict</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">table_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

            <span class="k">if</span> <span class="n">progress_callback</span><span class="p">:</span>
                <span class="n">progress_callback</span><span class="p">(</span><span class="n">table_key</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">total_tables</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> rows into </span><span class="si">{</span><span class="n">table_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">counts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_table_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if table exists in ORM.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span><span class="p">,</span>
        <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a single table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table to load.</span>
<span class="sd">            on_conflict: Conflict handling strategy.</span>
<span class="sd">            batch_size: Rows per batch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of rows loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Find SQL table</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table_key</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table_key</span><span class="si">}</span><span class="s2"> not found in ORM&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Check if source has data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">has_table</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data for </span><span class="si">{</span><span class="n">table_key</span><span class="si">}</span><span class="s2"> in source&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Get data from source</span>
        <span class="n">rows_loaded</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">get_table_data</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">batch_size</span><span class="p">:</span>
                    <span class="n">rows_loaded</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_batch</span><span class="p">(</span>
                        <span class="n">conn</span><span class="p">,</span> <span class="n">sql_table</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">on_conflict</span>
                    <span class="p">)</span>
                    <span class="n">batch</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Insert remaining rows</span>
            <span class="k">if</span> <span class="n">batch</span><span class="p">:</span>
                <span class="n">rows_loaded</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_batch</span><span class="p">(</span>
                    <span class="n">conn</span><span class="p">,</span> <span class="n">sql_table</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">on_conflict</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">rows_loaded</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_insert_batch</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">conn</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">sql_table</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
        <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert a batch of rows.</span>

<span class="sd">        Args:</span>
<span class="sd">            conn: Database connection.</span>
<span class="sd">            sql_table: SQLAlchemy table.</span>
<span class="sd">            rows: List of row dictionaries.</span>
<span class="sd">            on_conflict: Conflict handling strategy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of rows inserted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rows</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">on_conflict</span> <span class="o">==</span> <span class="s2">&quot;ignore&quot;</span><span class="p">:</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="n">sqlite_insert</span><span class="p">(</span><span class="n">sql_table</span><span class="p">)</span><span class="o">.</span><span class="n">on_conflict_do_nothing</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">on_conflict</span> <span class="o">==</span> <span class="s2">&quot;replace&quot;</span><span class="p">:</span>
                <span class="c1"># For SQLite, we need to specify all columns for upsert</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="n">sqlite_insert</span><span class="p">(</span><span class="n">sql_table</span><span class="p">)</span>
                <span class="n">update_cols</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">stmt</span><span class="o">.</span><span class="n">excluded</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;RID&quot;</span><span class="p">,)</span>  <span class="c1"># Don&#39;t update primary key</span>
                <span class="p">}</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="n">on_conflict_do_update</span><span class="p">(</span>
                    <span class="n">index_elements</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RID&quot;</span><span class="p">],</span>
                    <span class="n">set_</span><span class="o">=</span><span class="n">update_cols</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stmt</span> <span class="o">=</span> <span class="n">sql_table</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span>

            <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error inserting into </span><span class="si">{</span><span class="n">sql_table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">on_conflict</span> <span class="o">==</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">,</span>
        <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a single table (without FK ordering).</span>

<span class="sd">        Use this when you know the dependencies are already satisfied</span>
<span class="sd">        or for loading a single table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table to load.</span>
<span class="sd">            on_conflict: Conflict handling strategy.</span>
<span class="sd">            batch_size: Rows per batch.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of rows loaded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">on_conflict</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_load_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the FK-safe load order for tables without loading.</span>

<span class="sd">        Useful for previewing or manually controlling load order.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Tables to order. If None, orders all available.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of table names in safe insertion order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">list_available_tables</span><span class="p">()</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">available</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>

        <span class="n">ordered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">get_insertion_order</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_load_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that tables can be loaded in the given order.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Ordered list of tables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of FK violations as (table, missing_dep, fk_name) tuples.</span>
<span class="sd">            Empty if order is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">validate_insertion_order</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataLoader.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">schema_orm</span><span class="p">:</span> <span class="n">SchemaORM</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="n">DataSource</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the loader.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema_orm</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SchemaORM (deriva_ml.model.schema_builder.SchemaORM)" href="#deriva_ml.model.SchemaORM">SchemaORM</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ORM structure from SchemaBuilder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_source</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="DataSource (deriva_ml.model.data_sources.DataSource)" href="#deriva_ml.model.DataSource">DataSource</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source of data to load (BagDataSource, CatalogDataSource, etc.).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">schema_orm</span><span class="p">:</span> <span class="n">SchemaORM</span><span class="p">,</span>
    <span class="n">data_source</span><span class="p">:</span> <span class="n">DataSource</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the loader.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema_orm: ORM structure from SchemaBuilder.</span>
<span class="sd">        data_source: Source of data to load (BagDataSource, CatalogDataSource, etc.).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orm</span> <span class="o">=</span> <span class="n">schema_orm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">data_source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span> <span class="o">=</span> <span class="n">ForeignKeyOrderer</span><span class="p">(</span>
        <span class="n">schema_orm</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="n">schema_orm</span><span class="o">.</span><span class="n">schemas</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataLoader.get_load_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_load_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_load_order</span><span class="p">(</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the FK-safe load order for tables without loading.</p>
<p>Useful for previewing or manually controlling load order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tables to order. If None, orders all available.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of table names in safe insertion order.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_load_order</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the FK-safe load order for tables without loading.</span>

<span class="sd">    Useful for previewing or manually controlling load order.</span>

<span class="sd">    Args:</span>
<span class="sd">        tables: Tables to order. If None, orders all available.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of table names in safe insertion order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">available</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">list_available_tables</span><span class="p">()</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">available</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>

    <span class="n">ordered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">get_insertion_order</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ordered</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataLoader.load_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_table</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
    <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load a single table (without FK ordering).</p>
<p>Use this when you know the dependencies are already satisfied
or for loading a single table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table to load.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_conflict</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Conflict handling strategy.</p>
              </div>
            </td>
            <td>
                  <code>&#39;ignore&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Rows per batch.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows loaded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">,</span>
    <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a single table (without FK ordering).</span>

<span class="sd">    Use this when you know the dependencies are already satisfied</span>
<span class="sd">    or for loading a single table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table to load.</span>
<span class="sd">        on_conflict: Conflict handling strategy.</span>
<span class="sd">        batch_size: Rows per batch.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of rows loaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">on_conflict</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataLoader.load_tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">load_tables</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">load_tables</span><span class="p">(</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span>
        <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span>
    <span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load data into specified tables with FK ordering.</p>
<p>Tables are automatically ordered by FK dependencies to ensure
referenced tables are populated first.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tables to load. If None, loads all tables that have
data in the source.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>on_conflict</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to handle duplicate keys:
- "ignore": Skip rows with duplicate keys (default)
- "replace": Replace existing rows
- "error": Raise error on duplicates</p>
              </div>
            </td>
            <td>
                  <code>&#39;ignore&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows per insert batch.</p>
              </div>
            </td>
            <td>
                  <code>1000</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>progress_callback</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span>[[<span title="str">str</span>, <span title="int">int</span>, <span title="int">int</span>], None] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional callback(table_name, rows_loaded, total_tables)
called after each table is loaded.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping table names to row counts loaded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_tables</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">on_conflict</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">progress_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load data into specified tables with FK ordering.</span>

<span class="sd">    Tables are automatically ordered by FK dependencies to ensure</span>
<span class="sd">    referenced tables are populated first.</span>

<span class="sd">    Args:</span>
<span class="sd">        tables: Tables to load. If None, loads all tables that have</span>
<span class="sd">            data in the source.</span>
<span class="sd">        on_conflict: How to handle duplicate keys:</span>
<span class="sd">            - &quot;ignore&quot;: Skip rows with duplicate keys (default)</span>
<span class="sd">            - &quot;replace&quot;: Replace existing rows</span>
<span class="sd">            - &quot;error&quot;: Raise error on duplicates</span>
<span class="sd">        batch_size: Number of rows per insert batch.</span>
<span class="sd">        progress_callback: Optional callback(table_name, rows_loaded, total_tables)</span>
<span class="sd">            called after each table is loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping table names to row counts loaded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Determine tables to load</span>
    <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Get all tables that have data in source</span>
        <span class="n">available</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">list_available_tables</span><span class="p">())</span>
        <span class="c1"># Filter to tables that exist in ORM</span>
        <span class="n">orm_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">list_tables</span><span class="p">())</span>

        <span class="c1"># Match available tables to ORM tables</span>
        <span class="n">tables_to_load</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">orm_table</span> <span class="ow">in</span> <span class="n">orm_tables</span><span class="p">:</span>
            <span class="c1"># Check both qualified and unqualified names</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">orm_table</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">orm_table</span> <span class="ow">in</span> <span class="n">available</span> <span class="ow">or</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">available</span><span class="p">:</span>
                <span class="n">tables_to_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orm_table</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tables_to_load</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">t</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables</span>
        <span class="p">]</span>

    <span class="c1"># Compute insertion order</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ordered_tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">get_insertion_order</span><span class="p">(</span><span class="n">tables_to_load</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Some tables might not be in the model, just use original order</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not compute FK ordering: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ordered_tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables_to_load</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="c1"># Load in order</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">total_tables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ordered_tables</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ordered_tables</span><span class="p">):</span>
        <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">on_conflict</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">table_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>

        <span class="k">if</span> <span class="n">progress_callback</span><span class="p">:</span>
            <span class="n">progress_callback</span><span class="p">(</span><span class="n">table_key</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">total_tables</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> rows into </span><span class="si">{</span><span class="n">table_key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">counts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataLoader.validate_load_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_load_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_load_order</span><span class="p">(</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate that tables can be loaded in the given order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ordered list of tables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of FK violations as (table, missing_dep, fk_name) tuples.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Empty if order is valid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_loader.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_load_order</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that tables can be loaded in the given order.</span>

<span class="sd">    Args:</span>
<span class="sd">        tables: Ordered list of tables.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of FK violations as (table, missing_dep, fk_name) tuples.</span>
<span class="sd">        Empty if order is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderer</span><span class="o">.</span><span class="n">validate_insertion_order</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.DataSource" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DataSource</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>



        <p>Protocol for data sources that can fill a database.</p>
<p>Implementations provide data for populating SQLite tables from
different sources (bags, remote catalogs, etc.).</p>
<p>This is used with DataLoader in Phase 2 of the two-phase pattern.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@runtime_checkable</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DataSource</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol for data sources that can fill a database.</span>

<span class="sd">    Implementations provide data for populating SQLite tables from</span>
<span class="sd">    different sources (bags, remote catalogs, etc.).</span>

<span class="sd">    This is used with DataLoader in Phase 2 of the two-phase pattern.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield rows for a table as dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name to get data for.</span>

<span class="sd">        Yields:</span>
<span class="sd">            Dictionary per row with column names as keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if this source has data for the table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table object or name to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if data is available for this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_available_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List tables with available data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of table names (may include schema prefix).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataSource.get_table_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_table_data</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_table_data</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Yield rows for a table as dictionaries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name to get data for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary per row with column names as keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_table_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Yield rows for a table as dictionaries.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name to get data for.</span>

<span class="sd">    Yields:</span>
<span class="sd">        Dictionary per row with column names as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataSource.has_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">has_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">has_table</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if this source has data for the table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object or name to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if data is available for this table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">has_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if this source has data for the table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table object or name to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if data is available for this table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DataSource.list_available_tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_available_tables</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_available_tables</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List tables with available data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of table names (may include schema prefix).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/data_sources.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_available_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List tables with available data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of table names (may include schema prefix).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.DerivaModel" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DerivaModel</span>


</h2>


    <div class="doc doc-contents ">



        <p>Augmented interface to deriva model class.</p>
<p>This class provides a number of DerivaML specific methods that augment the interface in the deriva model class.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.DerivaModel.model">model</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ERMRest model for the catalog.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.DerivaModel.catalog">catalog</span></code></td>
            <td>
                  <code><span title="deriva_ml.model.catalog.ErmrestCatalog">ErmrestCatalog</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ERMRest catalog for the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.DerivaModel.hostname">hostname</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hostname of the ERMRest server.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.DerivaModel.ml_schema">ml_schema</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ML schema name for the catalog.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.DerivaModel.domain_schemas">domain_schemas</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Frozenset of all domain schema names in the catalog.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.DerivaModel.default_schema">default_schema</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The default schema for table creation operations.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DerivaModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Augmented interface to deriva model class.</span>

<span class="sd">    This class provides a number of DerivaML specific methods that augment the interface in the deriva model class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        model: ERMRest model for the catalog.</span>
<span class="sd">        catalog: ERMRest catalog for the model.</span>
<span class="sd">        hostname: Hostname of the ERMRest server.</span>
<span class="sd">        ml_schema: The ML schema name for the catalog.</span>
<span class="sd">        domain_schemas: Frozenset of all domain schema names in the catalog.</span>
<span class="sd">        default_schema: The default schema for table creation operations.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">ml_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">ML_SCHEMA</span><span class="p">,</span>
        <span class="n">domain_schemas</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create and initialize a DerivaModel instance.</span>

<span class="sd">        This method will connect to a catalog and initialize schema configuration.</span>
<span class="sd">        This class is intended to be used as a base class on which domain-specific interfaces are built.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: The ERMRest model for the catalog.</span>
<span class="sd">            ml_schema: The ML schema name.</span>
<span class="sd">            domain_schemas: Optional explicit set of domain schema names. If None,</span>
<span class="sd">                auto-detects all non-system schemas.</span>
<span class="sd">            default_schema: The default schema for table creation operations. If None</span>
<span class="sd">                and there is exactly one domain schema, that schema is used as default.</span>
<span class="sd">                If there are multiple domain schemas, default_schema must be specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">:</span> <span class="n">ErmrestCatalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">catalog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">deriva_server</span><span class="o">.</span><span class="n">server</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span> <span class="n">ErmrestCatalog</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;localhost&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span> <span class="o">=</span> <span class="n">ml_schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_system_schemas</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">SYSTEM_SCHEMAS</span> <span class="o">|</span> <span class="p">{</span><span class="n">ml_schema</span><span class="p">})</span>

        <span class="c1"># Determine domain schemas</span>
        <span class="k">if</span> <span class="n">domain_schemas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">domain_schemas</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain_schemas</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">domain_schemas</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Auto-detect all domain schemas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span> <span class="o">=</span> <span class="n">get_domain_schemas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ml_schema</span><span class="p">)</span>

        <span class="c1"># Determine default schema for table creation</span>
        <span class="k">if</span> <span class="n">default_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default_schema</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;default_schema &#39;</span><span class="si">{</span><span class="n">default_schema</span><span class="si">}</span><span class="s2">&#39; is not in domain_schemas: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="n">default_schema</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Single domain schema - use it as default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># No domain schemas - default_schema will be None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Multiple domain schemas, no explicit default</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_system_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a schema is a system or ML schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema_name: Name of the schema to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the schema is a system or ML schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">is_system_schema</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_domain_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a schema is a domain schema.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema_name: Name of the schema to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the schema is a domain schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_require_default_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get default schema, raising an error if not set.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The default schema name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If default_schema is not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No default_schema set. With multiple domain schemas </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;you must either specify a default_schema when creating DerivaML or &quot;</span>
                <span class="s2">&quot;pass an explicit schema parameter to this method.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">refresh_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">getCatalogModel</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">chaise_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the chaise configuration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">chaise_config</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_schema_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_system_columns</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a JSON description of the catalog schema structure.</span>

<span class="sd">        Provides a structured representation of the domain and ML schemas including</span>
<span class="sd">        tables, columns, foreign keys, and relationships. Useful for understanding</span>
<span class="sd">        the data model structure programmatically.</span>

<span class="sd">        Args:</span>
<span class="sd">            include_system_columns: If True, include RID, RCT, RMT, RCB, RMB columns.</span>
<span class="sd">                Default False to reduce output size.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary with schema structure:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;domain_schemas&quot;: [&quot;schema_name1&quot;, &quot;schema_name2&quot;],</span>
<span class="sd">                &quot;default_schema&quot;: &quot;schema_name1&quot;,</span>
<span class="sd">                &quot;ml_schema&quot;: &quot;deriva-ml&quot;,</span>
<span class="sd">                &quot;schemas&quot;: {</span>
<span class="sd">                    &quot;schema_name&quot;: {</span>
<span class="sd">                        &quot;tables&quot;: {</span>
<span class="sd">                            &quot;TableName&quot;: {</span>
<span class="sd">                                &quot;comment&quot;: &quot;description&quot;,</span>
<span class="sd">                                &quot;is_vocabulary&quot;: bool,</span>
<span class="sd">                                &quot;is_asset&quot;: bool,</span>
<span class="sd">                                &quot;is_association&quot;: bool,</span>
<span class="sd">                                &quot;columns&quot;: [...],</span>
<span class="sd">                                &quot;foreign_keys&quot;: [...],</span>
<span class="sd">                                &quot;features&quot;: [...]</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span> <span class="s2">&quot;RCT&quot;</span><span class="p">,</span> <span class="s2">&quot;RMT&quot;</span><span class="p">,</span> <span class="s2">&quot;RCB&quot;</span><span class="p">,</span> <span class="s2">&quot;RMB&quot;</span><span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;domain_schemas&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">),</span>
            <span class="s2">&quot;default_schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span><span class="p">,</span>
            <span class="s2">&quot;ml_schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">,</span>
            <span class="s2">&quot;schemas&quot;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">}</span>

        <span class="c1"># Include all domain schemas and the ML schema</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">schema</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">schema_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tables&quot;</span><span class="p">:</span> <span class="p">{}}</span>

            <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Get columns</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">include_system_columns</span> <span class="ow">and</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">system_columns</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">typename</span><span class="p">),</span>
                        <span class="s2">&quot;nullok&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">nullok</span><span class="p">,</span>
                        <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">comment</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="p">})</span>

                <span class="c1"># Get foreign keys</span>
                <span class="n">foreign_keys</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                    <span class="n">fk_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">]</span>
                    <span class="n">ref_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">]</span>
                    <span class="n">foreign_keys</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">fk_cols</span><span class="p">,</span>
                        <span class="s2">&quot;referenced_table&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;referenced_columns&quot;</span><span class="p">:</span> <span class="n">ref_cols</span><span class="p">,</span>
                    <span class="p">})</span>

                <span class="c1"># Get features if this is a domain table</span>
                <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">schema_name</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_features</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
                            <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_name</span><span class="p">,</span>
                                <span class="s2">&quot;feature_table&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="p">})</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>  <span class="c1"># Table may not support features</span>

                <span class="n">table_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">comment</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;is_vocabulary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_vocabulary</span><span class="p">(</span><span class="n">table</span><span class="p">),</span>
                    <span class="s2">&quot;is_asset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">table</span><span class="p">),</span>
                    <span class="s2">&quot;is_association&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_association</span><span class="p">(</span><span class="n">table</span><span class="p">)),</span>
                    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span>
                    <span class="s2">&quot;foreign_keys&quot;</span><span class="p">:</span> <span class="n">foreign_keys</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
                    <span class="n">table_info</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>

                <span class="n">schema_info</span><span class="p">[</span><span class="s2">&quot;tables&quot;</span><span class="p">][</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_info</span>

            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;schemas&quot;</span><span class="p">][</span><span class="n">schema_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema_info</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="c1"># Called only if `name` is not found in Manager.  Delegate attributes to model class.</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">name_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the table object corresponding to the given table name.</span>

<span class="sd">        Searches domain schemas first (in sorted order), then ML schema, then WWW.</span>
<span class="sd">        If the table name appears in more than one schema, returns the first match.</span>

<span class="sd">        Args:</span>
<span class="sd">          table: A ERMRest table object or a string that is the name of the table.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Table object.</span>

<span class="sd">        Raises:</span>
<span class="sd">          DerivaMLException: If the table doesn&#39;t exist in any searchable schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">table</span>

        <span class="c1"># Search domain schemas (sorted for deterministic order), then ML schema, then WWW</span>
        <span class="n">search_order</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">,</span> <span class="s2">&quot;WWW&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">sname</span> <span class="ow">in</span> <span class="n">search_order</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">sname</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The table </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a given table is a controlled vocabulary table.</span>

<span class="sd">        Args:</span>
<span class="sd">          table_name: A ERMRest table object or the name of the table.</span>

<span class="sd">        Returns:</span>
<span class="sd">          Table object if the table is a controlled vocabulary, False otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">          DerivaMLException: if the table doesn&#39;t exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vocab_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;URI&quot;</span><span class="p">,</span> <span class="s2">&quot;SYNONYMS&quot;</span><span class="p">,</span> <span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">}</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vocab_columns</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">vocab_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return mapping from canonical vocab column name to actual column name.</span>

<span class="sd">        Canonical names are TitleCase (Name, ID, URI, Description, Synonyms).</span>
<span class="sd">        Actual names reflect the table&#39;s schema  could be lowercase for</span>
<span class="sd">        FaceBase-style catalogs or TitleCase for DerivaML-native tables.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: A table object or the name of the table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping canonical name to actual column name in the table.</span>
<span class="sd">            E.g. ``{&quot;Name&quot;: &quot;name&quot;, &quot;ID&quot;: &quot;id&quot;, ...}`` for FaceBase tables</span>
<span class="sd">            or ``{&quot;Name&quot;: &quot;Name&quot;, &quot;ID&quot;: &quot;ID&quot;, ...}`` for DerivaML tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">canon</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="n">canon</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="k">for</span> <span class="n">canon</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;URI&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;Synonyms&quot;</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_association</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
        <span class="n">unqualified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">min_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">max_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the specified table to see if it is an association table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: param unqualified:</span>
<span class="sd">            pure: return: (Default value = True)</span>
<span class="sd">            table_name: str | Table:</span>
<span class="sd">            unqualified:  (Default value = True)</span>

<span class="sd">        Returns:</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">is_association</span><span class="p">(</span><span class="n">unqualified</span><span class="o">=</span><span class="n">unqualified</span><span class="p">,</span> <span class="n">pure</span><span class="o">=</span><span class="n">pure</span><span class="p">,</span> <span class="n">min_arity</span><span class="o">=</span><span class="n">min_arity</span><span class="p">,</span> <span class="n">max_arity</span><span class="o">=</span><span class="n">max_arity</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_association</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table1</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table2</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Column</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given two tables, return an association table that connects the two and the two columns used to link them..</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaML exception if there is either not an association table or more than one association table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>
        <span class="n">table2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>

        <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">self_fkey</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_key</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table1</span><span class="o">.</span><span class="n">find_associations</span><span class="p">(</span><span class="n">pure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">other_key</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span><span class="o">.</span><span class="n">pk_table</span> <span class="o">==</span> <span class="n">table2</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No association tables found between </span><span class="si">{</span><span class="n">table1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">table2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span><span class="si">}</span><span class="s2"> association tables between </span><span class="si">{</span><span class="n">table1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">table2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_asset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;True if the specified table is an asset table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: str | Table:</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if the specified table is an asset table, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">asset_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Filename&quot;</span><span class="p">,</span> <span class="s2">&quot;URL&quot;</span><span class="p">,</span> <span class="s2">&quot;Length&quot;</span><span class="p">,</span> <span class="s2">&quot;MD5&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">}</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">asset_columns</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the list of asset tables in the current model&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_vocabularies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all controlled vocabulary tables in domain and ML schemas.&quot;&quot;&quot;</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_vocabulary</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tables</span>

    <span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">find_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List features in the catalog.</span>

<span class="sd">        If a table is specified, returns only features for that table.</span>
<span class="sd">        If no table is specified, returns all features across all tables in the catalog.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Optional table to find features for. If None, returns all features</span>
<span class="sd">                in the catalog.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An iterable of Feature instances describing the features.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_feature</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">FindAssociationResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Check if association represents a feature.</span>

<span class="sd">            Args:</span>
<span class="sd">                a: Association result to check</span>
<span class="sd">            Returns:</span>
<span class="sd">                bool: True if association represents a feature</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;Feature_Name&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Execution&quot;</span><span class="p">,</span>
                <span class="n">a</span><span class="o">.</span><span class="n">self_fkey</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">find_table_features</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Find all features for a single table.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">Feature</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">find_associations</span><span class="p">(</span><span class="n">min_arity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_arity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_feature</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Find features for a specific table</span>
            <span class="k">return</span> <span class="n">find_table_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Find all features across all domain and ML schema tables</span>
            <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Feature</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]:</span>
                <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_table_features</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">features</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">lookup_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Feature</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lookup the named feature associated with the provided table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: param feature_name:</span>
<span class="sd">            table: str | Table:</span>
<span class="sd">            feature_name: str:</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Feature class that represents the requested feature.</span>

<span class="sd">        Raises:</span>
<span class="sd">          DerivaMLException: If the feature cannot be found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_features</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_name</span> <span class="o">==</span> <span class="n">feature_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">asset_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the metadata columns for an asset table.&quot;&quot;&quot;</span>

        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">DerivaMLTableTypeError</span><span class="p">(</span><span class="s2">&quot;asset table&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span> <span class="o">-</span> <span class="n">DerivaAssetColumns</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call ERMRestModel.apply&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">==</span> <span class="s2">&quot;file-system&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Cannot apply() to non-catalog model.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_dataset_rid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span> <span class="n">deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a given RID is a dataset RID.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">rid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">_e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid RID </span><span class="si">{</span><span class="n">rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">deleted</span><span class="p">:</span>
            <span class="c1"># Got a dataset rid. Now check to see if its deleted or not.</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Deleted&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_element_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the data types of elements contained within a dataset.</span>

<span class="sd">        This method analyzes the dataset and identifies the data types for all</span>
<span class="sd">        elements within it. It is useful for understanding the structure and</span>
<span class="sd">        content of the dataset and allows for better manipulation and usage of its</span>
<span class="sd">        data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: A list of strings where each string represents a data type</span>
<span class="sd">            of an element found in the dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dataset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="s2">&quot;Dataset&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_domain_or_dataset_table</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">dataset_table</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_domain_or_dataset_table</span><span class="p">(</span><span class="n">t</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_wide_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">dataset_rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span> <span class="n">include_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates details of a wide table from the model</span>

<span class="sd">        Args:</span>
<span class="sd">            include_tables (list[str] | None): List of table names to include in the denormalized dataset. If None,</span>
<span class="sd">                all tables from the dataset will be included.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: SQL query string that represents the process of denormalization.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Skip over tables that we don&#39;t want to include in the denormalized dataset.</span>
        <span class="c1"># Also, strip off the Dataset/Dataset_X part of the path so we don&#39;t include dataset columns in the denormalized</span>
        <span class="c1"># table.</span>
        <span class="n">include_tables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include_tables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">include_tables</span><span class="p">:</span>
            <span class="c1"># Check to make sure the table is in the catalog.</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="n">table_paths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">path</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_to_paths</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">include_tables</span> <span class="ow">and</span> <span class="n">include_tables</span><span class="o">.</span><span class="n">intersection</span><span class="p">({</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">})</span>
        <span class="p">]</span>
        <span class="n">paths_by_element</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">table_paths</span><span class="p">:</span>
            <span class="n">paths_by_element</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">skip_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RCT&quot;</span><span class="p">,</span> <span class="s2">&quot;RMT&quot;</span><span class="p">,</span> <span class="s2">&quot;RCB&quot;</span><span class="p">,</span> <span class="s2">&quot;RMB&quot;</span><span class="p">}</span>
        <span class="n">element_tables</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">element_table</span><span class="p">,</span> <span class="n">paths</span> <span class="ow">in</span> <span class="n">paths_by_element</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="n">graph</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c1"># New lets remove any cycles that we may have in the graph.</span>
            <span class="c1"># We will use a topological sort to find the order in which we need to join the tables.</span>
            <span class="c1"># If we find a cycle, we will remove the table from the graph and splice in an additional ON clause.</span>
            <span class="c1"># We will then repeat the process until there are no cycles.</span>
            <span class="n">graph_has_cycles</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">element_join_tables</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">element_join_conditions</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">while</span> <span class="n">graph_has_cycles</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="n">TopologicalSorter</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
                    <span class="n">element_join_tables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">static_order</span><span class="p">())))</span>
                    <span class="n">graph_has_cycles</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="n">CycleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">cycle_nodes</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle_nodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected cycle found when normalizing dataset </span><span class="si">{</span><span class="n">cycle_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="c1"># Remove cycle from graph and splice in additional ON constraint.</span>
                    <span class="n">graph</span><span class="p">[</span><span class="n">cycle_nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cycle_nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># The Dataset_Version table is a special case as it points to dataset and dataset to version.</span>
            <span class="k">if</span> <span class="s2">&quot;Dataset_Version&quot;</span> <span class="ow">in</span> <span class="n">element_join_tables</span><span class="p">:</span>
                <span class="n">element_join_tables</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Dataset_Version&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:],</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="k">if</span> <span class="n">right</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Dataset_Version&quot;</span><span class="p">:</span>
                        <span class="c1"># The Dataset_Version table is a special case as it points to dataset and dataset to version.</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">element_join_tables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">element_join_tables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="n">table_relationship</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_relationship</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
                    <span class="n">element_join_conditions</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">table_relationship</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">table_relationship</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>
            <span class="n">element_tables</span><span class="p">[</span><span class="n">element_table</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">element_join_tables</span><span class="p">,</span> <span class="n">element_join_conditions</span><span class="p">)</span>
        <span class="c1"># Get the list of columns that will appear in the final denormalized dataset.</span>
        <span class="n">denormalized_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">include_tables</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_association</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>  <span class="c1"># Don&#39;t include association columns in the denormalized view.&#39;</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">include_tables</span> <span class="ow">or</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">include_tables</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip_columns</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">element_tables</span><span class="p">,</span> <span class="n">denormalized_columns</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_table_relationship</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">table1</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span>
        <span class="n">table2</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Column</span><span class="p">,</span> <span class="n">Column</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return columns used to relate two tables.&quot;&quot;&quot;</span>
        <span class="n">table1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>
        <span class="n">table2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>
        <span class="n">relationships</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table1</span><span class="o">.</span><span class="n">foreign_keys</span> <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span> <span class="o">==</span> <span class="n">table2</span>
        <span class="p">]</span>
        <span class="n">relationships</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fk</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table1</span><span class="o">.</span><span class="n">referenced_by</span> <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">table</span> <span class="o">==</span> <span class="n">table2</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relationships</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Ambiguous linkage between </span><span class="si">{</span><span class="n">table1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">table2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="p">[(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">relationships</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">relationships</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_schema_to_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">root</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">exclude_tables</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of paths through the schema graph.</span>

<span class="sd">        Args:</span>
<span class="sd">            root: The root table to start from.</span>
<span class="sd">            path: The current path being built.</span>
<span class="sd">            exclude_tables: Optional set of table names to skip during traversal.</span>
<span class="sd">                Tables in this set will not be visited, effectively pruning branches</span>
<span class="sd">                of the FK graph that pass through them.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of paths through the schema graph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">exclude_tables</span> <span class="o">=</span> <span class="n">exclude_tables</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="kc">None</span>  <span class="c1"># Table that we are coming from.</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">find_arcs</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Given a path through the model, return the FKs that link the tables&quot;&quot;&quot;</span>
            <span class="c1"># Valid schemas for traversal: all domain schemas + ML schema</span>
            <span class="n">valid_schemas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span> <span class="o">|</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">}</span>
            <span class="n">arc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span> <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">fk</span><span class="o">.</span><span class="n">table</span> <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">]</span>
            <span class="n">arc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">arc_list</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">valid_schemas</span><span class="p">]</span>
            <span class="n">domain_tables</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">arc_list</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">multiple_columns</span> <span class="o">:=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">domain_tables</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ambiguous relationship in </span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">multiple_columns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">arc_list</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_nested_dataset_loopback</span><span class="p">(</span><span class="n">n1</span><span class="p">:</span> <span class="n">Table</span><span class="p">,</span> <span class="n">n2</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Test to see if node is an association table used to link elements to datasets.&quot;&quot;&quot;</span>
            <span class="c1"># If we have node_name &lt;- node_name_dataset-&gt; Dataset then we are looping</span>
            <span class="c1"># back around to a new dataset element</span>
            <span class="n">dataset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="s2">&quot;Dataset&quot;</span><span class="p">]</span>
            <span class="n">assoc_table</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span> <span class="o">==</span> <span class="n">n2</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">assoc_table</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n1</span> <span class="o">!=</span> <span class="n">dataset_table</span>

        <span class="c1"># Don&#39;t follow vocabulary terms back to their use.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_vocabulary</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">paths</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">find_arcs</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
            <span class="c1">#        if child.name in {&quot;Dataset_Execution&quot;, &quot;Dataset_Dataset&quot;, &quot;Execution&quot;}:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;Dataset_Dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;Execution&quot;</span><span class="p">}:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">exclude_tables</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">child</span> <span class="o">==</span> <span class="n">parent</span><span class="p">:</span>
                <span class="c1"># Don&#39;t loop back via referred_by</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">is_nested_dataset_loopback</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cycle in schema path: </span><span class="si">{</span><span class="n">child</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> path:</span><span class="si">{</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">path</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_schema_to_paths</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">exclude_tables</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">paths</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_def</span><span class="p">:</span> <span class="n">TableDefinition</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new table from TableDefinition.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_def: Table definition (dataclass or dict).</span>
<span class="sd">            schema: Schema to create the table in. If None, uses default_schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The newly created Table.</span>

<span class="sd">        Raises:</span>
<span class="sd">            DerivaMLException: If no schema specified and default_schema is not set.</span>

<span class="sd">        Note: @validate_call removed because TableDefinition is now a dataclass from</span>
<span class="sd">        deriva.core.typed and Pydantic validation doesn&#39;t work well with dataclass fields.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_default_schema</span><span class="p">()</span>
        <span class="c1"># Handle both TableDefinition (dataclass with to_dict) and plain dicts</span>
        <span class="n">table_dict</span> <span class="o">=</span> <span class="n">table_def</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">table_def</span><span class="p">,</span> <span class="s1">&#39;to_dict&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">table_def</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema</span><span class="p">]</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">table_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="deriva_ml.model.DerivaModel.chaise_config" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">chaise_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">chaise_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the chaise configuration.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">ml_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">ML_SCHEMA</span><span class="p">,</span>
    <span class="n">domain_schemas</span><span class="p">:</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create and initialize a DerivaModel instance.</p>
<p>This method will connect to a catalog and initialize schema configuration.
This class is intended to be used as a base class on which domain-specific interfaces are built.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ERMRest model for the catalog.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ml_schema</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ML schema name.</p>
              </div>
            </td>
            <td>
                  <code><span title="deriva_ml.core.definitions.ML_SCHEMA">ML_SCHEMA</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>domain_schemas</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="set">set</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional explicit set of domain schema names. If None,
auto-detects all non-system schemas.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_schema</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The default schema for table creation operations. If None
and there is exactly one domain schema, that schema is used as default.
If there are multiple domain schemas, default_schema must be specified.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">ml_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">ML_SCHEMA</span><span class="p">,</span>
    <span class="n">domain_schemas</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">default_schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and initialize a DerivaModel instance.</span>

<span class="sd">    This method will connect to a catalog and initialize schema configuration.</span>
<span class="sd">    This class is intended to be used as a base class on which domain-specific interfaces are built.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: The ERMRest model for the catalog.</span>
<span class="sd">        ml_schema: The ML schema name.</span>
<span class="sd">        domain_schemas: Optional explicit set of domain schema names. If None,</span>
<span class="sd">            auto-detects all non-system schemas.</span>
<span class="sd">        default_schema: The default schema for table creation operations. If None</span>
<span class="sd">            and there is exactly one domain schema, that schema is used as default.</span>
<span class="sd">            If there are multiple domain schemas, default_schema must be specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">:</span> <span class="n">ErmrestCatalog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">catalog</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">deriva_server</span><span class="o">.</span><span class="n">server</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">catalog</span><span class="p">,</span> <span class="n">ErmrestCatalog</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;localhost&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span> <span class="o">=</span> <span class="n">ml_schema</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_system_schemas</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">SYSTEM_SCHEMAS</span> <span class="o">|</span> <span class="p">{</span><span class="n">ml_schema</span><span class="p">})</span>

    <span class="c1"># Determine domain schemas</span>
    <span class="k">if</span> <span class="n">domain_schemas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">domain_schemas</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain_schemas</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">(</span><span class="n">domain_schemas</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Auto-detect all domain schemas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span> <span class="o">=</span> <span class="n">get_domain_schemas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ml_schema</span><span class="p">)</span>

    <span class="c1"># Determine default schema for table creation</span>
    <span class="k">if</span> <span class="n">default_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">default_schema</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;default_schema &#39;</span><span class="si">{</span><span class="n">default_schema</span><span class="si">}</span><span class="s2">&#39; is not in domain_schemas: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="n">default_schema</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Single domain schema - use it as default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># No domain schemas - default_schema will be None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Multiple domain schemas, no explicit default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.apply" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Call ERMRestModel.apply</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Call ERMRestModel.apply&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">catalog</span> <span class="o">==</span> <span class="s2">&quot;file-system&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="s2">&quot;Cannot apply() to non-catalog model.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.asset_metadata" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">asset_metadata</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">asset_metadata</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the metadata columns for an asset table.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">asset_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the metadata columns for an asset table.&quot;&quot;&quot;</span>

    <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">DerivaMLTableTypeError</span><span class="p">(</span><span class="s2">&quot;asset table&quot;</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span> <span class="o">-</span> <span class="n">DerivaAssetColumns</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.create_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">create_table</span><span class="p">(</span>
    <span class="n">table_def</span><span class="p">:</span> <span class="n">TableDefinition</span><span class="p">,</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new table from TableDefinition.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_def</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TableDefinition


  
      module-attribute
   (deriva_ml.core.definitions.TableDefinition)" href="../deriva_definitions/#deriva_ml.core.definitions.TableDefinition">TableDefinition</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table definition (dataclass or dict).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schema to create the table in. If None, uses default_schema.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.model.catalog.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The newly created Table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If no schema specified and default_schema is not set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Note: @validate_call removed because TableDefinition is now a dataclass from
deriva.core.typed and Pydantic validation doesn't work well with dataclass fields.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_def</span><span class="p">:</span> <span class="n">TableDefinition</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new table from TableDefinition.</span>

<span class="sd">    Args:</span>
<span class="sd">        table_def: Table definition (dataclass or dict).</span>
<span class="sd">        schema: Schema to create the table in. If None, uses default_schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The newly created Table.</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaMLException: If no schema specified and default_schema is not set.</span>

<span class="sd">    Note: @validate_call removed because TableDefinition is now a dataclass from</span>
<span class="sd">    deriva.core.typed and Pydantic validation doesn&#39;t work well with dataclass fields.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_require_default_schema</span><span class="p">()</span>
    <span class="c1"># Handle both TableDefinition (dataclass with to_dict) and plain dicts</span>
    <span class="n">table_dict</span> <span class="o">=</span> <span class="n">table_def</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">table_def</span><span class="p">,</span> <span class="s1">&#39;to_dict&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">table_def</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema</span><span class="p">]</span><span class="o">.</span><span class="n">create_table</span><span class="p">(</span><span class="n">table_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.find_assets" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_assets</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_assets</span><span class="p">(</span>
    <span class="n">with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the list of asset tables in the current model</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_assets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the list of asset tables in the current model&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.find_association" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_association</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_association</span><span class="p">(</span>
    <span class="n">table1</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">table2</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Column</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Given two tables, return an association table that connects the two and the two columns used to link them..</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_association</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table1</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table2</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Column</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given two tables, return an association table that connects the two and the two columns used to link them..</span>

<span class="sd">    Raises:</span>
<span class="sd">        DerivaML exception if there is either not an association table or more than one association table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table1</span><span class="p">)</span>
    <span class="n">table2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table2</span><span class="p">)</span>

    <span class="n">tables</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">self_fkey</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other_key</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table1</span><span class="o">.</span><span class="n">find_associations</span><span class="p">(</span><span class="n">pure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">other_key</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span><span class="o">.</span><span class="n">pk_table</span> <span class="o">==</span> <span class="n">table2</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No association tables found between </span><span class="si">{</span><span class="n">table1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">table2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span><span class="si">}</span><span class="s2"> association tables between </span><span class="si">{</span><span class="n">table1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">table2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.find_features" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_features</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_features</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Feature</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List features in the catalog.</p>
<p>If a table is specified, returns only features for that table.
If no table is specified, returns all features across all tables in the catalog.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional table to find features for. If None, returns all features
in the catalog.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Iterable">Iterable</span>[<a class="autorefs autorefs-internal" title="Feature (deriva_ml.feature.Feature)" href="../feature/#deriva_ml.feature.Feature">Feature</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An iterable of Feature instances describing the features.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">ConfigDict</span><span class="p">(</span><span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">find_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List features in the catalog.</span>

<span class="sd">    If a table is specified, returns only features for that table.</span>
<span class="sd">    If no table is specified, returns all features across all tables in the catalog.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Optional table to find features for. If None, returns all features</span>
<span class="sd">            in the catalog.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An iterable of Feature instances describing the features.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_feature</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">FindAssociationResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if association represents a feature.</span>

<span class="sd">        Args:</span>
<span class="sd">            a: Association result to check</span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if association represents a feature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Feature_Name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Execution&quot;</span><span class="p">,</span>
            <span class="n">a</span><span class="o">.</span><span class="n">self_fkey</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_table_features</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Feature</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all features for a single table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">Feature</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">find_associations</span><span class="p">(</span><span class="n">min_arity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_arity</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_feature</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Find features for a specific table</span>
        <span class="k">return</span> <span class="n">find_table_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Find all features across all domain and ML schema tables</span>
        <span class="n">features</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Feature</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">find_table_features</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">features</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.find_vocabularies" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_vocabularies</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_vocabularies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a list of all controlled vocabulary tables in domain and ML schemas.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_vocabularies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of all controlled vocabulary tables in domain and ML schemas.&quot;&quot;&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_vocabulary</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tables</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.get_schema_description" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_schema_description</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_schema_description</span><span class="p">(</span>
    <span class="n">include_system_columns</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return a JSON description of the catalog schema structure.</p>
<p>Provides a structured representation of the domain and ML schemas including
tables, columns, foreign keys, and relationships. Useful for understanding
the data model structure programmatically.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>include_system_columns</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, include RID, RCT, RMT, RCB, RMB columns.
Default False to reduce output size.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary with schema structure:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>{
"domain_schemas": ["schema_name1", "schema_name2"],
"default_schema": "schema_name1",
"ml_schema": "deriva-ml",
"schemas": {
    "schema_name": {
        "tables": {
            "TableName": {
                "comment": "description",
                "is_vocabulary": bool,
                "is_asset": bool,
                "is_association": bool,
                "columns": [...],
                "foreign_keys": [...],
                "features": [...]
            }
        }
    }
}</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>}</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_schema_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_system_columns</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a JSON description of the catalog schema structure.</span>

<span class="sd">    Provides a structured representation of the domain and ML schemas including</span>
<span class="sd">    tables, columns, foreign keys, and relationships. Useful for understanding</span>
<span class="sd">    the data model structure programmatically.</span>

<span class="sd">    Args:</span>
<span class="sd">        include_system_columns: If True, include RID, RCT, RMT, RCB, RMB columns.</span>
<span class="sd">            Default False to reduce output size.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with schema structure:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;domain_schemas&quot;: [&quot;schema_name1&quot;, &quot;schema_name2&quot;],</span>
<span class="sd">            &quot;default_schema&quot;: &quot;schema_name1&quot;,</span>
<span class="sd">            &quot;ml_schema&quot;: &quot;deriva-ml&quot;,</span>
<span class="sd">            &quot;schemas&quot;: {</span>
<span class="sd">                &quot;schema_name&quot;: {</span>
<span class="sd">                    &quot;tables&quot;: {</span>
<span class="sd">                        &quot;TableName&quot;: {</span>
<span class="sd">                            &quot;comment&quot;: &quot;description&quot;,</span>
<span class="sd">                            &quot;is_vocabulary&quot;: bool,</span>
<span class="sd">                            &quot;is_asset&quot;: bool,</span>
<span class="sd">                            &quot;is_association&quot;: bool,</span>
<span class="sd">                            &quot;columns&quot;: [...],</span>
<span class="sd">                            &quot;foreign_keys&quot;: [...],</span>
<span class="sd">                            &quot;features&quot;: [...]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">system_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span> <span class="s2">&quot;RCT&quot;</span><span class="p">,</span> <span class="s2">&quot;RMT&quot;</span><span class="p">,</span> <span class="s2">&quot;RCB&quot;</span><span class="p">,</span> <span class="s2">&quot;RMB&quot;</span><span class="p">}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;domain_schemas&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">),</span>
        <span class="s2">&quot;default_schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_schema</span><span class="p">,</span>
        <span class="s2">&quot;ml_schema&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">,</span>
        <span class="s2">&quot;schemas&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="p">}</span>

    <span class="c1"># Include all domain schemas and the ML schema</span>
    <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">]:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">schema_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">schema</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">schema_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tables&quot;</span><span class="p">:</span> <span class="p">{}}</span>

        <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Get columns</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">include_system_columns</span> <span class="ow">and</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">system_columns</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">typename</span><span class="p">),</span>
                    <span class="s2">&quot;nullok&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">nullok</span><span class="p">,</span>
                    <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">col</span><span class="o">.</span><span class="n">comment</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="p">})</span>

            <span class="c1"># Get foreign keys</span>
            <span class="n">foreign_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                <span class="n">fk_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">]</span>
                <span class="n">ref_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">]</span>
                <span class="n">foreign_keys</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">fk_cols</span><span class="p">,</span>
                    <span class="s2">&quot;referenced_table&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;referenced_columns&quot;</span><span class="p">:</span> <span class="n">ref_cols</span><span class="p">,</span>
                <span class="p">})</span>

            <span class="c1"># Get features if this is a domain table</span>
            <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">schema_name</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_features</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
                        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_name</span><span class="p">,</span>
                            <span class="s2">&quot;feature_table&quot;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="p">})</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># Table may not support features</span>

            <span class="n">table_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="n">table</span><span class="o">.</span><span class="n">comment</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="s2">&quot;is_vocabulary&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_vocabulary</span><span class="p">(</span><span class="n">table</span><span class="p">),</span>
                <span class="s2">&quot;is_asset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_asset</span><span class="p">(</span><span class="n">table</span><span class="p">),</span>
                <span class="s2">&quot;is_association&quot;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_association</span><span class="p">(</span><span class="n">table</span><span class="p">)),</span>
                <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span>
                <span class="s2">&quot;foreign_keys&quot;</span><span class="p">:</span> <span class="n">foreign_keys</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">features</span><span class="p">:</span>
                <span class="n">table_info</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span>

            <span class="n">schema_info</span><span class="p">[</span><span class="s2">&quot;tables&quot;</span><span class="p">][</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_info</span>

        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;schemas&quot;</span><span class="p">][</span><span class="n">schema_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema_info</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.is_asset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_asset</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_asset</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>True if the specified table is an asset table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str | Table:</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the specified table is an asset table, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_asset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;True if the specified table is an asset table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table_name: str | Table:</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the specified table is an asset table, False otherwise.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">asset_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Filename&quot;</span><span class="p">,</span> <span class="s2">&quot;URL&quot;</span><span class="p">,</span> <span class="s2">&quot;Length&quot;</span><span class="p">,</span> <span class="s2">&quot;MD5&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">}</span>
    <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">asset_columns</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.is_association" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_association</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_association</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
    <span class="n">unqualified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">pure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">min_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">max_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check the specified table to see if it is an association table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="deriva_ml.model.catalog.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>param unqualified:</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pure</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>return: (Default value = True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="deriva_ml.model.catalog.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str | Table:</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unqualified</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(Default value = True)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_association</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
    <span class="n">unqualified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">pure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">min_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">max_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check the specified table to see if it is an association table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table_name: param unqualified:</span>
<span class="sd">        pure: return: (Default value = True)</span>
<span class="sd">        table_name: str | Table:</span>
<span class="sd">        unqualified:  (Default value = True)</span>

<span class="sd">    Returns:</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span><span class="o">.</span><span class="n">is_association</span><span class="p">(</span><span class="n">unqualified</span><span class="o">=</span><span class="n">unqualified</span><span class="p">,</span> <span class="n">pure</span><span class="o">=</span><span class="n">pure</span><span class="p">,</span> <span class="n">min_arity</span><span class="o">=</span><span class="n">min_arity</span><span class="p">,</span> <span class="n">max_arity</span><span class="o">=</span><span class="n">max_arity</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.is_dataset_rid" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_dataset_rid</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_dataset_rid</span><span class="p">(</span>
    <span class="n">rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span> <span class="n">deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if a given RID is a dataset RID.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_dataset_rid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rid</span><span class="p">:</span> <span class="n">RID</span><span class="p">,</span> <span class="n">deleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a given RID is a dataset RID.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">rid_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">resolve_rid</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">_e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid RID </span><span class="si">{</span><span class="n">rid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rid_info</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Dataset&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">deleted</span><span class="p">:</span>
        <span class="c1"># Got a dataset rid. Now check to see if its deleted or not.</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="n">rid_info</span><span class="o">.</span><span class="n">datapath</span><span class="o">.</span><span class="n">entities</span><span class="p">()</span><span class="o">.</span><span class="n">fetch</span><span class="p">())[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Deleted&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.is_domain_schema" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_domain_schema</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_domain_schema</span><span class="p">(</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if a schema is a domain schema.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the schema to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the schema is a domain schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_domain_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a schema is a domain schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema_name: Name of the schema to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the schema is a domain schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.is_system_schema" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_system_schema</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_system_schema</span><span class="p">(</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if a schema is a system or ML schema.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the schema to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the schema is a system or ML schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_system_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a schema is a system or ML schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema_name: Name of the schema to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if the schema is a system or ML schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">is_system_schema</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.is_vocabulary" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_vocabulary</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_vocabulary</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if a given table is a controlled vocabulary table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A ERMRest table object or the name of the table.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object if the table is a controlled vocabulary, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if the table doesn't exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_vocabulary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a given table is a controlled vocabulary table.</span>

<span class="sd">    Args:</span>
<span class="sd">      table_name: A ERMRest table object or the name of the table.</span>

<span class="sd">    Returns:</span>
<span class="sd">      Table object if the table is a controlled vocabulary, False otherwise.</span>

<span class="sd">    Raises:</span>
<span class="sd">      DerivaMLException: if the table doesn&#39;t exist.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vocab_columns</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;URI&quot;</span><span class="p">,</span> <span class="s2">&quot;SYNONYMS&quot;</span><span class="p">,</span> <span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">}</span>
    <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vocab_columns</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.list_dataset_element_types" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_dataset_element_types</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_dataset_element_types</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">(</span>
    <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Lists the data types of elements contained within a dataset.</p>
<p>This method analyzes the dataset and identifies the data types for all
elements within it. It is useful for understanding the structure and
content of the dataset and allows for better manipulation and usage of its
data.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.model.catalog.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]: A list of strings where each string represents a data type</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.model.catalog.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>of an element found in the dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_dataset_element_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Table</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Lists the data types of elements contained within a dataset.</span>

<span class="sd">    This method analyzes the dataset and identifies the data types for all</span>
<span class="sd">    elements within it. It is useful for understanding the structure and</span>
<span class="sd">    content of the dataset and allows for better manipulation and usage of its</span>
<span class="sd">    data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: A list of strings where each string represents a data type</span>
<span class="sd">        of an element found in the dataset.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dataset_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="s2">&quot;Dataset&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_domain_or_dataset_table</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Table</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_domain_schema</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">dataset_table</span><span class="o">.</span><span class="n">name</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">t</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">dataset_table</span><span class="o">.</span><span class="n">find_associations</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_domain_or_dataset_table</span><span class="p">(</span><span class="n">t</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">other_fkeys</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.lookup_feature" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">lookup_feature</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">lookup_feature</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Feature</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Lookup the named feature associated with the provided table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>param feature_name:</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str | Table:</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>feature_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>str:</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Feature (deriva_ml.feature.Feature)" href="../feature/#deriva_ml.feature.Feature">Feature</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A Feature class that represents the requested feature.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the feature cannot be found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lookup_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Feature</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lookup the named feature associated with the provided table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: param feature_name:</span>
<span class="sd">        table: str | Table:</span>
<span class="sd">        feature_name: str:</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Feature class that represents the requested feature.</span>

<span class="sd">    Raises:</span>
<span class="sd">      DerivaMLException: If the feature cannot be found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_features</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">feature_name</span> <span class="o">==</span> <span class="n">feature_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">feature_name</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.name_to_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">name_to_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">name_to_table</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the table object corresponding to the given table name.</p>
<p>Searches domain schemas first (in sorted order), then ML schema, then WWW.
If the table name appears in more than one schema, returns the first match.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A ERMRest table object or a string that is the name of the table.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="deriva_ml.model.catalog.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="DerivaMLException (deriva_ml.core.exceptions.DerivaMLException)" href="../exceptions/#deriva_ml.core.exceptions.DerivaMLException">DerivaMLException</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the table doesn't exist in any searchable schema.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">name_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Table</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the table object corresponding to the given table name.</span>

<span class="sd">    Searches domain schemas first (in sorted order), then ML schema, then WWW.</span>
<span class="sd">    If the table name appears in more than one schema, returns the first match.</span>

<span class="sd">    Args:</span>
<span class="sd">      table: A ERMRest table object or a string that is the name of the table.</span>

<span class="sd">    Returns:</span>
<span class="sd">      Table object.</span>

<span class="sd">    Raises:</span>
<span class="sd">      DerivaMLException: If the table doesn&#39;t exist in any searchable schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">Table</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">table</span>

    <span class="c1"># Search domain schemas (sorted for deterministic order), then ML schema, then WWW</span>
    <span class="n">search_order</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain_schemas</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_schema</span><span class="p">,</span> <span class="s2">&quot;WWW&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">sname</span> <span class="ow">in</span> <span class="n">search_order</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">sname</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table</span><span class="p">]</span>
    <span class="k">raise</span> <span class="n">DerivaMLException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The table </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> doesn&#39;t exist.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.DerivaModel.vocab_columns" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">vocab_columns</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">vocab_columns</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return mapping from canonical vocab column name to actual column name.</p>
<p>Canonical names are TitleCase (Name, ID, URI, Description, Synonyms).
Actual names reflect the table's schema  could be lowercase for
FaceBase-style catalogs or TitleCase for DerivaML-native tables.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="deriva_ml.model.catalog.TableInput">TableInput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A table object or the name of the table.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict mapping canonical name to actual column name in the table.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>E.g. <code>{"Name": "name", "ID": "id", ...}</code> for FaceBase tables</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>or <code>{"Name": "Name", "ID": "ID", ...}</code> for DerivaML tables.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/catalog.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">vocab_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="n">TableInput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return mapping from canonical vocab column name to actual column name.</span>

<span class="sd">    Canonical names are TitleCase (Name, ID, URI, Description, Synonyms).</span>
<span class="sd">    Actual names reflect the table&#39;s schema  could be lowercase for</span>
<span class="sd">    FaceBase-style catalogs or TitleCase for DerivaML-native tables.</span>

<span class="sd">    Args:</span>
<span class="sd">        table_name: A table object or the name of the table.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict mapping canonical name to actual column name in the table.</span>
<span class="sd">        E.g. ``{&quot;Name&quot;: &quot;name&quot;, &quot;ID&quot;: &quot;id&quot;, ...}`` for FaceBase tables</span>
<span class="sd">        or ``{&quot;Name&quot;: &quot;Name&quot;, &quot;ID&quot;: &quot;ID&quot;, ...}`` for DerivaML tables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_to_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
    <span class="n">col_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">canon</span><span class="p">:</span> <span class="n">col_map</span><span class="p">[</span><span class="n">canon</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="k">for</span> <span class="n">canon</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="s2">&quot;URI&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">,</span> <span class="s2">&quot;Synonyms&quot;</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.Display" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Display</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="deriva_ml.model.annotations.AnnotationBuilder">AnnotationBuilder</span></code></p>



        <p>Display annotation for tables and columns.</p>
<p>Controls the display name, description/tooltip, and how null values
and foreign key links are rendered. Can be applied to both tables
and columns.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display name shown in the UI (mutually exclusive with markdown_name)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>markdown_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Markdown-formatted display name (mutually exclusive with name)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name_style</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="NameStyle


  
      dataclass
   (deriva_ml.model.annotations.NameStyle)" href="#deriva_ml.model.NameStyle">NameStyle</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Styling options for automatic name formatting</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comment</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description text shown as tooltip/help text</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_null</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="bool">bool</span> | <span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to display null values, per context</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_foreign_key_link</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="bool">bool</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show FK values as links, per context</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If both name and markdown_name are provided</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Basic display name::</p>
<pre><code>&gt;&gt;&gt; display = Display(name="Research Subjects")
&gt;&gt;&gt; handle.set_annotation(display)
</code></pre>
<p>With description/tooltip::</p>
<pre><code>&gt;&gt;&gt; display = Display(
...     name="Subjects",
...     comment="Individuals enrolled in research studies"
... )
</code></pre>
<p>Markdown-formatted name::</p>
<pre><code>&gt;&gt;&gt; display = Display(markdown_name="**Bold** _Italic_ Name")
</code></pre>
<p>Context-specific null display::</p>
<pre><code>&gt;&gt;&gt; from deriva_ml.model import CONTEXT_COMPACT, CONTEXT_DETAILED
&gt;&gt;&gt; display = Display(
...     name="Value",
...     show_null={
...         CONTEXT_COMPACT: False,      # Hide nulls in lists
...         CONTEXT_DETAILED: '"N/A"'    # Show "N/A" string
...     }
... )
</code></pre>
<p>Control foreign key link display::</p>
<pre><code>&gt;&gt;&gt; display = Display(
...     name="Subject",
...     show_foreign_key_link={CONTEXT_COMPACT: False}
... )
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Display</span><span class="p">(</span><span class="n">AnnotationBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display annotation for tables and columns.</span>

<span class="sd">    Controls the display name, description/tooltip, and how null values</span>
<span class="sd">    and foreign key links are rendered. Can be applied to both tables</span>
<span class="sd">    and columns.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Display name shown in the UI (mutually exclusive with markdown_name)</span>
<span class="sd">        markdown_name: Markdown-formatted display name (mutually exclusive with name)</span>
<span class="sd">        name_style: Styling options for automatic name formatting</span>
<span class="sd">        comment: Description text shown as tooltip/help text</span>
<span class="sd">        show_null: How to display null values, per context</span>
<span class="sd">        show_foreign_key_link: Whether to show FK values as links, per context</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If both name and markdown_name are provided</span>

<span class="sd">    Example:</span>
<span class="sd">        Basic display name::</span>

<span class="sd">            &gt;&gt;&gt; display = Display(name=&quot;Research Subjects&quot;)</span>
<span class="sd">            &gt;&gt;&gt; handle.set_annotation(display)</span>

<span class="sd">        With description/tooltip::</span>

<span class="sd">            &gt;&gt;&gt; display = Display(</span>
<span class="sd">            ...     name=&quot;Subjects&quot;,</span>
<span class="sd">            ...     comment=&quot;Individuals enrolled in research studies&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        Markdown-formatted name::</span>

<span class="sd">            &gt;&gt;&gt; display = Display(markdown_name=&quot;**Bold** _Italic_ Name&quot;)</span>

<span class="sd">        Context-specific null display::</span>

<span class="sd">            &gt;&gt;&gt; from deriva_ml.model import CONTEXT_COMPACT, CONTEXT_DETAILED</span>
<span class="sd">            &gt;&gt;&gt; display = Display(</span>
<span class="sd">            ...     name=&quot;Value&quot;,</span>
<span class="sd">            ...     show_null={</span>
<span class="sd">            ...         CONTEXT_COMPACT: False,      # Hide nulls in lists</span>
<span class="sd">            ...         CONTEXT_DETAILED: &#39;&quot;N/A&quot;&#39;    # Show &quot;N/A&quot; string</span>
<span class="sd">            ...     }</span>
<span class="sd">            ... )</span>

<span class="sd">        Control foreign key link display::</span>

<span class="sd">            &gt;&gt;&gt; display = Display(</span>
<span class="sd">            ...     name=&quot;Subject&quot;,</span>
<span class="sd">            ...     show_foreign_key_link={CONTEXT_COMPACT: False}</span>
<span class="sd">            ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_DISPLAY</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">markdown_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">name_style</span><span class="p">:</span> <span class="n">NameStyle</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">show_null</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">show_foreign_key_link</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;name and markdown_name are mutually exclusive&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_style</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">style_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_style</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">style_dict</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;name_style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">style_dict</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_null</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;show_null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_null</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_foreign_key_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;show_foreign_key_link&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_foreign_key_link</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.Facet" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Facet</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>A facet definition for filtering.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span> | <a class="autorefs autorefs-internal" title="InboundFK


  
      dataclass
   (deriva_ml.model.annotations.InboundFK)" href="#deriva_ml.model.InboundFK">InboundFK</a> | <a class="autorefs autorefs-internal" title="OutboundFK


  
      dataclass
   (deriva_ml.model.annotations.OutboundFK)" href="#deriva_ml.model.OutboundFK">OutboundFK</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to source data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sourcekey</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to named source</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>markdown_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display name</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comment</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>entity</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this is an entity facet</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>open</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start expanded</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ux_mode</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="FacetUxMode (deriva_ml.model.annotations.FacetUxMode)" href="#deriva_ml.model.FacetUxMode">FacetUxMode</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UI mode (choices, ranges, check_presence)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bar_plot</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show bar plot</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>choices</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preset choice values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ranges</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="FacetRange


  
      dataclass
   (deriva_ml.model.annotations.FacetRange)" href="#deriva_ml.model.FacetRange">FacetRange</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preset range values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>not_null</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter to non-null values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hide_null_choice</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hide "null" option</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hide_not_null_choice</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hide "not null" option</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_bins</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bins for histogram</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Facet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A facet definition for filtering.</span>

<span class="sd">    Args:</span>
<span class="sd">        source: Path to source data</span>
<span class="sd">        sourcekey: Reference to named source</span>
<span class="sd">        markdown_name: Display name</span>
<span class="sd">        comment: Description</span>
<span class="sd">        entity: Whether this is an entity facet</span>
<span class="sd">        open: Start expanded</span>
<span class="sd">        ux_mode: UI mode (choices, ranges, check_presence)</span>
<span class="sd">        bar_plot: Show bar plot</span>
<span class="sd">        choices: Preset choice values</span>
<span class="sd">        ranges: Preset range values</span>
<span class="sd">        not_null: Filter to non-null values</span>
<span class="sd">        hide_null_choice: Hide &quot;null&quot; option</span>
<span class="sd">        hide_not_null_choice: Hide &quot;not null&quot; option</span>
<span class="sd">        n_bins: Number of bins for histogram</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">InboundFK</span> <span class="o">|</span> <span class="n">OutboundFK</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">sourcekey</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">markdown_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">entity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">open</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ux_mode</span><span class="p">:</span> <span class="n">FacetUxMode</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bar_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">choices</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ranges</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">FacetRange</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">not_null</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hide_null_choice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hide_not_null_choice</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">n_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcekey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;sourcekey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcekey</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ux_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ux_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ux_mode</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bar_plot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ranges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_null</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;not_null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_null</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_null_choice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;hide_null_choice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_null_choice</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_not_null_choice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;hide_not_null_choice&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_not_null_choice</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;n_bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_bins</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.FacetList" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FacetList</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>A list of facets for filtering (visible_columns.filter).</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>facets = FacetList([
...     Facet(source="Species", open=True),
...     Facet(source="Age", ux_mode=FacetUxMode.RANGES)
... ])</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FacetList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of facets for filtering (visible_columns.filter).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; facets = FacetList([</span>
<span class="sd">        ...     Facet(source=&quot;Species&quot;, open=True),</span>
<span class="sd">        ...     Facet(source=&quot;Age&quot;, ux_mode=FacetUxMode.RANGES)</span>
<span class="sd">        ... ])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">facets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Facet</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facet</span><span class="p">:</span> <span class="n">Facet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FacetList&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a facet to the list.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facet</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;and&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="p">]}</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.FacetList.add" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add</span><span class="p">(</span><span class="n">facet</span><span class="p">:</span> <span class="n">Facet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;FacetList&#39;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a facet to the list.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facet</span><span class="p">:</span> <span class="n">Facet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FacetList&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a facet to the list.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">facets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">facet</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.FacetRange" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FacetRange</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>A range for facet filtering.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>min</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum value</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum value</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_exclusive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exclude min value</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_exclusive</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Exclude max value</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FacetRange</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A range for facet filtering.</span>

<span class="sd">    Args:</span>
<span class="sd">        min: Minimum value</span>
<span class="sd">        max: Maximum value</span>
<span class="sd">        min_exclusive: Exclude min value</span>
<span class="sd">        max_exclusive: Exclude max value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">max</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">min_exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">max_exclusive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_exclusive</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;min_exclusive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_exclusive</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_exclusive</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;max_exclusive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_exclusive</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.FacetUxMode" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">FacetUxMode</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>



        <p>UX modes for facet filters in the search panel.</p>
<p>Controls how users interact with a facet filter.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.FacetUxMode.CHOICES">CHOICES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Checkbox list for selecting values</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.FacetUxMode.RANGES">RANGES</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Range slider/inputs for numeric or date ranges</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.FacetUxMode.CHECK_PRESENCE">CHECK_PRESENCE</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Check if value exists or is null</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="deriva_ml.model.FacetUxMode--choice-based-facet">Choice-based facet</h3>
<p>Facet(source="Status", ux_mode=FacetUxMode.CHOICES)</p>
<h3 id="deriva_ml.model.FacetUxMode--range-based-facet-for-numeric-values">Range-based facet for numeric values</h3>
<p>Facet(source="Age", ux_mode=FacetUxMode.RANGES)</p>
<h3 id="deriva_ml.model.FacetUxMode--check-presence-has-value-no-value">Check presence (has value / no value)</h3>
<p>Facet(source="Notes", ux_mode=FacetUxMode.CHECK_PRESENCE)</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FacetUxMode</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;UX modes for facet filters in the search panel.</span>

<span class="sd">    Controls how users interact with a facet filter.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        CHOICES: Checkbox list for selecting values</span>
<span class="sd">        RANGES: Range slider/inputs for numeric or date ranges</span>
<span class="sd">        CHECK_PRESENCE: Check if value exists or is null</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Choice-based facet</span>
<span class="sd">        &gt;&gt;&gt; Facet(source=&quot;Status&quot;, ux_mode=FacetUxMode.CHOICES)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Range-based facet for numeric values</span>
<span class="sd">        &gt;&gt;&gt; Facet(source=&quot;Age&quot;, ux_mode=FacetUxMode.RANGES)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Check presence (has value / no value)</span>
<span class="sd">        &gt;&gt;&gt; Facet(source=&quot;Notes&quot;, ux_mode=FacetUxMode.CHECK_PRESENCE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CHOICES</span> <span class="o">=</span> <span class="s2">&quot;choices&quot;</span>
    <span class="n">RANGES</span> <span class="o">=</span> <span class="s2">&quot;ranges&quot;</span>
    <span class="n">CHECK_PRESENCE</span> <span class="o">=</span> <span class="s2">&quot;check_presence&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.ForeignKeyOrderer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ForeignKeyOrderer</span>


</h2>


    <div class="doc doc-contents ">



        <p>Computes insertion order for tables based on FK dependencies.</p>
<p>Uses topological sort to ensure referenced tables are populated
before tables that reference them. Handles cycles by either
raising an error or breaking them.</p>


<details class="example" open>
  <summary>Example</summary>
  <p>orderer = ForeignKeyOrderer(model, schemas=['domain', 'deriva-ml'])</p>
<h3 id="deriva_ml.model.ForeignKeyOrderer--get-insertion-order">Get insertion order</h3>
<p>tables_to_fill = ['Image', 'Subject', 'Diagnosis']
ordered = orderer.get_insertion_order(tables_to_fill)</p>
<h3 id="deriva_ml.model.ForeignKeyOrderer--returns-subject-image-diagnosis">Returns: ['Subject', 'Image', 'Diagnosis']</h3>
<h3 id="deriva_ml.model.ForeignKeyOrderer--get-all-tables-in-safe-order">Get all tables in safe order</h3>
<p>all_ordered = orderer.get_insertion_order()</p>
<h3 id="deriva_ml.model.ForeignKeyOrderer--get-fk-dependencies-for-a-table">Get FK dependencies for a table</h3>
<p>deps = orderer.get_dependencies('Image')</p>
<h3 id="deriva_ml.model.ForeignKeyOrderer--returns-subject-dataset">Returns: {'Subject', 'Dataset', ...}</h3>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ForeignKeyOrderer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes insertion order for tables based on FK dependencies.</span>

<span class="sd">    Uses topological sort to ensure referenced tables are populated</span>
<span class="sd">    before tables that reference them. Handles cycles by either</span>
<span class="sd">    raising an error or breaking them.</span>

<span class="sd">    Example:</span>
<span class="sd">        orderer = ForeignKeyOrderer(model, schemas=[&#39;domain&#39;, &#39;deriva-ml&#39;])</span>

<span class="sd">        # Get insertion order</span>
<span class="sd">        tables_to_fill = [&#39;Image&#39;, &#39;Subject&#39;, &#39;Diagnosis&#39;]</span>
<span class="sd">        ordered = orderer.get_insertion_order(tables_to_fill)</span>
<span class="sd">        # Returns: [&#39;Subject&#39;, &#39;Image&#39;, &#39;Diagnosis&#39;]</span>

<span class="sd">        # Get all tables in safe order</span>
<span class="sd">        all_ordered = orderer.get_insertion_order()</span>

<span class="sd">        # Get FK dependencies for a table</span>
<span class="sd">        deps = orderer.get_dependencies(&#39;Image&#39;)</span>
<span class="sd">        # Returns: {&#39;Subject&#39;, &#39;Dataset&#39;, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the orderer.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: ERMrest Model object.</span>
<span class="sd">            schemas: Schemas to consider for FK relationships.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">schemas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_table_cache</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_table_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build cache mapping table names to Table objects.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Store both qualified and unqualified names</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span>
                <span class="c1"># Only store unqualified if not already present (avoids conflicts)</span>
                <span class="k">if</span> <span class="n">table_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">table</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_to_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DerivaTable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert table name to Table object.</span>

<span class="sd">        Args:</span>
<span class="sd">            t: Table name or Table object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DerivaTable object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If table not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">t</span>

        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> not found in schemas </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_table_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get unique key for a table.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get tables that this table depends on (FK targets).</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table name or object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Set of tables that must be populated before this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">dependencies</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
            <span class="n">pk_table</span> <span class="o">=</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span>
            <span class="c1"># Only include dependencies within our schemas</span>
            <span class="k">if</span> <span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="c1"># Don&#39;t include self-references as dependencies</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">pk_table</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">dependencies</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pk_table</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dependencies</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dependents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get tables that depend on this table (FK sources).</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table name or object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Set of tables that reference this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">dependents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">other_table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">other_table</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">other_table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                        <span class="n">dependents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_table</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">dependents</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_dependency_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build FK dependency graph.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Tables to include. If None, includes all tables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict mapping table key -&gt; set of table keys it depends on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Include all tables in schemas</span>
            <span class="n">table_objs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                    <span class="n">table_objs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_objs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>

        <span class="n">table_keys</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table_objs</span><span class="p">}</span>
        <span class="n">graph</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table_objs</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">deps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                <span class="n">pk_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)</span>
                <span class="c1"># Only include deps within our table set</span>
                <span class="k">if</span> <span class="n">pk_key</span> <span class="ow">in</span> <span class="n">table_keys</span> <span class="ow">and</span> <span class="n">pk_key</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">deps</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pk_key</span><span class="p">)</span>

            <span class="n">graph</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">deps</span>

        <span class="k">return</span> <span class="n">graph</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_insertion_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">handle_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute FK-safe insertion order for the given tables.</span>

<span class="sd">        Returns tables ordered so that all FK dependencies are satisfied</span>
<span class="sd">        when inserting in order.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Tables to order. If None, orders all tables in schemas.</span>
<span class="sd">            handle_cycles: If True, break cycles by removing edges.</span>
<span class="sd">                If False, raise CycleError on cycles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Ordered list of Table objects (insert from first to last).</span>

<span class="sd">        Raises:</span>
<span class="sd">            CycleError: If handle_cycles=False and cycles exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dependency_graph</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TopologicalSorter</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="n">ordered_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">static_order</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">CycleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handle_cycles</span><span class="p">:</span>
                <span class="n">ordered_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_break_cycles_and_sort</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="c1"># Convert keys back to Table objects</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ordered_keys</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_deletion_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">handle_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute FK-safe deletion order for the given tables.</span>

<span class="sd">        Returns tables in reverse dependency order - tables that are</span>
<span class="sd">        referenced should be deleted last.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Tables to order. If None, orders all tables in schemas.</span>
<span class="sd">            handle_cycles: If True, break cycles. If False, raise on cycles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Ordered list of Table objects (delete from first to last).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">insertion_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_insertion_order</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span> <span class="n">handle_cycles</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">insertion_order</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_break_cycles_and_sort</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">graph</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">error</span><span class="p">:</span> <span class="n">CycleError</span><span class="p">,</span>
        <span class="n">_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle cycles by breaking them and re-sorting.</span>

<span class="sd">        Uses a simple strategy of removing edges from cycle members</span>
<span class="sd">        until no cycles remain.</span>

<span class="sd">        Args:</span>
<span class="sd">            graph: Dependency graph.</span>
<span class="sd">            error: CycleError with cycle info.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Ordered list of table keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>  <span class="c1"># Can&#39;t have more cycles than edges</span>
        <span class="k">if</span> <span class="n">_depth</span> <span class="o">&gt;</span> <span class="n">max_depth</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Too many cycles to break, returning arbitrary order&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># Get cycle from error message.</span>
        <span class="c1"># CycleError.args[1] is like [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;A&#39;] where first == last.</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">cycle</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Breaking cycle in FK dependencies: </span><span class="si">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Remove one edge from the cycle to break it.</span>
            <span class="c1"># cycle[-1] == cycle[0], so the unique nodes are cycle[:-1].</span>
            <span class="c1"># Each consecutive pair cycle[i] -&gt; cycle[i+1] corresponds to</span>
            <span class="c1"># graph[cycle[i+1]] containing cycle[i] (i.e., cycle[i+1] depends on cycle[i]).</span>
            <span class="c1"># Remove the last real edge: cycle[-2] from graph[cycle[-1]].</span>
            <span class="n">edge_removed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">dep_node</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># the dependency</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>      <span class="c1"># the node that depends on dep_node</span>
                <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span> <span class="ow">and</span> <span class="n">dep_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                    <span class="n">graph</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dep_node</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed dependency </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dep_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">edge_removed</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">edge_removed</span><span class="p">:</span>
                <span class="c1"># Try removing any edge in the cycle</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dep_node</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cycle</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span> <span class="ow">and</span> <span class="n">dep_node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
                        <span class="n">graph</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dep_node</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed dependency </span><span class="si">{</span><span class="n">node</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">dep_node</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="n">edge_removed</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

        <span class="c1"># Try again</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">TopologicalSorter</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">static_order</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">CycleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Recursively break more cycles</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_break_cycles_and_sort</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_insertion_order</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that a list of tables can be inserted in order.</span>

<span class="sd">        Checks each table to ensure all its FK dependencies are</span>
<span class="sd">        satisfied by tables earlier in the list.</span>

<span class="sd">        Args:</span>
<span class="sd">            tables: Ordered list of tables to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of (table, missing_dependency, fk_name) tuples for</span>
<span class="sd">            any unsatisfied dependencies. Empty list if valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">table_objs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>
        <span class="n">seen_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">violations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table_objs</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                <span class="n">pk_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)</span>
                <span class="c1"># Skip self-references and tables not in our set</span>
                <span class="k">if</span> <span class="n">pk_key</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">pk_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table_objs</span><span class="p">}:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">pk_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_keys</span><span class="p">:</span>
                    <span class="n">violations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">pk_key</span><span class="p">,</span> <span class="n">fk</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="n">seen_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">violations</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_all_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all tables in configured schemas.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of all Table objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="n">tables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">tables</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find all FK dependency cycles in the schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of cycles, each cycle is a list of table keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dependency_graph</span><span class="p">()</span>
        <span class="n">cycles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Use DFS to find cycles</span>
        <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">rec_stack</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">rec_stack</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">neighbor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dfs</span><span class="p">(</span><span class="n">neighbor</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">rec_stack</span><span class="p">:</span>
                    <span class="c1"># Found cycle</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">neighbor</span><span class="p">)</span>
                    <span class="n">cycle</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">neighbor</span><span class="p">]</span>
                    <span class="n">cycles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>

            <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">rec_stack</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="n">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cycles</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the orderer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ERMrest Model object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schemas</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schemas to consider for FK relationships.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the orderer.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: ERMrest Model object.</span>
<span class="sd">        schemas: Schemas to consider for FK relationships.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">schemas</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_build_table_cache</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.find_cycles" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_cycles</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_cycles</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find all FK dependency cycles in the schema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="list">list</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of cycles, each cycle is a list of table keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_cycles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all FK dependency cycles in the schema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of cycles, each cycle is a list of table keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dependency_graph</span><span class="p">()</span>
    <span class="n">cycles</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Use DFS to find cycles</span>
    <span class="n">visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">rec_stack</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">rec_stack</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">set</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">neighbor</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dfs</span><span class="p">(</span><span class="n">neighbor</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">rec_stack</span><span class="p">:</span>
                <span class="c1"># Found cycle</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">neighbor</span><span class="p">)</span>
                <span class="n">cycle</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">neighbor</span><span class="p">]</span>
                <span class="n">cycles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>

        <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">rec_stack</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">visited</span><span class="p">:</span>
            <span class="n">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">cycles</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.get_all_tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_all_tables</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_all_tables</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all tables in configured schemas.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of all Table objects.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_all_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all tables in configured schemas.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of all Table objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">tables</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.get_deletion_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_deletion_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_deletion_order</span><span class="p">(</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">handle_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute FK-safe deletion order for the given tables.</p>
<p>Returns tables in reverse dependency order - tables that are
referenced should be deleted last.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tables to order. If None, orders all tables in schemas.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>handle_cycles</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, break cycles. If False, raise on cycles.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ordered list of Table objects (delete from first to last).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_deletion_order</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">handle_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute FK-safe deletion order for the given tables.</span>

<span class="sd">    Returns tables in reverse dependency order - tables that are</span>
<span class="sd">    referenced should be deleted last.</span>

<span class="sd">    Args:</span>
<span class="sd">        tables: Tables to order. If None, orders all tables in schemas.</span>
<span class="sd">        handle_cycles: If True, break cycles. If False, raise on cycles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Ordered list of Table objects (delete from first to last).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">insertion_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_insertion_order</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span> <span class="n">handle_cycles</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">insertion_order</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.get_dependencies" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_dependencies</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_dependencies</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get tables that this table depends on (FK targets).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name or object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of tables that must be populated before this table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get tables that this table depends on (FK targets).</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table name or object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Set of tables that must be populated before this table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">dependencies</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
        <span class="n">pk_table</span> <span class="o">=</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span>
        <span class="c1"># Only include dependencies within our schemas</span>
        <span class="k">if</span> <span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="c1"># Don&#39;t include self-references as dependencies</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">pk_table</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="n">dependencies</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pk_table</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dependencies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.get_dependents" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_dependents</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_dependents</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get tables that depend on this table (FK sources).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name or object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="set">set</span>[<span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set of tables that reference this table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dependents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get tables that depend on this table (FK sources).</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table name or object.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Set of tables that reference this table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="n">dependents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="k">for</span> <span class="n">other_table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">other_table</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">other_table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                    <span class="n">dependents</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other_table</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="k">return</span> <span class="n">dependents</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.get_insertion_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_insertion_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_insertion_order</span><span class="p">(</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">]</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">handle_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute FK-safe insertion order for the given tables.</p>
<p>Returns tables ordered so that all FK dependencies are satisfied
when inserting in order.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tables to order. If None, orders all tables in schemas.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>handle_cycles</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, break cycles by removing edges.
If False, raise CycleError on cycles.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ordered list of Table objects (insert from first to last).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="graphlib.CycleError">CycleError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If handle_cycles=False and cycles exist.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_insertion_order</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">handle_cycles</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DerivaTable</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute FK-safe insertion order for the given tables.</span>

<span class="sd">    Returns tables ordered so that all FK dependencies are satisfied</span>
<span class="sd">    when inserting in order.</span>

<span class="sd">    Args:</span>
<span class="sd">        tables: Tables to order. If None, orders all tables in schemas.</span>
<span class="sd">        handle_cycles: If True, break cycles by removing edges.</span>
<span class="sd">            If False, raise CycleError on cycles.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Ordered list of Table objects (insert from first to last).</span>

<span class="sd">    Raises:</span>
<span class="sd">        CycleError: If handle_cycles=False and cycles exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_dependency_graph</span><span class="p">(</span><span class="n">tables</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">TopologicalSorter</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
        <span class="n">ordered_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">static_order</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">CycleError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">handle_cycles</span><span class="p">:</span>
            <span class="n">ordered_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_break_cycles_and_sort</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="c1"># Convert keys back to Table objects</span>
    <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ordered_keys</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.ForeignKeyOrderer.validate_insertion_order" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validate_insertion_order</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validate_insertion_order</span><span class="p">(</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Table</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate that a list of tables can be inserted in order.</p>
<p>Checks each table to ensure all its FK dependencies are
satisfied by tables earlier in the list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tables</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="deriva.core.ermrest_model.Table">Table</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Ordered list of tables to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of (table, missing_dependency, fk_name) tuples for</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>any unsatisfied dependencies. Empty list if valid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/fk_orderer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_insertion_order</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">DerivaTable</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate that a list of tables can be inserted in order.</span>

<span class="sd">    Checks each table to ensure all its FK dependencies are</span>
<span class="sd">    satisfied by tables earlier in the list.</span>

<span class="sd">    Args:</span>
<span class="sd">        tables: Ordered list of tables to validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of (table, missing_dependency, fk_name) tuples for</span>
<span class="sd">        any unsatisfied dependencies. Empty list if valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">table_objs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_table</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">]</span>
    <span class="n">seen_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">violations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">table_objs</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
            <span class="n">pk_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="p">)</span>
            <span class="c1"># Skip self-references and tables not in our set</span>
            <span class="k">if</span> <span class="n">pk_key</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">pk_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_table_key</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">table_objs</span><span class="p">}:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">pk_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen_keys</span><span class="p">:</span>
                <span class="n">violations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">pk_key</span><span class="p">,</span> <span class="n">fk</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">seen_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">violations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.InboundFK" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">InboundFK</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>An inbound foreign key path step for pseudo-column source paths.</p>
<p>Use this when following a foreign key FROM another table TO the current table.
This is common when counting or aggregating related records.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schema name containing the FK constraint</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Foreign key constraint name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Count images related to a subject (Image has FK to Subject)::</p>
<pre><code>&gt;&gt;&gt; # In Subject table, count related images
&gt;&gt;&gt; pc = PseudoColumn(
...     source=[InboundFK("domain", "Image_Subject_fkey"), "RID"],
...     aggregate=Aggregate.CNT,
...     markdown_name="Image Count"
... )
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">InboundFK</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An inbound foreign key path step for pseudo-column source paths.</span>

<span class="sd">    Use this when following a foreign key FROM another table TO the current table.</span>
<span class="sd">    This is common when counting or aggregating related records.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema: Schema name containing the FK constraint</span>
<span class="sd">        constraint: Foreign key constraint name</span>

<span class="sd">    Example:</span>
<span class="sd">        Count images related to a subject (Image has FK to Subject)::</span>

<span class="sd">            &gt;&gt;&gt; # In Subject table, count related images</span>
<span class="sd">            &gt;&gt;&gt; pc = PseudoColumn(</span>
<span class="sd">            ...     source=[InboundFK(&quot;domain&quot;, &quot;Image_Subject_fkey&quot;), &quot;RID&quot;],</span>
<span class="sd">            ...     aggregate=Aggregate.CNT,</span>
<span class="sd">            ...     markdown_name=&quot;Image Count&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">constraint</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;inbound&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="p">]}</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.NameStyle" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">NameStyle</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Styling options for automatic display name formatting.</p>
<p>Applied to table or column names when no explicit display name is set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>underline_space</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Replace underscores with spaces (e.g., "First_Name" -&gt; "First Name")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title_case</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Apply title case formatting (e.g., "firstname" -&gt; "Firstname")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>markdown</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Render the name as markdown</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="deriva_ml.model.NameStyle--transform-subject_id-to-subject-id-with-title-case">Transform "Subject_ID" to "Subject Id" with title case</h3>
<p>display = Display(
...     name_style=NameStyle(underline_space=True, title_case=True)
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NameStyle</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Styling options for automatic display name formatting.</span>

<span class="sd">    Applied to table or column names when no explicit display name is set.</span>

<span class="sd">    Args:</span>
<span class="sd">        underline_space: Replace underscores with spaces (e.g., &quot;First_Name&quot; -&gt; &quot;First Name&quot;)</span>
<span class="sd">        title_case: Apply title case formatting (e.g., &quot;firstname&quot; -&gt; &quot;Firstname&quot;)</span>
<span class="sd">        markdown: Render the name as markdown</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Transform &quot;Subject_ID&quot; to &quot;Subject Id&quot; with title case</span>
<span class="sd">        &gt;&gt;&gt; display = Display(</span>
<span class="sd">        ...     name_style=NameStyle(underline_space=True, title_case=True)</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">underline_space</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">title_case</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">markdown</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dictionary, excluding None values.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">underline_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;underline_space&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">underline_space</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_case</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;title_case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_case</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.NameStyle.to_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">to_dict</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_dict</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert to dictionary, excluding None values.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to dictionary, excluding None values.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">underline_space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;underline_space&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">underline_space</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_case</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;title_case&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title_case</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.OutboundFK" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">OutboundFK</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>An outbound foreign key path step for pseudo-column source paths.</p>
<p>Use this when following a foreign key FROM the current table TO another table.
This is common when displaying values from referenced tables.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schema name containing the FK constraint</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Foreign key constraint name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Show species name from a related Species table::</p>
<pre><code>&gt;&gt;&gt; # Subject has FK to Species, display Species.Name
&gt;&gt;&gt; pc = PseudoColumn(
...     source=[OutboundFK("domain", "Subject_Species_fkey"), "Name"],
...     markdown_name="Species"
... )
</code></pre>
<p>Chain multiple outbound FKs::</p>
<pre><code>&gt;&gt;&gt; # Image -&gt; Subject -&gt; Species
&gt;&gt;&gt; pc = PseudoColumn(
...     source=[
...         OutboundFK("domain", "Image_Subject_fkey"),
...         OutboundFK("domain", "Subject_Species_fkey"),
...         "Name"
...     ],
...     markdown_name="Species"
... )
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OutboundFK</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An outbound foreign key path step for pseudo-column source paths.</span>

<span class="sd">    Use this when following a foreign key FROM the current table TO another table.</span>
<span class="sd">    This is common when displaying values from referenced tables.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema: Schema name containing the FK constraint</span>
<span class="sd">        constraint: Foreign key constraint name</span>

<span class="sd">    Example:</span>
<span class="sd">        Show species name from a related Species table::</span>

<span class="sd">            &gt;&gt;&gt; # Subject has FK to Species, display Species.Name</span>
<span class="sd">            &gt;&gt;&gt; pc = PseudoColumn(</span>
<span class="sd">            ...     source=[OutboundFK(&quot;domain&quot;, &quot;Subject_Species_fkey&quot;), &quot;Name&quot;],</span>
<span class="sd">            ...     markdown_name=&quot;Species&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        Chain multiple outbound FKs::</span>

<span class="sd">            &gt;&gt;&gt; # Image -&gt; Subject -&gt; Species</span>
<span class="sd">            &gt;&gt;&gt; pc = PseudoColumn(</span>
<span class="sd">            ...     source=[</span>
<span class="sd">            ...         OutboundFK(&quot;domain&quot;, &quot;Image_Subject_fkey&quot;),</span>
<span class="sd">            ...         OutboundFK(&quot;domain&quot;, &quot;Subject_Species_fkey&quot;),</span>
<span class="sd">            ...         &quot;Name&quot;</span>
<span class="sd">            ...     ],</span>
<span class="sd">            ...     markdown_name=&quot;Species&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">constraint</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;outbound&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint</span><span class="p">]}</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.PreFormat" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">PreFormat</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Pre-formatting options for column values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Printf-style format string (e.g., "%.2f")</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bool_true_value</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display value for True</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bool_false_value</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display value for False</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PreFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-formatting options for column values.</span>

<span class="sd">    Args:</span>
<span class="sd">        format: Printf-style format string (e.g., &quot;%.2f&quot;)</span>
<span class="sd">        bool_true_value: Display value for True</span>
<span class="sd">        bool_false_value: Display value for False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bool_true_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">bool_false_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_true_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bool_true_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_true_value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_false_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;bool_false_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool_false_value</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.PseudoColumn" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">PseudoColumn</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>A pseudo-column definition for visible columns and foreign keys.</p>
<p>Pseudo-columns display computed values, values from related tables,
or custom markdown patterns. They appear as columns in table views
but are not actual database columns.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="list">list</span>[<span title="str">str</span> | <a class="autorefs autorefs-internal" title="InboundFK


  
      dataclass
   (deriva_ml.model.annotations.InboundFK)" href="#deriva_ml.model.InboundFK">InboundFK</a> | <a class="autorefs autorefs-internal" title="OutboundFK


  
      dataclass
   (deriva_ml.model.annotations.OutboundFK)" href="#deriva_ml.model.OutboundFK">OutboundFK</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to source data. Can be:
- A column name (string)
- A list of FK path steps ending with a column name</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sourcekey</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reference to a named source in source-definitions annotation</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>markdown_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display name for the column (supports markdown)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comment</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="typing.Literal">Literal</span>[False] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description/tooltip text (or False to hide)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>entity</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this represents an entity (affects rendering)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Aggregate (deriva_ml.model.annotations.Aggregate)" href="#deriva_ml.model.Aggregate">Aggregate</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Aggregation function when source returns multiple values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>self_link</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Make the value a link to the current row</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="PseudoColumnDisplay


  
      dataclass
   (deriva_ml.model.annotations.PseudoColumnDisplay)" href="#deriva_ml.model.PseudoColumnDisplay">PseudoColumnDisplay</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display formatting options</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array_options</code>
            </td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options for array aggregates (max_length, order)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>source and sourcekey are mutually exclusive. Use source for inline
definitions, sourcekey to reference pre-defined sources.</p>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If both source and sourcekey are provided</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Simple column with custom display name::</p>
<pre><code>&gt;&gt;&gt; PseudoColumn(source="Internal_ID", markdown_name="ID")
</code></pre>
<p>Outbound FK traversal (display value from referenced table)::</p>
<pre><code>&gt;&gt;&gt; # Subject has FK to Species - show Species.Name
&gt;&gt;&gt; PseudoColumn(
...     source=[OutboundFK("domain", "Subject_Species_fkey"), "Name"],
...     markdown_name="Species"
... )
</code></pre>
<p>Inbound FK with aggregation (count related records)::</p>
<pre><code>&gt;&gt;&gt; # Count images pointing to this subject
&gt;&gt;&gt; PseudoColumn(
...     source=[InboundFK("domain", "Image_Subject_fkey"), "RID"],
...     aggregate=Aggregate.CNT,
...     markdown_name="Images"
... )
</code></pre>
<p>Multi-hop FK path::</p>
<pre><code>&gt;&gt;&gt; # Image -&gt; Subject -&gt; Species
&gt;&gt;&gt; PseudoColumn(
...     source=[
...         OutboundFK("domain", "Image_Subject_fkey"),
...         OutboundFK("domain", "Subject_Species_fkey"),
...         "Name"
...     ],
...     markdown_name="Species"
... )
</code></pre>
<p>With custom display formatting::</p>
<pre><code>&gt;&gt;&gt; PseudoColumn(
...     source="URL",
...     display=PseudoColumnDisplay(
...         markdown_pattern="[Download]({{{_value}}})",
...         show_foreign_key_link=False
...     )
... )
</code></pre>
<p>Array aggregate with display options::</p>
<pre><code>&gt;&gt;&gt; PseudoColumn(
...     source=[InboundFK("domain", "Tag_Item_fkey"), "Name"],
...     aggregate=Aggregate.ARRAY_D,
...     display=PseudoColumnDisplay(array_ux_mode=ArrayUxMode.CSV),
...     markdown_name="Tags"
... )
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PseudoColumn</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A pseudo-column definition for visible columns and foreign keys.</span>

<span class="sd">    Pseudo-columns display computed values, values from related tables,</span>
<span class="sd">    or custom markdown patterns. They appear as columns in table views</span>
<span class="sd">    but are not actual database columns.</span>

<span class="sd">    Args:</span>
<span class="sd">        source: Path to source data. Can be:</span>
<span class="sd">            - A column name (string)</span>
<span class="sd">            - A list of FK path steps ending with a column name</span>
<span class="sd">        sourcekey: Reference to a named source in source-definitions annotation</span>
<span class="sd">        markdown_name: Display name for the column (supports markdown)</span>
<span class="sd">        comment: Description/tooltip text (or False to hide)</span>
<span class="sd">        entity: Whether this represents an entity (affects rendering)</span>
<span class="sd">        aggregate: Aggregation function when source returns multiple values</span>
<span class="sd">        self_link: Make the value a link to the current row</span>
<span class="sd">        display: Display formatting options</span>
<span class="sd">        array_options: Options for array aggregates (max_length, order)</span>

<span class="sd">    Note:</span>
<span class="sd">        source and sourcekey are mutually exclusive. Use source for inline</span>
<span class="sd">        definitions, sourcekey to reference pre-defined sources.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If both source and sourcekey are provided</span>

<span class="sd">    Example:</span>
<span class="sd">        Simple column with custom display name::</span>

<span class="sd">            &gt;&gt;&gt; PseudoColumn(source=&quot;Internal_ID&quot;, markdown_name=&quot;ID&quot;)</span>

<span class="sd">        Outbound FK traversal (display value from referenced table)::</span>

<span class="sd">            &gt;&gt;&gt; # Subject has FK to Species - show Species.Name</span>
<span class="sd">            &gt;&gt;&gt; PseudoColumn(</span>
<span class="sd">            ...     source=[OutboundFK(&quot;domain&quot;, &quot;Subject_Species_fkey&quot;), &quot;Name&quot;],</span>
<span class="sd">            ...     markdown_name=&quot;Species&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        Inbound FK with aggregation (count related records)::</span>

<span class="sd">            &gt;&gt;&gt; # Count images pointing to this subject</span>
<span class="sd">            &gt;&gt;&gt; PseudoColumn(</span>
<span class="sd">            ...     source=[InboundFK(&quot;domain&quot;, &quot;Image_Subject_fkey&quot;), &quot;RID&quot;],</span>
<span class="sd">            ...     aggregate=Aggregate.CNT,</span>
<span class="sd">            ...     markdown_name=&quot;Images&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        Multi-hop FK path::</span>

<span class="sd">            &gt;&gt;&gt; # Image -&gt; Subject -&gt; Species</span>
<span class="sd">            &gt;&gt;&gt; PseudoColumn(</span>
<span class="sd">            ...     source=[</span>
<span class="sd">            ...         OutboundFK(&quot;domain&quot;, &quot;Image_Subject_fkey&quot;),</span>
<span class="sd">            ...         OutboundFK(&quot;domain&quot;, &quot;Subject_Species_fkey&quot;),</span>
<span class="sd">            ...         &quot;Name&quot;</span>
<span class="sd">            ...     ],</span>
<span class="sd">            ...     markdown_name=&quot;Species&quot;</span>
<span class="sd">            ... )</span>

<span class="sd">        With custom display formatting::</span>

<span class="sd">            &gt;&gt;&gt; PseudoColumn(</span>
<span class="sd">            ...     source=&quot;URL&quot;,</span>
<span class="sd">            ...     display=PseudoColumnDisplay(</span>
<span class="sd">            ...         markdown_pattern=&quot;[Download]({{{_value}}})&quot;,</span>
<span class="sd">            ...         show_foreign_key_link=False</span>
<span class="sd">            ...     )</span>
<span class="sd">            ... )</span>

<span class="sd">        Array aggregate with display options::</span>

<span class="sd">            &gt;&gt;&gt; PseudoColumn(</span>
<span class="sd">            ...     source=[InboundFK(&quot;domain&quot;, &quot;Tag_Item_fkey&quot;), &quot;Name&quot;],</span>
<span class="sd">            ...     aggregate=Aggregate.ARRAY_D,</span>
<span class="sd">            ...     display=PseudoColumnDisplay(array_ux_mode=ArrayUxMode.CSV),</span>
<span class="sd">            ...     markdown_name=&quot;Tags&quot;</span>
<span class="sd">            ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">InboundFK</span> <span class="o">|</span> <span class="n">OutboundFK</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">sourcekey</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">markdown_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">entity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">aggregate</span><span class="p">:</span> <span class="n">Aggregate</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">self_link</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">display</span><span class="p">:</span> <span class="n">PseudoColumnDisplay</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">array_options</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Can be complex</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcekey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;source and sourcekey are mutually exclusive&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Convert path elements</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;to_dict&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcekey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;sourcekey&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourcekey</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;aggregate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;self_link&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_link</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;display&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;array_options&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_options</span>

        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.PseudoColumnDisplay" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">PseudoColumnDisplay</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Display options for a pseudo-column.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>markdown_pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Handlebars/mustache template</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_engine</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TemplateEngine (deriva_ml.model.annotations.TemplateEngine)" href="#deriva_ml.model.TemplateEngine">TemplateEngine</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template engine to use</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_foreign_key_link</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Show as clickable link</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array_ux_mode</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ArrayUxMode (deriva_ml.model.annotations.ArrayUxMode)" href="#deriva_ml.model.ArrayUxMode">ArrayUxMode</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How to render array values</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>column_order</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="SortKey


  
      dataclass
   (deriva_ml.model.annotations.SortKey)" href="#deriva_ml.model.SortKey">SortKey</a>] | <span title="typing.Literal">Literal</span>[False] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sort order for the column, or False to disable</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait_for</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template variables to wait for before rendering</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PseudoColumnDisplay</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display options for a pseudo-column.</span>

<span class="sd">    Args:</span>
<span class="sd">        markdown_pattern: Handlebars/mustache template</span>
<span class="sd">        template_engine: Template engine to use</span>
<span class="sd">        show_foreign_key_link: Show as clickable link</span>
<span class="sd">        array_ux_mode: How to render array values</span>
<span class="sd">        column_order: Sort order for the column, or False to disable</span>
<span class="sd">        wait_for: Template variables to wait for before rendering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">markdown_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">template_engine</span><span class="p">:</span> <span class="n">TemplateEngine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">show_foreign_key_link</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">array_ux_mode</span><span class="p">:</span> <span class="n">ArrayUxMode</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">column_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SortKey</span><span class="p">]</span> <span class="o">|</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">wait_for</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;markdown_pattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markdown_pattern</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;template_engine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_engine</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_foreign_key_link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;show_foreign_key_link&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_foreign_key_link</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_ux_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;array_ux_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_ux_mode</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_order</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;column_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;column_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">k</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">SortKey</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_order</span>
                <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wait_for&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_for</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.SchemaBuilder" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SchemaBuilder</span>


</h2>


    <div class="doc doc-contents ">



        <p>Creates SQLAlchemy ORM from a Deriva catalog model.</p>
<p>Phase 1 of the two-phase database creation pattern. This class handles
only schema/ORM creation - no data loading.</p>
<p>The Model can come from either a live catalog or a schema.json file:
- From catalog: model = catalog.getCatalogModel()
- From file: model = Model.fromfile("file-system", "path/to/schema.json")</p>


<details class="example" open>
  <summary>Example</summary>
  <h3 id="deriva_ml.model.SchemaBuilder--create-orm-from-catalog-model">Create ORM from catalog model</h3>
<p>model = catalog.getCatalogModel()
builder = SchemaBuilder(model, schemas=['domain', 'deriva-ml'])
orm = builder.build()</p>
<h3 id="deriva_ml.model.SchemaBuilder--create-orm-from-schema-file">Create ORM from schema file</h3>
<p>model = Model.fromfile("file-system", "schema.json")
builder = SchemaBuilder(model, schemas=['domain'], database_path="local.db")
orm = builder.build()</p>
<h3 id="deriva_ml.model.SchemaBuilder--use-the-orm">Use the ORM</h3>
<p>ImageClass = orm.get_orm_class("Image")
with Session(orm.engine) as session:
    images = session.query(ImageClass).all()</p>
<h3 id="deriva_ml.model.SchemaBuilder--clean-up">Clean up</h3>
<p>orm.dispose()</p>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SchemaBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates SQLAlchemy ORM from a Deriva catalog model.</span>

<span class="sd">    Phase 1 of the two-phase database creation pattern. This class handles</span>
<span class="sd">    only schema/ORM creation - no data loading.</span>

<span class="sd">    The Model can come from either a live catalog or a schema.json file:</span>
<span class="sd">    - From catalog: model = catalog.getCatalogModel()</span>
<span class="sd">    - From file: model = Model.fromfile(&quot;file-system&quot;, &quot;path/to/schema.json&quot;)</span>

<span class="sd">    Example:</span>
<span class="sd">        # Create ORM from catalog model</span>
<span class="sd">        model = catalog.getCatalogModel()</span>
<span class="sd">        builder = SchemaBuilder(model, schemas=[&#39;domain&#39;, &#39;deriva-ml&#39;])</span>
<span class="sd">        orm = builder.build()</span>

<span class="sd">        # Create ORM from schema file</span>
<span class="sd">        model = Model.fromfile(&quot;file-system&quot;, &quot;schema.json&quot;)</span>
<span class="sd">        builder = SchemaBuilder(model, schemas=[&#39;domain&#39;], database_path=&quot;local.db&quot;)</span>
<span class="sd">        orm = builder.build()</span>

<span class="sd">        # Use the ORM</span>
<span class="sd">        ImageClass = orm.get_orm_class(&quot;Image&quot;)</span>
<span class="sd">        with Session(orm.engine) as session:</span>
<span class="sd">            images = session.query(ImageClass).all()</span>

<span class="sd">        # Clean up</span>
<span class="sd">        orm.dispose()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Type mapping from ERMrest to SQLAlchemy</span>
    <span class="n">_TYPE_MAP</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;boolean&quot;</span><span class="p">:</span> <span class="n">ERMRestBoolean</span><span class="p">,</span>
        <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">StringToDate</span><span class="p">,</span>
        <span class="s2">&quot;float4&quot;</span><span class="p">:</span> <span class="n">StringToFloat</span><span class="p">,</span>
        <span class="s2">&quot;float8&quot;</span><span class="p">:</span> <span class="n">StringToFloat</span><span class="p">,</span>
        <span class="s2">&quot;int2&quot;</span><span class="p">:</span> <span class="n">StringToInteger</span><span class="p">,</span>
        <span class="s2">&quot;int4&quot;</span><span class="p">:</span> <span class="n">StringToInteger</span><span class="p">,</span>
        <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="n">StringToInteger</span><span class="p">,</span>
        <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="n">JSON</span><span class="p">,</span>
        <span class="s2">&quot;jsonb&quot;</span><span class="p">:</span> <span class="n">JSON</span><span class="p">,</span>
        <span class="s2">&quot;timestamptz&quot;</span><span class="p">:</span> <span class="n">StringToDateTime</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">StringToDateTime</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">database_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the schema builder.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: ERMrest Model object (from catalog or schema.json file).</span>
<span class="sd">            schemas: List of schema names to include in the ORM.</span>
<span class="sd">            database_path: Path to SQLite database file. Use &quot;:memory:&quot; for</span>
<span class="sd">                in-memory database (default). If a Path or string is provided,</span>
<span class="sd">                separate .db files will be created for each schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="n">schemas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">database_path</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span> <span class="k">else</span> <span class="n">database_path</span>

        <span class="c1"># Will be set during build()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">:</span> <span class="n">Engine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="p">:</span> <span class="n">AutomapBase</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_sql_type</span><span class="p">(</span><span class="n">deriva_type</span><span class="p">:</span> <span class="n">DerivaType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeEngine</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map ERMrest type to SQLAlchemy type with CSV string conversion.</span>

<span class="sd">        Args:</span>
<span class="sd">            deriva_type: ERMrest type object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SQLAlchemy type class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SchemaBuilder</span><span class="o">.</span><span class="n">_TYPE_MAP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">deriva_type</span><span class="o">.</span><span class="n">typename</span><span class="p">,</span> <span class="n">String</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_is_key_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="n">DerivaColumn</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DerivaTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if column is the primary key (RID).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">column</span> <span class="ow">in</span> <span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">unique_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">]</span> <span class="ow">and</span> <span class="n">column</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;RID&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SchemaORM</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the SQLAlchemy ORM structure.</span>

<span class="sd">        Creates SQLite tables from the ERMrest schema and generates</span>
<span class="sd">        ORM classes via SQLAlchemy automap.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SchemaORM object containing engine, metadata, Base, and utilities.</span>

<span class="sd">        Note:</span>
<span class="sd">            In-memory databases (database_path=&quot;:memory:&quot;) do not support</span>
<span class="sd">            SQLite schema attachments, so all tables will be created in a</span>
<span class="sd">            single database without schema prefixes in table names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create unique prefix for ORM class names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>

        <span class="c1"># Determine if we&#39;re using in-memory or file-based database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span>

        <span class="c1"># Create engine</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">==</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///:memory:&quot;</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ensure the database path exists</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.db&quot;</span><span class="p">:</span>
                    <span class="c1"># Single file path</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">main_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Directory path</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">main_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">/</span> <span class="s2">&quot;main.db&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">main_db</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">)</span>
                <span class="n">main_db</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sqlite:///</span><span class="si">{</span><span class="n">main_db</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Attach schema-specific databases</span>
            <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_schemas</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Base</span> <span class="o">=</span> <span class="n">automap_base</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c1"># Build the schema</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Built ORM for schemas </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%d</span><span class="s2"> tables&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">SchemaORM</span><span class="p">(</span>
            <span class="n">engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">Base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">schemas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">,</span>
            <span class="n">class_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span><span class="p">,</span>
            <span class="n">use_schemas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_attach_schemas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbapi_conn</span><span class="p">,</span> <span class="n">_conn_record</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attach schema-specific SQLite databases.&quot;&quot;&quot;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">dbapi_conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">db_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="n">schema_file</span> <span class="o">=</span> <span class="p">(</span><span class="n">db_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">.db&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ATTACH DATABASE &#39;</span><span class="si">{</span><span class="n">schema_file</span><span class="si">}</span><span class="s2">&#39; AS &#39;</span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create SQLite tables from the ERMrest schema.&quot;&quot;&quot;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">col</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Get column from ORM class, handling both attribute and table column access.&quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">__table__</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">guess_attr_name</span><span class="p">(</span><span class="n">col_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generate relationship attribute name from column name.&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="n">col_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">col_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_id&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="n">col_name</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">make_table_name</span><span class="p">(</span><span class="n">schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Generate table name, including schema prefix if using schemas.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For in-memory, use underscore separator to avoid conflicts</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">database_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SQLTable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema </span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2"> not found in model&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">database_columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SQLColumn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">database_column</span> <span class="o">=</span> <span class="n">SQLColumn</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">type_</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_type</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
                        <span class="n">comment</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                        <span class="n">primary_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_key_column</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">table</span><span class="p">),</span>
                        <span class="n">nullable</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">nullok</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">database_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_column</span><span class="p">)</span>

                <span class="c1"># Use schema prefix only for file-based databases</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
                    <span class="n">database_table</span> <span class="o">=</span> <span class="n">SQLTable</span><span class="p">(</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="o">*</span><span class="n">database_columns</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema_name</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># For in-memory, embed schema in table name</span>
                    <span class="n">full_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                    <span class="n">database_table</span> <span class="o">=</span> <span class="n">SQLTable</span><span class="p">(</span>
                        <span class="n">full_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="o">*</span><span class="n">database_columns</span>
                    <span class="p">)</span>

                <span class="c1"># Add unique constraints</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
                    <span class="n">key_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">unique_columns</span><span class="p">]</span>
                    <span class="n">database_table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
                        <span class="n">SQLUniqueConstraint</span><span class="p">(</span><span class="o">*</span><span class="n">key_columns</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>

                <span class="c1"># Add foreign key constraints (within same schema only for now)</span>
                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">schema_name</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="c1"># Build reference column names</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
                        <span class="n">refcols</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span>
                        <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># For in-memory, use the embedded schema name</span>
                        <span class="n">ref_table_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">schema_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                        <span class="n">refcols</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_table_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span>
                        <span class="p">]</span>

                    <span class="n">database_table</span><span class="o">.</span><span class="n">append_constraint</span><span class="p">(</span>
                        <span class="n">SQLForeignKeyConstraint</span><span class="p">(</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fk</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">],</span>
                            <span class="n">refcolumns</span><span class="o">=</span><span class="n">refcols</span><span class="p">,</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">fk</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">comment</span><span class="o">=</span><span class="n">fk</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

                <span class="n">database_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database_table</span><span class="p">)</span>

        <span class="c1"># Create all tables</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">database_tables</span><span class="p">,</span> <span class="n">checkfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Configure ORM class naming</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">name_for_scalar_relationship</span><span class="p">(</span><span class="n">_base</span><span class="p">,</span> <span class="n">local_cls</span><span class="p">,</span> <span class="n">referred_cls</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="n">constraint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">key</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">local_cls</span><span class="o">.</span><span class="n">__table__</span><span class="o">.</span><span class="n">columns</span><span class="p">}:</span>
                    <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;_rel&quot;</span>
                <span class="k">return</span> <span class="n">name</span>
            <span class="k">return</span> <span class="n">constraint</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">referred_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">name_for_collection_relationship</span><span class="p">(</span><span class="n">_base</span><span class="p">,</span> <span class="n">local_cls</span><span class="p">,</span> <span class="n">referred_cls</span><span class="p">,</span> <span class="n">constraint</span><span class="p">):</span>
            <span class="n">backref_name</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_fkey&quot;</span><span class="p">,</span> <span class="s2">&quot;_collection&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">backref_name</span> <span class="ow">or</span> <span class="p">(</span><span class="n">referred_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_collection&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">classname_for_table</span><span class="p">(</span><span class="n">_base</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span> <span class="o">+</span> <span class="n">tablename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>

        <span class="c1"># Build ORM mappings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span>
            <span class="n">name_for_scalar_relationship</span><span class="o">=</span><span class="n">name_for_scalar_relationship</span><span class="p">,</span>
            <span class="n">name_for_collection_relationship</span><span class="o">=</span><span class="n">name_for_collection_relationship</span><span class="p">,</span>
            <span class="n">classname_for_table</span><span class="o">=</span><span class="n">classname_for_table</span><span class="p">,</span>
            <span class="n">reflect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add cross-schema relationships</span>
        <span class="k">for</span> <span class="n">schema_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">schema_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">foreign_keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">schema_name</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">table_name</span> <span class="o">=</span> <span class="n">make_table_name</span><span class="p">(</span><span class="n">schema_name</span><span class="p">,</span> <span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">table_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_orm_class_by_name</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
                    <span class="n">foreign_key_column_name</span> <span class="o">=</span> <span class="n">fk</span><span class="o">.</span><span class="n">foreign_key_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">foreign_key_column</span> <span class="o">=</span> <span class="n">col</span><span class="p">(</span><span class="n">table_class</span><span class="p">,</span> <span class="n">foreign_key_column_name</span><span class="p">)</span>

                    <span class="n">referenced_table_name</span> <span class="o">=</span> <span class="n">make_table_name</span><span class="p">(</span><span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fk</span><span class="o">.</span><span class="n">pk_table</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">referenced_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_orm_class_by_name</span><span class="p">(</span><span class="n">referenced_table_name</span><span class="p">)</span>
                    <span class="n">referenced_column</span> <span class="o">=</span> <span class="n">col</span><span class="p">(</span><span class="n">referenced_class</span><span class="p">,</span> <span class="n">fk</span><span class="o">.</span><span class="n">referenced_columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

                    <span class="n">relationship_attr</span> <span class="o">=</span> <span class="n">guess_attr_name</span><span class="p">(</span><span class="n">foreign_key_column_name</span><span class="p">)</span>
                    <span class="n">backref_attr</span> <span class="o">=</span> <span class="n">fk</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_fkey&quot;</span><span class="p">,</span> <span class="s2">&quot;_collection&quot;</span><span class="p">)</span>

                    <span class="c1"># Check if relationship already exists</span>
                    <span class="n">existing_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">table_class</span><span class="p">,</span> <span class="n">relationship_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm</span><span class="w"> </span><span class="kn">import</span> <span class="n">RelationshipProperty</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy.orm.attributes</span><span class="w"> </span><span class="kn">import</span> <span class="n">InstrumentedAttribute</span>

                    <span class="n">is_relationship</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">existing_attr</span><span class="p">,</span> <span class="n">InstrumentedAttribute</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">existing_attr</span><span class="o">.</span><span class="n">property</span><span class="p">,</span> <span class="n">RelationshipProperty</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_relationship</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span>
                            <span class="n">table_class</span><span class="p">,</span>
                            <span class="n">relationship_attr</span><span class="p">,</span>
                            <span class="n">relationship</span><span class="p">(</span>
                                <span class="n">referenced_class</span><span class="p">,</span>
                                <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">foreign_key_column</span><span class="p">],</span>
                                <span class="n">primaryjoin</span><span class="o">=</span><span class="n">foreign</span><span class="p">(</span><span class="n">foreign_key_column</span><span class="p">)</span> <span class="o">==</span> <span class="n">referenced_column</span><span class="p">,</span>
                                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="n">backref_attr</span><span class="p">,</span> <span class="n">viewonly</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                                <span class="n">viewonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="p">),</span>
                        <span class="p">)</span>

        <span class="c1"># Configure mappers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_orm_class_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get ORM class by table name (internal use during build).</span>

<span class="sd">        Handles both schema.table format (file-based) and schema_table format (in-memory).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try exact match first</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For in-memory databases, table names use underscore separator</span>
            <span class="c1"># Try converting schema.table to schema_table format</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">table_name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
                <span class="n">converted_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">converted_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                    <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">converted_name</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sql_table</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Try matching just the table name part</span>
                <span class="n">sql_table</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># Handle both . and _ separators</span>
                    <span class="n">table_part</span> <span class="o">=</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">full_name</span> <span class="k">else</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">full_name</span> <span class="k">else</span> <span class="n">full_name</span>
                    <span class="k">if</span> <span class="n">table_part</span> <span class="o">==</span> <span class="n">table_name</span> <span class="ow">or</span> <span class="n">full_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                        <span class="n">sql_table</span> <span class="o">=</span> <span class="n">table</span>
                        <span class="k">break</span>

        <span class="k">if</span> <span class="n">sql_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mapper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">mappers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mapper</span><span class="o">.</span><span class="n">persist_selectable</span> <span class="ow">is</span> <span class="n">sql_table</span> <span class="ow">or</span> <span class="n">sql_table</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaBuilder.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">database_path</span><span class="p">:</span> <span class="n">Path</span>
    <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize the schema builder.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ERMrest Model object (from catalog or schema.json file).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schemas</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of schema names to include in the ORM.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>database_path</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to SQLite database file. Use ":memory:" for
in-memory database (default). If a Path or string is provided,
separate .db files will be created for each schema.</p>
              </div>
            </td>
            <td>
                  <code>&#39;:memory:&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">database_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the schema builder.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: ERMrest Model object (from catalog or schema.json file).</span>
<span class="sd">        schemas: List of schema names to include in the ORM.</span>
<span class="sd">        database_path: Path to SQLite database file. Use &quot;:memory:&quot; for</span>
<span class="sd">            in-memory database (default). If a Path or string is provided,</span>
<span class="sd">            separate .db files will be created for each schema.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="n">schemas</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">database_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">database_path</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span> <span class="k">else</span> <span class="n">database_path</span>

    <span class="c1"># Will be set during build()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">:</span> <span class="n">Engine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="p">:</span> <span class="n">AutomapBase</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaBuilder.build" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">build</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaORM</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Build the SQLAlchemy ORM structure.</p>
<p>Creates SQLite tables from the ERMrest schema and generates
ORM classes via SQLAlchemy automap.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="SchemaORM (deriva_ml.model.schema_builder.SchemaORM)" href="#deriva_ml.model.SchemaORM">SchemaORM</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SchemaORM object containing engine, metadata, Base, and utilities.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>In-memory databases (database_path=":memory:") do not support
SQLite schema attachments, so all tables will be created in a
single database without schema prefixes in table names.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SchemaORM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build the SQLAlchemy ORM structure.</span>

<span class="sd">    Creates SQLite tables from the ERMrest schema and generates</span>
<span class="sd">    ORM classes via SQLAlchemy automap.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SchemaORM object containing engine, metadata, Base, and utilities.</span>

<span class="sd">    Note:</span>
<span class="sd">        In-memory databases (database_path=&quot;:memory:&quot;) do not support</span>
<span class="sd">        SQLite schema attachments, so all tables will be created in a</span>
<span class="sd">        single database without schema prefixes in table names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create unique prefix for ORM class names</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>

    <span class="c1"># Determine if we&#39;re using in-memory or file-based database</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">!=</span> <span class="s2">&quot;:memory:&quot;</span>

    <span class="c1"># Create engine</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">==</span> <span class="s2">&quot;:memory:&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///:memory:&quot;</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Ensure the database path exists</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">==</span> <span class="s2">&quot;.db&quot;</span><span class="p">:</span>
                <span class="c1"># Single file path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">main_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Directory path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">main_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_path</span> <span class="o">/</span> <span class="s2">&quot;main.db&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">main_db</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_path</span><span class="p">)</span>
            <span class="n">main_db</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sqlite:///</span><span class="si">{</span><span class="n">main_db</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Attach schema-specific databases</span>
        <span class="n">event</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span> <span class="s2">&quot;connect&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_schemas</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Base</span> <span class="o">=</span> <span class="n">automap_base</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

    <span class="c1"># Build the schema</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_create_tables</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Built ORM for schemas </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%d</span><span class="s2"> tables&quot;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">SchemaORM</span><span class="p">(</span>
        <span class="n">engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">Base</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
        <span class="n">schemas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schemas</span><span class="p">,</span>
        <span class="n">class_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span><span class="p">,</span>
        <span class="n">use_schemas</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.SchemaORM" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SchemaORM</span>


</h2>


    <div class="doc doc-contents ">



        <p>Container for SQLAlchemy ORM components.</p>
<p>Provides access to the ORM structure and utility methods for
table/class lookup. This is the result of Phase 1 (SchemaBuilder).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.SchemaORM.engine">engine</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy Engine for database connections.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.SchemaORM.metadata">metadata</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy MetaData with table definitions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.SchemaORM.Base">Base</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy automap base for ORM classes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.SchemaORM.model">model</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ERMrest Model the ORM was built from.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.SchemaORM.schemas">schemas</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of schema names included.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.SchemaORM.use_schemas">use_schemas</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether schema prefixes are used (False for in-memory).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SchemaORM</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for SQLAlchemy ORM components.</span>

<span class="sd">    Provides access to the ORM structure and utility methods for</span>
<span class="sd">    table/class lookup. This is the result of Phase 1 (SchemaBuilder).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        engine: SQLAlchemy Engine for database connections.</span>
<span class="sd">        metadata: SQLAlchemy MetaData with table definitions.</span>
<span class="sd">        Base: SQLAlchemy automap base for ORM classes.</span>
<span class="sd">        model: ERMrest Model the ORM was built from.</span>
<span class="sd">        schemas: List of schema names included.</span>
<span class="sd">        use_schemas: Whether schema prefixes are used (False for in-memory).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">engine</span><span class="p">:</span> <span class="n">Engine</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
        <span class="n">Base</span><span class="p">:</span> <span class="n">AutomapBase</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
        <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">class_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">use_schemas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize SchemaORM container.</span>

<span class="sd">        Args:</span>
<span class="sd">            engine: SQLAlchemy Engine.</span>
<span class="sd">            metadata: SQLAlchemy MetaData with tables.</span>
<span class="sd">            Base: Automap base with ORM classes.</span>
<span class="sd">            model: Source ERMrest Model.</span>
<span class="sd">            schemas: Schemas that were included.</span>
<span class="sd">            class_prefix: Prefix used for ORM class names.</span>
<span class="sd">            use_schemas: Whether schema prefixes are used (False for in-memory).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Base</span> <span class="o">=</span> <span class="n">Base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="n">schemas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span> <span class="o">=</span> <span class="n">class_prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span> <span class="o">=</span> <span class="n">use_schemas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">list_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List all tables in the database.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of fully-qualified table names (schema.table), sorted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tables</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SQLTable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find a table by name.</span>

<span class="sd">        Handles both schema.table format and schema_table format (for in-memory databases).</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: Table name, with or without schema prefix.</span>
<span class="sd">                Can be &quot;schema.table&quot;, &quot;schema_table&quot;, or just &quot;table&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SQLAlchemy Table object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If table not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try exact match first</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

        <span class="c1"># Try converting schema.table to schema_table format (for in-memory)</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">table_name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
            <span class="n">converted_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">converted_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">converted_name</span><span class="p">]</span>

        <span class="c1"># Try matching just the table name part</span>
        <span class="k">for</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Handle . separator (file-based)</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">full_name</span> <span class="ow">and</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">table</span>
            <span class="c1"># Handle _ separator (in-memory) - match suffix after first _</span>
            <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">full_name</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_name</span><span class="p">:</span>
                <span class="c1"># Check if table_name matches the part after schema prefix</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">table</span>
                <span class="c1"># Also check if it ends with the table name</span>
                <span class="k">if</span> <span class="n">full_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">table</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_orm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ORM class for a table by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_name: Table name, with or without schema prefix.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SQLAlchemy ORM class for the table.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If table not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orm_class_for_table</span><span class="p">(</span><span class="n">sql_table</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_orm_class_for_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">SQLTable</span> <span class="o">|</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the ORM class for a table.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: SQLAlchemy Table, Deriva Table, or table name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SQLAlchemy ORM class, or None if not found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">):</span>
            <span class="c1"># Try schema.table format first (file-based), then schema_table (in-memory)</span>
            <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
                <span class="c1"># Try underscore format for in-memory databases</span>
                <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
                <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">mapper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">mappers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mapper</span><span class="o">.</span><span class="n">persist_selectable</span> <span class="ow">is</span> <span class="n">table</span> <span class="ow">or</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_table_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all rows from a table as dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            table: Table name (with or without schema prefix).</span>

<span class="sd">        Yields:</span>
<span class="sd">            Dictionary for each row with column names as keys.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">sql_table</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">mappings</span><span class="p">():</span>
                <span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_association_table</span><span class="p">(</span>
        <span class="n">table_class</span><span class="p">,</span>
        <span class="n">min_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">max_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">unqualified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">pure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">no_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">return_fkeys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if an ORM class represents an association table.</span>

<span class="sd">        An association table links two or more tables through foreign keys,</span>
<span class="sd">        with a composite unique key covering those foreign keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            table_class: SQLAlchemy ORM class to check.</span>
<span class="sd">            min_arity: Minimum number of foreign keys (default 2).</span>
<span class="sd">            max_arity: Maximum number of foreign keys (default 2).</span>
<span class="sd">            unqualified: If True, reject associations with extra key columns.</span>
<span class="sd">            pure: If True, reject associations with extra non-key columns.</span>
<span class="sd">            no_overlap: If True, reject associations with shared FK columns.</span>
<span class="sd">            return_fkeys: If True, return the foreign keys instead of arity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If return_fkeys=False: Integer arity if association, False otherwise.</span>
<span class="sd">            If return_fkeys=True: Set of foreign keys if association, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">min_arity</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An association cannot have arity &lt; 2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_arity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_arity</span> <span class="o">&lt;</span> <span class="n">min_arity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_arity cannot be less than min_arity&quot;</span><span class="p">)</span>

        <span class="n">mapper</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">table_class</span><span class="p">)</span><span class="o">.</span><span class="n">mapper</span>
        <span class="n">system_cols</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span> <span class="s2">&quot;RCT&quot;</span><span class="p">,</span> <span class="s2">&quot;RMT&quot;</span><span class="p">,</span> <span class="s2">&quot;RCB&quot;</span><span class="p">,</span> <span class="s2">&quot;RMB&quot;</span><span class="p">}</span>

        <span class="n">non_sys_cols</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">system_cols</span>
        <span class="p">}</span>

        <span class="n">unique_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">table_class</span><span class="p">)</span><span class="o">.</span><span class="n">local_table</span><span class="o">.</span><span class="n">constraints</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">SQLUniqueConstraint</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">non_sys_key_colsets</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">frozenset</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">unique_columns</span>
            <span class="k">if</span> <span class="n">uc</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">non_sys_cols</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">non_sys_key_colsets</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Choose longest compound key</span>
        <span class="n">row_key</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">non_sys_key_colsets</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">table_class</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="n">covered_fkeys</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">fkey</span> <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">foreign_keys</span>
            <span class="k">if</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fkey</span><span class="o">.</span><span class="n">local_columns</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">row_key</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">covered_fkey_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_fkeys</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_arity</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">max_arity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_fkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_arity</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">covered_fkeys</span><span class="p">:</span>
            <span class="n">fkcols</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fkey</span><span class="o">.</span><span class="n">local_columns</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">no_overlap</span> <span class="ow">and</span> <span class="n">fkcols</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">covered_fkey_cols</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">covered_fkey_cols</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fkcols</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unqualified</span> <span class="ow">and</span> <span class="n">row_key</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">covered_fkey_cols</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">pure</span> <span class="ow">and</span> <span class="n">non_sys_cols</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">row_key</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">covered_fkeys</span> <span class="k">if</span> <span class="n">return_fkeys</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_fkeys</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_association_class</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">left_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
        <span class="n">right_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find an association class connecting two ORM classes.</span>

<span class="sd">        Args:</span>
<span class="sd">            left_cls: First ORM class.</span>
<span class="sd">            right_cls: Second ORM class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple of (association_class, left_relationship, right_relationship),</span>
<span class="sd">            or None if no association found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">left_rel</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">left_cls</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mid_cls</span> <span class="o">=</span> <span class="n">left_rel</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
            <span class="n">is_assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_association_table</span><span class="p">(</span><span class="n">mid_cls</span><span class="p">,</span> <span class="n">return_fkeys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_assoc</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">assoc_local_columns_left</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">is_assoc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">local_columns</span>
            <span class="n">assoc_local_columns_right</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">is_assoc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">local_columns</span>

            <span class="n">found_left</span> <span class="o">=</span> <span class="n">found_right</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">left_cls</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">remote_side</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">remote_side</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">remote_side</span> <span class="ow">in</span> <span class="n">assoc_local_columns_left</span><span class="p">:</span>
                    <span class="n">found_left</span> <span class="o">=</span> <span class="n">r</span>
                <span class="k">if</span> <span class="n">remote_side</span> <span class="ow">in</span> <span class="n">assoc_local_columns_right</span><span class="p">:</span>
                    <span class="n">found_left</span> <span class="o">=</span> <span class="n">r</span>
                    <span class="c1"># Swap if backwards</span>
                    <span class="n">assoc_local_columns_left</span><span class="p">,</span> <span class="n">assoc_local_columns_right</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">assoc_local_columns_right</span><span class="p">,</span>
                        <span class="n">assoc_local_columns_left</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">right_cls</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">remote_side</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">remote_side</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">remote_side</span> <span class="ow">in</span> <span class="n">assoc_local_columns_right</span><span class="p">:</span>
                    <span class="n">found_right</span> <span class="o">=</span> <span class="n">r</span>

            <span class="k">if</span> <span class="n">found_left</span> <span class="ow">and</span> <span class="n">found_right</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">mid_cls</span><span class="p">,</span> <span class="n">found_left</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">,</span> <span class="n">found_right</span><span class="o">.</span><span class="n">class_attribute</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">dispose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispose of SQLAlchemy resources.</span>

<span class="sd">        Call this when done with the database to properly clean up connections.</span>
<span class="sd">        After calling dispose(), the instance should not be used further.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;engine&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleanup resources when garbage collected.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SchemaORM&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Context manager exit - dispose resources.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.__del__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__del__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__del__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Cleanup resources when garbage collected.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleanup resources when garbage collected.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.__enter__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__enter__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__enter__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="s1">&#39;SchemaORM&#39;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager entry.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SchemaORM&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager entry.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.__exit__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__exit__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__exit__</span><span class="p">(</span>
    <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Context manager exit - dispose resources.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager exit - dispose resources.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span>
    <span class="n">engine</span><span class="p">:</span> <span class="n">Engine</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
    <span class="n">Base</span><span class="p">:</span> <span class="n">AutomapBase</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">class_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_schemas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize SchemaORM container.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>engine</code>
            </td>
            <td>
                  <code><span title="sqlalchemy.engine.Engine">Engine</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy Engine.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metadata</code>
            </td>
            <td>
                  <code><span title="sqlalchemy.MetaData">MetaData</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy MetaData with tables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Base</code>
            </td>
            <td>
                  <code><span title="sqlalchemy.ext.automap.AutomapBase">AutomapBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Automap base with ORM classes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="deriva.core.ermrest_model.Model">Model</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source ERMrest Model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>schemas</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schemas that were included.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>class_prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Prefix used for ORM class names.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_schemas</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether schema prefixes are used (False for in-memory).</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">engine</span><span class="p">:</span> <span class="n">Engine</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">MetaData</span><span class="p">,</span>
    <span class="n">Base</span><span class="p">:</span> <span class="n">AutomapBase</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
    <span class="n">schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">class_prefix</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">use_schemas</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize SchemaORM container.</span>

<span class="sd">    Args:</span>
<span class="sd">        engine: SQLAlchemy Engine.</span>
<span class="sd">        metadata: SQLAlchemy MetaData with tables.</span>
<span class="sd">        Base: Automap base with ORM classes.</span>
<span class="sd">        model: Source ERMrest Model.</span>
<span class="sd">        schemas: Schemas that were included.</span>
<span class="sd">        class_prefix: Prefix used for ORM class names.</span>
<span class="sd">        use_schemas: Whether schema prefixes are used (False for in-memory).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Base</span> <span class="o">=</span> <span class="n">Base</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schemas</span> <span class="o">=</span> <span class="n">schemas</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_class_prefix</span> <span class="o">=</span> <span class="n">class_prefix</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span> <span class="o">=</span> <span class="n">use_schemas</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.dispose" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">dispose</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">dispose</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Dispose of SQLAlchemy resources.</p>
<p>Call this when done with the database to properly clean up connections.
After calling dispose(), the instance should not be used further.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">dispose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dispose of SQLAlchemy resources.</span>

<span class="sd">    Call this when done with the database to properly clean up connections.</span>
<span class="sd">    After calling dispose(), the instance should not be used further.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Base&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;engine&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_disposed</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.find_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SQLTable</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find a table by name.</p>
<p>Handles both schema.table format and schema_table format (for in-memory databases).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name, with or without schema prefix.
Can be "schema.table", "schema_table", or just "table".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="sqlalchemy.Table">Table</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy Table object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If table not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">find_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SQLTable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a table by name.</span>

<span class="sd">    Handles both schema.table format and schema_table format (for in-memory databases).</span>

<span class="sd">    Args:</span>
<span class="sd">        table_name: Table name, with or without schema prefix.</span>
<span class="sd">            Can be &quot;schema.table&quot;, &quot;schema_table&quot;, or just &quot;table&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SQLAlchemy Table object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If table not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Try exact match first</span>
    <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>

    <span class="c1"># Try converting schema.table to schema_table format (for in-memory)</span>
    <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">table_name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
        <span class="n">converted_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">converted_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">converted_name</span><span class="p">]</span>

    <span class="c1"># Try matching just the table name part</span>
    <span class="k">for</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Handle . separator (file-based)</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">full_name</span> <span class="ow">and</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">table</span>
        <span class="c1"># Handle _ separator (in-memory) - match suffix after first _</span>
        <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">full_name</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">full_name</span><span class="p">:</span>
            <span class="c1"># Check if table_name matches the part after schema prefix</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">full_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">table_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">table</span>
            <span class="c1"># Also check if it ends with the table name</span>
            <span class="k">if</span> <span class="n">full_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">table</span>

    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.get_association_class" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_association_class</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_association_class</span><span class="p">(</span>
    <span class="n">left_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">right_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find an association class connecting two ORM classes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>left_cls</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First ORM class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>right_cls</code>
            </td>
            <td>
                  <code><span title="typing.Type">Type</span>[<span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second ORM class.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (association_class, left_relationship, right_relationship),</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>or None if no association found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_association_class</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">left_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">right_cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find an association class connecting two ORM classes.</span>

<span class="sd">    Args:</span>
<span class="sd">        left_cls: First ORM class.</span>
<span class="sd">        right_cls: Second ORM class.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of (association_class, left_relationship, right_relationship),</span>
<span class="sd">        or None if no association found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">left_rel</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">left_cls</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mid_cls</span> <span class="o">=</span> <span class="n">left_rel</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
        <span class="n">is_assoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_association_table</span><span class="p">(</span><span class="n">mid_cls</span><span class="p">,</span> <span class="n">return_fkeys</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_assoc</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">assoc_local_columns_left</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">is_assoc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">local_columns</span>
        <span class="n">assoc_local_columns_right</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">is_assoc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">local_columns</span>

        <span class="n">found_left</span> <span class="o">=</span> <span class="n">found_right</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">left_cls</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">remote_side</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">remote_side</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">remote_side</span> <span class="ow">in</span> <span class="n">assoc_local_columns_left</span><span class="p">:</span>
                <span class="n">found_left</span> <span class="o">=</span> <span class="n">r</span>
            <span class="k">if</span> <span class="n">remote_side</span> <span class="ow">in</span> <span class="n">assoc_local_columns_right</span><span class="p">:</span>
                <span class="n">found_left</span> <span class="o">=</span> <span class="n">r</span>
                <span class="c1"># Swap if backwards</span>
                <span class="n">assoc_local_columns_left</span><span class="p">,</span> <span class="n">assoc_local_columns_right</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">assoc_local_columns_right</span><span class="p">,</span>
                    <span class="n">assoc_local_columns_left</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">right_cls</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">remote_side</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">remote_side</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">remote_side</span> <span class="ow">in</span> <span class="n">assoc_local_columns_right</span><span class="p">:</span>
                <span class="n">found_right</span> <span class="o">=</span> <span class="n">r</span>

        <span class="k">if</span> <span class="n">found_left</span> <span class="ow">and</span> <span class="n">found_right</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mid_cls</span><span class="p">,</span> <span class="n">found_left</span><span class="o">.</span><span class="n">class_attribute</span><span class="p">,</span> <span class="n">found_right</span><span class="o">.</span><span class="n">class_attribute</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.get_orm_class" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_orm_class</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_orm_class</span><span class="p">(</span>
    <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the ORM class for a table by name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name, with or without schema prefix.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy ORM class for the table.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If table not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_orm_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the ORM class for a table by name.</span>

<span class="sd">    Args:</span>
<span class="sd">        table_name: Table name, with or without schema prefix.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SQLAlchemy ORM class for the table.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: If table not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_orm_class_for_table</span><span class="p">(</span><span class="n">sql_table</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.get_orm_class_for_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_orm_class_for_table</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_orm_class_for_table</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="n">Table</span> <span class="o">|</span> <span class="n">Table</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the ORM class for a table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="sqlalchemy.Table">Table</span> | <span title="deriva.core.ermrest_model.Table">Table</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy Table, Deriva Table, or table name.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Any">Any</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy ORM class, or None if not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_orm_class_for_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">SQLTable</span> <span class="o">|</span> <span class="n">DerivaTable</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the ORM class for a table.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: SQLAlchemy Table, Deriva Table, or table name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SQLAlchemy ORM class, or None if not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">DerivaTable</span><span class="p">):</span>
        <span class="c1"># Try schema.table format first (file-based), then schema_table (in-memory)</span>
        <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_schemas</span><span class="p">:</span>
            <span class="c1"># Try underscore format for in-memory databases</span>
            <span class="n">table_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">table_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">mapper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Base</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">mappers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mapper</span><span class="o">.</span><span class="n">persist_selectable</span> <span class="ow">is</span> <span class="n">table</span> <span class="ow">or</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="n">class_</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.get_table_contents" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_table_contents</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_table_contents</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span>
    <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
<span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve all rows from a table as dictionaries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Table name (with or without schema prefix).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary for each row with column names as keys.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_table_contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve all rows from a table as dictionaries.</span>

<span class="sd">    Args:</span>
<span class="sd">        table: Table name (with or without schema prefix).</span>

<span class="sd">    Yields:</span>
<span class="sd">        Dictionary for each row with column names as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sql_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_table</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">sql_table</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">mappings</span><span class="p">():</span>
            <span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.is_association_table" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_association_table</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_association_table</span><span class="p">(</span>
    <span class="n">table_class</span><span class="p">,</span>
    <span class="n">min_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">max_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">unqualified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">pure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">no_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">return_fkeys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if an ORM class represents an association table.</p>
<p>An association table links two or more tables through foreign keys,
with a composite unique key covering those foreign keys.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>table_class</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQLAlchemy ORM class to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_arity</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of foreign keys (default 2).</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_arity</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of foreign keys (default 2).</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unqualified</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, reject associations with extra key columns.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pure</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, reject associations with extra non-key columns.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>no_overlap</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, reject associations with shared FK columns.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_fkeys</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, return the foreign keys instead of arity.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If return_fkeys=False: Integer arity if association, False otherwise.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If return_fkeys=True: Set of foreign keys if association, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">is_association_table</span><span class="p">(</span>
    <span class="n">table_class</span><span class="p">,</span>
    <span class="n">min_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">max_arity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">unqualified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">pure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">no_overlap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">return_fkeys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if an ORM class represents an association table.</span>

<span class="sd">    An association table links two or more tables through foreign keys,</span>
<span class="sd">    with a composite unique key covering those foreign keys.</span>

<span class="sd">    Args:</span>
<span class="sd">        table_class: SQLAlchemy ORM class to check.</span>
<span class="sd">        min_arity: Minimum number of foreign keys (default 2).</span>
<span class="sd">        max_arity: Maximum number of foreign keys (default 2).</span>
<span class="sd">        unqualified: If True, reject associations with extra key columns.</span>
<span class="sd">        pure: If True, reject associations with extra non-key columns.</span>
<span class="sd">        no_overlap: If True, reject associations with shared FK columns.</span>
<span class="sd">        return_fkeys: If True, return the foreign keys instead of arity.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If return_fkeys=False: Integer arity if association, False otherwise.</span>
<span class="sd">        If return_fkeys=True: Set of foreign keys if association, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">min_arity</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;An association cannot have arity &lt; 2&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_arity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_arity</span> <span class="o">&lt;</span> <span class="n">min_arity</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;max_arity cannot be less than min_arity&quot;</span><span class="p">)</span>

    <span class="n">mapper</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">table_class</span><span class="p">)</span><span class="o">.</span><span class="n">mapper</span>
    <span class="n">system_cols</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;RID&quot;</span><span class="p">,</span> <span class="s2">&quot;RCT&quot;</span><span class="p">,</span> <span class="s2">&quot;RMT&quot;</span><span class="p">,</span> <span class="s2">&quot;RCB&quot;</span><span class="p">,</span> <span class="s2">&quot;RMB&quot;</span><span class="p">}</span>

    <span class="n">non_sys_cols</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">system_cols</span>
    <span class="p">}</span>

    <span class="n">unique_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">inspect</span><span class="p">(</span><span class="n">table_class</span><span class="p">)</span><span class="o">.</span><span class="n">local_table</span><span class="o">.</span><span class="n">constraints</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">SQLUniqueConstraint</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">non_sys_key_colsets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">frozenset</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uc</span> <span class="ow">in</span> <span class="n">unique_columns</span>
        <span class="k">if</span> <span class="n">uc</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">non_sys_cols</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">uc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">non_sys_key_colsets</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Choose longest compound key</span>
    <span class="n">row_key</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">non_sys_key_colsets</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">foreign_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="p">(</span><span class="n">table_class</span><span class="p">)</span><span class="o">.</span><span class="n">relationships</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="n">covered_fkeys</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">fkey</span> <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">foreign_keys</span>
        <span class="k">if</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fkey</span><span class="o">.</span><span class="n">local_columns</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">row_key</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">covered_fkey_cols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_fkeys</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_arity</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">max_arity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_fkeys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_arity</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="n">covered_fkeys</span><span class="p">:</span>
        <span class="n">fkcols</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fkey</span><span class="o">.</span><span class="n">local_columns</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">no_overlap</span> <span class="ow">and</span> <span class="n">fkcols</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">covered_fkey_cols</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">covered_fkey_cols</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fkcols</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">unqualified</span> <span class="ow">and</span> <span class="n">row_key</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">covered_fkey_cols</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">pure</span> <span class="ow">and</span> <span class="n">non_sys_cols</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">row_key</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">covered_fkeys</span> <span class="k">if</span> <span class="n">return_fkeys</span> <span class="k">else</span> <span class="nb">len</span><span class="p">(</span><span class="n">covered_fkeys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SchemaORM.list_tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_tables</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">list_tables</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>List all tables in the database.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of fully-qualified table names (schema.table), sorted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/schema_builder.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">list_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List all tables in the database.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of fully-qualified table names (schema.table), sorted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">tables</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tables</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.SortKey" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SortKey</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>A sort key for row ordering.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column name to sort by</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>descending</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sort in descending order (default False)</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>SortKey("Name")  # Ascending
SortKey("Created", descending=True)  # Descending</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SortKey</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A sort key for row ordering.</span>

<span class="sd">    Args:</span>
<span class="sd">        column: Column name to sort by</span>
<span class="sd">        descending: Sort in descending order (default False)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; SortKey(&quot;Name&quot;)  # Ascending</span>
<span class="sd">        &gt;&gt;&gt; SortKey(&quot;Created&quot;, descending=True)  # Descending</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">column</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">descending</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to dict or string (if ascending).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descending</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">,</span> <span class="s2">&quot;descending&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.SortKey.to_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">to_dict</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_dict</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert to dict or string (if ascending).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert to dict or string (if ascending).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">descending</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;column&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">,</span> <span class="s2">&quot;descending&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">column</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.TableDisplay" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TableDisplay</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="deriva_ml.model.annotations.AnnotationBuilder">AnnotationBuilder</span></code></p>



        <p>Table-display annotation builder.</p>
<p>Controls table-level display options like row naming and ordering.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>td = TableDisplay()
td.row_name(row_markdown_pattern="{{{Name}}} ({{{Species}}})")
td.compact(row_order=[SortKey("Name")])</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TableDisplay</span><span class="p">(</span><span class="n">AnnotationBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Table-display annotation builder.</span>

<span class="sd">    Controls table-level display options like row naming and ordering.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; td = TableDisplay()</span>
<span class="sd">        &gt;&gt;&gt; td.row_name(row_markdown_pattern=&quot;{{{Name}}} ({{{Species}}})&quot;)</span>
<span class="sd">        &gt;&gt;&gt; td.compact(row_order=[SortKey(&quot;Name&quot;)])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_TABLE_DISPLAY</span>

    <span class="n">_contexts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TableDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set options for a context.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">row_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">row_markdown_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">template_engine</span><span class="p">:</span> <span class="n">TemplateEngine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set row name pattern (used in foreign key dropdowns, etc.).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span>
            <span class="n">CONTEXT_ROW_NAME</span><span class="p">,</span>
            <span class="n">TableDisplayOptions</span><span class="p">(</span>
                <span class="n">row_markdown_pattern</span><span class="o">=</span><span class="n">row_markdown_pattern</span><span class="p">,</span>
                <span class="n">template_engine</span><span class="o">=</span><span class="n">template_engine</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set options for compact (list) view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_COMPACT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set options for detailed (record) view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set default options.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">options</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.TableDisplay.compact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compact</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">compact</span><span class="p">(</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set options for compact (list) view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set options for compact (list) view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_COMPACT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.TableDisplay.default" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">default</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">default</span><span class="p">(</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set default options.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set default options.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.TableDisplay.detailed" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">detailed</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">detailed</span><span class="p">(</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set options for detailed (record) view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set options for detailed (record) view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.TableDisplay.row_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">row_name</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">row_name</span><span class="p">(</span>
    <span class="n">row_markdown_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">template_engine</span><span class="p">:</span> <span class="n">TemplateEngine</span>
    <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set row name pattern (used in foreign key dropdowns, etc.).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">row_name</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">row_markdown_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">template_engine</span><span class="p">:</span> <span class="n">TemplateEngine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set row name pattern (used in foreign key dropdowns, etc.).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span>
        <span class="n">CONTEXT_ROW_NAME</span><span class="p">,</span>
        <span class="n">TableDisplayOptions</span><span class="p">(</span>
            <span class="n">row_markdown_pattern</span><span class="o">=</span><span class="n">row_markdown_pattern</span><span class="p">,</span>
            <span class="n">template_engine</span><span class="o">=</span><span class="n">template_engine</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.TableDisplay.set_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_context</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_context</span><span class="p">(</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span>
    <span class="o">|</span> <span class="nb">str</span>
    <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set options for a context.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">TableDisplayOptions</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TableDisplay&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set options for a context.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.TableDisplayOptions" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TableDisplayOptions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Options for a single table display context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>row_order</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="SortKey


  
      dataclass
   (deriva_ml.model.annotations.SortKey)" href="#deriva_ml.model.SortKey">SortKey</a>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sort order for rows</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_size</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of rows per page</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>row_markdown_pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template for row names</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>page_markdown_pattern</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template for page header</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator_markdown</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template between rows</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prefix_markdown</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template before rows</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>suffix_markdown</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template after rows</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>template_engine</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="TemplateEngine (deriva_ml.model.annotations.TemplateEngine)" href="#deriva_ml.model.TemplateEngine">TemplateEngine</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Template engine for patterns</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collapse_toc_panel</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Collapse TOC panel</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hide_column_headers</code>
            </td>
            <td>
                  <code><span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hide column headers</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TableDisplayOptions</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Options for a single table display context.</span>

<span class="sd">    Args:</span>
<span class="sd">        row_order: Sort order for rows</span>
<span class="sd">        page_size: Number of rows per page</span>
<span class="sd">        row_markdown_pattern: Template for row names</span>
<span class="sd">        page_markdown_pattern: Template for page header</span>
<span class="sd">        separator_markdown: Template between rows</span>
<span class="sd">        prefix_markdown: Template before rows</span>
<span class="sd">        suffix_markdown: Template after rows</span>
<span class="sd">        template_engine: Template engine for patterns</span>
<span class="sd">        collapse_toc_panel: Collapse TOC panel</span>
<span class="sd">        hide_column_headers: Hide column headers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">row_order</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SortKey</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">row_markdown_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">page_markdown_pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">separator_markdown</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prefix_markdown</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">suffix_markdown</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">template_engine</span><span class="p">:</span> <span class="n">TemplateEngine</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">collapse_toc_panel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">hide_column_headers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;row_order&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">k</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">SortKey</span><span class="p">)</span> <span class="k">else</span> <span class="n">k</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_order</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;page_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_size</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_markdown_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;row_markdown_pattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_markdown_pattern</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_markdown_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;page_markdown_pattern&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">page_markdown_pattern</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">separator_markdown</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;separator_markdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">separator_markdown</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_markdown</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;prefix_markdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_markdown</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix_markdown</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;suffix_markdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suffix_markdown</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_engine</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;template_engine&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template_engine</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapse_toc_panel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;collapse_toc_panel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapse_toc_panel</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_column_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;hide_column_headers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hide_column_headers</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.TemplateEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TemplateEngine</span>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>



        <p>Template engine for markdown patterns.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.TemplateEngine.HANDLEBARS">HANDLEBARS</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use Handlebars.js templating (recommended, more features)</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="deriva_ml.model.TemplateEngine.MUSTACHE">MUSTACHE</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use Mustache templating (simpler, fewer features)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>display = PseudoColumnDisplay(
...     markdown_pattern="<a href="{{{URL}}}">{{{Name}}}</a>",
...     template_engine=TemplateEngine.HANDLEBARS
... )</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TemplateEngine</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Template engine for markdown patterns.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        HANDLEBARS: Use Handlebars.js templating (recommended, more features)</span>
<span class="sd">        MUSTACHE: Use Mustache templating (simpler, fewer features)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; display = PseudoColumnDisplay(</span>
<span class="sd">        ...     markdown_pattern=&quot;[{{{Name}}}]({{{URL}}})&quot;,</span>
<span class="sd">        ...     template_engine=TemplateEngine.HANDLEBARS</span>
<span class="sd">        ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">HANDLEBARS</span> <span class="o">=</span> <span class="s2">&quot;handlebars&quot;</span>
    <span class="n">MUSTACHE</span> <span class="o">=</span> <span class="s2">&quot;mustache&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.VisibleColumns" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">VisibleColumns</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="deriva_ml.model.annotations.AnnotationBuilder">AnnotationBuilder</span></code></p>



        <p>Visible-columns annotation builder.</p>
<p>Controls which columns appear in different UI contexts and their order.
This is one of the most commonly used annotations for customizing the
Chaise interface.</p>
<p>Column entries can be:
- Column names (strings): "Name", "RID", "Description"
- Foreign key references: fk_constraint("schema", "constraint_name")
- Pseudo-columns: PseudoColumn(...) for computed/derived values</p>
<p>Contexts:
- <code>compact</code>: Table/list views (search results, data browser)
- <code>detailed</code>: Single record view (full record page)
- <code>entry</code>: Create/edit forms
- <code>entry/create</code>: Create form only
- <code>entry/edit</code>: Edit form only
- <code>*</code>: Default for all contexts</p>


<details class="example" open>
  <summary>Example</summary>
  <p>Basic column lists for different contexts::</p>
<pre><code>&gt;&gt;&gt; vc = VisibleColumns()
&gt;&gt;&gt; vc.compact(["RID", "Name", "Status"])
&gt;&gt;&gt; vc.detailed(["RID", "Name", "Status", "Description", "Created"])
&gt;&gt;&gt; vc.entry(["Name", "Status", "Description"])
&gt;&gt;&gt; handle.set_annotation(vc)
</code></pre>
<p>Method chaining::</p>
<pre><code>&gt;&gt;&gt; vc = (VisibleColumns()
...     .compact(["RID", "Name"])
...     .detailed(["RID", "Name", "Description"])
...     .entry(["Name", "Description"]))
</code></pre>
<p>Including foreign key references::</p>
<pre><code>&gt;&gt;&gt; vc = VisibleColumns()
&gt;&gt;&gt; vc.compact([
...     "RID",
...     "Name",
...     fk_constraint("domain", "Subject_Species_fkey"),
... ])
</code></pre>
<p>With pseudo-columns for computed values::</p>
<pre><code>&gt;&gt;&gt; vc = VisibleColumns()
&gt;&gt;&gt; vc.compact([
...     "RID",
...     "Name",
...     PseudoColumn(
...         source=[InboundFK("domain", "Sample_Subject_fkey"), "RID"],
...         aggregate=Aggregate.CNT,
...         markdown_name="Samples"
...     ),
... ])
</code></pre>
<p>Context inheritance (reference another context)::</p>
<pre><code>&gt;&gt;&gt; vc = VisibleColumns()
&gt;&gt;&gt; vc.compact(["RID", "Name"])
&gt;&gt;&gt; vc.set_context("compact/brief", "compact")  # Inherit from compact
</code></pre>
<p>With faceted search (filter context)::</p>
<pre><code>&gt;&gt;&gt; vc = VisibleColumns()
&gt;&gt;&gt; vc.compact(["RID", "Name", "Status"])
&gt;&gt;&gt; facets = FacetList()
&gt;&gt;&gt; facets.add(Facet(source="Status", open=True))
&gt;&gt;&gt; vc._contexts["filter"] = facets.to_dict()
</code></pre>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VisibleColumns</span><span class="p">(</span><span class="n">AnnotationBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible-columns annotation builder.</span>

<span class="sd">    Controls which columns appear in different UI contexts and their order.</span>
<span class="sd">    This is one of the most commonly used annotations for customizing the</span>
<span class="sd">    Chaise interface.</span>

<span class="sd">    Column entries can be:</span>
<span class="sd">    - Column names (strings): &quot;Name&quot;, &quot;RID&quot;, &quot;Description&quot;</span>
<span class="sd">    - Foreign key references: fk_constraint(&quot;schema&quot;, &quot;constraint_name&quot;)</span>
<span class="sd">    - Pseudo-columns: PseudoColumn(...) for computed/derived values</span>

<span class="sd">    Contexts:</span>
<span class="sd">    - ``compact``: Table/list views (search results, data browser)</span>
<span class="sd">    - ``detailed``: Single record view (full record page)</span>
<span class="sd">    - ``entry``: Create/edit forms</span>
<span class="sd">    - ``entry/create``: Create form only</span>
<span class="sd">    - ``entry/edit``: Edit form only</span>
<span class="sd">    - ``*``: Default for all contexts</span>

<span class="sd">    Example:</span>
<span class="sd">        Basic column lists for different contexts::</span>

<span class="sd">            &gt;&gt;&gt; vc = VisibleColumns()</span>
<span class="sd">            &gt;&gt;&gt; vc.compact([&quot;RID&quot;, &quot;Name&quot;, &quot;Status&quot;])</span>
<span class="sd">            &gt;&gt;&gt; vc.detailed([&quot;RID&quot;, &quot;Name&quot;, &quot;Status&quot;, &quot;Description&quot;, &quot;Created&quot;])</span>
<span class="sd">            &gt;&gt;&gt; vc.entry([&quot;Name&quot;, &quot;Status&quot;, &quot;Description&quot;])</span>
<span class="sd">            &gt;&gt;&gt; handle.set_annotation(vc)</span>

<span class="sd">        Method chaining::</span>

<span class="sd">            &gt;&gt;&gt; vc = (VisibleColumns()</span>
<span class="sd">            ...     .compact([&quot;RID&quot;, &quot;Name&quot;])</span>
<span class="sd">            ...     .detailed([&quot;RID&quot;, &quot;Name&quot;, &quot;Description&quot;])</span>
<span class="sd">            ...     .entry([&quot;Name&quot;, &quot;Description&quot;]))</span>

<span class="sd">        Including foreign key references::</span>

<span class="sd">            &gt;&gt;&gt; vc = VisibleColumns()</span>
<span class="sd">            &gt;&gt;&gt; vc.compact([</span>
<span class="sd">            ...     &quot;RID&quot;,</span>
<span class="sd">            ...     &quot;Name&quot;,</span>
<span class="sd">            ...     fk_constraint(&quot;domain&quot;, &quot;Subject_Species_fkey&quot;),</span>
<span class="sd">            ... ])</span>

<span class="sd">        With pseudo-columns for computed values::</span>

<span class="sd">            &gt;&gt;&gt; vc = VisibleColumns()</span>
<span class="sd">            &gt;&gt;&gt; vc.compact([</span>
<span class="sd">            ...     &quot;RID&quot;,</span>
<span class="sd">            ...     &quot;Name&quot;,</span>
<span class="sd">            ...     PseudoColumn(</span>
<span class="sd">            ...         source=[InboundFK(&quot;domain&quot;, &quot;Sample_Subject_fkey&quot;), &quot;RID&quot;],</span>
<span class="sd">            ...         aggregate=Aggregate.CNT,</span>
<span class="sd">            ...         markdown_name=&quot;Samples&quot;</span>
<span class="sd">            ...     ),</span>
<span class="sd">            ... ])</span>

<span class="sd">        Context inheritance (reference another context)::</span>

<span class="sd">            &gt;&gt;&gt; vc = VisibleColumns()</span>
<span class="sd">            &gt;&gt;&gt; vc.compact([&quot;RID&quot;, &quot;Name&quot;])</span>
<span class="sd">            &gt;&gt;&gt; vc.set_context(&quot;compact/brief&quot;, &quot;compact&quot;)  # Inherit from compact</span>

<span class="sd">        With faceted search (filter context)::</span>

<span class="sd">            &gt;&gt;&gt; vc = VisibleColumns()</span>
<span class="sd">            &gt;&gt;&gt; vc.compact([&quot;RID&quot;, &quot;Name&quot;, &quot;Status&quot;])</span>
<span class="sd">            &gt;&gt;&gt; facets = FacetList()</span>
<span class="sd">            &gt;&gt;&gt; facets.add(Facet(source=&quot;Status&quot;, open=True))</span>
<span class="sd">            &gt;&gt;&gt; vc._contexts[&quot;filter&quot;] = facets.to_dict()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_VISIBLE_COLUMNS</span>

    <span class="n">_contexts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set columns for a context.</span>

<span class="sd">        Args:</span>
<span class="sd">            context: Context name (e.g., &quot;compact&quot;, &quot;detailed&quot;, &quot;*&quot;)</span>
<span class="sd">            columns: List of columns, or string referencing another context</span>

<span class="sd">        Returns:</span>
<span class="sd">            Self for chaining</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set columns for compact (list) view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_COMPACT</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set columns for detailed (record) view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set columns for entry (create/edit) forms.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_ENTRY</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">entry_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set columns for create form only.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_ENTRY_CREATE</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">entry_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set columns for edit form only.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_ENTRY_EDIT</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set default columns for all contexts.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">columns</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">PseudoColumn</span><span class="p">)</span> <span class="k">else</span> <span class="n">c</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">columns</span>
                <span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.compact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">compact</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">compact</span><span class="p">(</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set columns for compact (list) view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set columns for compact (list) view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_COMPACT</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.default" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">default</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">default</span><span class="p">(</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set default columns for all contexts.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set default columns for all contexts.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.detailed" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">detailed</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">detailed</span><span class="p">(</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set columns for detailed (record) view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set columns for detailed (record) view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.entry" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">entry</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">entry</span><span class="p">(</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set columns for entry (create/edit) forms.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set columns for entry (create/edit) forms.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_ENTRY</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.entry_create" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">entry_create</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">entry_create</span><span class="p">(</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set columns for create form only.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">entry_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set columns for create form only.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_ENTRY_CREATE</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.entry_edit" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">entry_edit</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">entry_edit</span><span class="p">(</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set columns for edit form only.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">entry_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set columns for edit form only.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_ENTRY_EDIT</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleColumns.set_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_context</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_context</span><span class="p">(</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set columns for a context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Context name (e.g., "compact", "detailed", "*")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>columns</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="deriva_ml.model.annotations.ColumnEntry">ColumnEntry</span>] | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of columns, or string referencing another context</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>&#39;VisibleColumns&#39;</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Self for chaining</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">columns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ColumnEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleColumns&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set columns for a context.</span>

<span class="sd">    Args:</span>
<span class="sd">        context: Context name (e.g., &quot;compact&quot;, &quot;detailed&quot;, &quot;*&quot;)</span>
<span class="sd">        columns: List of columns, or string referencing another context</span>

<span class="sd">    Returns:</span>
<span class="sd">        Self for chaining</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="deriva_ml.model.VisibleForeignKeys" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">VisibleForeignKeys</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="deriva_ml.model.annotations.AnnotationBuilder">AnnotationBuilder</span></code></p>



        <p>Visible-foreign-keys annotation builder.</p>
<p>Controls which related tables appear in the UI via inbound foreign keys.</p>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>vfk = VisibleForeignKeys()
vfk.detailed([
...     fk_constraint("domain", "Image_Subject_fkey"),
...     fk_constraint("domain", "Diagnosis_Subject_fkey")
... ])</p>
</blockquote>
</blockquote>
</blockquote>
</details>







              <details class="mkdocstrings-source">
                <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VisibleForeignKeys</span><span class="p">(</span><span class="n">AnnotationBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible-foreign-keys annotation builder.</span>

<span class="sd">    Controls which related tables appear in the UI via inbound foreign keys.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; vfk = VisibleForeignKeys()</span>
<span class="sd">        &gt;&gt;&gt; vfk.detailed([</span>
<span class="sd">        ...     fk_constraint(&quot;domain&quot;, &quot;Image_Subject_fkey&quot;),</span>
<span class="sd">        ...     fk_constraint(&quot;domain&quot;, &quot;Diagnosis_Subject_fkey&quot;)</span>
<span class="sd">        ... ])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_VISIBLE_FOREIGN_KEYS</span>

    <span class="n">_contexts</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set foreign keys for a context.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">foreign_keys</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set foreign keys for detailed view.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set default foreign keys for all contexts.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">context</span><span class="p">,</span> <span class="n">fkeys</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fkeys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">fkeys</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">fk</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fk</span><span class="p">,</span> <span class="n">PseudoColumn</span><span class="p">)</span> <span class="k">else</span> <span class="n">fk</span>
                    <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="n">fkeys</span>
                <span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleForeignKeys.default" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">default</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">default</span><span class="p">(</span>
    <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set default foreign keys for all contexts.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set default foreign keys for all contexts.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DEFAULT</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleForeignKeys.detailed" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">detailed</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">detailed</span><span class="p">(</span>
    <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set foreign keys for detailed view.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detailed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set foreign keys for detailed view.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">CONTEXT_DETAILED</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="deriva_ml.model.VisibleForeignKeys.set_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set_context</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_context</span><span class="p">(</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">]</span>
    <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set foreign keys for a context.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_context</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">foreign_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ForeignKeyEntry</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;VisibleForeignKeys&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set foreign keys for a context.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_contexts</span><span class="p">[</span><span class="n">context</span><span class="p">]</span> <span class="o">=</span> <span class="n">foreign_keys</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="deriva_ml.model.__getattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__getattr__</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Lazy import for DatabaseModel and DerivaMLDatabase.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lazy import for DatabaseModel and DerivaMLDatabase.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;DatabaseModel&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.model.database</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseModel</span>

        <span class="k">return</span> <span class="n">DatabaseModel</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;DerivaMLDatabase&quot;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">deriva_ml.model.deriva_ml_database</span><span class="w"> </span><span class="kn">import</span> <span class="n">DerivaMLDatabase</span>

        <span class="k">return</span> <span class="n">DerivaMLDatabase</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;module </span><span class="si">{</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> has no attribute </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="deriva_ml.model.fk_constraint" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fk_constraint</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fk_constraint</span><span class="p">(</span>
    <span class="n">schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a foreign key constraint reference for visible-columns.</p>
<p>Use this in visible-columns to include a foreign key column (showing the
referenced row's name/link). This is different from InboundFK/OutboundFK
which are used inside PseudoColumn source paths.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Schema name containing the FK constraint</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Foreign key constraint name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[schema, constraint] list for use in visible-columns</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <p>Include a foreign key in visible columns::</p>
<pre><code>&gt;&gt;&gt; vc = VisibleColumns()
&gt;&gt;&gt; vc.compact([
...     "RID",
...     "Name",
...     fk_constraint("domain", "Subject_Species_fkey"),  # Shows Species
... ])
</code></pre>
<p>This is equivalent to the raw format::</p>
<pre><code>&gt;&gt;&gt; vc.compact(["RID", "Name", ["domain", "Subject_Species_fkey"]])
</code></pre>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>src/deriva_ml/model/annotations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fk_constraint</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a foreign key constraint reference for visible-columns.</span>

<span class="sd">    Use this in visible-columns to include a foreign key column (showing the</span>
<span class="sd">    referenced row&#39;s name/link). This is different from InboundFK/OutboundFK</span>
<span class="sd">    which are used inside PseudoColumn source paths.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema: Schema name containing the FK constraint</span>
<span class="sd">        constraint: Foreign key constraint name</span>

<span class="sd">    Returns:</span>
<span class="sd">        [schema, constraint] list for use in visible-columns</span>

<span class="sd">    Example:</span>
<span class="sd">        Include a foreign key in visible columns::</span>

<span class="sd">            &gt;&gt;&gt; vc = VisibleColumns()</span>
<span class="sd">            &gt;&gt;&gt; vc.compact([</span>
<span class="sd">            ...     &quot;RID&quot;,</span>
<span class="sd">            ...     &quot;Name&quot;,</span>
<span class="sd">            ...     fk_constraint(&quot;domain&quot;, &quot;Subject_Species_fkey&quot;),  # Shows Species</span>
<span class="sd">            ... ])</span>

<span class="sd">        This is equivalent to the raw format::</span>

<span class="sd">            &gt;&gt;&gt; vc.compact([&quot;RID&quot;, &quot;Name&quot;, [&quot;domain&quot;, &quot;Subject_Species_fkey&quot;]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">schema</span><span class="p">,</span> <span class="n">constraint</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../deriva_ml_base/" class="md-footer__link md-footer__link--prev" aria-label="Previous: DerivaML">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                DerivaML
              </div>
            </div>
          </a>
        
        
          
          <a href="../dataset/" class="md-footer__link md-footer__link--next" aria-label="Next: Dataset">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Dataset
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.footer"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>